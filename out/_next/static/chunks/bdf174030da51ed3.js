(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,740452,e=>{"use strict";e.s([],897631),e.i(897631),e.s([],598229),e.i(598229);var t=e.i(813704),s=e.i(996789),o=e.i(491513),r=e.i(694372),i=e.i(676187),n=e.i(953855),a=e.i(771005);class c{constructor(e){this.getNonce=e.getNonce}async createMessage(e){let t={accountAddress:e.accountAddress,chainId:e.chainId,version:"1",domain:"u"<typeof document?"Unknown Domain":document.location.host,uri:"u"<typeof document?"Unknown URI":document.location.href,resources:this.resources,nonce:await this.getNonce(e),issuedAt:this.stringifyDate(new Date),statement:void 0,expirationTime:void 0,notBefore:void 0};return Object.assign(t,{toString:()=>this.stringify(t)})}stringify(e){let t=this.getNetworkName(e.chainId);return[`${e.domain} wants you to sign in with your ${t} account:`,e.accountAddress,e.statement?`
${e.statement}
`:"",`URI: ${e.uri}`,`Version: ${e.version}`,`Chain ID: ${e.chainId}`,`Nonce: ${e.nonce}`,e.issuedAt&&`Issued At: ${e.issuedAt}`,e.expirationTime&&`Expiration Time: ${e.expirationTime}`,e.notBefore&&`Not Before: ${e.notBefore}`,e.requestId&&`Request ID: ${e.requestId}`,e.resources?.length&&e.resources.reduce((e,t)=>`${e}
- ${t}`,"Resources:")].filter(e=>"string"==typeof e).join("\n").trim()}getNetworkName(e){let t=i.ChainController.getAllRequestedCaipNetworks();return a.NetworkUtil.getNetworkNameByCaipNetworkId(t,e)}stringifyDate(e){return e.toISOString()}}e.s(["ReownAuthenticationMessenger",()=>c],841439);class h{constructor(e={}){this.otpUuid=null,this.listeners={sessionChanged:[]},this.localAuthStorageKey=e.localAuthStorageKey||s.SafeLocalStorageKeys.SIWX_AUTH_TOKEN,this.localNonceStorageKey=e.localNonceStorageKey||s.SafeLocalStorageKeys.SIWX_NONCE_TOKEN,this.required=e.required??!0,this.messenger=new c({getNonce:this.getNonce.bind(this)})}async createMessage(e){return this.messenger.createMessage(e)}async addSession(e){let t=await this.request({method:"POST",key:"authenticate",body:{data:e.data,message:e.message,signature:e.signature,clientId:this.getClientId(),walletInfo:this.getWalletInfo()},headers:["nonce","otp"]});this.setStorageToken(t.token,this.localAuthStorageKey),this.emit("sessionChanged",e),this.setAppKitAccountUser(function(e){let t=e.split(".");if(3!==t.length)throw Error("Invalid token");let s=t[1];if("string"!=typeof s)throw Error("Invalid token");let o=s.replace(/-/gu,"+").replace(/_/gu,"/");return JSON.parse(atob(o.padEnd(o.length+(4-o.length%4)%4,"=")))}(t.token)),this.otpUuid=null}async getSessions(e,t){try{if(!this.getStorageToken(this.localAuthStorageKey))return[];let s=await this.request({method:"GET",key:"me",query:{},headers:["auth"]});if(!s)return[];let o=s.address.toLowerCase()===t.toLowerCase(),r=s.caip2Network===e;if(!o||!r)return[];let i={data:{accountAddress:s.address,chainId:s.caip2Network},message:"",signature:""};return this.emit("sessionChanged",i),this.setAppKitAccountUser(s),[i]}catch{return[]}}async revokeSession(e,t){return Promise.resolve(this.clearStorageTokens())}async setSessions(e){if(0===e.length)this.clearStorageTokens();else{let t=e.find(e=>e.data.chainId===(0,n.getActiveCaipNetwork)()?.caipNetworkId)||e[0];await this.addSession(t)}}getRequired(){return this.required}async getSessionAccount(){if(!this.getStorageToken(this.localAuthStorageKey))throw Error("Not authenticated");return this.request({method:"GET",key:"me",body:void 0,query:{includeAppKitAccount:!0},headers:["auth"]})}async setSessionAccountMetadata(e=null){if(!this.getStorageToken(this.localAuthStorageKey))throw Error("Not authenticated");return this.request({method:"PUT",key:"account-metadata",body:{metadata:e},headers:["auth"]})}on(e,t){return this.listeners[e].push(t),()=>{this.listeners[e]=this.listeners[e].filter(e=>e!==t)}}removeAllListeners(){Object.keys(this.listeners).forEach(e=>{this.listeners[e]=[]})}async requestEmailOtp({email:e,account:t}){let s=await this.request({method:"POST",key:"otp",body:{email:e,account:t}});return this.otpUuid=s.uuid,this.messenger.resources=[`email:${e}`],s}confirmEmailOtp({code:e}){return this.request({method:"PUT",key:"otp",body:{code:e},headers:["otp"]})}async request({method:e,key:s,query:o,body:r,headers:i}){let{projectId:n,st:a,sv:c}=this.getSDKProperties(),h=new URL(`${t.ConstantsUtil.W3M_API_URL}/auth/v1/${String(s)}`);h.searchParams.set("projectId",n),h.searchParams.set("st",a),h.searchParams.set("sv",c),o&&Object.entries(o).forEach(([e,t])=>h.searchParams.set(e,String(t)));let u=await fetch(h,{method:e,body:r?JSON.stringify(r):void 0,headers:Array.isArray(i)?i.reduce((e,t)=>{switch(t){case"nonce":e["x-nonce-jwt"]=`Bearer ${this.getStorageToken(this.localNonceStorageKey)}`;break;case"auth":e.Authorization=`Bearer ${this.getStorageToken(this.localAuthStorageKey)}`;break;case"otp":this.otpUuid&&(e["x-otp"]=this.otpUuid)}return e},{}):void 0});if(!u.ok)throw Error(await u.text());return u.headers.get("content-type")?.includes("application/json")?u.json():null}getStorageToken(e){return s.SafeLocalStorage.getItem(e)}setStorageToken(e,t){s.SafeLocalStorage.setItem(t,e)}clearStorageTokens(){this.otpUuid=null,s.SafeLocalStorage.removeItem(this.localAuthStorageKey),s.SafeLocalStorage.removeItem(this.localNonceStorageKey),this.emit("sessionChanged",void 0)}async getNonce(){let{nonce:e,token:t}=await this.request({method:"GET",key:"nonce"});return this.setStorageToken(t,this.localNonceStorageKey),e}getClientId(){return r.BlockchainApiController.state.clientId}getWalletInfo(){let e=i.ChainController.getAccountData()?.connectedWalletInfo;if(!e)return;if("social"in e&&"identifier"in e)return{type:"social",social:e.social,identifier:e.identifier};let{name:t,icon:s}=e,o="unknown";switch(e.type){case"EXTERNAL":case"INJECTED":case"ANNOUNCED":o="extension";break;case"WALLET_CONNECT":o="walletconnect";break;default:o="unknown"}return{type:o,name:t,icon:s}}getSDKProperties(){return o.ApiController._getSdkProperties()}emit(e,t){this.listeners[e].forEach(e=>e(t))}setAppKitAccountUser(e){let{email:s}=e;s&&Object.values(t.ConstantsUtil.CHAIN).forEach(e=>{i.ChainController.setAccountProp("user",{email:s},e)})}}e.s(["ReownAuthentication",()=>h],94254),e.i(94254),e.i(841439),e.s(["ReownAuthentication",()=>h,"ReownAuthenticationMessenger",()=>c],799390),e.i(799390),e.s(["ReownAuthentication",()=>h,"ReownAuthenticationMessenger",()=>c],740452)}]);