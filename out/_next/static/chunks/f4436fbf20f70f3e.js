(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,40841,568873,63437,521446,854301,39793,491894,147494,905533,417263,420746,627617,706882,511115,312067,e=>{"use strict";let t={path:"/api/v1/apps/:app_id/smart_wallets",method:"GET"};class r{getConfig(){return this._privyInternal.config}async getSmartWalletConfig(){return this._smartWalletConfig||(this._smartWalletConfig=await this._privyInternal.fetch(t,{params:{app_id:this.appId}})),this._smartWalletConfig}get appId(){return this._privyInternal.appId}constructor(e){this._privyInternal=e}}e.s(["default",()=>r],40841);let i={path:"/api/v1/apps/:app_id/cross-app/connections",method:"GET"},n=crypto;e.s(["default",0,n,"isCryptoKey",0,e=>e instanceof CryptoKey],568873);let s=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await n.subtle.digest(r,t))};e.s(["default",0,s],63437);let a=new TextEncoder,o=new TextDecoder;function l(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t}function c(e,t){return l(a.encode(e),new Uint8Array([0]),t)}function d(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function u(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return d(r,t,0),d(r,e%0x100000000,4),r}function h(e){let t=new Uint8Array(4);return d(t,e),t}function p(e){return l(h(e.length),e)}async function f(e,t,r){let i=Math.ceil((t>>3)/32),n=new Uint8Array(32*i);for(let t=0;t<i;t++){let i=new Uint8Array(4+e.length+r.length);i.set(h(t+1)),i.set(e,4),i.set(r,4+e.length),n.set(await s("sha256",i),32*t)}return n.slice(0,t>>3)}e.s(["concat",()=>l,"concatKdf",()=>f,"decoder",0,o,"encoder",0,a,"lengthAndInput",()=>p,"p2s",()=>c,"uint32be",()=>h,"uint64be",()=>u],521446);let y=e=>{let t=e;"string"==typeof t&&(t=a.encode(t));let r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))},g=e=>y(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),m=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},w=e=>{let t=e;t instanceof Uint8Array&&(t=o.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return m(t)}catch(e){throw TypeError("The input to be decoded is not correctly encoded.")}};function v(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}e.s(["decode",0,w,"decodeBase64",0,m,"encode",0,g,"encodeBase64",0,y],854301),e.s(["decode",0,w,"encode",0,g],39793),e.s(["default",()=>v],491894);class b extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null==(t=Error.captureStackTrace)||t.call(Error,this,this.constructor)}}class _ extends b{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class E extends b{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}}class I extends b{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class A extends b{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class S extends b{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class k extends b{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class T extends b{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class C extends b{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class x extends b{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class P extends b{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class O extends b{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class R extends b{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class N extends b{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class M extends b{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class U extends b{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}function D(e){let t,r;if("string"!=typeof e)throw new x("JWTs must use Compact JWS serialization, JWT must be a string");let{1:i,length:n}=e.split(".");if(5===n)throw new x("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new x("Invalid JWT");if(!i)throw new x("JWTs must contain a payload");try{t=w(i)}catch(e){throw new x("Failed to base64url decode the payload")}try{r=JSON.parse(o.decode(t))}catch(e){throw new x("Failed to parse the decoded payload as JSON")}if(!v(r))throw new x("Invalid JWT Claims Set");return r}e.s(["JOSEAlgNotAllowed",()=>I,"JOSEError",()=>b,"JOSENotSupported",()=>A,"JWEDecompressionFailed",()=>k,"JWEDecryptionFailed",()=>S,"JWEInvalid",()=>T,"JWKInvalid",()=>P,"JWKSInvalid",()=>O,"JWKSMultipleMatchingKeys",()=>N,"JWKSNoMatchingKey",()=>R,"JWKSTimeout",()=>M,"JWSInvalid",()=>C,"JWSSignatureVerificationFailed",()=>U,"JWTClaimValidationFailed",()=>_,"JWTExpired",()=>E,"JWTInvalid",()=>x],147494),e.s(["decodeJwt",()=>D],905533);class L{static parse(e){try{return new L(e)}catch(e){return null}}get subject(){return this._decoded.sub}get expiration(){return this._decoded.exp}get issuer(){return this._decoded.iss}get audience(){return this._decoded.aud}isExpired(e=0){return Date.now()>=1e3*(this.expiration-e)}constructor(e){this.value=e,this._decoded=D(e)}}e.s(["Token",()=>L],417263);class j{async updateOnCrossAppAuthentication(e,t){let r=t.access_token,i=j.providerAccessTokenStorageKey(e);await this._storage.put(i,r)}async getProviderAccessToken(e){let t=j.providerAccessTokenStorageKey(e),r=await this._storage.get(t);if("string"!=typeof r)return null;try{if(new L(r).isExpired())throw Error("JWT is expired");return r}catch{return await this._storage.del(t),null}}async getCrossAppConnections(){return await this._privyInternal.fetch(i,{params:{app_id:this._privyInternal.appId}})}constructor(e,t){this._privyInternal=e,this._storage=t}}j.providerAccessTokenStorageKey=e=>`privy:cross-app:${e}`,e.s(["default",()=>j],420746);var W=e.i(564137);class B{async revoke(){await this._privyInternal.fetch(W.WalletsRevoke,{})}constructor(e){this._privyInternal=e}}e.s(["default",()=>B],627617);var F=e.i(982989);let q=e=>!!e.id&&"privy-v2"===e.recovery_method;e.s(["isUnifiedWallet",()=>q],706882);class H{async sign({message:e}){return await this.request({method:"sign",params:{message:new TextDecoder("utf8").decode(e)}})}async signTransaction({psbt:e}){return await this.request({method:"signTransaction",params:{psbt:e}})}async request(e){if(q(this._account))throw new F.PrivyClientError({code:"unsupported_wallet_type",error:"Bitcoin wallet providers are only supported for on-device execution and this app uses TEE execution. Use the useSignRawHash hook from @privy-io/expo/extended-chains to sign over a hash with this wallet. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide"});if(!await this._privyInternal.getAccessTokenInternal())throw new F.PrivyClientError({error:"Missing access token",code:"attempted_rpc_call_before_logged_in"});return this.handleIFrameRpc(e)}async handleIFrameRpc(e){try{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw Error("Missing access token. User must be authenticated.");return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_started",{method:e.method,address:this._account.address}),(await this._proxy.rpcWallet({accessToken:t,request:e,entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,hdWalletIndex:this._account.wallet_index,chainType:this._account.chain_type})).response.data}catch(r){console.error(r);let t=r instanceof Error?r.message:"Unable to make wallet request";throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_failed",{method:e.method,address:this._account.address,error:t}),new F.PrivyClientError({code:"embedded_wallet_request_error",error:t})}}toJSON(){return`PrivyEmbeddedBitcoinProvider { address: '${this._account.address}', request: [Function] }`}constructor({proxy:e,privyInternal:t,account:r,entropyId:i,entropyIdVerifier:n}){this._proxy=e,this._privyInternal=t,this._account=r,this._entropyId=i,this._entropyIdVerifier=n}}e.s(["EmbeddedBitcoinWalletProvider",()=>H],511115);var z=e.i(308058);async function $({context:e,chainType:t,idempotencyKey:r}){return{wallet:await (0,z.create)(e,{request:{chain_type:t,owner_id:void 0},headers:r?{"privy-idempotency-key":r}:void 0})}}e.s(["walletCreate",()=>$],312067)},210052,e=>{"use strict";var t=e.i(522081),r=e.i(399678),i=e.i(589774);let n=(e,n,a,o)=>{let l=Number(e),c=n.find(e=>e.id===l);if(!c)throw new i.PrivyConnectorError(`Unsupported chainId ${e}`,4901);return(0,t.createPublicClient)({transport:(0,r.http)(s(c,a,o.appId)),chain:c})},s=(e,t,r)=>{let n,s=e.id,a=Number(e.id);if(e.rpcUrls.privyWalletOverride&&e.rpcUrls.privyWalletOverride.http[0])n=e.rpcUrls.privyWalletOverride.http[0];else if(t.rpcUrls&&t.rpcUrls[a])n=t.rpcUrls[a];else if(e.rpcUrls.privy?.http[0]){let t=new URL(e.rpcUrls.privy.http[0]);t.searchParams.append("privyAppId",r),n=t.toString()}else n=e.rpcUrls.public?.http[0]?e.rpcUrls.public.http[0]:e.rpcUrls.default?.http[0];if(!n)throw new i.PrivyConnectorError(`No RPC url found for ${s}`);return n};function a({currentRecoveryMethod:e,upgradeToRecoveryMethod:t}){switch(e){case"privy":case"user-passcode":case"recovery-encryption-key":return!0;case"icloud":case"google-drive":if(e===t)throw Error("Cannot upgrade to the existing cloud platform");return!0;default:throw Error("Unknown recovery method")}}e.s(["getJsonRpcEndpointFromChain",()=>s,"getPublicClient",()=>n,"throwIfInvalidRecoveryUpgradePath",()=>a])},507686,(e,t,r)=>{e.e,t.exports=function(){"use strict";function e(e){return Number.isInteger(e)&&e>=0}function t(e){this.name="ArgumentError",this.message=e}return function(r,i){if(i=i||{},"function"!=typeof r)throw new t("fetch must be a function");if("object"!=typeof i)throw new t("defaults must be an object");if(void 0!==i.retries&&!e(i.retries))throw new t("retries must be a positive integer");if(void 0!==i.retryDelay&&!e(i.retryDelay)&&"function"!=typeof i.retryDelay)throw new t("retryDelay must be a positive integer or a function returning a positive integer");if(void 0!==i.retryOn&&!Array.isArray(i.retryOn)&&"function"!=typeof i.retryOn)throw new t("retryOn property expects an array or function");return i=Object.assign({retries:3,retryDelay:1e3,retryOn:[]},i),function(n,s){var a=i.retries,o=i.retryDelay,l=i.retryOn;if(s&&void 0!==s.retries)if(e(s.retries))a=s.retries;else throw new t("retries must be a positive integer");if(s&&void 0!==s.retryDelay)if(e(s.retryDelay)||"function"==typeof s.retryDelay)o=s.retryDelay;else throw new t("retryDelay must be a positive integer or a function returning a positive integer");if(s&&s.retryOn)if(Array.isArray(s.retryOn)||"function"==typeof s.retryOn)l=s.retryOn;else throw new t("retryOn property expects an array or function");return new Promise(function(e,t){var i=function(i){r("u">typeof Request&&n instanceof Request?n.clone():n,s).then(function(r){if(Array.isArray(l)&&-1===l.indexOf(r.status))e(r);else if("function"==typeof l)try{return Promise.resolve(l(i,null,r)).then(function(t){t?c(i,null,r):e(r)}).catch(t)}catch(e){t(e)}else i<a?c(i,null,r):e(r)}).catch(function(e){if("function"==typeof l)try{Promise.resolve(l(i,e,null)).then(function(r){r?c(i,e,null):t(e)}).catch(function(e){t(e)})}catch(e){t(e)}else i<a?c(i,e,null):t(e)})};function c(e,t,r){setTimeout(function(){i(++e)},"function"==typeof o?o(e,t,r):o)}i(0)})}}}()},612964,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toBig=r.shrSL=r.shrSH=r.rotrSL=r.rotrSH=r.rotrBL=r.rotrBH=r.rotr32L=r.rotr32H=r.rotlSL=r.rotlSH=r.rotlBL=r.rotlBH=r.add5L=r.add5H=r.add4L=r.add4H=r.add3L=r.add3H=void 0,r.add=b,r.fromBig=s,r.split=a;let i=BigInt(0x100000000-1),n=BigInt(32);function s(e,t=!1){return t?{h:Number(e&i),l:Number(e>>n&i)}:{h:0|Number(e>>n&i),l:0|Number(e&i)}}function a(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let a=0;a<r;a++){let{h:r,l:o}=s(e[a],t);[i[a],n[a]]=[r,o]}return[i,n]}let o=(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0);r.toBig=o;let l=(e,t,r)=>e>>>r;r.shrSH=l;let c=(e,t,r)=>e<<32-r|t>>>r;r.shrSL=c;let d=(e,t,r)=>e>>>r|t<<32-r;r.rotrSH=d;let u=(e,t,r)=>e<<32-r|t>>>r;r.rotrSL=u;let h=(e,t,r)=>e<<64-r|t>>>r-32;r.rotrBH=h;let p=(e,t,r)=>e>>>r-32|t<<64-r;r.rotrBL=p;let f=(e,t)=>t;r.rotr32H=f;let y=(e,t)=>e;r.rotr32L=y;let g=(e,t,r)=>e<<r|t>>>32-r;r.rotlSH=g;let m=(e,t,r)=>t<<r|e>>>32-r;r.rotlSL=m;let w=(e,t,r)=>t<<r-32|e>>>64-r;r.rotlBH=w;let v=(e,t,r)=>e<<r-32|t>>>64-r;function b(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}r.rotlBL=v;let _=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);r.add3L=_;let E=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0;r.add3H=E;let I=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0);r.add4L=I;let A=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0;r.add4H=A;let S=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0);r.add5L=S;let k=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0;r.add5H=k,r.default={fromBig:s,split:a,toBig:o,shrSH:l,shrSL:c,rotrSH:d,rotrSL:u,rotrBH:h,rotrBL:p,rotr32H:f,rotr32L:y,rotlSH:g,rotlSL:m,rotlBH:w,rotlBL:v,add:b,add3L:_,add3H:E,add4L:I,add4H:A,add5H:k,add5L:S}},94870,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.crypto=void 0,r.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0},135872,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.Hash=r.nextTick=r.swap32IfBE=r.byteSwapIfBE=r.swap8IfBE=r.isLE=void 0,r.isBytes=n,r.anumber=s,r.abytes=a,r.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");s(e.outputLen),s(e.blockLen)},r.aexists=function(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")},r.aoutput=function(e,t){a(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)},r.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},r.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},r.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},r.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},r.rotr=function(e,t){return e<<32-t|e>>>t},r.rotl=function(e,t){return e<<t|e>>>32-t>>>0},r.byteSwap=o,r.byteSwap32=l,r.bytesToHex=function(e){if(a(e),c)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=d[e[r]];return t},r.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(c)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=u(e.charCodeAt(n)),s=u(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i},r.asyncLoop=h,r.utf8ToBytes=p,r.bytesToUtf8=function(e){return new TextDecoder().decode(e)},r.toBytes=f,r.kdfInputToBytes=function(e){return"string"==typeof e&&(e=p(e)),a(e),e},r.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];a(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r},r.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options should be object or undefined");return Object.assign(e,t)},r.createHasher=y,r.createOptHasher=g,r.createXOFer=m,r.randomBytes=function(e=32){if(i.crypto&&"function"==typeof i.crypto.getRandomValues)return i.crypto.getRandomValues(new Uint8Array(e));if(i.crypto&&"function"==typeof i.crypto.randomBytes)return Uint8Array.from(i.crypto.randomBytes(e));throw Error("crypto.getRandomValues must be defined")};let i=e.r(94870);function n(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function s(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function a(e,...t){if(!n(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function o(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}function l(e){for(let t=0;t<e.length;t++)e[t]=o(e[t]);return e}r.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],r.swap8IfBE=r.isLE?e=>e:e=>o(e),r.byteSwapIfBE=r.swap8IfBE,r.swap32IfBE=r.isLE?e=>e:l;let c="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,d=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function u(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}async function h(e,t,i){let n=Date.now();for(let s=0;s<e;s++){i(s);let e=Date.now()-n;e>=0&&e<t||(await (0,r.nextTick)(),n+=e)}}function p(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function f(e){return"string"==typeof e&&(e=p(e)),a(e),e}function y(e){let t=t=>e().update(f(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function g(e){let t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function m(e){let t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}r.nextTick=async()=>{},r.Hash=class{},r.wrapConstructor=y,r.wrapConstructorWithOpts=g,r.wrapXOFConstructorWithOpts=m},206492,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shake256=r.shake128=r.keccak_512=r.keccak_384=r.keccak_256=r.keccak_224=r.sha3_512=r.sha3_384=r.sha3_256=r.sha3_224=r.Keccak=void 0,r.keccakP=v;let i=e.r(612964),n=e.r(135872),s=BigInt(0),a=BigInt(1),o=BigInt(2),l=BigInt(7),c=BigInt(256),d=BigInt(113),u=[],h=[],p=[];for(let e=0,t=a,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],u.push(2*(5*i+r)),h.push((e+1)*(e+2)/2%64);let n=s;for(let e=0;e<7;e++)(t=(t<<a^(t>>l)*d)%c)&o&&(n^=a<<(a<<BigInt(e))-a);p.push(n)}let f=(0,i.split)(p,!0),y=f[0],g=f[1],m=(e,t,r)=>r>32?(0,i.rotlBH)(e,t,r):(0,i.rotlSH)(e,t,r),w=(e,t,r)=>r>32?(0,i.rotlBL)(e,t,r):(0,i.rotlSL)(e,t,r);function v(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=m(s,a,1)^r[i],l=w(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=h[r],s=m(t,n,i),a=w(t,n,i),o=u[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=y[i],e[1]^=g[i]}(0,n.clean)(r)}class b extends n.Hash{constructor(e,t,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,(0,n.anumber)(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,n.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,n.swap32IfBE)(this.state32),v(this.state32,this.rounds),(0,n.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(e){(0,n.aexists)(this),e=(0,n.toBytes)(e),(0,n.abytes)(e);let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,n.aexists)(this,!1),(0,n.abytes)(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,n.anumber)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,n.aoutput)(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,n.clean)(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new b(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}r.Keccak=b;let _=(e,t,r)=>(0,n.createHasher)(()=>new b(t,e,r));r.sha3_224=_(6,144,28),r.sha3_256=_(6,136,32),r.sha3_384=_(6,104,48),r.sha3_512=_(6,72,64),r.keccak_224=_(1,144,28),r.keccak_256=_(1,136,32),r.keccak_384=_(1,104,48),r.keccak_512=_(1,72,64);let E=(e,t,r)=>(0,n.createXOFer)((i={})=>new b(t,e,void 0===i.dkLen?r:i.dkLen,!0));r.shake128=E(31,168,16),r.shake256=E(31,136,32)},172130,(e,t,r)=>{var i=e.i(498921);let{keccak_256:n}=e.r(206492);function s(e){return i.Buffer.allocUnsafe(e).fill(0)}function a(e,t){let r=e.toString(16);r.length%2!=0&&(r="0"+r);let n=r.match(/.{1,2}/g).map(e=>parseInt(e,16));for(;n.length<t;)n.unshift(0);return i.Buffer.from(n)}function o(e,t,r){let i=s(t);return(e=l(e),r)?e.length<t?(e.copy(i),i):e.slice(0,t):e.length<t?(e.copy(i,t-e.length),i):e.slice(-t)}function l(e){if(!i.Buffer.isBuffer(e))if(Array.isArray(e))e=i.Buffer.from(e);else if("string"==typeof e){var t;e=c(e)?i.Buffer.from((t=d(e)).length%2?"0"+t:t,"hex"):i.Buffer.from(e)}else if("number"==typeof e)e=intToBuffer(e);else if(null==e)e=i.Buffer.allocUnsafe(0);else if("bigint"==typeof e)e=a(e);else if(e.toArray)e=i.Buffer.from(e.toArray());else throw Error("invalid type");return e}function c(e){return"string"==typeof e&&e.match(/^0x[0-9A-Fa-f]*$/)}function d(e){return"string"==typeof e&&e.startsWith("0x")?e.slice(2):e}t.exports={zeros:s,setLength:o,setLengthRight:function(e,t){return o(e,t,!0)},isHexString:c,stripHexPrefix:d,toBuffer:l,bufferToHex:function(e){return"0x"+(e=l(e)).toString("hex")},keccak:function(e,t){if(e=l(e),t||(t=256),256!==t)throw Error("unsupported");return i.Buffer.from(n(new Uint8Array(e)))},bitLengthFromBigInt:function(e){return e.toString(2).length},bufferBEFromBigInt:a,twosFromBigInt:function(e,t){return(e<0n?(~e&(1n<<BigInt(t))-1n)+1n:e)&(1n<<BigInt(t))-1n}}},637950,(e,t,r)=>{var i=e.i(498921);let n=e.r(172130);function s(e){if(e.startsWith("int["))return"int256"+e.slice(3);if("int"===e)return"int256";if(e.startsWith("uint["))return"uint256"+e.slice(4);if("uint"===e)return"uint256";if(e.startsWith("fixed["))return"fixed128x128"+e.slice(5);else if("fixed"===e)return"fixed128x128";else if(e.startsWith("ufixed["))return"ufixed128x128"+e.slice(6);else if("ufixed"===e)return"ufixed128x128";return e}function a(e){return Number.parseInt(/^\D+(\d+)$/.exec(e)[1],10)}function o(e){var t=/^\D+(\d+)x(\d+)$/.exec(e);return[Number.parseInt(t[1],10),Number.parseInt(t[2],10)]}function l(e){var t=e.match(/(.*)\[(.*?)\]$/);return t?""===t[2]?"dynamic":Number.parseInt(t[2],10):null}function c(e){var t=typeof e;if("string"===t||"number"===t)return BigInt(e);if("bigint"===t)return e;throw Error("Argument is not a number")}function d(e,t){if("address"===e)return d("uint160",c(t));if("bool"===e)return d("uint8",+!!t);if("string"===e)return d("bytes",new i.Buffer(t,"utf8"));if((p=e).lastIndexOf("]")===p.length-1){if(void 0===t.length)throw Error("Not an array?");if("dynamic"!==(r=l(e))&&0!==r&&t.length>r)throw Error("Elements exceed array size: "+r);for(h in u=[],e=e.slice(0,e.lastIndexOf("[")),"string"==typeof t&&(t=JSON.parse(t)),t)u.push(d(e,t[h]));if("dynamic"===r){var r,s,u,h,p,f=d("uint256",t.length);u.unshift(f)}return i.Buffer.concat(u)}else if("bytes"===e)return t=new i.Buffer(t),u=i.Buffer.concat([d("uint256",t.length),t]),t.length%32!=0&&(u=i.Buffer.concat([u,n.zeros(32-t.length%32)])),u;else if(e.startsWith("bytes")){if((r=a(e))<1||r>32)throw Error("Invalid bytes<N> width: "+r);return n.setLengthRight(t,32)}else if(e.startsWith("uint")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied uint exceeds width: "+r+" vs "+i);if(s<0)throw Error("Supplied uint is negative");return n.bufferBEFromBigInt(s,32)}else if(e.startsWith("int")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied int exceeds width: "+r+" vs "+i);let o=n.twosFromBigInt(s,256);return n.bufferBEFromBigInt(o,32)}else if(e.startsWith("ufixed")){if(r=o(e),(s=c(t))<0)throw Error("Supplied ufixed is negative");return d("uint256",s*BigInt(2)**BigInt(r[1]))}else if(e.startsWith("fixed"))return r=o(e),d("int256",c(t)*BigInt(2)**BigInt(r[1]));throw Error("Unsupported or invalid type: "+e)}function u(e,t){if(e.length!==t.length)throw Error("Number of types are not matching the values");for(var r,o,l=[],d=0;d<e.length;d++){var u=s(e[d]),h=t[d];if("bytes"===u)l.push(h);else if("string"===u)l.push(new i.Buffer(h,"utf8"));else if("bool"===u)l.push(new i.Buffer(h?"01":"00","hex"));else if("address"===u)l.push(n.setLength(h,20));else if(u.startsWith("bytes")){if((r=a(u))<1||r>32)throw Error("Invalid bytes<N> width: "+r);l.push(n.setLengthRight(h,r))}else if(u.startsWith("uint")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied uint exceeds width: "+r+" vs "+e);l.push(n.bufferBEFromBigInt(o,r/8))}else if(u.startsWith("int")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied int exceeds width: "+r+" vs "+e);let t=n.twosFromBigInt(o,r);l.push(n.bufferBEFromBigInt(t,r/8))}else throw Error("Unsupported or invalid type: "+u)}return i.Buffer.concat(l)}t.exports={rawEncode:function(e,t){var r=[],n=[],a=32*e.length;for(var o in e){var c=s(e[o]),u=d(c,t[o]);"string"===c||"bytes"===c||"dynamic"===l(c)?(r.push(d("uint256",a)),n.push(u),a+=u.length):r.push(u)}return i.Buffer.concat(r.concat(n))},solidityPack:u,soliditySHA3:function(e,t){return n.keccak(u(e,t))}}},620446,(e,t,r)=>{var i=e.i(498921);let n=e.r(172130),s=e.r(637950),a={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},o={encodeData(e,t,r,a=!0){let o=["bytes32"],l=[this.hashType(e,r)];if(a){let c=(e,t,o)=>{if(void 0!==r[t])return["bytes32",null==o?"0x0000000000000000000000000000000000000000000000000000000000000000":n.keccak(this.encodeData(t,o,r,a))];if(void 0===o)throw Error(`missing value for field ${e} of type ${t}`);if("bytes"===t)return["bytes32",n.keccak(o)];if("string"===t)return"string"==typeof o&&(o=i.Buffer.from(o,"utf8")),["bytes32",n.keccak(o)];if(t.lastIndexOf("]")===t.length-1){let r=t.slice(0,t.lastIndexOf("[")),i=o.map(t=>c(e,r,t));return["bytes32",n.keccak(s.rawEncode(i.map(([e])=>e),i.map(([,e])=>e)))]}return[t,o]};for(let i of r[e]){let[e,r]=c(i.name,i.type,t[i.name]);o.push(e),l.push(r)}}else for(let s of r[e]){let e=t[s.name];if(void 0!==e)if("bytes"===s.type)o.push("bytes32"),e=n.keccak(e),l.push(e);else if("string"===s.type)o.push("bytes32"),"string"==typeof e&&(e=i.Buffer.from(e,"utf8")),e=n.keccak(e),l.push(e);else if(void 0!==r[s.type])o.push("bytes32"),e=n.keccak(this.encodeData(s.type,e,r,a)),l.push(e);else if(s.type.lastIndexOf("]")===s.type.length-1)throw Error("Arrays currently unimplemented in encodeData");else o.push(s.type),l.push(e)}return s.rawEncode(o,l)},encodeType(e,t){let r="",i=this.findTypeDependencies(e,t).filter(t=>t!==e);for(let n of i=[e].concat(i.sort())){if(!t[n])throw Error("No type definition specified: "+n);r+=n+"("+t[n].map(({name:e,type:t})=>t+" "+e).join(",")+")"}return r},findTypeDependencies(e,t,r=[]){if(e=e.match(/^\w*/)[0],r.includes(e)||void 0===t[e])return r;for(let i of(r.push(e),t[e]))for(let e of this.findTypeDependencies(i.type,t,r))r.includes(e)||r.push(e);return r},hashStruct(e,t,r,i=!0){return n.keccak(this.encodeData(e,t,r,i))},hashType(e,t){return n.keccak(this.encodeType(e,t))},sanitizeData(e){let t={};for(let r in a.properties)e[r]&&(t[r]=e[r]);return t.types&&(t.types=Object.assign({EIP712Domain:[]},t.types)),t},hash(e,t=!0){let r=this.sanitizeData(e),s=[i.Buffer.from("1901","hex")];return s.push(this.hashStruct("EIP712Domain",r.domain,r.types,t)),"EIP712Domain"!==r.primaryType&&s.push(this.hashStruct(r.primaryType,r.message,r.types,t)),n.keccak(i.Buffer.concat(s))}};t.exports={TYPED_MESSAGE_SCHEMA:a,TypedDataUtils:o,hashForSignTypedDataLegacy:function(e){return function(e){let t=Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;let r=e.map(function(e){return"bytes"===e.type?n.toBuffer(e.value):e.value}),i=e.map(function(e){return e.type}),a=e.map(function(e){if(!e.name)throw t;return e.type+" "+e.name});return s.soliditySHA3(["bytes32","bytes32"],[s.soliditySHA3(Array(e.length).fill("string"),a),s.soliditySHA3(i,r)])}(e.data)},hashForSignTypedData_v3:function(e){return o.hash(e.data,!1)},hashForSignTypedData_v4:function(e){return o.hash(e.data)}}},212483,(e,t,r)=>{"use strict";var i=e.r(505034),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=i.useRef,o=i.useEffect,l=i.useMemo,c=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,d){var u=a(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;var p=s(e,(u=l(function(){function e(e){if(!o){if(o=!0,s=e,e=i(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return a=t}return a=e}if(t=a,n(s,e))return t;var r=i(e);return void 0!==d&&d(t,r)?(s=e,t):(s=e,a=r)}var s,a,o=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,i,d]))[0],u[1]);return o(function(){h.hasValue=!0,h.value=p},[p]),c(p),p}},129852,(e,t,r)=>{"use strict";t.exports=e.r(212483)},135022,(e,t,r)=>{"use strict";let i=e.r(443426);t.exports=d;let n=function(){function e(e){return void 0!==e&&e}try{if("u">typeof globalThis)return globalThis;return Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{};function s(e,t){return"silent"===e?1/0:t.levels.values[e]}let a=Symbol("pino.logFuncs"),o=Symbol("pino.hierarchy"),l={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function c(e,t){let r={logger:t,parent:e[o]};t[o]=r}function d(e){var t,r,i;let o,f,y;(e=e||{}).browser=e.browser||{};let g=e.browser.transmit;if(g&&"function"!=typeof g.send)throw Error("pino: transmit option must have a send function");let b=e.browser.write||n;e.browser.write&&(e.browser.asObject=!0);let _=e.serializers||{},E=(t=e.browser.serialize,Array.isArray(t)?t.filter(function(e){return"!stdSerializers.err"!==e}):!0===t&&Object.keys(_)),I=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(I=!1);let A=Object.keys(e.customLevels||{}),S=["error","fatal","warn","info","debug","trace"].concat(A);"function"==typeof b&&S.forEach(function(e){b[e]=b}),(!1===e.enabled||e.browser.disabled)&&(e.level="silent");let k=e.level||"info",T=Object.create(b);T.log||(T.log=m),o={},S.forEach(e=>{o[e]=b[e]?b[e]:n[e]||n[l[e]||"log"]||m}),T[a]=o,c({},T),Object.defineProperty(T,"levelVal",{get:function(){return s(this.level,this)}}),Object.defineProperty(T,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,u(this,C,T,"error"),u(this,C,T,"fatal"),u(this,C,T,"warn"),u(this,C,T,"info"),u(this,C,T,"debug"),u(this,C,T,"trace"),A.forEach(e=>{u(this,C,T,e)})}});let C={transmit:g,serialize:E,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:S,timestamp:"function"==typeof(r=e).timestamp?r.timestamp:!1===r.timestamp?w:v,messageKey:e.messageKey||"msg",onChild:e.onChild||m};function x(t,r,i){if(!r)throw Error("missing bindings for child Pino");i=i||{},E&&r.serializers&&(i.serializers=r.serializers);let n=i.serializers;if(E&&n){var s=Object.assign({},_,n),a=!0===e.browser.serialize?Object.keys(s):E;delete r.serializers,h([r],a,s,this._stdErrSerialize)}function o(e){this._childLevel=(0|e._childLevel)+1,this.bindings=r,s&&(this.serializers=s,this._serialize=a),g&&(this._logEvent=p([].concat(e._logEvent.bindings,r)))}o.prototype=this;let l=new o(this);return c(this,l),l.child=function(...e){return x.call(this,t,...e)},l.level=i.level||this.level,t.onChild(l),l}return f=e.customLevels||{},T.levels={values:Object.assign({},d.levels.values,f),labels:Object.assign({},d.levels.labels,(y={},Object.keys(i=f).forEach(function(e){y[i[e]]=e}),y))},T.level=k,T.isLevelEnabled=function(e){return!!this.levels.values[e]&&this.levels.values[e]>=this.levels.values[this.level]},T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=m,T.serializers=_,T._serialize=E,T._stdErrSerialize=I,T.child=function(...e){return x.call(this,C,...e)},g&&(T._logEvent=p()),T}function u(e,t,r,l){var c,d,u,f,y,g,w;if(Object.defineProperty(e,l,{value:s(e.level,r)>s(l,r)?m:r[a][l],writable:!0,enumerable:!0,configurable:!0}),e[l]===m){if(!t.transmit)return;let i=s(t.transmit.level||e.level,r);if(s(l,r)<i)return}e[l]=(c=e,d=t,u=r,f=l,y=c[a][f],function(){let e=d.timestamp(),t=Array(arguments.length),r=Object.getPrototypeOf&&Object.getPrototypeOf(this)===n?n:this;for(var a=0;a<t.length;a++)t[a]=arguments[a];var o=!1;if(d.serialize&&(h(t,this._serialize,this.serializers,this._stdErrSerialize),o=!0),d.asObject||d.formatters?y.call(r,...function(e,t,r,n,s){let{level:a,log:o=e=>e}=s.formatters||{},l=r.slice(),c=l[0],d={},u=(0|e._childLevel)+1;if(u<1&&(u=1),n&&(d.time=n),a?Object.assign(d,a(t,e.levels.values[t])):d.level=e.levels.values[t],s.asObjectBindingsOnly){if(null!==c&&"object"==typeof c)for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());return[o(d),...l]}if(null!==c&&"object"==typeof c){for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());c=l.length?i(l.shift(),l):void 0}else"string"==typeof c&&(c=i(l.shift(),l));return void 0!==c&&(d[s.messageKey]=c),[o(d)]}(this,f,t,e,d)):y.apply(r,t),d.transmit){let r=d.transmit.level||c._level,i=s(r,u),n=s(f,u);if(n<i)return;!function(e,t,r,i=!1){let n=t.send,s=t.ts,a=t.methodLevel,o=t.methodValue,l=t.val,c=e._logEvent.bindings;i||h(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=r.filter(function(e){return -1===c.indexOf(e)}),e._logEvent.level.label=a,e._logEvent.level.value=o,n(a,e._logEvent,l),e._logEvent=p(c)}(this,{ts:e,methodLevel:f,methodValue:n,transmitLevel:r,transmitValue:u.levels.values[d.transmit.level||c._level],send:d.transmit.send,val:s(c._level,u)},t,o)}});let v=function(e){let t=[];e.bindings&&t.push(e.bindings);let r=e[o];for(;r.parent;)(r=r.parent).logger.bindings&&t.push(r.logger.bindings);return t.reverse()}(e);0!==v.length&&(e[l]=(g=v,w=e[l],function(){return w.apply(this,[...g,...arguments])}))}function h(e,t,r,i){for(let n in e)if(i&&e[n]instanceof Error)e[n]=d.stdSerializers.err(e[n]);else if("object"==typeof e[n]&&!Array.isArray(e[n])&&t)for(let i in e[n])t.indexOf(i)>-1&&i in r&&(e[n][i]=r[i](e[n][i]))}function p(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function f(e){let t={type:e.constructor.name,msg:e.message,stack:e.stack};for(let r in e)void 0===t[r]&&(t[r]=e[r]);return t}function y(){return{}}function g(e){return e}function m(){}function w(){return!1}function v(){return Date.now()}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers={mapHttpRequest:y,mapHttpResponse:y,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:y,res:y,err:f,errWithCause:f},d.stdTimeFunctions=Object.assign({},{nullTime:w,epochTime:v,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),t.exports.default=d,t.exports.pino=d},384249,464143,866979,464427,555361,279116,5741,285972,437421,623388,957932,621418,152594,756345,719036,892009,327422,436392,291329,85905,622039,157516,813170,644546,359948,855481,475835,879058,676389,854569,559889,e=>{"use strict";let t,r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m,w,v,b,_,E,I,A,S,k,T,C,x,P,O,R,N,M,U,D,L;var j=e.i(14270),W=e.i(505034),B=e.i(40841),F=e.i(420746),q=e.i(627617),H=e.i(404458),z=e.i(849519),$=e.i(982989),K=e.i(511115),V=e.i(589774),J=e.i(312067),G=e.i(210052),Z=e.i(706882);async function Y(e,t,r,i,n=!1,s,a){let o=n,l=async s=>{if(o){s===+!n?i():r.current?.reject(new V.PrivyIframeError("missing_or_invalid_mfa","MFA verification failed, retry."));let o=await new Promise((e,i)=>{t.current={resolve:e,reject:i},setTimeout(()=>{let e=new V.PrivyIframeError("mfa_timeout","Timed out waiting for MFA code");r.current?.reject(e),i(e)},a)});return await e(o)}return await e()},c=null;for(let e=0;e<s;e++)try{c=await l(e),r.current?.resolve(void 0);break}catch(e){if("missing_or_invalid_mfa"!==e.type)throw r.current?.resolve(void 0),e;o=!0}if(null===c){let e=new V.PrivyIframeError("mfa_verification_max_attempts_reached","Max MFA verification attempts reached");throw r.current?.reject(e),e}return c}let Q=(ex=0,()=>"id-"+ex++),X=(e,t)=>"bigint"==typeof t?t.toString():t,ee=async(e,{ms:t,msg:r})=>{let i,n=new Promise((e,n)=>{i=setTimeout(()=>{n(Error(r))},t??15e3)});try{return await Promise.race([e,n])}finally{void 0!==i&&clearTimeout(i)}},et=new class{enqueue(e,t){this.callbacks[e]=t}dequeue(e,t){let r=this.callbacks[t];if(!r)throw Error(`cannot dequeue ${e} event: no event found for id ${t}`);switch(delete this.callbacks[t],e){case"privy:iframe:ready":case"privy:wallets:create":case"privy:user-signer:sign":case"privy:wallets:add":case"privy:wallets:set-recovery":case"privy:wallets:connect":case"privy:wallets:recover":case"privy:wallets:rpc":case"privy:wallet:create":case"privy:wallet:connect":case"privy:wallet:recover":case"privy:wallet:rpc":case"privy:solana-wallet:create":case"privy:solana-wallet:create-additional":case"privy:solana-wallet:connect":case"privy:solana-wallet:recover":case"privy:solana-wallet:rpc":case"privy:delegated-actions:consent":case"privy:mfa:verify":case"privy:mfa:init-enrollment":case"privy:mfa:submit-enrollment":case"privy:mfa:unenroll":case"privy:mfa:clear":return r;default:throw Error(`invalid wallet event type ${e}`)}}constructor(){this.callbacks={}}};class er{invokeWithMfa(e,t){return ee(Y(r=>ee(this.waitForReady().then(()=>e(r)),{msg:t.timeoutMsg,ms:t.timeoutMs}),this.mfa.rootPromise,this.mfa.submitPromise,()=>this.mfa.emit("mfaRequired"),t.mfaAlwaysRequired??!1,4,3e5),{msg:"Operation reached timeout: MFA verification",ms:126e4})}reload(){return this.ready=!1,this._embeddedWalletMessagePoster.reload()}ping(e=15e3){return ee(this.invoke("privy:iframe:ready",{}),{msg:"Ping reached timeout",ms:e})}create(e){return ee(this.waitForReady().then(()=>this.invoke("privy:wallet:create",e)),{msg:"Operation reached timeout: create"})}rpc(e){return this.invokeWithMfa(t=>this.invoke("privy:wallet:rpc",{...t,...e}),{timeoutMsg:"Operation reached timeout: rpc"})}createSolana(e){return this.invokeWithMfa(t=>this.invoke("privy:solana-wallet:create",{...t,...e}),{timeoutMsg:"Operation reached timeout: create",timeoutMs:6e4})}createAdditionalSolana(e){return ee(this.waitForReady().then(()=>this.invoke("privy:solana-wallet:create-additional",e)),{msg:"Operation reached timeout: create"})}solanaRpc(e){return this.invokeWithMfa(t=>this.invoke("privy:solana-wallet:rpc",{...t,...e}),{timeoutMsg:"Operation reached timeout: solana-rpc"})}delegateWallets(e){return this.invokeWithMfa(t=>this.invoke("privy:delegated-actions:consent",{...t,...e}),{timeoutMsg:"Operation reached timeout: delegated-actions:consent"})}verifyMfa(e){return this.invokeWithMfa(t=>this.invoke("privy:mfa:verify",{...t,...e}),{timeoutMsg:"Operation reached timeout: mfa:verify",mfaAlwaysRequired:!0})}initEnrollMfa(e){return this.invokeWithMfa(t=>this.invoke("privy:mfa:init-enrollment",{...t,...e}),{timeoutMsg:"Operation reached timeout: mfa:init-enrollment"})}submitEnrollMfa(e){return this.invokeWithMfa(t=>this.invoke("privy:mfa:submit-enrollment",{...t,...e}),{timeoutMsg:"Operation reached timeout: mfa:submit-enrollment"})}unenrollMfa(e){return this.invokeWithMfa(t=>this.invoke("privy:mfa:unenroll",{...t,...e}),{timeoutMsg:"Operation reached timeout: mfa:unenroll",mfaAlwaysRequired:!0})}clearMfa(e){return ee(this.waitForReady().then(()=>this.invoke("privy:mfa:clear",e)),{msg:"Operation reached timeout: mfa:clear"})}createWallet(e){return this.invokeWithMfa(t=>this.invoke("privy:wallets:create",{...t,...e}),{timeoutMsg:"Operation reached timeout: create",timeoutMs:6e4})}signWithUserSigner(e){return this.invokeWithMfa(t=>this.invoke("privy:user-signer:sign",{...t,...e}),{timeoutMsg:"Operation reached timeout: user-signer:sign"})}addWallet(e){return ee(this.waitForReady().then(()=>this.invoke("privy:wallets:add",e)),{msg:"Operation reached timeout: wallets:add"})}setRecovery(e){return this.invokeWithMfa(t=>this.invoke("privy:wallets:set-recovery",{...t,...e}),{timeoutMsg:"Operation reached timeout: wallets:set-recovery",timeoutMs:6e4})}connect(e){return ee(this.waitForReady().then(()=>this.invoke("privy:wallets:connect",e)),{msg:"Operation reached timeout: wallets:connect"})}recover(e){return this.invokeWithMfa(t=>this.invoke("privy:wallets:recover",{...t,...e}),{timeoutMsg:"Operation reached timeout: wallets:recover",timeoutMs:6e4})}rpcWallet(e){return this.invokeWithMfa(t=>this.invoke("privy:wallets:rpc",{...t,...e}),{timeoutMsg:"Operation reached timeout: wallets:rpc"})}handleEmbeddedWalletMessages(e){if(!e.event.startsWith("privy:"))return void console.warn(`Unsupported event type: ${e.event}`);let{reject:t,resolve:r}=et.dequeue(e.event,e.id);return void 0!==e.error?t(new V.PrivyIframeError(e.error.type,e.error.message)):r(e.data)}waitForReady(){return this.ready?Promise.resolve():new Promise(async(e,t)=>{for(;!this.ready;)this.invoke("privy:iframe:ready",{}).then(()=>{this.ready=!0,e()}).catch(t),await new Promise(e=>{setTimeout(()=>{e()},150)})})}invoke(e,t){let r=`${e}${JSON.stringify(t,X)}`;if("privy:wallet:create"===e||"privy:solana-wallet:create"===e){let e=this.cache.get(r);if(e)return e}let i=new Promise((r,i)=>{let n=Q();et.enqueue(n,{resolve:r,reject:i}),this._embeddedWalletMessagePoster.postMessage(JSON.stringify({id:n,event:e,data:t}),"*")}).finally(()=>{this.cache.delete(r)});return this.cache.set(r,i),i}constructor(e,t){this.ready=!1,this.cache=new Map,this._embeddedWalletMessagePoster=e,this.mfa=t}}var ei=e.i(329723),en=e.i(583748),es=e.i(883096);let ea={0:"legacy",1:"eip2930",2:"eip1559",3:"eip4844",4:"eip7702"},eo={legacy:0,eip2930:1,eip1559:2,eip4844:3,eip7702:4},el=e=>void 0!==e?BigInt(e):void 0;function ec(e){let t,{type:r=2,...i}="string"==typeof e?JSON.parse(e):e;i.accessList&&Array.isArray(i.accessList)?t=i.accessList.map(e=>Array.isArray(e)?{address:e[0],storageKeys:e[1]}:e):i.accessList&&(t=Object.entries(i.accessList).map(e=>({address:e[0],storageKeys:e[1]})));let n=Number(i.chainId??1),s=(0,es.isHex)(i.data)?i.data:i.data?(0,en.toHex)(Uint8Array.from(i.data)):void 0,a=i.nonce?Number(i.nonce):void 0,o={chainId:n,data:s,nonce:a,value:el(i.value),gas:el(i.gas??i.gasLimit)},l=Number(r);if(0===l)return{...i,type:ea[l],...o,gasPrice:el(i.gasPrice),accessList:void 0,maxFeePerGas:void 0,maxPriorityFeePerGas:void 0};if(1===l)return{...i,type:ea[l],...o,gasPrice:el(i.gasPrice),accessList:t,maxFeePerGas:void 0,maxPriorityFeePerGas:void 0};if(2===l)return{...i,type:ea[l],...o,nonce:a,accessList:t,maxFeePerGas:el(i.maxFeePerGas),maxPriorityFeePerGas:el(i.maxPriorityFeePerGas),gasPrice:void 0,maxFeePerBlobGas:void 0};throw Error(`Unsupported transaction type: ${r}`)}var ed=e.i(498921);let eu=e=>ed.Buffer.from(e,"utf8"),eh=e=>`0x${e.toString("hex")}`;var ep=e.i(261692);function ef(e){if("number"==typeof e||"bigint"==typeof e)return`0x${BigInt(e).toString(16)}`;if("string"==typeof e)return/^0x[0-9a-fA-F]*$/.test(e)?e:eh(eu(e))}async function ey({context:e,account:t,rpcRequest:r}){switch(r.chainType){case"ethereum":return async function({context:e,account:t,rpcRequest:r}){var i;switch(r.method){case"personal_sign":{let[i]=r.params,n=await (0,ep.rpc)(e,e.signRequest,{chain_type:"ethereum",method:"personal_sign",wallet_id:t.id,params:i.startsWith("0x")?{message:i.slice(2),encoding:"hex"}:{message:i,encoding:"utf-8"}});if("personal_sign"!==n.method)throw Error("Unable to sign message");return{data:n.data.signature}}case"eth_signTransaction":{let[i]=r.params,n=await (0,ep.rpc)(e,e.signRequest,{chain_type:"ethereum",method:"eth_signTransaction",wallet_id:t.id,params:{transaction:{from:i.from,to:i.to??void 0,nonce:ef(i.nonce),chain_id:ef(i.chainId),data:function(e){if(void 0!==e)return"string"==typeof e?/^0x[0-9a-fA-F]*$/.test(e)?e:eh(eu(e)):eh(ed.Buffer.from(Uint8Array.from(e)))}(i.data),value:ef(i.value),type:i.type,gas_limit:ef(i.gasLimit),gas_price:ef(i.gasPrice),max_fee_per_gas:ef(i.maxFeePerGas),max_priority_fee_per_gas:ef(i.maxPriorityFeePerGas)}}});if("eth_signTransaction"!==n.method)throw Error("Unable to sign transaction");return{data:n.data.signed_transaction}}case"eth_signTypedData_v4":{let[,n]=r.params,s=await (0,ep.rpc)(e,e.signRequest,{chain_type:"ethereum",method:r.method,wallet_id:t.id,params:{typed_data:("string"==typeof(i=n)&&(i=JSON.parse(i)),{types:i.types,primary_type:String(i.primaryType),domain:i.domain,message:i.message})}});if("eth_signTypedData_v4"!==s.method)throw Error("Unable to sign typed data");return{data:s.data.signature}}case"eth_sign":{let[,i]=r.params,n=await (0,ep.rpc)(e,e.signRequest,{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:t.id,params:{hash:/^0x[0-9a-fA-F]*$/.test(i)?i:eh(eu(i))}});if("secp256k1_sign"!==n.method)throw Error("Unable to sign message");return{data:n.data.signature}}case"secp256k1_sign":{let[i]=r.params,n=await (0,ep.rpc)(e,e.signRequest,{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:t.id,params:{hash:/^0x[0-9a-fA-F]*$/.test(i)?i:eh(eu(i))}});if("secp256k1_sign"!==n.method)throw Error("Unable to sign message");return{data:n.data.signature}}case"csw_signUserOperation":case"eth_sendTransaction":case"eth_populateTransactionRequest":throw Error(`This wallet does not support the method: ${r.method}`)}}({context:e,account:t,rpcRequest:r.request});case"solana":return async function({context:e,account:t,rpcRequest:r}){if("signMessage"===r.method){let{message:i}=r.params,n=await (0,ep.rpc)(e,e.signRequest,{chain_type:"solana",method:"signMessage",wallet_id:t.id,params:{message:i,encoding:"base64"}});if("signMessage"!==n.method)throw Error("Unable to sign message");return{data:n.data.signature}}}({context:e,account:t,rpcRequest:r.request})}}e.i(305456);let eg=new Set(["eth_sign","personal_sign","eth_signTypedData_v4","csw_signUserOperation","secp256k1_sign"]);class em extends ei.default{async request(e){if(eg.has(e.method))return this.handleIFrameRpc(e);switch(e.method){case"eth_accounts":case"eth_requestAccounts":return this._account.address?[this._account.address]:[];case"eth_chainId":return`0x${this._chainId.toString(16)}`;case"wallet_switchEthereumChain":return this.handleSwitchEthereumChain(e);case"eth_estimateGas":return this.handleEstimateGas(e);case"eth_signTransaction":{let t=e.params?.[0];return this.handleSignTransaction(t)}case"eth_sendTransaction":{let t=e.params?.[0];return this.handleSendTransaction(t)}case"eth_populateTransactionRequest":{let t=e.params?.[0];return this.handlePopulateTransaction(t)}default:return this.handleJsonRpc(e)}}ensureChainId(e){let t={chainId:this._chainId,...e};return this.internalSwitchEthereumChain(t.chainId),t}internalSwitchEthereumChain(e){e&&Number(e)!==this._chainId&&(this._chainId=Number(e),this._client=(0,G.getPublicClient)(this._chainId,this._chains,{rpcUrls:[]},{appId:this._privyInternal.appId}),this.emit("chainChanged",e))}async handlePopulateTransaction(e){let t=this.ensureChainId(e),r=ec(t),{type:i,...n}=await this._client.prepareTransactionRequest({account:t.from??this._account.address,...r});return{...n,type:eo[i]}}async handleSignTransaction(e){let t={...e};for(let e of Object.keys(t)){let r=t[e];r&&"bigint"==typeof r&&(t[e]=(0,en.toHex)(r))}return await this.handleIFrameRpc({method:"eth_signTransaction",params:[t]})}async handleSendTransaction(e){let t=await this.handlePopulateTransaction(e),r=await this.handleSignTransaction(t);return await this.handleJsonRpc({method:"eth_sendRawTransaction",params:[r]})}async handleEstimateGas(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_estimateGas");let t=e.params?.[0],r=this.ensureChainId(t),i=ec(r);return await this._client.estimateGas({account:r.from??this._account.address,...i})}handleSwitchEthereumChain(e){let t;if(!e.params||!Array.isArray(e.params))throw new V.EmbeddedProviderError(`Invalid params for ${e.method}`,4200);if("string"==typeof e.params[0])t=e.params[0];else{if(!("chainId"in e.params[0])||"string"!=typeof e.params[0].chainId)throw new V.EmbeddedProviderError(`Invalid params for ${e.method}`,4200);t=e.params[0].chainId}this.internalSwitchEthereumChain(t)}async handleIFrameRpc(e){try{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw Error("Missing privy token. User must be logged in");this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_started",{method:e.method,address:this._account.address});let r=this._account;if((0,Z.isUnifiedWallet)(r)){let{data:i}=await ey({context:{app:this._appApi,fetchPrivyRoute:(...e)=>this._privyInternal.fetch(...e),getCompiledPath:(...e)=>this._privyInternal.getPath(...e),signRequest:({message:e})=>this._walletProxy.signWithUserSigner({accessToken:t,message:e})},account:r,rpcRequest:{chainType:"ethereum",request:e}});return i}try{await this._walletProxy.connect({entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,accessToken:t})}catch(r){let e=(0,V.errorIndicatesRecoveryIsNeeded)(r);if(e&&"privy"===this._account.recovery_method)await this._walletProxy.recover({entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,accessToken:t});else{if(!e||!this._onNeedsRecovery)throw r;{let e;await new Promise(async(t,r)=>{e=setTimeout(()=>r(new $.PrivyClientError({code:"embedded_wallet_recovery_error",error:"User-owned recovery timed out"})),12e4),await this._onNeedsRecovery?.({recoveryMethod:this._account.recovery_method,onRecovered:()=>t(!0)})}).finally(()=>clearTimeout(e))}}}return(await this._walletProxy.rpcWallet({accessToken:t,request:e,entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,hdWalletIndex:this._account.wallet_index,chainType:"ethereum"})).response.data}catch(r){console.error(r);let t=r instanceof Error?r.message:"Unable to make wallet request";throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_failed",{method:e.method,address:this._account.address,error:t}),new $.PrivyClientError({code:"embedded_wallet_request_error",error:t})}}async handleJsonRpc(e){return this._client.request(e)}toJSON(){return`PrivyEIP1193Provider { address: '${this._account.address}', chainId: ${this._chainId}, request: [Function] }`}constructor({walletProxy:e,privyInternal:t,account:r,entropyId:i,entropyIdVerifier:n,chains:s,onNeedsRecovery:a,chainId:o=s[0].id,appApi:l}){super(),this._walletProxy=e,this._privyInternal=t,this._account=r,this._entropyId=i,this._entropyIdVerifier=n,this._chainId=o,this._chains=s,this._onNeedsRecovery=a,this._client=(0,G.getPublicClient)(o,s,{rpcUrls:[]},{appId:l.appId}),this._appApi=l}}function ew(e){return"version"in e}function ev(e,t){let r=(ew(e)?e.message:e.compileMessage()).staticAccountKeys.find(e=>e.toBase58()===t);if(!r)throw Error(`Transaction does not contain public key ${t}`);return r}class eb{async request(e){if(!await this._privyInternal.getAccessTokenInternal())throw new $.PrivyClientError({error:"Missing access token",code:"attempted_rpc_call_before_logged_in"});switch(e.method){case"signAndSendTransaction":return await this.handleSignAndSendTransaction(e);case"signTransaction":return await this.handleSignTransaction(e);default:return await this.handleIFrameRpc(e)}}get _publicKey(){return this._account.address}async connectAndRecover(e){if("privy-v2"!==this._account.recovery_method)try{await this._proxy.connect({entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,accessToken:e})}catch(r){let t=(0,V.errorIndicatesRecoveryIsNeeded)(r);if(t&&"privy"===this._account.recovery_method)await this._proxy.recover({entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier,accessToken:e});else{if(!t||!this._onNeedsRecovery)throw r;{let e;await new Promise(async(t,r)=>{e=setTimeout(()=>r(new $.PrivyClientError({code:"embedded_wallet_recovery_error",error:"User-owned recovery timed out"})),12e4),await this._onNeedsRecovery?.({recoveryMethod:this._account.recovery_method,onRecovered:()=>t(!0)})}).finally(()=>clearTimeout(e))}}}}async signMessageRpc(e,t){let r=this._account;if(!(0,Z.isUnifiedWallet)(r))return(await this._proxy.rpcWallet({accessToken:t,request:e,chainType:"solana",hdWalletIndex:this._account.wallet_index,entropyId:this._entropyId,entropyIdVerifier:this._entropyIdVerifier})).response.data;{let{data:i}=await ey({context:{app:this._app,fetchPrivyRoute:(...e)=>this._privyInternal.fetch(...e),getCompiledPath:(...e)=>this._privyInternal.getPath(...e),signRequest:({message:e})=>this._proxy.signWithUserSigner({accessToken:t,message:e})},account:r,rpcRequest:{chainType:"solana",request:e}});return{signature:i}}}async handleIFrameRpc(e){try{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw Error("Missing privy token. User must be logged in");return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_started",{method:e.method,address:this._account.address}),await this.connectAndRecover(t),await this.signMessageRpc(e,t)}catch(r){console.error(r);let t=r instanceof Error?r.message:"Unable to make wallet request";throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_failed",{method:e.method,address:this._account.address,error:t}),new $.PrivyClientError({code:"embedded_wallet_request_error",error:t})}}async handleSignAndSendTransaction(e){try{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw Error("Missing privy token. User must be logged in");this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_started",{method:e.method,address:this._account.address}),await this.connectAndRecover(t);let{transaction:r,connection:i,options:n}=e.params,s=ev(r,this._account.address),a=ew(r)?ed.Buffer.from(r.message.serialize()):r.serializeMessage(),{signature:o}=await this.signMessageRpc({method:"signMessage",params:{message:a.toString("base64")}},t);return r.addSignature(s,ed.Buffer.from(o,"base64")),{signature:await i.sendRawTransaction(r.serialize(),n)}}catch(r){console.error(r);let t=r instanceof Error?r.message:"Unable to make wallet request";throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_failed",{method:e.method,address:this._account.address,error:t}),new $.PrivyClientError({code:"embedded_wallet_request_error",error:t})}}async handleSignTransaction(e){try{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw Error("Missing privy token. User must be logged in");this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_started",{method:e.method,address:this._account.address}),await this.connectAndRecover(t);let{transaction:r}=e.params,i=ev(r,this._account.address),n=ew(r)?ed.Buffer.from(r.message.serialize()):r.serializeMessage(),{signature:s}=await this.signMessageRpc({method:"signMessage",params:{message:n.toString("base64")}},t);return r.addSignature(i,ed.Buffer.from(s,"base64")),{signedTransaction:r}}catch(r){console.error(r);let t=r instanceof Error?r.message:"Unable to make wallet request";throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_rpc_failed",{method:e.method,address:this._account.wallet_index,error:t}),new $.PrivyClientError({code:"embedded_wallet_request_error",error:t})}}toJSON(){return`PrivyEmbeddedSolanaProvider { address: '${this._account.address}', request: [Function] }`}constructor({proxy:e,privyInternal:t,account:r,entropyId:i,entropyIdVerifier:n,onNeedsRecovery:s,app:a}){this._proxy=e,this._privyInternal=t,this._account=r,this._entropyId=i,this._entropyIdVerifier=n,this._onNeedsRecovery=s,this._app=a}}class e_{setMessagePoster(e){this._proxy=new er(e,this._mfaPromises),this._mfa.setProxy(this._proxy)}async signWithUserSigner(e){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw new $.PrivyClientError({error:"User must be logged in to sign a message with the user signer",code:"user_signer_sign_error"});let{signature:r}=await this._proxy.signWithUserSigner({accessToken:t,message:e.message});return{signature:r}}async add(e){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");if("user-controlled-server-wallets-only"===this._privyInternal.config?.embedded_wallet_config.mode)await (0,J.walletCreate)({context:{app:this._appApi,fetchPrivyRoute:(...e)=>this._privyInternal.fetch(...e),getCompiledPath:(...e)=>this._privyInternal.getPath(...e)},chainType:e.chainType});else{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw new $.PrivyClientError({error:"User must be logged in to create an embedded wallet",code:"embedded_wallet_creation_error"});await this._proxy.addWallet({accessToken:t,...e})}let{user:t}=await this._privyInternal.refreshSession();return{user:t}}async getBitcoinProvider({wallet:e,entropyId:t,entropyIdVerifier:r,recoveryPassword:i,recoveryAccessToken:n,recoverySecretOverride:s}){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");if(!await this._privyInternal.getAccessTokenInternal())throw Error("User must be logged in to create an embedded wallet");return(0,Z.isUnifiedWallet)(e)||await this._load({entropyId:t,entropyIdVerifier:r,wallet:e,recoveryPassword:i,recoveryAccessToken:n,recoverySecretOverride:s}),new K.EmbeddedBitcoinWalletProvider({account:e,privyInternal:this._privyInternal,proxy:this._proxy,entropyId:t,entropyIdVerifier:r})}async create({password:e,recoveryMethod:t,recoveryToken:r,recoveryKey:i,recoverySecretOverride:n,iCloudRecordNameOverride:s,solanaAccount:a,skipCallbacks:o,idempotencyKey:l}){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");if("user-controlled-server-wallets-only"===this._privyInternal.config?.embedded_wallet_config.mode){if(t&&!t.startsWith("privy"))throw new $.PrivyClientError({error:"User-controlled server wallets do not support custom recovery methods",code:"embedded_wallet_creation_error"});await (0,J.walletCreate)({context:{app:this._appApi,fetchPrivyRoute:(...e)=>this._privyInternal.fetch(...e),getCompiledPath:(...e)=>this._privyInternal.getPath(...e)},chainType:"ethereum",idempotencyKey:l})}else{let o;if(o=t||(e?"user-passcode":"privy"),e&&"string"!=typeof e)throw Error("Invalid recovery password, must be a string");if("privy"===o&&this._privyInternal.config?.embedded_wallet_config.require_user_password_on_create)throw Error("Password not provided yet is required by App configuration");let l=await this._privyInternal.getAccessTokenInternal();if(!l)throw Error("User must be logged in to create an embedded wallet");let{address:c}=await this._proxy.create({accessToken:l,recoveryMethod:o,recoveryKey:i,recoveryPassword:e,recoveryAccessToken:r,recoverySecretOverride:n,iCloudRecordNameOverride:s,solanaAddress:a?.address});if(!c)throw Error("Failed to create wallet")}return await this._privyInternal.refreshSession(o)}async createSolana(e){if(!this._proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_creation_error"});if("user-controlled-server-wallets-only"===this._privyInternal.config?.embedded_wallet_config.mode)await (0,J.walletCreate)({context:{app:this._appApi,fetchPrivyRoute:(...e)=>this._privyInternal.fetch(...e),getCompiledPath:(...e)=>this._privyInternal.getPath(...e)},chainType:"solana",idempotencyKey:e?.idempotencyKey});else{let t=await this._privyInternal.getAccessTokenInternal();if(!t)throw new $.PrivyClientError({error:"User must be logged in to create an embedded wallet",code:"embedded_wallet_creation_error"});e?.ethereumAccount&&await this.getProvider(e.ethereumAccount);let{publicKey:r}=await this._proxy.createSolana({accessToken:t,ethereumAddress:e?.ethereumAccount?.address});if(!r)throw new $.PrivyClientError({error:"Failed to create wallet",code:"embedded_wallet_creation_error"})}return await this._privyInternal.refreshSession()}async delegateWallets({delegatedWallets:e,rootWallet:t}){if(!this._proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_creation_error"});let r=await this._privyInternal.getAccessTokenInternal();if(!r)throw new $.PrivyClientError({error:"User must be logged in to create an embedded wallet",code:"embedded_wallet_creation_error"});await this._proxy.delegateWallets({accessToken:r,delegatedWallets:e,rootWallet:t})}async getProvider(e,t,r,i,n){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");return(0,Z.isUnifiedWallet)(e)||await this._load({wallet:e,entropyId:e.address,entropyIdVerifier:"ethereum-address-verifier",recoveryPassword:t,recoveryKey:n,recoveryAccessToken:r,recoverySecretOverride:i}),new em({account:e,entropyId:e.address,entropyIdVerifier:"ethereum-address-verifier",privyInternal:this._privyInternal,chains:this._chains,walletProxy:this._proxy,appApi:this._appApi})}async getEthereumProvider({wallet:e,entropyId:t,entropyIdVerifier:r,recoveryPassword:i,recoveryAccessToken:n,recoverySecretOverride:s,recoveryKey:a,onNeedsRecovery:o}){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");if(!await this._privyInternal.getAccessTokenInternal())throw Error("User must be logged in to create an embedded wallet");return(0,Z.isUnifiedWallet)(e)||(!o||i||n||s||a)&&await this._load({entropyId:t,entropyIdVerifier:r,wallet:e,recoveryPassword:i,recoveryAccessToken:n,recoverySecretOverride:s,recoveryKey:a}),new em({account:e,entropyId:t,entropyIdVerifier:"ethereum-address-verifier",privyInternal:this._privyInternal,chains:this._chains,walletProxy:this._proxy,onNeedsRecovery:o,appApi:this._appApi})}async getSolanaProvider(e,t,r,i,n,s,a){if(!this._proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});return(0,Z.isUnifiedWallet)(e)||(!a||i||n||s)&&await this._load({wallet:e,entropyId:t,entropyIdVerifier:r,recoveryPassword:i,recoveryAccessToken:n,recoverySecretOverride:s}),new eb({account:e,privyInternal:this._privyInternal,proxy:this._proxy,entropyId:t,entropyIdVerifier:r,onNeedsRecovery:a,app:this._appApi})}async setRecovery(e){let{wallet:t,...r}=e;if(!this._proxy)throw Error("Embedded wallet proxy not initialized");if((0,Z.isUnifiedWallet)(t))throw new $.PrivyClientError({error:"This wallet does not support setting recovery methods",code:"unsupported_recovery_method"});(0,G.throwIfInvalidRecoveryUpgradePath)({currentRecoveryMethod:t.recovery_method,upgradeToRecoveryMethod:"icloud-native"===r.recoveryMethod?"icloud":r.recoveryMethod}),await this._load("solana"===t.chain_type?{wallet:t,entropyId:t.address,entropyIdVerifier:"solana-address-verifier"}:{wallet:t,entropyId:t.address,entropyIdVerifier:"ethereum-address-verifier"});let i=await this._privyInternal.getAccessTokenInternal();if(!i)throw Error("User must be logged in to interact with embedded wallets");let n=t.recovery_method;this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_set_recovery_started",{address:t.address,target_recovery_method:r.recoveryMethod,existing_recovery_method:n});try{let e;if("user-passcode"===r.recoveryMethod)e={recoveryMethod:"user-passcode",recoveryPassword:r.password};else if("google-drive"===r.recoveryMethod)e={recoveryMethod:"google-drive",recoveryAccessToken:r.recoveryAccessToken};else if("icloud"===r.recoveryMethod)e={recoveryMethod:"icloud",recoveryAccessToken:r.recoveryAccessToken};else if("icloud-native"===r.recoveryMethod)e={recoveryMethod:"icloud-native",iCloudRecordNameOverride:r.iCloudRecordNameOverride,recoverySecretOverride:r.recoverySecretOverride};else if("recovery-encryption-key"===r.recoveryMethod)e={recoveryMethod:"recovery-encryption-key",recoveryKey:r.recoveryKey};else{if("privy"!==r.recoveryMethod)throw Error(`Unknown recovery method: ${r.recoveryMethod}`);e={recoveryMethod:"privy"}}await this._proxy.setRecovery({accessToken:i,entropyId:t.address,entropyIdVerifier:"solana"===t.chain_type?"solana-address-verifier":"ethereum-address-verifier",...e}),this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_set_recovery_completed",{address:t.address,target_recovery_method:r.recoveryMethod,existing_recovery_method:n});let{user:s}=await this._privyInternal.refreshSession();return{user:s,provider:"ethereum"!==t.chain_type?null:new em({account:t,entropyId:t.address,entropyIdVerifier:"ethereum-address-verifier",privyInternal:this._privyInternal,chains:this._chains,walletProxy:this._proxy,appApi:this._appApi})}}catch(e){throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_set_recovery_failed",{address:t.address,recovery_method:t.recovery_method,error:e instanceof Error?e.message:"Unable to recover wallet"}),e}}getURL(){let e=new URL(`${this._privyInternal.baseUrl}/apps/${this._privyInternal.appId}/embedded-wallets`);return this._privyInternal.caid&&e.searchParams.append("caid",this._privyInternal.caid),this._privyInternal.appClientId&&e.searchParams.append("client_id",this._privyInternal.appClientId),e.href}get chains(){return this._chains}onMessage(e){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");return this._proxy.handleEmbeddedWalletMessages(e)}reload(){this._proxy?this._proxy.reload():console.warn("Attempted to reload proxy before initialized")}async ping(e){try{if(!this._proxy)throw Error("Embedded wallet proxy not initialized");return await this._proxy.ping(e),!0}catch(e){return console.error(e),!1}}async _load({entropyId:e,entropyIdVerifier:t,wallet:r,recoveryPassword:i,recoveryKey:n,recoveryAccessToken:s,recoverySecretOverride:a}){if(!this._proxy)throw Error("Embedded wallet proxy not initialized");let o=await this._privyInternal.getAccessTokenInternal();if(!o)throw Error("User must be logged in to interact with embedded wallets");try{return await this._proxy.connect({accessToken:o,entropyId:e,entropyIdVerifier:t}),e}catch(l){if((0,V.errorIndicatesRecoveryIsNeeded)(l))try{if("privy"===r.recovery_method){this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_started",{address:r.address,recovery_method:r.recovery_method});let i=await this._proxy.recover({accessToken:o,entropyId:e,entropyIdVerifier:t});return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_completed",{address:r.address,recovery_method:r.recovery_method}),i.entropyId}if("user-passcode"===r.recovery_method&&i){this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_started",{address:r.address,recovery_method:r.recovery_method});let n=await this._proxy.recover({accessToken:o,recoveryPassword:i,entropyId:e,entropyIdVerifier:t});return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_completed",{address:r.address,recovery_method:r.recovery_method}),n.entropyId}if(["google-drive","icloud"].includes(r.recovery_method)&&s){this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_started",{address:r.address,recovery_method:r.recovery_method});let i=await this._proxy.recover({accessToken:o,recoveryAccessToken:s,entropyId:e,entropyIdVerifier:t});return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_completed",{address:r.address,recovery_method:r.recovery_method}),i.entropyId}if("icloud"===r.recovery_method&&a){this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_started",{address:r.address,recovery_method:"icloud-native"});let i=await this._proxy.recover({accessToken:o,recoverySecretOverride:a,entropyId:e,entropyIdVerifier:t});return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_completed",{address:r.address,recovery_method:"icloud-native"}),i.entropyId}if("recovery-encryption-key"===r.recovery_method&&n){this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_started",{address:r.address,recovery_method:r.recovery_method});let i=await this._proxy.recover({accessToken:o,recoveryKey:n,entropyId:e,entropyIdVerifier:t});return this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_completed",{address:r.address,recovery_method:r.recovery_method}),i.entropyId}}catch(t){throw this._privyInternal.createAnalyticsEvent("embedded_wallet_sdk_recovery_failed",{address:r.address,recovery_method:r.recovery_method,error:t instanceof Error?t.message:`Unable to recover wallet: ${e}`}),t}throw l}}constructor(e,t,r,i,n,s){if(this._chains=Array.from(H.DEFAULT_SUPPORTED_CHAINS),this._privyInternal=e,t&&(this._proxy=new er(t,n),i.setProxy(this._proxy)),r){let e=(0,z.dedupeSupportedChains)(r);this._chains=e}this._mfa=i,this._mfaPromises=n,this._appApi=s}}var eE=ei;class eI extends eE.default{constructor(){super(),this.rootPromise={current:null},this.submitPromise={current:null}}}var eA=e.i(507686);let eS="u">typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ek=new Uint8Array(16),eT=[];for(let e=0;e<256;++e)eT.push((e+256).toString(16).slice(1));let eC=function(e,r,i){if(eS&&!r&&!e)return eS();let n=(e=e||{}).random||(e.rng||function(){if(!t&&!(t="u">typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(ek)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,r){i=i||0;for(let e=0;e<16;++e)r[i+e]=n[e];return r}return function(e,t=0){return eT[e[t+0]]+eT[e[t+1]]+eT[e[t+2]]+eT[e[t+3]]+"-"+eT[e[t+4]]+eT[e[t+5]]+"-"+eT[e[t+6]]+eT[e[t+7]]+"-"+eT[e[t+8]]+eT[e[t+9]]+"-"+eT[e[t+10]]+eT[e[t+11]]+eT[e[t+12]]+eT[e[t+13]]+eT[e[t+14]]+eT[e[t+15]]}(n)};var ex,eP,eO=((eP={}).OAUTH_ACCOUNT_SUSPENDED="oauth_account_suspended",eP.MISSING_OR_INVALID_PRIVY_APP_ID="missing_or_invalid_privy_app_id",eP.MISSING_OR_INVALID_PRIVY_CLIENT_ID="missing_or_invalid_privy_client_id",eP.MISSING_OR_INVALID_PRIVY_ACCOUNT_ID="missing_or_invalid_privy_account_id",eP.MISSING_OR_INVALID_TOKEN="missing_or_invalid_token",eP.MISSING_MFA_ENROLLMENT="missing_mfa_enrollment",eP.MISSING_OR_INVALID_MFA="missing_or_invalid_mfa",eP.EXPIRED_OR_INVALID_MFA_TOKEN="expired_or_invalid_mfa_token",eP.INVALID_DATA="invalid_data",eP.INVALID_CREDENTIALS="invalid_credentials",eP.INVALID_CAPTCHA="invalid_captcha",eP.LINKED_TO_ANOTHER_USER="linked_to_another_user",eP.ALLOWLIST_REJECTED="allowlist_rejected",eP.CANNOT_UNLINK_EMBEDDED_WALLET="cannot_unlink_embedded_wallet",eP.CANNOT_UNLINK_SOLE_ACCOUNT="cannot_unlink_sole_account",eP.CANNOT_LINK_MORE_OF_TYPE="cannot_link_more_of_type",eP.LINKED_ACCOUNT_NOT_FOUND="linked_account_not_found",eP.TOO_MANY_REQUESTS="too_many_requests",eP.RESOURCE_CONFLICT="resource_conflict",eP.INVALID_ORIGIN="invalid_origin",eP.MISSING_ORIGIN="missing_origin",eP.INVALID_NATIVE_APP_ID="invalid_native_app_id",eP.TOKEN_ALREADY_USED="token_already_used",eP.ALREADY_LOGGED_OUT="already_logged_out",eP.NOT_SUPPORTED="not_supported",eP.USER_UNSUBSCRIBED="user_unsubscribed",eP.MAX_APPS_REACHED="max_apps_reached",eP.USER_LIMIT_REACHED="max_accounts_reached",eP.DEVICE_REVOKED="device_revoked",eP.WALLET_PASSWORD_EXISTS="wallet_password_exists",eP.OAUTH_STATE_MISMATCH="oauth_state_mismatch",eP.MAX_DENYLIST_ENTRIES_REACHED="max_denylist_entries_reached",eP.MAX_TEST_ACCOUNTS_REACHED="max_test_accounts_reached",eP.DISALLOWED_LOGIN_METHOD="disallowed_login_method",eP.DISALLOWED_PLUS_EMAIL="disallowed_plus_email",eP.DISALLOWED_RECOVERY_METHOD="disallowed_recovery_method",eP.LEGACY_DASHBOARD_LOGIN_CONFIGURATION="legacy_dashboard_login_configuration",eP.CANNOT_SET_PASSWORD="cannot_set_password",eP.INVALID_PKCE_PARAMETERS="invalid_pkce_parameters",eP.INVALID_APP_URL_SCHEME_CONFIGURATION="invalid_app_url_scheme_configuration",eP.CROSS_APP_CONNECTION_NOT_ALLOWED="cross_app_connection_not_allowed",eP.USER_DOES_NOT_EXIST="user_does_not_exist",eP.ALREADY_EXISTS="resource_already_exists",eP.ACCOUNT_TRANSFER_REQUIRED="account_transfer_required",eP.USER_HAS_NOT_DELEGATED_WALLET="user_has_not_delegated_wallet",eP.FEATURE_NOT_ENABLED="feature_not_enabled",eP.INSUFFICIENT_FUNDS="insufficient_funds",eP.TRANSACTION_BROADCAST_FAILURE="transaction_broadcast_failure",eP.TRANSACTION_EXECUTION_FAILURE="transaction_execution_failure",eP.INVALID_SOLANA_TRANSACTION="invalid_solana_transaction",eP.INVALID_POLICY_FORMAT="invalid_policy_format",eP.INVALID_AGGREGATION_FORMAT="invalid_aggregation_format",eP.POLICY_VIOLATION="policy_violation",eP.AUTHORIZATION_KEY_HAS_ASSOCIATED_WALLETS="authorization_key_has_associated_wallets",eP.INVALID_REQUEST="invalid_request",eP.SIGNUP_DISABLED="signup_disabled",eP);let eR={path:"/api/v1/apps/:app_id",method:"GET"},eN={path:"/api/v1/analytics_events",method:"POST"},eM={path:"/api/v1/sessions",method:"POST"},eU={path:"/api/v1/sessions/logout",method:"POST"};var eD=ei,eL=e.i(39793),eL=eL;function ej(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}var eW=function e(t,r){function i(e,i,n){if("u">typeof document){"number"==typeof(n=ej({},r,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in n)n[a]&&(s+="; "+a,!0!==n[a]&&(s+="="+n[a].split(";")[0]));return document.cookie=e+"="+t.write(i,e)+s}}return Object.create({set:i,get:function(e){if("u">typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],i={},n=0;n<r.length;n++){var s=r[n].split("="),a=s.slice(1).join("=");try{var o=decodeURIComponent(s[0]);if(i[o]=t.read(a,o),e===o)break}catch(e){}}return e?i[e]:i}},remove:function(e,t){i(e,"",ej({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,ej({},this.attributes,t))},withConverter:function(t){return e(ej({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});e.s(["default",()=>eW],464143);var eB=e.i(417263);let eF=Promise.allSettled.bind(Promise)??(e=>Promise.all(e.map(e=>e.then(e=>({status:"fulfilled",value:e})).catch(e=>({status:"rejected",reason:e}))))),eq="privy:token",eH="privy-token",ez="privy:pat",e$="privy:refresh_token",eK="privy-refresh-token",eV="privy:id-token",eJ="privy-id-token",eG="privy-session";class eZ extends eD.default{set isUsingServerCookies(e){this._isUsingServerCookies=e}async getCustomerAccessToken(){let e=await this._storage.get(eq);try{return"string"==typeof e?new eB.Token(e).value:null}catch(e){return console.error(e),await this.destroyLocalState({reason:"getToken_error"}),null}}async getPrivyAccessToken(){let e=await this._storage.get(ez);try{return"string"==typeof e?new eB.Token(e).value:null}catch(e){return console.error(e),await this.destroyLocalState({reason:"getToken_error"}),null}}async getRefreshToken(){let e=await this._storage.get(e$);return"string"==typeof e?e:null}async getIdentityToken(){let e=await this._storage.get(eV);return"string"==typeof e?e:null}get mightHaveServerCookies(){try{let e=eW.get(eG);return void 0!==e&&e.length>0}catch(e){console.error(e)}return!1}hasRefreshCredentials(e,t){return this.mightHaveServerCookies||"string"==typeof e&&"string"==typeof t}tokenIsActive(e){if(!e)return!1;let t=eB.Token.parse(e);return null!==t&&!t.isExpired(30)}async destroyLocalState(e){await eF([this._storage.del(eq),this._storage.del(e$),this._storage.del(eV),this._storage.del(this.GUEST_CREDENTIAL_STORAGE_KEY)]),eW.remove(eH),eW.remove(eK),eW.remove(eJ),eW.remove(eG),e?.reason&&this.emit("storage_cleared",{reason:e.reason})}async storeCustomerAccessToken(e){if("string"==typeof e){let t=await this._storage.get(eq);if(await this._storage.put(eq,e),!this._isUsingServerCookies){let t=eB.Token.parse(e)?.expiration;eW.set(eH,e,{sameSite:"Strict",secure:!0,expires:t?new Date(1e3*t):void 0})}t!==e&&this.emit("token_stored",{cookiesEnabled:this._isUsingServerCookies})}else{let e=await this._storage.get(eq);await this._storage.del(eq),eW.remove(eH),null!==e&&this.emit("token_cleared",{reason:"set_with_non_string_value"})}}async storePrivyAccessToken(e){"string"==typeof e?await this._storage.put(ez,e):await this._storage.del(ez)}async storeRefreshToken(e){"string"==typeof e?(await this._storage.put(e$,e),this._isUsingServerCookies||(eW.set(eG,"t",{sameSite:"Strict",secure:!0,expires:30}),eW.set(eK,e,{sameSite:"Strict",secure:!0,expires:30})),this.emit("refresh_token_stored",{cookiesEnabled:this._isUsingServerCookies})):(await this._storage.del(e$),eW.remove(eK),eW.remove(eG),this.emit("refresh_token_cleared",{reason:"set_with_non_string_value"}))}async updateWithTokensResponse(e){let t=(await eF([this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token),this.storeRefreshToken(e.refresh_token),this.storeIdentityToken(e.identity_token),this.processOAuthTokens(e.oauth_tokens)])).filter(e=>"rejected"===e.status);t.length>0&&this.emit("error_storing_tokens",t.map(e=>String(e.reason)).join(", "))}async processOAuthTokens(e){e&&this.emit("oauth_tokens_granted",e)}async storeIdentityToken(e){if("string"==typeof e){let t=await this._storage.get(eV);if(await this._storage.put(eV,e),!this._isUsingServerCookies){let t=eB.Token.parse(e)?.expiration;eW.set(eJ,e,{sameSite:"Strict",secure:!0,expires:t?new Date(1e3*t):void 0})}t!==e&&this.emit("identity_token_stored",{cookiesEnabled:this._isUsingServerCookies})}else{let e=await this._storage.get(eV);await this._storage.del(eV),eW.remove(eJ),null!==e&&this.emit("identity_token_cleared",{reason:"set_with_non_string_value"})}}async getOrCreateGuestCredential(){let e=this._storage.get(this.GUEST_CREDENTIAL_STORAGE_KEY);if(e&&"string"==typeof e)return e;let t=eL.encode(crypto.getRandomValues(new Uint8Array(32)));return await this._storage.put(this.GUEST_CREDENTIAL_STORAGE_KEY,t),t}constructor(e){super(),this._isUsingServerCookies=!1,this._storage=e.storage,this.GUEST_CREDENTIAL_STORAGE_KEY=`privy:guest:${e.appId}`}}eZ.events=["storage_cleared","token_cleared","refresh_token_cleared","identity_token_cleared","token_stored","refresh_token_stored","identity_token_stored","oauth_tokens_granted","error_storing_tokens"];let eY=()=>{},eQ={NONE:-1/0,ERROR:1,WARN:2,INFO:3,DEBUG:1/0},eX="privy:caid";class e0{setCallbacks(e){this.callbacks={...this.callbacks,...e}}get isReady(){return!!this._config}get config(){return this._config}get caid(){return this._analyticsId}async _initialize(){if(this.isReady)this.callbacks?.setIsReady?.(!0);else{if(!await this.isStorageAccessible())throw new $.PrivyClientError({code:"storage_error",error:"Unable to access storage"});this._config=await this.getAppConfig(),this._config?.custom_api_url&&(this.baseUrl=this._config.custom_api_url,this.session.isUsingServerCookies=!0),this.callbacks?.setIsReady?.(!0),this._sdkVersion.startsWith("react-auth:")||this.createAnalyticsEvent("sdk_initialize",{})}}getPath(e,{params:t,query:r}){let i;return`${this.baseUrl}${i=e.path,t?Object.entries(t).reduce((e,[t,r])=>e.replace(`:${t}`,`${r}`),i):i}${function(e){let t=new URLSearchParams;for(let r in e)null!=e[r]&&t.append(r,String(e[r]));return Array.from(t).length?"?"+t.toString():""}(r)}`}async fetch(e,{body:t,params:r,query:i,headers:n,onRequest:s=this._beforeRequest.bind(this)}){let a=new Request(this.getPath(e,{params:r,query:i}),{method:e.method,body:JSON.stringify(t),headers:n}),o=await s(a),l=await this._fetch(a,o),c=await l.json();if(l.status>299)throw new $.PrivyApiError({...c,status:l.status});return c}async _beforeRequestWithoutInitialize(e){let t,r=await this.session.getPrivyAccessToken()??await this.session.getCustomerAccessToken(),i=new Headers(e.headers);i.set("privy-app-id",this.appId),this.appClientId&&i.set("privy-client-id",this.appClientId),i.set("privy-client",this._sdkVersion),r&&i.set("Authorization",`Bearer ${r}`),i.set("Content-Type","application/json"),i.set("Accept","application/json");let n=await this._getOrGenerateClientAnalyticsId();return n&&i.set("privy-ca-id",n),this.nativeAppIdentifier&&i.set("x-native-app-identifier",this.nativeAppIdentifier),{signal:(t=new AbortController,setTimeout(()=>t.abort(),2e4),t.signal),headers:i,credentials:"include"}}async beforeRequestWithoutRefresh(e){return await this._initialize(),this._beforeRequestWithoutInitialize(e)}async _beforeRequest(e){return await this._initialize(),await this.getAccessTokenInternal(),this.beforeRequestWithoutRefresh(e)}async getAppConfig(){return await this.fetch(eR,{params:{app_id:this.appId},onRequest:this._beforeRequestWithoutInitialize.bind(this)})}async _getOrGenerateClientAnalyticsId(){if(this._analyticsId)return this._analyticsId;try{let e=await this._storage.get(eX);if("string"==typeof e&&e.length>0)return this._analyticsId=e,e}catch(e){this.logger.error("Unable to load clientId",e)}try{this._analyticsId=eC()}catch(e){this.logger.error("Unable to generate uuidv4",e)}if(this._analyticsId){try{await this._storage.put(eX,this._analyticsId)}catch(e){this.logger.error(`Unable to store clientId: ${this._analyticsId}`,e)}return this._analyticsId}}async destroyClientAnalyticsId(){try{return await this._storage.del(eX)}catch(e){this.logger.error("Unable to delete clientId",e)}}async createAnalyticsEvent(e,t){try{await this.fetch(eN,{body:{event_name:e,client_id:await this._getOrGenerateClientAnalyticsId(),payload:t},onRequest:this.beforeRequestWithoutRefresh.bind(this)})}catch(e){}}async refreshSession(e=!1){if(!await this.isStorageAccessible())throw new $.PrivyClientError({code:"storage_error",error:"Unable to access storage"});let t=await this.session.getRefreshToken()??void 0,r=t??"key",i=this._cache.get(r);if(i)return this.logger.debug("[privy:refresh] found in-flight session refresh request, deduping"),await i;let n=this._refreshSession(t,e);this._cache.set(r,n);try{return await n}finally{this._cache.delete(r)}}async _refreshSession(e,t){let r=await this.session.getCustomerAccessToken();if(!this.session.hasRefreshCredentials(r,e??null))throw this.logger.debug("[privy:refresh] missing tokens, skipping request"),await this._initialize(),new $.PrivyApiError({code:eO.MISSING_OR_INVALID_TOKEN,error:"No tokens found in storage",status:401});try{this.logger.debug(`[privy:refresh] fetching: ${eM.path}`);let r=await this.fetch(eM,{body:{refresh_token:e},onRequest:this.beforeRequestWithoutRefresh.bind(this)}),i=r.session_update_action;return this.logger.debug(`[privy:refresh] response: ${i}`),"set"===i&&(await this.session.updateWithTokensResponse(r),this.logger.debug("[privy:refresh] tokens stored")),"clear"===i&&(await this.session.destroyLocalState(),this.logger.debug("[privy:refresh] tokens cleared"),t||this.callbacks?.setUser?.(null)),"ignore"===i&&(r.token&&(await this.session.storeCustomerAccessToken(r.token),this.logger.debug("[privy:refresh] token stored (CAT)")),r.privy_access_token&&(await this.session.storePrivyAccessToken(r.privy_access_token),this.logger.debug("[privy:refresh] token stored (PAT)")),r.identity_token&&(this.logger.debug("[privy:refresh] token stored (IDT)"),await this.session.storeIdentityToken(r.identity_token))),this.logger.debug("[privy:refresh] returning response"),t||this.callbacks?.setUser?.(r.user),r}catch(e){throw this.logger.debug(`[privy:refresh] error: ${e.message??"unknown error"}`),e instanceof $.PrivyApiError&&e.code===eO.MISSING_OR_INVALID_TOKEN&&(await this.session.destroyLocalState(),t||this.callbacks?.setUser?.(null)),e}}async getAccessToken(){let[e,t]=await Promise.all([this.session.getCustomerAccessToken(),this.session.getRefreshToken()]);if(!this.session.tokenIsActive(e)&&this.session.hasRefreshCredentials(e,t)){let t=await this.refreshSession(),r=await this.session.getCustomerAccessToken();return t.token||this.logger.debug("[privy:getAccessToken] expected token received null"),t.token===e&&this.logger.debug("[privy:getAccessToken] expected new token in response received existing"),r===e&&this.logger.debug("[privy:getAccessToken] expected new token in storage received existing"),t.token??r}return e}async getAccessTokenInternal(){let e=await this.getAccessToken();return await this.session.getPrivyAccessToken()??e}async getIdentityToken(){return await this.session.getIdentityToken()}async isStorageAccessible(){try{let e=`privy:__storage__test-${eC()}`,t="blobby";await this._storage.put(e,t);let r=await this._storage.get(e);return await this._storage.del(e),r===t}catch(e){return this.logger.error(e),!1}}constructor(e){this._sdkVersion="js-sdk-core:0.60.2",this._cache=new Map,this.logger=(({level:e}={level:"ERROR"})=>({get level(){return e},error:eQ[e]>=eQ.ERROR?console.error:eY,warn:eQ[e]>=eQ.WARN?console.warn:eY,info:eQ[e]>=eQ.INFO?console.info:eY,debug:eQ[e]>=eQ.DEBUG?console.debug:eY}))({level:e.logLevel??"ERROR"}),this._storage=e.storage,this._analyticsId=null,this._getOrGenerateClientAnalyticsId(),this.baseUrl=e.baseUrl??"https://auth.privy.io",this.appId=e.appId,this.appClientId=e.appClientId,this._sdkVersion=e.sdkVersion??this._sdkVersion,this.callbacks=e.callbacks,this.nativeAppIdentifier=e.nativeAppIdentifier,this.session=new eZ({storage:this._storage,isUsingServerCookies:!1,appId:e.appId}),this._fetch=(0,eA.default)(globalThis.fetch,{retries:3,retryDelay:e=>3**e*500,retryOn:[408,409,425,500,502,503,504]}),this.session.on("error_storing_tokens",e=>{this.createAnalyticsEvent("error_updating_tokens_in_storage",{reason:e})})}}let e1={path:"/api/v1/users/me/accept_terms",method:"POST"};class e2{async get(){let{user:e}=await this._privyInternal.refreshSession();return{user:e}}async acceptTerms(){return{user:await this._privyInternal.fetch(e1,{})}}constructor(e){this._privyInternal=e}}let e5={path:"/api/v1/custom_jwt_account/authenticate",method:"POST"},e3={path:"/api/v1/custom_jwt_account/link",method:"POST"},e8=e=>"wallet"===e.type&&"privy"===e.wallet_client_type&&"embedded"===e.connector_type,e4=e=>e?e.linked_accounts.filter(e8).filter(e=>"ethereum"===e.chain_type).sort((e,t)=>e.wallet_index-t.wallet_index):[],e6=e=>e4(e).find(e=>0===e.wallet_index)??null,e9=e=>e?e.linked_accounts.filter(e8).filter(e=>"solana"===e.chain_type).sort((e,t)=>e.wallet_index-t.wallet_index):[],e7=async(e,t,r)=>{let i,n,s,a,o=(i=t.user,!("off"===(n=r?.ethereum?.createOnLogin??"off")||e4(i).length>0||i.linked_accounts.filter(e=>"wallet"===e.type&&"ethereum"===e.chain_type).length>0&&"all-users"!==n)),l=(s=t.user,!("off"===(a=r?.solana?.createOnLogin??"off")||e9(s).length>0||s.linked_accounts.filter(e=>"wallet"===e.type&&"solana"===e.chain_type).length>0&&"all-users"!==a));if(o&&l){let r=await e.create({recoveryMethod:"privy",skipCallbacks:!0});return{...await e.createSolana({ethereumAccount:e6(r.user)??void 0}),is_new_user:t.is_new_user,oauth_tokens:t.oauth_tokens}}return o?{...await e.create({recoveryMethod:"privy",solanaAccount:e9(t.user).find(e=>0===e.wallet_index)??null??void 0}),is_new_user:t.is_new_user,oauth_tokens:t.oauth_tokens}:l?{...await e.createSolana({ethereumAccount:e6(t.user)??void 0}),is_new_user:t.is_new_user,oauth_tokens:t.oauth_tokens}:t};class te{async syncWithToken(e,t,r){let i=await this._privyInternal.fetch(e5,{body:{token:e,mode:r}});await this._privyInternal.session.updateWithTokensResponse(i);let n=await e7(this._embedded,i,t?.embedded);return this._privyInternal.callbacks?.setUser?.(n.user),n}async linkWithToken(e){await this._privyInternal.fetch(e3,{body:{token:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}constructor(e,t){this._privyInternal=e,this._embedded=t}}let tt={path:"/api/v1/passwordless/authenticate",method:"POST"},tr={path:"/api/v1/passwordless/init",method:"POST"},ti={path:"/api/v1/passwordless/link",method:"POST"},tn={path:"/api/v1/passwordless/unlink",method:"POST"},ts={path:"/api/v1/passwordless/update",method:"POST"};class ta{async sendCode(e,t){return this._privyInternal.fetch(tr,{body:{email:e,token:t}})}async loginWithCode(e,t,r,i){let n=await this._privyInternal.fetch(tt,{body:{email:e,code:t,mode:r}});await this._privyInternal.session.updateWithTokensResponse(n);let s=await e7(this._embedded,n,i?.embedded);return this._privyInternal.callbacks?.setUser?.(s.user),s}async linkWithCode(e,t){await this._privyInternal.fetch(ti,{body:{email:e,code:t}});let r=await this._privyInternal.refreshSession();return{user:r.user,identity_token:r.identity_token}}async updateEmail({oldEmailAddress:e,newEmailAddress:t,code:r}){await this._privyInternal.fetch(ts,{body:{oldAddress:e,newAddress:t,code:r}});let i=await this._privyInternal.refreshSession();return{user:i.user,identity_token:i.identity_token}}async unlink(e){await this._privyInternal.fetch(tn,{body:{address:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}constructor(e,t){this._privyInternal=e,this._embedded=t}}let to={path:"/api/v1/farcaster/init",method:"POST"},tl={path:"/api/v1/farcaster/authenticate",method:"POST"},tc={path:"/api/v1/farcaster/link",method:"POST"},td={path:"/api/v1/farcaster/unlink",method:"POST"},tu={path:"/api/v1/farcaster/status",method:"GET"},th={path:"/api/v2/farcaster/init",method:"POST"},tp={path:"/api/v2/farcaster/authenticate",method:"POST"};class tf{async initializeAuth({relyingParty:e,redirectUrl:t,token:r}){return await this._privyInternal.fetch(to,{body:{relying_party:e,redirect_url:t,token:r}})}async getFarcasterStatus({channel_token:e}){return await this._privyInternal.fetch(tu,{headers:{"farcaster-channel-token":e}})}async authenticate({channel_token:e,message:t,signature:r,fid:i,mode:n},s){let a=await this._privyInternal.fetch(tl,{body:{channel_token:e,message:t,signature:r,fid:i,mode:n}});await this._privyInternal.session.updateWithTokensResponse(a);let o=await e7(this._embedded,a,s?.embedded);return this._privyInternal.callbacks?.setUser?.(o.user),o}async link({channel_token:e,message:t,signature:r,fid:i}){await this._privyInternal.fetch(tc,{body:{channel_token:e,message:t,signature:r,fid:i}});let n=await this._privyInternal.refreshSession();return{user:n.user,identity_token:n.identity_token}}async unlink({fid:e}){await this._privyInternal.fetch(td,{body:{fid:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}constructor(e,t){this._privyInternal=e,this._embedded=t}}class ty{async initializeAuth(){return await this._privyInternal.fetch(th,{body:{}})}async authenticate({message:e,signature:t,fid:r},i){let n=await this._privyInternal.fetch(tp,{body:{message:e,signature:t,fid:r}});await this._privyInternal.session.updateWithTokensResponse(n);let s=await e7(this._embedded,n,i?.embedded);return this._privyInternal.callbacks?.setUser?.(s.user),s}constructor(e,t){this._privyInternal=e,this._embedded=t}}let tg={path:"/api/v1/guest/authenticate",method:"POST"};class tm{async create(e){let t=await this._privyInternal.session.getOrCreateGuestCredential(),r=await this._privyInternal.fetch(tg,{body:{guest_credential:t}});await this._privyInternal.session.updateWithTokensResponse(r);let i=await e7(this._embedded,r,e?.embedded);return this._privyInternal.callbacks?.setUser?.(i.user),i}constructor(e,t){this._privyInternal=e,this._embedded=t}}let tw={path:"/api/v1/oauth/authenticate",method:"POST"},tv={path:"/api/v1/oauth/init",method:"POST"},tb={path:"/api/v1/oauth/link",method:"POST"},t_={path:"/api/v1/oauth/unlink",method:"POST"};var eL=eL;let tE="privy:state_code",tI="privy:code_verifier";async function tA(e,t){let r=(new TextEncoder).encode(e);return new Uint8Array(await t("SHA-256",r))}function tS(){return eL.encode(crypto.getRandomValues(new Uint8Array(36)))}async function tk({codeVerifier:e,method:t="S256",digest:r=crypto.subtle.digest.bind(crypto.subtle)}){if("S256"!=t)return e;{let t=await tA(e,r);return eL.encode(t)}}class tT{async generateURL(e,t){let r=tS(),i=tS(),n=await tk({codeVerifier:r,digest:this._crypto?.digest});return await Promise.all([this._storage.put(tI,r),this._storage.put(tE,i)]),this._privyInternal.fetch(tv,{body:{redirect_to:t,provider:e,code_challenge:n,state_code:i}})}async loginWithCode(e,t,r,i,n,s){let[a,o]=await Promise.all([this._storage.get(tI),this._storage.get(tE)]);if(o!==t)throw this._privyInternal.createAnalyticsEvent("possible_phishing_attempt",{flow:"oauth",provider:r,storedStateCode:o??"",returnedStateCode:t??""}),new $.PrivyClientError({code:"pkce_state_code_mismatch",error:"Unexpected auth flow. This may be a phishing attempt."});let l=await this._privyInternal.fetch(tw,{body:{authorization_code:e,code_type:i,state_code:o,code_verifier:a,mode:n}});await this._privyInternal.session.updateWithTokensResponse(l);let c=await e7(this._embedded,l,s?.embedded);return await Promise.all([this._storage.del(tI),this._storage.del(tE)]),this._privyInternal.callbacks?.setUser?.(c.user),c}async linkWithCode(e,t,r,i){let[n,s]=await Promise.all([this._storage.get(tI),this._storage.get(tE)]);if(s!==t)throw this._privyInternal.createAnalyticsEvent("possible_phishing_attempt",{flow:"oauth",provider:r,storedStateCode:s??"",returnedStateCode:t??""}),new $.PrivyClientError({code:"pkce_state_code_mismatch",error:"Unexpected auth flow. This may be a phishing attempt."});let a=await this._privyInternal.fetch(tb,{body:{authorization_code:e,code_type:i,state_code:s,code_verifier:n}});await this._privyInternal.session.processOAuthTokens(a.oauth_tokens);let o=await this._privyInternal.refreshSession();return await Promise.all([this._storage.del(tI),this._storage.del(tE)]),{user:o.user,identity_token:o.identity_token}}async unlink(e,t){await this._privyInternal.fetch(t_,{body:{provider:e,subject:t}});let r=await this._privyInternal.refreshSession();return{user:r.user,identity_token:r.identity_token}}constructor(e,t,r,i){this._privyInternal=e,this._embedded=t,this._storage=r,this._crypto=i}}let tC={path:"/api/v1/passkeys/link",method:"POST"},tx={path:"/api/v1/passkeys/authenticate",method:"POST"},tP={path:"/api/v1/passkeys/register",method:"POST"},tO={path:"/api/v1/passkeys/authenticate/init",method:"POST"},tR={path:"/api/v1/passkeys/register/init",method:"POST"},tN={path:"/api/v1/passkeys/link/init",method:"POST"};class tM{async generateRegistrationOptions(e){return await this._privyInternal.fetch(tN,{body:{relying_party:e}})}async generateAuthenticationOptions(e){return await this._privyInternal.fetch(tO,{body:{relying_party:e}})}async generateSignupOptions(e){return await this._privyInternal.fetch(tR,{body:{relying_party:e}})}async loginWithPasskey(e,t,r,i){let n=await this._privyInternal.fetch(tx,{body:{relying_party:r,challenge:t,authenticator_response:this._transformAuthenticationResponseToSnakeCase(e)}});await this._privyInternal.session.updateWithTokensResponse(n);let s=await e7(this._embedded,n,i?.embedded);return this._privyInternal.callbacks?.setUser?.(s.user),s}async signupWithPasskey(e,t,r){let i=await this._privyInternal.fetch(tP,{body:{relying_party:t,authenticator_response:this._transformRegistrationResponseToSnakeCase(e)}});await this._privyInternal.session.updateWithTokensResponse(i);let n=await e7(this._embedded,i,r?.embedded);return this._privyInternal.callbacks?.setUser?.(n.user),n}async linkWithPasskey(e,t){await this._privyInternal.fetch(tC,{body:{relying_party:t,authenticator_response:this._transformRegistrationResponseToSnakeCase(e)}});let r=await this._privyInternal.refreshSession();return{user:r.user,identity_token:r.identity_token}}_transformRegistrationResponseToSnakeCase(e){return{type:e.type,id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,attestation_object:e.response.attestationObject,authenticator_data:e.response.authenticatorData||void 0,transports:e.response.transports||void 0,public_key:e.response.publicKey||void 0,public_key_algorithm:e.response.publicKeyAlgorithm||void 0},authenticator_attachment:e.authenticatorAttachment||void 0,client_extension_results:{app_id:e.clientExtensionResults.appid||void 0,cred_props:e.clientExtensionResults.credProps||void 0,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret||void 0}}}_transformAuthenticationResponseToSnakeCase(e){return{type:e.type,id:e.id,raw_id:e.rawId,response:{signature:e.response.signature,client_data_json:e.response.clientDataJSON,authenticator_data:e.response.authenticatorData,user_handle:e.response.userHandle||void 0},authenticator_attachment:e.authenticatorAttachment||void 0,client_extension_results:{app_id:e.clientExtensionResults.appid||void 0,cred_props:e.clientExtensionResults.credProps||void 0,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret||void 0}}}constructor(e,t){this._privyInternal=e,this._embedded=t}}let tU={path:"/api/v1/passwordless_sms/authenticate",method:"POST"},tD={path:"/api/v1/passwordless_sms/init",method:"POST"},tL={path:"/api/v1/passwordless_sms/link",method:"POST"},tj={path:"/api/v1/passwordless_sms/unlink",method:"POST"},tW={path:"/api/v1/passwordless_sms/update",method:"POST"};class tB{async sendCode(e,t){return this._privyInternal.fetch(tD,{body:{phoneNumber:e,token:t}})}async loginWithCode(e,t,r,i){let n=await this._privyInternal.fetch(tU,{body:{phoneNumber:e,code:t,mode:r}});await this._privyInternal.session.updateWithTokensResponse(n);let s=await e7(this._embedded,n,i?.embedded);return this._privyInternal.callbacks?.setUser?.(s.user),s}async linkWithCode(e,t){await this._privyInternal.fetch(tL,{body:{phoneNumber:e,code:t}});let r=await this._privyInternal.refreshSession();return{user:r.user,identity_token:r.identity_token}}async updatePhone({oldPhoneNumber:e,newPhoneNumber:t,code:r}){await this._privyInternal.fetch(tW,{body:{old_phone_number:e,new_phone_number:t,code:r}});let i=await this._privyInternal.refreshSession();return{user:i.user,identity_token:i.identity_token}}async unlink(e){await this._privyInternal.fetch(tj,{body:{phoneNumber:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}constructor(e,t){this._privyInternal=e,this._embedded=t}}let tF={path:"/api/v1/siwe/init",method:"POST"},tq={path:"/api/v1/siwe/authenticate",method:"POST"},tH={path:"/api/v1/siwe/link",method:"POST"},tz={path:"/api/v1/siwe/link_smart_wallet",method:"POST"},t$={path:"/api/v1/siwe/unlink",method:"POST"};class tK{async unlinkWallet(e){await this._privyInternal.fetch(t$,{body:{address:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}async linkWithSiwe(e,t,r){let i=t||this._wallet,n=r||this._preparedMessage;if(!i)throw Error("A wallet must be provided in the init step or as an argument to linkWithSiwe");if(!n)throw Error("A message must be generated and signed before being used to link a wallet to privy");await this._privyInternal.fetch(tH,{body:{message:n,signature:e,chainId:i.chainId,walletClientType:i.walletClientType??null,connectorType:i.connectorType??null}});let s=await this._privyInternal.refreshSession();return{user:s.user,identity_token:s.identity_token}}async loginWithSiwe(e,t,r,i,n){let s=t||this._wallet,a=r||this._preparedMessage;if(!s)throw Error("A wallet must be provided in the init step or as an argument to loginWithSiwe");if(!a)throw Error("A message must be generated and signed before being used to login to privy with a wallet");let o=await this._privyInternal.fetch(tq,{body:{signature:e,message:a,chainId:s.chainId,walletClientType:s.walletClientType??null,connectorType:s.connectorType??null,mode:i}});await this._privyInternal.session.updateWithTokensResponse(o);let l=await e7(this._embedded,o,n?.embedded);return this._privyInternal.callbacks?.setUser?.(l.user),l}async init(e,t,r){var i;this._wallet=e;let{nonce:n}=await this._privyInternal.fetch(tF,{body:{address:e.address}}),s=`${(i={chainId:e.chainId.toString().replace("eip155:",""),address:e.address,issuedAt:(new Date).toISOString(),statement:"By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.",domain:t,nonce:n,uri:r}).domain} wants you to sign in with your Ethereum account:
${i.address}

${i.statement}

URI: ${i.uri}
Version: 1
Chain ID: ${i.chainId}
Nonce: ${i.nonce}
Issued At: ${i.issuedAt}
Resources:
- https://privy.io`;return this._preparedMessage=s,{nonce:n,message:s}}constructor(e,t){this._wallet=void 0,this._privyInternal=e,this._embedded=t}}let tV={path:"/api/v1/siws/init",method:"POST"},tJ={path:"/api/v1/siws/authenticate",method:"POST"},tG={path:"/api/v1/siws/link",method:"POST"},tZ={path:"/api/v1/siws/unlink",method:"POST"};class tY{async unlink({address:e}){await this._privyInternal.fetch(tZ,{body:{address:e}});let t=await this._privyInternal.refreshSession();return{user:t.user,identity_token:t.identity_token}}async link({message:e,signature:t,walletClientType:r,connectorType:i}){await this._privyInternal.fetch(tG,{body:{message:e,signature:t,walletClientType:r??null,connectorType:i??null}});let n=await this._privyInternal.refreshSession();return{user:n.user,identity_token:n.identity_token}}async login({mode:e,message:t,signature:r,walletClientType:i,connectorType:n,opts:s}){let a=await this._privyInternal.fetch(tJ,{body:{signature:r,message:t,walletClientType:i??null,connectorType:n??null,mode:e}});await this._privyInternal.session.updateWithTokensResponse(a);let o=await e7(this._embedded,a,s?.embedded);return this._privyInternal.callbacks?.setUser?.(o.user),o}async fetchNonce({address:e}){let{nonce:t}=await this._privyInternal.fetch(tV,{body:{address:e}});return{nonce:t}}constructor(e,t){this._privyInternal=e,this._embedded=t}}class tQ{async link(e,t,r,i){await this._privyInternal.fetch(tz,{body:{message:e,signature:t,smart_wallet_type:r,smart_wallet_version:i}});let n=await this._privyInternal.refreshSession();return{user:n.user,identity_token:n.identity_token}}async init(e){var t;let{nonce:r}=await this._privyInternal.fetch(tF,{body:{address:e.address}});return{nonce:r,message:`${(t={chainId:e.chainId.toString().replace("eip155:",""),address:e.address,issuedAt:(new Date).toISOString(),statement:"By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.",domain:"privy.io",uri:"https://auth.privy.io",nonce:r}).domain} wants you to sign in with your Ethereum account:
${t.address}

${t.statement}

URI: ${t.uri}
Version: 1
Chain ID: ${t.chainId}
Nonce: ${t.nonce}
Issued At: ${t.issuedAt}
Resources:
- https://privy.io`}}constructor(e){this._privyInternal=e}}class tX{async logout(e){try{let e=await this._privyInternal.session.getRefreshToken()??void 0;await this._privyInternal.fetch(eU,{body:{refresh_token:e}})}catch(e){console.warn("Error destroying session")}await Promise.all([this._privyInternal.session.destroyLocalState({reason:"logout"}),this._privyInternal.destroyClientAnalyticsId(),e?.userId&&this._mfa.clearMfa({userId:e.userId})]),this._privyInternal.callbacks?.setUser?.(null)}constructor(e,t,r,i,n){this._privyInternal=e,this._mfa=n,this.customProvider=new te(this._privyInternal,t),this.phone=new tB(this._privyInternal,t),this.email=new ta(this._privyInternal,t),this.oauth=new tT(this._privyInternal,t,r,i),this.guest=new tm(this._privyInternal,t),this.siwe=new tK(this._privyInternal,t),this.siws=new tY(this._privyInternal,t),this.smartWallet=new tQ(this._privyInternal),this.passkey=new tM(this._privyInternal,t),this.farcaster=new tf(this._privyInternal,t),this.farcasterV2=new ty(this._privyInternal,t)}}let t0={path:"/api/v1/funding/coinbase_on_ramp/init",method:"POST"},t1={path:"/api/v1/funding/coinbase_on_ramp/status",method:"GET"};class t2{async initOnRampSession(e){return await this._privyInternal.fetch(t0,{body:e})}async getStatus(e){return await this._privyInternal.fetch(t1,{query:{partnerUserId:e}})}constructor(e){this._privyInternal=e}}let t5={path:"/api/v1/plugins/moonpay_on_ramp/sign",method:"POST"};var t3=e.i(614003);class t8{async sign(e){return await this._privyInternal.fetch(t5,{body:e})}async getTransactionStatus({transactionId:e,useSandbox:t}){let{url:r,key:i}=t3.MoonpayEnvironments[t?"sandbox":"prod"],n=await (0,eA.default)(fetch,{retries:3,retryDelay:500})(`${r}/transactions/ext/${e}?apiKey=${i}`);if(!n.ok)throw new $.MoonpayApiError({error:`Failed to fetch transaction status for Transaction ${e}`,code:"failed_to_fetch_moonpay_transaction_status",response:n});let s=await n.json();return Array.isArray(s)?s.at(0):void 0}constructor(e){this._privyInternal=e}}class t4{constructor(e){this.moonpay=new t8(e),this.coinbase=new t2(e)}}let t6={path:"/api/v1/mfa/passkeys/init",method:"POST"};class t9{async generateAuthenticationOptions(e){return await this._privyInternal.fetch(t6,{body:e})}constructor(e){this._privyInternal=e}}let t7={path:"/api/v1/mfa/passwordless_sms/init",method:"POST"};class re{async sendCode(e){return await this._privyInternal.fetch(t7,{body:e})}constructor(e){this._privyInternal=e}}class rt{setProxy(e){this.proxy=e}async getAccessTokenInternal(){let e=await this.privyInternal.getAccessTokenInternal();if(!e)throw new $.PrivyClientError({error:"Missing access token",code:"attempted_rpc_call_before_logged_in"});return e}async verifyMfa(){if(!this.proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});return await this.proxy.verifyMfa({accessToken:await this.getAccessTokenInternal()})}async initEnrollMfa(e){if(!this.proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});return await this.proxy.initEnrollMfa({...e,accessToken:await this.getAccessTokenInternal()})}async submitEnrollMfa(e){if(!this.proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});let t=await this.proxy.submitEnrollMfa({...e,accessToken:await this.getAccessTokenInternal()});return await this.privyInternal.refreshSession(),t}async unenrollMfa(e){if(!this.proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});let t=await this.proxy.unenrollMfa({method:e,accessToken:await this.getAccessTokenInternal()});return await this.privyInternal.refreshSession(),t}async clearMfa(e){if(!this.proxy)throw new $.PrivyClientError({error:"Embedded wallet proxy not initialized",code:"embedded_wallet_webview_not_loaded"});return await this.proxy.clearMfa(e)}constructor(e,t){this.proxy=t,this.privyInternal=e,this.sms=new re(e),this.passkey=new t9(e)}}let rr={path:"/api/v1/embedded_wallets/:address/recovery/key_material",method:"POST"},ri={path:"/api/v1/recovery/oauth/init",method:"POST"},rn={path:"/api/v1/recovery/oauth/authenticate",method:"POST"},rs={path:"/api/v1/recovery/oauth/init_icloud",method:"POST"},ra={path:"/api/v1/recovery/configuration_icloud",method:"POST"},ro=class{async init(e){return this._privyInternal.fetch(rs,{body:{client_type:e}})}async getICloudConfiguration(e){return this._privyInternal.fetch(ra,{body:{client_type:e}})}constructor(e){this._privyInternal=e}};class rl{async generateURL(e){let t=tS(),r=tS(),i=await tk({codeVerifier:t,digest:this._crypto?.digest});return await Promise.all([this._storage.put(tI,t),this._storage.put(tE,r)]),this._privyInternal.fetch(ri,{body:{redirect_to:e,code_challenge:i,state_code:r}})}async authorize(e,t){let[r,i]=await Promise.all([this._storage.get(tI),this._storage.get(tE)]);if(i!==t)throw this._privyInternal.createAnalyticsEvent("possible_phishing_attempt",{flow:"recovery_oauth",storedStateCode:i??"",returnedStateCode:t??""}),new $.PrivyClientError({code:"pkce_state_code_mismatch",error:"Unexpected auth flow. This may be a phishing attempt."});let n=await this._privyInternal.fetch(rn,{body:{authorization_code:e,state_code:i,code_verifier:r}});return await Promise.all([this._storage.del(tI),this._storage.del(tE)]),n}constructor(e,t,r){this._privyInternal=e,this._storage=t,this._crypto=r}}class rc{async getRecoveryKeyMaterial(e,t){return this._privyInternal.fetch(rr,{body:{chain_type:t},params:{address:e}})}constructor(e,t,r){this._privyInternal=e,this.auth=new rl(this._privyInternal,t,r),this.icloudAuth=new ro(this._privyInternal)}}class rd{async initialize(){await this._privyInternal._initialize()}setMessagePoster(e){this.embeddedWallet.setMessagePoster(e)}addOAuthTokensListener(e){return this._privyInternal.session.on("oauth_tokens_granted",e),{unsubscribe:()=>{this._privyInternal.session.removeListener("oauth_tokens_granted",e)}}}setCallbacks(e){this._privyInternal.setCallbacks(e)}getAccessToken(){return this._privyInternal.getAccessToken()}getIdentityToken(){return this._privyInternal.getIdentityToken()}getCompiledPath(e,t){return this._privyInternal.getPath(e,t)}async fetchPrivyRoute(e,t){return this._privyInternal.fetch(e,t)}get logger(){return this._privyInternal.logger}constructor({clientId:e,...t}){this._privyInternal=new e0({...t,appClientId:e}),this.mfa=new rt(this._privyInternal),this.mfaPromises=new eI,this.app=new B.default(this._privyInternal),this.embeddedWallet=new e_(this._privyInternal,t.embeddedWalletMessagePoster,t.supportedChains,this.mfa,this.mfaPromises,this.app),this.user=new e2(this._privyInternal),this.auth=new tX(this._privyInternal,this.embeddedWallet,t.storage,t.crypto,this.mfa),this.recovery=new rc(this._privyInternal,t.storage,t.crypto),this.funding=new t4(this._privyInternal),this.delegated=new q.default(this._privyInternal),this.crossApp=new F.default(this._privyInternal,t.storage)}}e.i(564137);e.i(94319);var ru=e.i(147494);e.s([],184591),e.i(184591);var rh=e.i(854301),rp=e.i(521446),rf=e.i(568873);let ry=rf.default.getRandomValues.bind(rf.default);function rg(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new ru.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}let rm=e=>ry(new Uint8Array(rg(e)>>3)),rw=(e,t)=>{if(t.length<<3!==rg(e))throw new ru.JWEInvalid("Invalid Initialization Vector length")},rv=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new ru.JWEInvalid(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)};function rb(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function r_(e,t){return e.name===t}function rE(e){return parseInt(e.name.slice(4),10)}function rI(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function rA(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!r_(e.algorithm,"AES-GCM"))throw rb("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rb(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!r_(e.algorithm,"AES-KW"))throw rb("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rb(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw rb("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!r_(e.algorithm,"PBKDF2"))throw rb("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!r_(e.algorithm,"RSA-OAEP"))throw rb("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(rE(e.algorithm.hash)!==r)throw rb(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}rI(e,r)}function rS(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let rk=(e,...t)=>rS("Key must be ",e,...t);function rT(e,t,...r){return rS(`Key for the ${e} algorithm must be `,t,...r)}let rC=e=>(0,rf.isCryptoKey)(e),rx=["CryptoKey"];async function rP(e,t,r,i,n,s){let a,o;if(!(t instanceof Uint8Array))throw TypeError(rk(t,"Uint8Array"));let l=parseInt(e.slice(1,4),10),c=await rf.default.subtle.importKey("raw",t.subarray(l>>3),"AES-CBC",!1,["decrypt"]),d=await rf.default.subtle.importKey("raw",t.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),u=(0,rp.concat)(s,i,r,(0,rp.uint64be)(s.length<<3)),h=new Uint8Array((await rf.default.subtle.sign("HMAC",d,u)).slice(0,l>>3));try{a=((e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,i=0,n=-1;for(;++n<r;)i|=e[n]^t[n];return 0===i})(n,h)}catch(e){}if(!a)throw new ru.JWEDecryptionFailed;try{o=new Uint8Array(await rf.default.subtle.decrypt({iv:i,name:"AES-CBC"},c,r))}catch(e){}if(!o)throw new ru.JWEDecryptionFailed;return o}async function rO(e,t,r,i,n,s){let a;t instanceof Uint8Array?a=await rf.default.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(rA(t,e,"decrypt"),a=t);try{return new Uint8Array(await rf.default.subtle.decrypt({additionalData:s,iv:i,name:"AES-GCM",tagLength:128},a,(0,rp.concat)(r,n)))}catch(e){throw new ru.JWEDecryptionFailed}}let rR=async(e,t,r,i,n,s)=>{if(!(0,rf.isCryptoKey)(t)&&!(t instanceof Uint8Array))throw TypeError(rk(t,...rx,"Uint8Array"));switch(rw(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&rv(t,parseInt(e.slice(-3),10)),rP(e,t,r,i,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&rv(t,parseInt(e.slice(1,4),10)),rO(e,t,r,i,n,s);default:throw new ru.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}},rN=async()=>{throw new ru.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},rM=async()=>{throw new ru.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},rU=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};var rD=e.i(491894);let rL=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function rj(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function rW(e,t,r){if((0,rf.isCryptoKey)(e))return rA(e,t,r),e;if(e instanceof Uint8Array)return rf.default.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(rk(e,...rx,"Uint8Array"))}let rB=async(e,t,r)=>{let i=await rW(t,e,"wrapKey");rj(i,e);let n=await rf.default.subtle.importKey("raw",r,...rL);return new Uint8Array(await rf.default.subtle.wrapKey("raw",n,i,"AES-KW"))},rF=async(e,t,r)=>{let i=await rW(t,e,"unwrapKey");rj(i,e);let n=await rf.default.subtle.unwrapKey("raw",r,i,"AES-KW",...rL);return new Uint8Array(await rf.default.subtle.exportKey("raw",n))};async function rq(e,t,r,i,n=new Uint8Array(0),s=new Uint8Array(0)){let a;if(!(0,rf.isCryptoKey)(e))throw TypeError(rk(e,...rx));if(rA(e,"ECDH"),!(0,rf.isCryptoKey)(t))throw TypeError(rk(t,...rx));rA(t,"ECDH","deriveBits");let o=(0,rp.concat)((0,rp.lengthAndInput)(rp.encoder.encode(r)),(0,rp.lengthAndInput)(n),(0,rp.lengthAndInput)(s),(0,rp.uint32be)(i));a="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3;let l=new Uint8Array(await rf.default.subtle.deriveBits({name:e.algorithm.name,public:e},t,a));return(0,rp.concatKdf)(l,i,o)}async function rH(e){if(!(0,rf.isCryptoKey)(e))throw TypeError(rk(e,...rx));return rf.default.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function rz(e){if(!(0,rf.isCryptoKey)(e))throw TypeError(rk(e,...rx));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function r$(e,t,r,i){if(!(e instanceof Uint8Array)||e.length<8)throw new ru.JWEInvalid("PBES2 Salt Input must be 8 or more octets");let n=(0,rp.p2s)(t,e),s=parseInt(t.slice(13,16),10),a={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:n},o=await function(e,t){if(e instanceof Uint8Array)return rf.default.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if((0,rf.isCryptoKey)(e))return rA(e,t,"deriveBits","deriveKey"),e;throw TypeError(rk(e,...rx,"Uint8Array"))}(i,t);if(o.usages.includes("deriveBits"))return new Uint8Array(await rf.default.subtle.deriveBits(a,o,s));if(o.usages.includes("deriveKey"))return rf.default.subtle.deriveKey(a,o,{length:s,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let rK=async(e,t,r,i=2048,n=ry(new Uint8Array(16)))=>{let s=await r$(n,e,i,t);return{encryptedKey:await rB(e.slice(-6),s,r),p2c:i,p2s:(0,rh.encode)(n)}},rV=async(e,t,r,i,n)=>{let s=await r$(n,e,i,t);return rF(e.slice(-6),s,r)};function rJ(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new ru.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let rG=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}},rZ=async(e,t,r)=>{if(!(0,rf.isCryptoKey)(t))throw TypeError(rk(t,...rx));if(rA(t,e,"encrypt","wrapKey"),rG(e,t),t.usages.includes("encrypt"))return new Uint8Array(await rf.default.subtle.encrypt(rJ(e),t,r));if(t.usages.includes("wrapKey")){let i=await rf.default.subtle.importKey("raw",r,...rL);return new Uint8Array(await rf.default.subtle.wrapKey("raw",i,t,rJ(e)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},rY=async(e,t,r)=>{if(!(0,rf.isCryptoKey)(t))throw TypeError(rk(t,...rx));if(rA(t,e,"decrypt","unwrapKey"),rG(e,t),t.usages.includes("decrypt"))return new Uint8Array(await rf.default.subtle.decrypt(rJ(e),t,r));if(t.usages.includes("unwrapKey")){let i=await rf.default.subtle.unwrapKey("raw",r,t,rJ(e),...rL);return new Uint8Array(await rf.default.subtle.exportKey("raw",i))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function rQ(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new ru.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}let rX=e=>ry(new Uint8Array(rQ(e)>>3)),r0=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`},r1=async(e,t,r)=>{if(!(0,rf.isCryptoKey)(r))throw TypeError(rk(r,...rx));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return r0((0,rh.encodeBase64)(new Uint8Array(await rf.default.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},r2=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));let i=e.indexOf(t[0],r);if(-1===i)return!1;let n=e.subarray(i,i+t.length);return n.length===t.length&&(n.every((e,r)=>e===t[r])||r2(e,t,i+1))},r5=e=>{switch(!0){case r2(e,[42,134,72,206,61,3,1,7]):return"P-256";case r2(e,[43,129,4,0,34]):return"P-384";case r2(e,[43,129,4,0,35]):return"P-521";case r2(e,[43,101,110]):return"X25519";case r2(e,[43,101,111]):return"X448";case r2(e,[43,101,112]):return"Ed25519";case r2(e,[43,101,113]):return"Ed448";default:throw new ru.JOSENotSupported("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},r3=async(e,t,r,i,n)=>{var s;let a,o,l=new Uint8Array(atob(r.replace(e,"")).split("").map(e=>e.charCodeAt(0))),c="spki"===t;switch(i){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(i.slice(-3),10)||1}`},o=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},o=c?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},o=c?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},o=c?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=r5(l);a=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},o=c?[]:["deriveBits"];break}case"EdDSA":a={name:r5(l)},o=c?["verify"]:["sign"];break;default:throw new ru.JOSENotSupported('Invalid or unsupported "alg" (Algorithm) value')}return rf.default.subtle.importKey(t,l,a,null!=(s=null==n?void 0:n.extractable)&&s,o)};function r8(e){let t=[],r=0;for(;r<e.length;){let i=r4(e.subarray(r));t.push(i),r+=i.byteLength}return t}function r4(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let i=0;if(e[t]<128)i=e[t],t++;else if(128===i){for(i=0;0!==e[t+i]||0!==e[t+i+1];){if(i>e.byteLength)throw TypeError("invalid indefinite form length");i++}let r=t+i+2;return{byteLength:r,contents:e.subarray(t,t+i),raw:e.subarray(0,r)}}else{let r=127&e[t];t++,i=0;for(let n=0;n<r;n++)i=256*i+e[t],t++}let n=t+i;return{byteLength:n,contents:e.subarray(t,n),raw:e.subarray(0,n)}}let r6=async e=>{var t,r;if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:i,keyUsages:n}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new ru.JOSENotSupported(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),s=[i,null!=(t=e.ext)&&t,null!=(r=e.key_ops)?r:n];if("PBKDF2"===i.name)return rf.default.subtle.importKey("raw",(0,rh.decode)(e.k),...s);let a={...e};return delete a.alg,delete a.use,rf.default.subtle.importKey("jwk",a,...s)};async function r9(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return r3(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r)}async function r7(e,t,r){let i;if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');try{let t,r;r=e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),i=r0((t=r8(r8(r4((0,rh.decodeBase64)(r)).contents)[0].contents),(0,rh.encodeBase64)(t[160===t[0].raw[0]?6:5].raw)),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return r3(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",i,t,r)}async function ie(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return r3(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r)}async function it(e,t,r){var i;if(!(0,rD.default)(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return r6({...e,alg:t,ext:null!=(i=e.ext)&&i});return(0,rh.decode)(e.k);case"RSA":if(void 0!==e.oth)throw new ru.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return r6({...e,alg:t});default:throw new ru.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}let ir=(e,t,r)=>{if(e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)){if(!(t instanceof Uint8Array)){if(!rC(t))throw TypeError(rT(e,t,...rx,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${rx.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}}else{if(!rC(t))throw TypeError(rT(e,t,...rx));if("secret"===t.type)throw TypeError(`${rx.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${rx.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${rx.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${rx.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${rx.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)}};async function ii(e,t,r,i,n){if(!(r instanceof Uint8Array))throw TypeError(rk(r,"Uint8Array"));let s=parseInt(e.slice(1,4),10),a=await rf.default.subtle.importKey("raw",r.subarray(s>>3),"AES-CBC",!1,["encrypt"]),o=await rf.default.subtle.importKey("raw",r.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),l=new Uint8Array(await rf.default.subtle.encrypt({iv:i,name:"AES-CBC"},a,t)),c=(0,rp.concat)(n,i,l,(0,rp.uint64be)(n.length<<3));return{ciphertext:l,tag:new Uint8Array((await rf.default.subtle.sign("HMAC",o,c)).slice(0,s>>3))}}async function is(e,t,r,i,n){let s;r instanceof Uint8Array?s=await rf.default.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(rA(r,e,"encrypt"),s=r);let a=new Uint8Array(await rf.default.subtle.encrypt({additionalData:n,iv:i,name:"AES-GCM",tagLength:128},s,t)),o=a.slice(-16);return{ciphertext:a.slice(0,-16),tag:o}}let ia=async(e,t,r,i,n)=>{if(!(0,rf.isCryptoKey)(r)&&!(r instanceof Uint8Array))throw TypeError(rk(r,...rx,"Uint8Array"));switch(rw(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&rv(r,parseInt(e.slice(-3),10)),ii(e,t,r,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&rv(r,parseInt(e.slice(1,4),10)),is(e,t,r,i,n);default:throw new ru.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}};async function io(e,t,r,i){let n=e.slice(0,7);i||(i=rm(n));let{ciphertext:s,tag:a}=await ia(n,r,t,i,new Uint8Array(0));return{encryptedKey:s,iv:(0,rh.encode)(i),tag:(0,rh.encode)(a)}}async function il(e,t,r,i,n){return rR(e.slice(0,7),t,r,i,n,new Uint8Array(0))}async function ic(e,t,r,i,n){switch(ir(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new ru.JWEInvalid("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new ru.JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,s;if(!(0,rD.default)(i.epk))throw new ru.JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!rz(t))throw new ru.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let a=await it(i.epk,e);if(void 0!==i.apu){if("string"!=typeof i.apu)throw new ru.JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=(0,rh.decode)(i.apu)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==i.apv){if("string"!=typeof i.apv)throw new ru.JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=(0,rh.decode)(i.apv)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the apv")}}let o=await rq(a,t,"ECDH-ES"===e?i.enc:e,"ECDH-ES"===e?rQ(i.enc):parseInt(e.slice(-5,-2),10),n,s);if("ECDH-ES"===e)return o;if(void 0===r)throw new ru.JWEInvalid("JWE Encrypted Key missing");return rF(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new ru.JWEInvalid("JWE Encrypted Key missing");return rY(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===r)throw new ru.JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof i.p2c)throw new ru.JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let a=(null==n?void 0:n.maxPBES2Count)||1e4;if(i.p2c>a)throw new ru.JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof i.p2s)throw new ru.JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=(0,rh.decode)(i.p2s)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the p2s")}return rV(e,t,r,i.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new ru.JWEInvalid("JWE Encrypted Key missing");return rF(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,s;if(void 0===r)throw new ru.JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof i.iv)throw new ru.JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof i.tag)throw new ru.JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=(0,rh.decode)(i.iv)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the iv")}try{s=(0,rh.decode)(i.tag)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the tag")}return il(e,t,r,n,s)}default:throw new ru.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let id=function(e,t,r,i,n){let s;if(void 0!==n.crit&&void 0===i.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,i.crit)){if(!s.has(a))throw new ru.JOSENotSupported(`Extension Header Parameter "${a}" is not recognized`);if(void 0===n[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(s.get(a)&&void 0===i[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(i.crit)},iu=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function ih(e,t,r){var i;let n,s,a,o,l,c,d;if(!(0,rD.default)(e))throw new ru.JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new ru.JWEInvalid("JOSE Header missing");if("string"!=typeof e.iv)throw new ru.JWEInvalid("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new ru.JWEInvalid("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new ru.JWEInvalid("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new ru.JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new ru.JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new ru.JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!(0,rD.default)(e.header))throw new ru.JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,rD.default)(e.unprotected))throw new ru.JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=(0,rh.decode)(e.protected);n=JSON.parse(rp.decoder.decode(t))}catch(e){throw new ru.JWEInvalid("JWE Protected Header is invalid")}if(!rU(n,e.header,e.unprotected))throw new ru.JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...n,...e.header,...e.unprotected};if(id(ru.JWEInvalid,new Map,null==r?void 0:r.crit,n,u),void 0!==u.zip){if(!n||!n.zip)throw new ru.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new ru.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:h,enc:p}=u;if("string"!=typeof h||!h)throw new ru.JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof p||!p)throw new ru.JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&iu("keyManagementAlgorithms",r.keyManagementAlgorithms),y=r&&iu("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(h))throw new ru.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(y&&!y.has(p))throw new ru.JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{s=(0,rh.decode)(e.encrypted_key)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the encrypted_key")}let g=!1;"function"==typeof t&&(t=await t(n,e),g=!0);try{a=await ic(h,t,s,u,r)}catch(e){if(e instanceof TypeError||e instanceof ru.JWEInvalid||e instanceof ru.JOSENotSupported)throw e;a=rX(p)}try{o=(0,rh.decode)(e.iv)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the iv")}try{l=(0,rh.decode)(e.tag)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the tag")}let m=rp.encoder.encode(null!=(i=e.protected)?i:"");c=void 0!==e.aad?(0,rp.concat)(m,rp.encoder.encode("."),rp.encoder.encode(e.aad)):m;try{d=(0,rh.decode)(e.ciphertext)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the ciphertext")}let w=await rR(p,a,d,o,l,c);"DEF"===u.zip&&(w=await ((null==r?void 0:r.inflateRaw)||rN)(w));let v={plaintext:w};if(void 0!==e.protected&&(v.protectedHeader=n),void 0!==e.aad)try{v.additionalAuthenticatedData=(0,rh.decode)(e.aad)}catch(e){throw new ru.JWEInvalid("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(v.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(v.unprotectedHeader=e.header),g)?{...v,key:t}:v}async function ip(e,t,r){if(e instanceof Uint8Array&&(e=rp.decoder.decode(e)),"string"!=typeof e)throw new ru.JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:i,1:n,2:s,3:a,4:o,length:l}=e.split(".");if(5!==l)throw new ru.JWEInvalid("Invalid Compact JWE");let c=await ih({ciphertext:a,iv:s||void 0,protected:i||void 0,tag:o||void 0,encrypted_key:n||void 0},t,r),d={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...d,key:c.key}:d}async function iy(e,t,r){if(!(0,rD.default)(e))throw new ru.JWEInvalid("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(rD.default))throw new ru.JWEInvalid("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new ru.JWEInvalid("JWE Recipients has no members");for(let i of e.recipients)try{return await ih({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:i.encrypted_key,header:i.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch(e){}throw new ru.JWEDecryptionFailed}let ig=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:(0,rh.encode)(e)};if(!(0,rf.isCryptoKey)(e))throw TypeError(rk(e,...rx,"Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:i,use:n,...s}=await rf.default.subtle.exportKey("jwk",e);return s};async function im(e){return r1("public","spki",e)}async function iw(e){return r1("private","pkcs8",e)}async function iv(e){return ig(e)}async function ib(e,t,r,i,n={}){let s,a,o;switch(ir(e,r,"encrypt"),e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!rz(r))throw new ru.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:l,apv:c}=n,{epk:d}=n;d||(d=(await rH(r)).privateKey);let{x:u,y:h,crv:p,kty:f}=await iv(d),y=await rq(r,d,"ECDH-ES"===e?t:e,"ECDH-ES"===e?rQ(t):parseInt(e.slice(-5,-2),10),l,c);if(a={epk:{x:u,crv:p,kty:f}},"EC"===f&&(a.epk.y=h),l&&(a.apu=(0,rh.encode)(l)),c&&(a.apv=(0,rh.encode)(c)),"ECDH-ES"===e){o=y;break}o=i||rX(t);let g=e.slice(-6);s=await rB(g,y,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=i||rX(t),s=await rZ(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=i||rX(t);let{p2c:l,p2s:c}=n;({encryptedKey:s,...a}=await rK(e,r,o,l,c));break}case"A128KW":case"A192KW":case"A256KW":o=i||rX(t),s=await rB(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=i||rX(t);let{iv:l}=n;({encryptedKey:s,...a}=await io(e,r,o,l));break}default:throw new ru.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:s,parameters:a}}let i_=Symbol();class iE{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,i,n,s,a,o,l;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new ru.JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!rU(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new ru.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(id(ru.JWEInvalid,new Map,null==t?void 0:t.crit,this._protectedHeader,c),void 0!==c.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new ru.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==c.zip)throw new ru.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:d,enc:u}=c;if("string"!=typeof d||!d)throw new ru.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof u||!u)throw new ru.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===d){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===d&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let n;({cek:i,encryptedKey:r,parameters:n}=await ib(d,u,e,this._cek,this._keyManagementParameters)),n&&(t&&i_ in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}if(this._iv||(this._iv=rm(u)),s=this._protectedHeader?rp.encoder.encode((0,rh.encode)(JSON.stringify(this._protectedHeader))):rp.encoder.encode(""),this._aad?(a=(0,rh.encode)(this._aad),n=(0,rp.concat)(s,rp.encoder.encode("."),rp.encoder.encode(a))):n=s,"DEF"===c.zip){let e=await ((null==t?void 0:t.deflateRaw)||rM)(this._plaintext);({ciphertext:o,tag:l}=await ia(u,e,i,this._iv,n))}else({ciphertext:o,tag:l}=await ia(u,this._plaintext,i,this._iv,n));let h={ciphertext:(0,rh.encode)(o),iv:(0,rh.encode)(this._iv),tag:(0,rh.encode)(l)};return r&&(h.encrypted_key=(0,rh.encode)(r)),a&&(h.aad=a),this._protectedHeader&&(h.protected=rp.decoder.decode(s)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}}class iI{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class iA{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let r=new iI(this,e,{crit:null==t?void 0:t.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var t,r,i;let n;if(!this._recipients.length)throw new ru.JWEInvalid("at least one recipient must be added");if(e={deflateRaw:null==e?void 0:e.deflateRaw},1===this._recipients.length){let[t]=this._recipients,r=await new iE(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(t.unprotectedHeader).encrypt(t.key,{...t.options,...e}),i={ciphertext:r.ciphertext,iv:r.iv,recipients:[{}],tag:r.tag};return r.aad&&(i.aad=r.aad),r.protected&&(i.protected=r.protected),r.unprotected&&(i.unprotected=r.unprotected),r.encrypted_key&&(i.recipients[0].encrypted_key=r.encrypted_key),r.header&&(i.recipients[0].header=r.header),i}for(let e=0;e<this._recipients.length;e++){let t=this._recipients[e];if(!rU(this._protectedHeader,this._unprotectedHeader,t.unprotectedHeader))throw new ru.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let r={...this._protectedHeader,...this._unprotectedHeader,...t.unprotectedHeader},{alg:i}=r;if("string"!=typeof i||!i)throw new ru.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===i||"ECDH-ES"===i)throw new ru.JWEInvalid('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof r.enc||!r.enc)throw new ru.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(n){if(n!==r.enc)throw new ru.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else n=r.enc;if(id(ru.JWEInvalid,new Map,t.options.crit,this._protectedHeader,r),void 0!==r.zip&&(!this._protectedHeader||!this._protectedHeader.zip))throw new ru.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let s=rX(n),a={ciphertext:"",iv:"",recipients:[],tag:""};for(let o=0;o<this._recipients.length;o++){let l=this._recipients[o],c={};a.recipients.push(c);let d=({...this._protectedHeader,...this._unprotectedHeader,...l.unprotectedHeader}).alg.startsWith("PBES2")?2048+o:void 0;if(0===o){let t=await new iE(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(s).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(l.unprotectedHeader).setKeyManagementParameters({p2c:d}).encrypt(l.key,{...l.options,...e,[i_]:!0});a.ciphertext=t.ciphertext,a.iv=t.iv,a.tag=t.tag,t.aad&&(a.aad=t.aad),t.protected&&(a.protected=t.protected),t.unprotected&&(a.unprotected=t.unprotected),c.encrypted_key=t.encrypted_key,t.header&&(c.header=t.header);continue}let{encryptedKey:u,parameters:h}=await ib((null==(t=l.unprotectedHeader)?void 0:t.alg)||(null==(r=this._protectedHeader)?void 0:r.alg)||(null==(i=this._unprotectedHeader)?void 0:i.alg),n,l.key,s,{p2c:d});c.encrypted_key=(0,rh.encode)(u),(l.unprotectedHeader||h)&&(c.header={...l.unprotectedHeader,...h})}return a}}function iS(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new ru.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function ik(e,t,r){if((0,rf.isCryptoKey)(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!r_(e.algorithm,"HMAC"))throw rb("HMAC");let r=parseInt(t.slice(2),10);if(rE(e.algorithm.hash)!==r)throw rb(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!r_(e.algorithm,"RSASSA-PKCS1-v1_5"))throw rb("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(rE(e.algorithm.hash)!==r)throw rb(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!r_(e.algorithm,"RSA-PSS"))throw rb("RSA-PSS");let r=parseInt(t.slice(2),10);if(rE(e.algorithm.hash)!==r)throw rb(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw rb("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!r_(e.algorithm,"ECDSA"))throw rb("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw rb(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}rI(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(rk(t,...rx));return rf.default.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw TypeError(rk(t,...rx,"Uint8Array"))}let iT=async(e,t,r,i)=>{let n=await ik(e,t,"verify");rG(e,n);let s=iS(e,n.algorithm);try{return await rf.default.subtle.verify(s,n,r,i)}catch(e){return!1}};async function iC(e,t,r){var i;let n,s;if(!(0,rD.default)(e))throw new ru.JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new ru.JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new ru.JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new ru.JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new ru.JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,rD.default)(e.header))throw new ru.JWSInvalid("JWS Unprotected Header incorrect type");let a={};if(e.protected)try{let t=(0,rh.decode)(e.protected);a=JSON.parse(rp.decoder.decode(t))}catch(e){throw new ru.JWSInvalid("JWS Protected Header is invalid")}if(!rU(a,e.header))throw new ru.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...a,...e.header},l=id(ru.JWSInvalid,new Map([["b64",!0]]),null==r?void 0:r.crit,a,o),c=!0;if(l.has("b64")&&"boolean"!=typeof(c=a.b64))throw new ru.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=o;if("string"!=typeof d||!d)throw new ru.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&iu("algorithms",r.algorithms);if(u&&!u.has(d))throw new ru.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(c){if("string"!=typeof e.payload)throw new ru.JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new ru.JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let h=!1;"function"==typeof t&&(t=await t(a,e),h=!0),ir(d,t,"verify");let p=(0,rp.concat)(rp.encoder.encode(null!=(i=e.protected)?i:""),rp.encoder.encode("."),"string"==typeof e.payload?rp.encoder.encode(e.payload):e.payload);try{n=(0,rh.decode)(e.signature)}catch(e){throw new ru.JWSInvalid("Failed to base64url decode the signature")}if(!await iT(d,t,n,p))throw new ru.JWSSignatureVerificationFailed;if(c)try{s=(0,rh.decode)(e.payload)}catch(e){throw new ru.JWSInvalid("Failed to base64url decode the payload")}else s="string"==typeof e.payload?rp.encoder.encode(e.payload):e.payload;let f={payload:s};return(void 0!==e.protected&&(f.protectedHeader=a),void 0!==e.header&&(f.unprotectedHeader=e.header),h)?{...f,key:t}:f}async function ix(e,t,r){if(e instanceof Uint8Array&&(e=rp.decoder.decode(e)),"string"!=typeof e)throw new ru.JWSInvalid("Compact JWS must be a string or Uint8Array");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a)throw new ru.JWSInvalid("Invalid Compact JWS");let o=await iC({payload:n,protected:i,signature:s},t,r),l={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...l,key:o.key}:l}async function iP(e,t,r){if(!(0,rD.default)(e))throw new ru.JWSInvalid("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(rD.default))throw new ru.JWSInvalid("JWS Signatures missing or incorrect type");for(let i of e.signatures)try{return await iC({header:i.header,payload:e.payload,protected:i.protected,signature:i.signature},t,r)}catch(e){}throw new ru.JWSSignatureVerificationFailed}let iO=e=>Math.floor(e.getTime()/1e3),iR=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,iN=e=>{let t=iR.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(0x1e187e0*r)}},iM=e=>e.toLowerCase().replace(/^application\//,""),iU=(e,t,r={})=>{var i,n;let s,a,{typ:o}=r;if(o&&("string"!=typeof e.typ||iM(e.typ)!==iM(o)))throw new ru.JWTClaimValidationFailed('unexpected "typ" JWT header value',"typ","check_failed");try{s=JSON.parse(rp.decoder.decode(t))}catch(e){}if(!(0,rD.default)(s))throw new ru.JWTInvalid("JWT Claims Set must be a top-level JSON object");let{requiredClaims:l=[],issuer:c,subject:d,audience:u,maxTokenAge:h}=r;for(let e of(void 0!==h&&l.push("iat"),void 0!==u&&l.push("aud"),void 0!==d&&l.push("sub"),void 0!==c&&l.push("iss"),new Set(l.reverse())))if(!(e in s))throw new ru.JWTClaimValidationFailed(`missing required "${e}" claim`,e,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(s.iss))throw new ru.JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");if(d&&s.sub!==d)throw new ru.JWTClaimValidationFailed('unexpected "sub" claim value',"sub","check_failed");if(u&&(i=s.aud,n="string"==typeof u?[u]:u,"string"==typeof i?!n.includes(i):!(Array.isArray(i)&&n.some(Set.prototype.has.bind(new Set(i))))))throw new ru.JWTClaimValidationFailed('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=iN(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=iO(p||new Date);if((void 0!==s.iat||h)&&"number"!=typeof s.iat)throw new ru.JWTClaimValidationFailed('"iat" claim must be a number',"iat","invalid");if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw new ru.JWTClaimValidationFailed('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>f+a)throw new ru.JWTClaimValidationFailed('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==s.exp){if("number"!=typeof s.exp)throw new ru.JWTClaimValidationFailed('"exp" claim must be a number',"exp","invalid");if(s.exp<=f-a)throw new ru.JWTExpired('"exp" claim timestamp check failed',"exp","check_failed")}if(h){let e=f-s.iat;if(e-a>("number"==typeof h?h:iN(h)))throw new ru.JWTExpired('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-a)throw new ru.JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function iD(e,t,r){var i;let n=await ix(e,t,r);if((null==(i=n.protectedHeader.crit)?void 0:i.includes("b64"))&&!1===n.protectedHeader.b64)throw new ru.JWTInvalid("JWTs MUST NOT use unencoded payload");let s={payload:iU(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...s,key:n.key}:s}async function iL(e,t,r){let i=await ip(e,t,r),n=iU(i.protectedHeader,i.plaintext,r),{protectedHeader:s}=i;if(void 0!==s.iss&&s.iss!==n.iss)throw new ru.JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==s.sub&&s.sub!==n.sub)throw new ru.JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(n.aud))throw new ru.JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',"aud","mismatch");let a={payload:n,protectedHeader:s};return"function"==typeof t?{...a,key:i.key}:a}class ij{constructor(e){this._flattened=new iE(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let iW=async(e,t,r)=>{let i=await ik(e,t,"sign");return rG(e,i),new Uint8Array(await rf.default.subtle.sign(iS(e,i.algorithm),i,r))};class iB{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new ru.JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!rU(this._protectedHeader,this._unprotectedHeader))throw new ru.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...this._protectedHeader,...this._unprotectedHeader},n=id(ru.JWSInvalid,new Map([["b64",!0]]),null==t?void 0:t.crit,this._protectedHeader,i),s=!0;if(n.has("b64")&&"boolean"!=typeof(s=this._protectedHeader.b64))throw new ru.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=i;if("string"!=typeof a||!a)throw new ru.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');ir(a,e,"sign");let o=this._payload;s&&(o=rp.encoder.encode((0,rh.encode)(o))),r=this._protectedHeader?rp.encoder.encode((0,rh.encode)(JSON.stringify(this._protectedHeader))):rp.encoder.encode("");let l=(0,rp.concat)(r,rp.encoder.encode("."),o),c=await iW(a,e,l),d={signature:(0,rh.encode)(c),payload:""};return s&&(d.payload=rp.decoder.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=rp.decoder.decode(r)),d}}class iF{constructor(e){this._flattened=new iB(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class iq{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class iH{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let r=new iq(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new ru.JWSInvalid("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],i=new iB(this._payload);i.setProtectedHeader(r.protectedHeader),i.setUnprotectedHeader(r.unprotectedHeader);let{payload:n,...s}=await i.sign(r.key,r.options);if(0===t)e.payload=n;else if(e.payload!==n)throw new ru.JWSInvalid("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}class iz{constructor(e){if(!(0,rD.default)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:iO(new Date)+iN(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:iO(new Date)+iN(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:iO(new Date)}:this._payload={...this._payload,iat:e},this}}class i$ extends iz{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;let i=new iF(rp.encoder.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray(null==(r=this._protectedHeader)?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new ru.JWTInvalid("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}class iK extends iz{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new ij(rp.encoder.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}var iV=e.i(63437);let iJ=(e,t)=>{if("string"!=typeof e||!e)throw new ru.JWKInvalid(`${t} missing or invalid`)};async function iG(e,t){let r;if(!(0,rD.default)(e))throw TypeError("JWK must be an object");if(null!=t||(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":iJ(e.crv,'"crv" (Curve) Parameter'),iJ(e.x,'"x" (X Coordinate) Parameter'),iJ(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":iJ(e.crv,'"crv" (Subtype of Key Pair) Parameter'),iJ(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":iJ(e.e,'"e" (Exponent) Parameter'),iJ(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":iJ(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new ru.JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported')}let i=rp.encoder.encode(JSON.stringify(r));return(0,rh.encode)(await (0,iV.default)(t,i))}async function iZ(e,t){null!=t||(t="sha256");let r=await iG(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function iY(e,t){let r={...e,...null==t?void 0:t.header};if(!(0,rD.default)(r.jwk))throw new ru.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let i=await it({...r.jwk,ext:!0},r.alg,!0);if(i instanceof Uint8Array||"public"!==i.type)throw new ru.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a public key');return i}function iQ(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(iX)}function iX(e){return(0,rD.default)(e)}class i0{constructor(e){if(this._cached=new WeakMap,!iQ(e))throw new ru.JWKSInvalid("JSON Web Key Set malformed");this._jwks=function(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e)}async getKey(e,t){let{alg:r,kid:i}={...e,...null==t?void 0:t.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new ru.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter(e=>{let t=n===e.kty;if(t&&"string"==typeof i&&(t=i===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t}),{0:a,length:o}=s;if(0===o)throw new ru.JWKSNoMatchingKey;if(1!==o){let e=new ru.JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of s)try{yield await i1(t,e,r)}catch(e){continue}},e}return i1(this._cached,a,r)}}async function i1(e,t,r){let i=e.get(t)||e.set(t,{}).get(t);if(void 0===i[r]){let e=await it({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new ru.JWKSInvalid("JSON Web Key Set members must be public keys");i[r]=e}return i[r]}function i2(e){let t=new i0(e);return async function(e,r){return t.getKey(e,r)}}let i5=async(e,t,r)=>{let i,n,s=!1;"function"==typeof AbortController&&(i=new AbortController,n=setTimeout(()=>{s=!0,i.abort()},t));let a=await fetch(e.href,{signal:i?i.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(s)throw new ru.JWKSTimeout;throw e});if(void 0!==n&&clearTimeout(n),200!==a.status)throw new ru.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch(e){throw new ru.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}};class i3 extends i0{constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(e,t)}catch(r){if(r instanceof ru.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),super.getKey(e,t);throw r}}async reload(){this._pendingFetch&&("u">typeof WebSocketPair||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"u">typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=i5(this._url,this._timeoutDuration,this._options).then(e=>{if(!iQ(e))throw new ru.JWKSInvalid("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function i8(e,t){let r=new i3(e,t);return async function(e,t){return r.getKey(e,t)}}class i4 extends iz{encode(){let e=rh.encode(JSON.stringify({alg:"none"})),t=rh.encode(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new ru.JWTInvalid("Unsecured JWT must be a string");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a||""!==s)throw new ru.JWTInvalid("Invalid Unsecured JWT");try{if(r=JSON.parse(rp.decoder.decode(rh.decode(i))),"none"!==r.alg)throw Error()}catch(e){throw new ru.JWTInvalid("Invalid Unsecured JWT")}return{payload:iU(r,rh.decode(n),t),header:r}}}var i6=eL;function i9(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(rp.decoder.decode((0,i6.decode)(t)));if(!(0,rD.default)(e))throw Error();return e}catch(e){throw TypeError("Invalid Token or Protected Header formatting")}}var i7=e.i(905533);async function ne(e,t){var r;let i,n,s;switch(e){case"HS256":case"HS384":case"HS512":i=parseInt(e.slice(-3),10),n={name:"HMAC",hash:`SHA-${i}`,length:i},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return ry(new Uint8Array((i=parseInt(e.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW",length:i=parseInt(e.slice(1,4),10)},s=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n={name:"AES-GCM",length:i=parseInt(e.slice(1,4),10)},s=["encrypt","decrypt"];break;default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return rf.default.subtle.generateKey(n,null!=(r=null==t?void 0:t.extractable)&&r,s)}function nt(e){var t;let r=null!=(t=null==e?void 0:e.modulusLength)?t:2048;if("number"!=typeof r||r<2048)throw new ru.JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function nr(e,t){var r,i,n;let s,a;switch(e){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:nt(t)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:nt(t)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:nt(t)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"EdDSA":a=["sign","verify"];let o=null!=(r=null==t?void 0:t.crv)?r:"Ed25519";switch(o){case"Ed25519":case"Ed448":s={name:o};break;default:throw new ru.JOSENotSupported("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let e=null!=(i=null==t?void 0:t.crv)?i:"P-256";switch(e){case"P-256":case"P-384":case"P-521":s={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":s={name:e};break;default:throw new ru.JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new ru.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return rf.default.subtle.generateKey(s,null!=(n=null==t?void 0:t.extractable)&&n,a)}async function ni(e,t){return nr(e,t)}async function nn(e,t){return ne(e,t)}var ns=eL;e.s(["CompactEncrypt",()=>ij,"CompactSign",()=>iF,"EmbeddedJWK",()=>iY,"EncryptJWT",()=>iK,"FlattenedEncrypt",()=>iE,"FlattenedSign",()=>iB,"GeneralEncrypt",()=>iA,"GeneralSign",()=>iH,"SignJWT",()=>i$,"UnsecuredJWT",()=>i4,"base64url",0,ns,"calculateJwkThumbprint",()=>iG,"calculateJwkThumbprintUri",()=>iZ,"compactDecrypt",()=>ip,"compactVerify",()=>ix,"createLocalJWKSet",()=>i2,"createRemoteJWKSet",()=>i8,"cryptoRuntime",0,"WebCryptoAPI","decodeJwt",()=>i7.decodeJwt,"decodeProtectedHeader",()=>i9,"errors",0,ru,"exportJWK",()=>iv,"exportPKCS8",()=>iw,"exportSPKI",()=>im,"flattenedDecrypt",()=>ih,"flattenedVerify",()=>iC,"generalDecrypt",()=>iy,"generalVerify",()=>iP,"generateKeyPair",()=>ni,"generateSecret",()=>nn,"importJWK",()=>it,"importPKCS8",()=>ie,"importSPKI",()=>r9,"importX509",()=>r7,"jwtDecrypt",()=>iL,"jwtVerify",()=>iD],784577),e.i(784577);var eL=eL,na=e.i(430321),no=ei,nl=e.i(526520),nc=e.i(483604),nd=e.i(957074),nu=e.i(799024);class nh{constructor(e,t){this.scope=e,this.module=t}storeObject(e,t){this.setItem(e,JSON.stringify(t))}loadObject(e){let t=this.getItem(e);return t?JSON.parse(t):void 0}setItem(e,t){localStorage.setItem(this.scopedKey(e),t)}getItem(e){return localStorage.getItem(this.scopedKey(e))}removeItem(e){localStorage.removeItem(this.scopedKey(e))}clear(){let e=this.scopedKey(""),t=[];for(let r=0;r<localStorage.length;r++){let i=localStorage.key(r);"string"==typeof i&&i.startsWith(e)&&t.push(i)}t.forEach(e=>localStorage.removeItem(e))}scopedKey(e){return`-${this.scope}${this.module?`:${this.module}`:""}:${e}`}static clearAll(){new nh("CBWSDK").clear(),new nh("walletlink").clear()}}let np=-32602,nf=-32603,ny=4001,ng=4100,nm=4200,nw=4900,nv={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}},nb="Unspecified error message.";function n_(e,t=nb){if(e&&Number.isInteger(e)){var r;let t=e.toString();if(nI(nv,t))return nv[t].message;if((r=e)>=-32099&&r<=-32e3)return"Unspecified server error."}return t}function nE(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function nI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function nA(e,t){return"object"==typeof e&&null!==e&&t in e&&"string"==typeof e[t]}let nS=e=>nR(np,e),nk=e=>nR(nf,e),nT=e=>nN(ny,e),nC=e=>nN(ng,e),nx=e=>nN(nm,e),nP=e=>nN(nw,e),nO=e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw Error("Ethereum Provider custom errors must provide single object argument.");let{code:t,message:r,data:i}=e;if(!r||"string"!=typeof r)throw Error('"message" must be a nonempty string');return new nD(t,r,i)};function nR(e,t){let[r,i]=nM(t);return new nU(e,r||n_(e),i)}function nN(e,t){let[r,i]=nM(t);return new nD(e,r||n_(e),i)}function nM(e){if(e){if("string"==typeof e)return[e];else if("object"==typeof e&&!Array.isArray(e)){let{message:t,data:r}=e;if(t&&"string"!=typeof t)throw Error("Must specify string message.");return[t||void 0,r]}}return[]}class nU extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==r&&(this.data=r)}}class nD extends nU{constructor(e,t,r){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}}function nL(e){return Math.floor(e)}let nj=/^[0-9]*$/,nW=/^[a-f0-9]*$/;function nB(e){return nF(crypto.getRandomValues(new Uint8Array(e)))}function nF(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}function nq(e){return new Uint8Array(e.match(/.{1,2}/g).map(e=>Number.parseInt(e,16)))}function nH(e,t=!1){let r=e.toString("hex");return t?`0x${r}`:r}function nz(e){return nH(nX(e),!0)}function n$(e){return e.toString(10)}function nK(e){return`0x${BigInt(e).toString(16)}`}function nV(e){return e.startsWith("0x")||e.startsWith("0X")}function nJ(e){return nV(e)?e.slice(2):e}function nG(e){return nV(e)?`0x${e.slice(2)}`:`0x${e}`}function nZ(e){if("string"!=typeof e)return!1;let t=nJ(e).toLowerCase();return nW.test(t)}function nY(e,t=!1){let r=function(e,t=!1){if("string"==typeof e){let r=nJ(e).toLowerCase();if(nW.test(r))return t?`0x${r}`:r}throw nS(`"${String(e)}" is not a hexadecimal string`)}(e,!1);return r.length%2==1&&(r=`0${r}`),t?`0x${r}`:r}function nQ(e){if("string"==typeof e){let t=nJ(e).toLowerCase();if(nZ(t)&&40===t.length)return nG(t)}throw nS(`Invalid Ethereum address: ${String(e)}`)}function nX(e){if(ed.Buffer.isBuffer(e))return e;if("string"==typeof e){if(nZ(e)){let t=nY(e,!1);return ed.Buffer.from(t,"hex")}return ed.Buffer.from(e,"utf8")}throw nS(`Not binary data: ${String(e)}`)}function n0(e){if("number"==typeof e&&Number.isInteger(e))return nL(e);if("string"==typeof e){if(nj.test(e))return nL(Number(e));if(nZ(e))return nL(Number(BigInt(nY(e,!0))))}throw nS(`Not an integer: ${String(e)}`)}function n1(e){if(null!==e&&("bigint"==typeof e||function(e){if(null==e||"function"!=typeof e.constructor)return!1;let{constructor:t}=e;return"function"==typeof t.config&&"number"==typeof t.EUCLID}(e)))return BigInt(e.toString(10));if("number"==typeof e)return BigInt(n0(e));if("string"==typeof e){if(nj.test(e))return BigInt(e);if(nZ(e))return BigInt(nY(e,!0))}throw nS(`Not an integer: ${String(e)}`)}async function n2(){return crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"])}async function n5(e,t){return crypto.subtle.deriveKey({name:"ECDH",public:t},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function n3(e,t){let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},e,new TextEncoder().encode(t));return{iv:r,cipherText:i}}async function n8(e,{iv:t,cipherText:r}){let i=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r);return new TextDecoder().decode(i)}function n4(e){switch(e){case"public":return"spki";case"private":return"pkcs8"}}async function n6(e,t){let r=n4(e);return nF(new Uint8Array(await crypto.subtle.exportKey(r,t)))}async function n9(e,t){let r=n4(e),i=nq(t).buffer;return await crypto.subtle.importKey(r,new Uint8Array(i),{name:"ECDH",namedCurve:"P-256"},!0,"private"===e?["deriveKey"]:[])}async function n7(e,t){return n3(t,JSON.stringify(e,(e,t)=>t instanceof Error?Object.assign(Object.assign({},t.code?{code:t.code}:{}),{message:t.message}):t))}async function se(e,t){return JSON.parse(await n8(t,e))}let st={storageKey:"ownPrivateKey",keyType:"private"},sr={storageKey:"ownPublicKey",keyType:"public"},si={storageKey:"peerPublicKey",keyType:"public"};class sn{constructor(){this.storage=new nh("CBWSDK","SCWKeyManager"),this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null}async getOwnPublicKey(){return await this.loadKeysIfNeeded(),this.ownPublicKey}async getSharedSecret(){return await this.loadKeysIfNeeded(),this.sharedSecret}async setPeerPublicKey(e){this.sharedSecret=null,this.peerPublicKey=e,await this.storeKey(si,e),await this.loadKeysIfNeeded()}async clear(){this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null,this.storage.removeItem(sr.storageKey),this.storage.removeItem(st.storageKey),this.storage.removeItem(si.storageKey)}async generateKeyPair(){let e=await n2();this.ownPrivateKey=e.privateKey,this.ownPublicKey=e.publicKey,await this.storeKey(st,e.privateKey),await this.storeKey(sr,e.publicKey)}async loadKeysIfNeeded(){null===this.ownPrivateKey&&(this.ownPrivateKey=await this.loadKey(st)),null===this.ownPublicKey&&(this.ownPublicKey=await this.loadKey(sr)),(null===this.ownPrivateKey||null===this.ownPublicKey)&&await this.generateKeyPair(),null===this.peerPublicKey&&(this.peerPublicKey=await this.loadKey(si)),null===this.sharedSecret&&null!==this.ownPrivateKey&&null!==this.peerPublicKey&&(this.sharedSecret=await n5(this.ownPrivateKey,this.peerPublicKey))}async loadKey(e){let t=this.storage.getItem(e.storageKey);return t?n9(e.keyType,t):null}async storeKey(e,t){let r=await n6(e.keyType,t);this.storage.setItem(e.storageKey,r)}}let ss="4.3.2",sa="@coinbase/wallet-sdk";async function so(e,t){let r=Object.assign(Object.assign({},e),{jsonrpc:"2.0",id:crypto.randomUUID()}),i=await window.fetch(t,{method:"POST",body:JSON.stringify(r),mode:"cors",headers:{"Content-Type":"application/json","X-Cbw-Sdk-Version":ss,"X-Cbw-Sdk-Platform":sa}}),{result:n,error:s}=await i.json();if(s)throw s;return n}let sl="accounts",sc="activeChain",sd="availableChains",su="walletCapabilities";class sh{constructor(e){var t,r,i;this.metadata=e.metadata,this.communicator=e.communicator,this.callback=e.callback,this.keyManager=new sn,this.storage=new nh("CBWSDK","SCWStateManager"),this.accounts=null!=(t=this.storage.loadObject(sl))?t:[],this.chain=this.storage.loadObject(sc)||{id:null!=(i=null==(r=e.metadata.appChainIds)?void 0:r[0])?i:1},this.handshake=this.handshake.bind(this),this.request=this.request.bind(this),this.createRequestMessage=this.createRequestMessage.bind(this),this.decryptResponseMessage=this.decryptResponseMessage.bind(this)}async handshake(e){var t,r,i,n;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let s=await this.createRequestMessage({handshake:{method:e.method,params:Object.assign({},this.metadata,null!=(i=e.params)?i:{})}}),a=await this.communicator.postRequestAndWaitForResponse(s);if("failure"in a.content)throw a.content.failure;let o=await n9("public",a.sender);await this.keyManager.setPeerPublicKey(o);let l=(await this.decryptResponseMessage(a)).result;if("error"in l)throw l.error;if("eth_requestAccounts"===e.method){let e=l.value;this.accounts=e,this.storage.storeObject(sl,e),null==(n=this.callback)||n.call(this,"accountsChanged",e)}}async request(e){var t;if(0===this.accounts.length)if("wallet_sendCalls"===e.method)return this.sendRequestToPopup(e);else throw nC();switch(e.method){case"eth_requestAccounts":return null==(t=this.callback)||t.call(this,"connect",{chainId:nK(this.chain.id)}),this.accounts;case"eth_accounts":return this.accounts;case"eth_coinbase":return this.accounts[0];case"net_version":return this.chain.id;case"eth_chainId":return nK(this.chain.id);case"wallet_getCapabilities":return this.storage.loadObject(su);case"wallet_switchEthereumChain":return this.handleSwitchChainRequest(e);case"eth_ecRecover":case"personal_sign":case"wallet_sign":case"personal_ecRecover":case"eth_signTransaction":case"eth_sendTransaction":case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":case"wallet_addEthereumChain":case"wallet_watchAsset":case"wallet_sendCalls":case"wallet_showCallsStatus":case"wallet_grantPermissions":return this.sendRequestToPopup(e);default:if(!this.chain.rpcUrl)throw nk("No RPC URL set for chain");return so(e,this.chain.rpcUrl)}}async sendRequestToPopup(e){var t,r;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let i=await this.sendEncryptedRequest(e),n=(await this.decryptResponseMessage(i)).result;if("error"in n)throw n.error;return n.value}async cleanup(){var e,t;this.storage.clear(),await this.keyManager.clear(),this.accounts=[],this.chain={id:null!=(t=null==(e=this.metadata.appChainIds)?void 0:e[0])?t:1}}async handleSwitchChainRequest(e){var t;let r=e.params;if(!r||!(null==(t=r[0])?void 0:t.chainId))throw nS();let i=n0(r[0].chainId);if(this.updateChain(i))return null;let n=await this.sendRequestToPopup(e);return null===n&&this.updateChain(i),n}async sendEncryptedRequest(e){let t=await this.keyManager.getSharedSecret();if(!t)throw nC("No valid session found, try requestAccounts before other methods");let r=await n7({action:e,chainId:this.chain.id},t),i=await this.createRequestMessage({encrypted:r});return this.communicator.postRequestAndWaitForResponse(i)}async createRequestMessage(e){let t=await n6("public",await this.keyManager.getOwnPublicKey());return{id:crypto.randomUUID(),sender:t,content:e,timestamp:new Date}}async decryptResponseMessage(e){var t,r;let i=e.content;if("failure"in i)throw i.failure;let n=await this.keyManager.getSharedSecret();if(!n)throw nC("Invalid session");let s=await se(i.encrypted,n),a=null==(t=s.data)?void 0:t.chains;if(a){let e=Object.entries(a).map(([e,t])=>({id:Number(e),rpcUrl:t}));this.storage.storeObject(sd,e),this.updateChain(this.chain.id,e)}let o=null==(r=s.data)?void 0:r.capabilities;return o&&this.storage.storeObject(su,o),s}updateChain(e,t){var r;let i=null!=t?t:this.storage.loadObject(sd),n=null==i?void 0:i.find(t=>t.id===e);return!!n&&(n!==this.chain&&(this.chain=n,this.storage.storeObject(sc,n),null==(r=this.callback)||r.call(this,"chainChanged",nK(n.id))),!0)}}var sp=e.i(620446);let sf="Addresses";function sy(e){return void 0!==e.errorMessage}class sg{constructor(e){this.secret=e}async encrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.importKey("raw",nq(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),n=new TextEncoder,s=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,n.encode(e)),a=s.slice(s.byteLength-16),o=s.slice(0,s.byteLength-16),l=new Uint8Array(a),c=new Uint8Array(o);return nF(new Uint8Array([...r,...l,...c]))}async decrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");return new Promise((r,i)=>{!async function(){let n=await crypto.subtle.importKey("raw",nq(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),s=nq(e),a=s.slice(0,12),o=s.slice(12,28),l=new Uint8Array([...s.slice(28),...o]),c={name:"AES-GCM",iv:new Uint8Array(a)};try{let e=await window.crypto.subtle.decrypt(c,n,l),t=new TextDecoder;r(t.decode(e))}catch(e){i(e)}}()})}}class sm{constructor(e,t,r){this.linkAPIUrl=e,this.sessionId=t;const i=`${t}:${r}`;this.auth=`Basic ${btoa(i)}`}async markUnseenEventsAsSeen(e){return Promise.all(e.map(e=>fetch(`${this.linkAPIUrl}/events/${e.eventId}/seen`,{method:"POST",headers:{Authorization:this.auth}}))).catch(e=>console.error("Unabled to mark event as failed:",e))}async fetchUnseenEvents(){var e;let t=await fetch(`${this.linkAPIUrl}/events?unseen=true`,{headers:{Authorization:this.auth}});if(t.ok){let{events:r,error:i}=await t.json();if(i)throw Error(`Check unseen events failed: ${i}`);let n=null!=(e=null==r?void 0:r.filter(e=>"Web3Response"===e.event).map(e=>({type:"Event",sessionId:this.sessionId,eventId:e.id,event:e.event,data:e.data})))?e:[];return this.markUnseenEventsAsSeen(n),n}throw Error(`Check unseen events failed: ${t.status}`)}}(sx=sP||(sP={}))[sx.DISCONNECTED=0]="DISCONNECTED",sx[sx.CONNECTING=1]="CONNECTING",sx[sx.CONNECTED=2]="CONNECTED";class sw{setConnectionStateListener(e){this.connectionStateListener=e}setIncomingDataListener(e){this.incomingDataListener=e}constructor(e,t=WebSocket){this.WebSocketClass=t,this.webSocket=null,this.pendingData=[],this.url=e.replace(/^http/,"ws")}async connect(){if(this.webSocket)throw Error("webSocket object is not null");return new Promise((e,t)=>{var r;let i;try{this.webSocket=i=new this.WebSocketClass(this.url)}catch(e){t(e);return}null==(r=this.connectionStateListener)||r.call(this,sP.CONNECTING),i.onclose=e=>{var r;this.clearWebSocket(),t(Error(`websocket error ${e.code}: ${e.reason}`)),null==(r=this.connectionStateListener)||r.call(this,sP.DISCONNECTED)},i.onopen=t=>{var r;e(),null==(r=this.connectionStateListener)||r.call(this,sP.CONNECTED),this.pendingData.length>0&&([...this.pendingData].forEach(e=>this.sendData(e)),this.pendingData=[])},i.onmessage=e=>{var t,r;if("h"===e.data)null==(t=this.incomingDataListener)||t.call(this,{type:"Heartbeat"});else try{let t=JSON.parse(e.data);null==(r=this.incomingDataListener)||r.call(this,t)}catch(e){}}})}disconnect(){var e;let{webSocket:t}=this;if(t){this.clearWebSocket(),null==(e=this.connectionStateListener)||e.call(this,sP.DISCONNECTED),this.connectionStateListener=void 0,this.incomingDataListener=void 0;try{t.close()}catch(e){}}}sendData(e){let{webSocket:t}=this;if(!t){this.pendingData.push(e),this.connect();return}t.send(e)}clearWebSocket(){let{webSocket:e}=this;e&&(this.webSocket=null,e.onclose=null,e.onerror=null,e.onmessage=null,e.onopen=null)}}class sv{constructor({session:e,linkAPIUrl:t,listener:r}){this.destroyed=!1,this.lastHeartbeatResponse=0,this.nextReqId=nL(1),this._connected=!1,this._linked=!1,this.shouldFetchUnseenEventsOnConnect=!1,this.requestResolutions=new Map,this.handleSessionMetadataUpdated=e=>{e&&new Map([["__destroyed",this.handleDestroyed],["EthereumAddress",this.handleAccountUpdated],["WalletUsername",this.handleWalletUsernameUpdated],["AppVersion",this.handleAppVersionUpdated],["ChainId",t=>e.JsonRpcUrl&&this.handleChainUpdated(t,e.JsonRpcUrl)]]).forEach((t,r)=>{let i=e[r];void 0!==i&&t(i)})},this.handleDestroyed=e=>{var t;"1"===e&&(null==(t=this.listener)||t.resetAndReload())},this.handleAccountUpdated=async e=>{var t;let r=await this.cipher.decrypt(e);null==(t=this.listener)||t.accountUpdated(r)},this.handleMetadataUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(t);null==(r=this.listener)||r.metadataUpdated(e,i)},this.handleWalletUsernameUpdated=async e=>{this.handleMetadataUpdated("walletUsername",e)},this.handleAppVersionUpdated=async e=>{this.handleMetadataUpdated("AppVersion",e)},this.handleChainUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(e),n=await this.cipher.decrypt(t);null==(r=this.listener)||r.chainUpdated(i,n)},this.session=e,this.cipher=new sg(e.secret),this.listener=r;const i=new sw(`${t}/rpc`,WebSocket);i.setConnectionStateListener(async e=>{let t=!1;switch(e){case sP.DISCONNECTED:if(!this.destroyed){let e=async()=>{await new Promise(e=>setTimeout(e,5e3)),this.destroyed||i.connect().catch(()=>{e()})};e()}break;case sP.CONNECTED:t=await this.handleConnected(),this.updateLastHeartbeat(),setInterval(()=>{this.heartbeat()},1e4),this.shouldFetchUnseenEventsOnConnect&&this.fetchUnseenEventsAPI();case sP.CONNECTING:}this.connected!==t&&(this.connected=t)}),i.setIncomingDataListener(e=>{var t;switch(e.type){case"Heartbeat":this.updateLastHeartbeat();return;case"IsLinkedOK":case"Linked":{let t="IsLinkedOK"===e.type?e.linked:void 0;this.linked=t||e.onlineGuests>0;break}case"GetSessionConfigOK":case"SessionConfigUpdated":this.handleSessionMetadataUpdated(e.metadata);break;case"Event":this.handleIncomingEvent(e)}void 0!==e.id&&(null==(t=this.requestResolutions.get(e.id))||t(e))}),this.ws=i,this.http=new sm(t,e.id,e.key)}connect(){if(this.destroyed)throw Error("instance is destroyed");this.ws.connect()}async destroy(){this.destroyed||(await this.makeRequest({type:"SetSessionConfig",id:nL(this.nextReqId++),sessionId:this.session.id,metadata:{__destroyed:"1"}},{timeout:1e3}),this.destroyed=!0,this.ws.disconnect(),this.listener=void 0)}get connected(){return this._connected}set connected(e){this._connected=e}get linked(){return this._linked}set linked(e){var t,r;this._linked=e,e&&(null==(t=this.onceLinked)||t.call(this)),null==(r=this.listener)||r.linkedUpdated(e)}setOnceLinked(e){return new Promise(t=>{this.linked?e().then(t):this.onceLinked=()=>{e().then(t),this.onceLinked=void 0}})}async handleIncomingEvent(e){var t;if("Event"!==e.type||"Web3Response"!==e.event)return;let r=JSON.parse(await this.cipher.decrypt(e.data));if("WEB3_RESPONSE"!==r.type)return;let{id:i,response:n}=r;null==(t=this.listener)||t.handleWeb3ResponseMessage(i,n)}async checkUnseenEvents(){if(!this.connected){this.shouldFetchUnseenEventsOnConnect=!0;return}await new Promise(e=>setTimeout(e,250));try{await this.fetchUnseenEventsAPI()}catch(e){console.error("Unable to check for unseen events",e)}}async fetchUnseenEventsAPI(){this.shouldFetchUnseenEventsOnConnect=!1,(await this.http.fetchUnseenEvents()).forEach(e=>this.handleIncomingEvent(e))}async publishEvent(e,t,r=!1){let i=await this.cipher.encrypt(JSON.stringify(Object.assign(Object.assign({},t),{origin:location.origin,location:location.href,relaySource:"coinbaseWalletExtension"in window&&window.coinbaseWalletExtension?"injected_sdk":"sdk"}))),n={type:"PublishEvent",id:nL(this.nextReqId++),sessionId:this.session.id,event:e,data:i,callWebhook:r};return this.setOnceLinked(async()=>{let e=await this.makeRequest(n);if("Fail"===e.type)throw Error(e.error||"failed to publish event");return e.eventId})}sendData(e){this.ws.sendData(JSON.stringify(e))}updateLastHeartbeat(){this.lastHeartbeatResponse=Date.now()}heartbeat(){if(Date.now()-this.lastHeartbeatResponse>2e4)return void this.ws.disconnect();try{this.ws.sendData("h")}catch(e){}}async makeRequest(e,t={timeout:6e4}){let r,i=e.id;return this.sendData(e),Promise.race([new Promise((e,n)=>{r=window.setTimeout(()=>{n(Error(`request ${i} timed out`))},t.timeout)}),new Promise(e=>{this.requestResolutions.set(i,t=>{clearTimeout(r),e(t),this.requestResolutions.delete(i)})})])}async handleConnected(){return"Fail"!==(await this.makeRequest({type:"HostSession",id:nL(this.nextReqId++),sessionId:this.session.id,sessionKey:this.session.key})).type&&(this.sendData({type:"IsLinked",id:nL(this.nextReqId++),sessionId:this.session.id}),this.sendData({type:"GetSessionConfig",id:nL(this.nextReqId++),sessionId:this.session.id}),!0)}}class sb{constructor(){this._nextRequestId=0,this.callbacks=new Map}makeRequestId(){this._nextRequestId=(this._nextRequestId+1)%0x7fffffff;let e=this._nextRequestId,t=nG(e.toString(16));return this.callbacks.get(t)&&this.callbacks.delete(t),e}}var s_=e.i(403893),sE=e.i(944445);let sI="session:id",sA="session:secret",sS="session:linked";class sk{constructor(e,t,r,i=!1){this.storage=e,this.id=t,this.secret=r,this.key=(0,sE.bytesToHex)((0,s_.sha256)(`${t}, ${r} WalletLink`)),this._linked=!!i}static create(e){return new sk(e,nB(16),nB(32)).save()}static load(e){let t=e.getItem(sI),r=e.getItem(sS),i=e.getItem(sA);return t&&i?new sk(e,t,i,"1"===r):null}get linked(){return this._linked}set linked(e){this._linked=e,this.persistLinked()}save(){return this.storage.setItem(sI,this.id),this.storage.setItem(sA,this.secret),this.persistLinked(),this}persistLinked(){this.storage.setItem(sS,this._linked?"1":"0")}}function sT(){var e,t;return null!=(t=null==(e=null==window?void 0:window.matchMedia)?void 0:e.call(window,"(prefers-color-scheme: dark)").matches)&&t}function sC(){let e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode('@namespace svg "http://www.w3.org/2000/svg";.-cbwsdk-css-reset,.-cbwsdk-css-reset *{animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:rgba(0,0,0,0);background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-left-radius:0;border-top-right-radius:0;border-top-style:none;border-top-width:medium;box-shadow:none;box-sizing:border-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;counter-increment:none;counter-reset:none;direction:ltr;empty-cells:show;float:none;font:normal;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;height:auto;hyphens:none;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;pointer-events:auto;position:static;quotes:"\\201C" "\\201D" "\\2018" "\\2019";tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;word-spacing:normal;z-index:auto}.-cbwsdk-css-reset strong{font-weight:bold}.-cbwsdk-css-reset *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;line-height:1}.-cbwsdk-css-reset [class*=container]{margin:0;padding:0}.-cbwsdk-css-reset style{display:none}')),document.documentElement.appendChild(e)}var sx,sP,sO,sR,sN,sM,sU,sD,sL,sj,sW,sB,sF,sq=e.i(722978),sH={},sz=[],s$=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,sK=Array.isArray;function sV(e,t){for(var r in t)e[r]=t[r];return e}function sJ(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function sG(e,t,r){var i,n,s,a={};for(s in t)"key"==s?i=t[s]:"ref"==s?n=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?sO.call(arguments,2):r),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return sZ(e,a,i,n,null)}function sZ(e,t,r,i,n){var s={type:e,props:t,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==n?++sN:n,__i:-1,__u:0};return null==n&&null!=sR.vnode&&sR.vnode(s),s}function sY(e){return e.children}function sQ(e,t){this.props=e,this.context=t}function sX(e,t){if(null==t)return e.__?sX(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?sX(e):null}function s0(e){(!e.__d&&(e.__d=!0)&&sM.push(e)&&!s1.__r++||sU!=sR.debounceRendering)&&((sU=sR.debounceRendering)||sD)(s1)}function s1(){for(var e,t=1;sM.length;)sM.length>t&&sM.sort(sL),e=sM.shift(),t=sM.length,function(e){if(e.__P&&e.__d){var t=e.__v,r=t.__e,i=[],n=[],s=sV({},t);s.__v=t.__v+1,sR.vnode&&sR.vnode(s),s4(e.__P,s,t,e.__n,e.__P.namespaceURI,32&t.__u?[r]:null,i,null==r?sX(t):r,!!(32&t.__u),n),s.__v=t.__v,s.__.__k[s.__i]=s,s9(i,s,n),t.__e=t.__=null,s.__e!=r&&function e(t){if(null!=(t=t.__)&&null!=t.__c)return t.__e=t.__c.base=null,t.__k.some(function(e){if(null!=e&&null!=e.__e)return t.__e=t.__c.base=e.__e}),e(t)}(s)}}(e);s1.__r=0}function s2(e,t,r,i,n,s,a,o,l,c,d){var u,h,p,f,y,g,m,w=i&&i.__k||sz,v=t.length;for(l=function(e,t,r,i,n){var s,a,o,l,c,d=r.length,u=d,h=0;for(e.__k=Array(n),s=0;s<n;s++)null!=(a=t[s])&&"boolean"!=typeof a&&"function"!=typeof a?("string"==typeof a||"number"==typeof a||"bigint"==typeof a||a.constructor==String?a=e.__k[s]=sZ(null,a,null,null,null):sK(a)?a=e.__k[s]=sZ(sY,{children:a},null,null,null):void 0===a.constructor&&a.__b>0?a=e.__k[s]=sZ(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[s]=a,l=s+h,a.__=e,a.__b=e.__b+1,o=null,-1!=(c=a.__i=function(e,t,r,i){var n,s,a,o=e.key,l=e.type,c=t[r],d=null!=c&&0==(2&c.__u);if(null===c&&null==o||d&&o==c.key&&l==c.type)return r;if(i>+!!d){for(n=r-1,s=r+1;n>=0||s<t.length;)if(null!=(c=t[a=n>=0?n--:s++])&&0==(2&c.__u)&&o==c.key&&l==c.type)return a}return -1}(a,r,l,u))&&(u--,(o=r[c])&&(o.__u|=2)),null==o||null==o.__v?(-1==c&&(n>d?h--:n<d&&h++),"function"!=typeof a.type&&(a.__u|=4)):c!=l&&(c==l-1?h--:c==l+1?h++:(c>l?h--:h++,a.__u|=4))):e.__k[s]=null;if(u)for(s=0;s<d;s++)null!=(o=r[s])&&0==(2&o.__u)&&(o.__e==i&&(i=sX(o)),function e(t,r,i){var n,s;if(sR.unmount&&sR.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||s7(n,null,r)),null!=(n=t.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){sR.__e(e,r)}n.base=n.__P=null}if(n=t.__k)for(s=0;s<n.length;s++)n[s]&&e(n[s],r,i||"function"!=typeof t.type);i||sJ(t.__e),t.__c=t.__=t.__e=void 0}(o,o));return i}(r,t,w,l,v),u=0;u<v;u++)null!=(p=r.__k[u])&&(h=-1!=p.__i&&w[p.__i]||sH,p.__i=u,g=s4(e,p,h,n,s,a,o,l,c,d),f=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&s7(h.ref,null,p),d.push(p.ref,p.__c||f,p)),null==y&&null!=f&&(y=f),(m=!!(4&p.__u))||h.__k===p.__k?l=function e(t,r,i,n){var s,a;if("function"==typeof t.type){for(s=t.__k,a=0;s&&a<s.length;a++)s[a]&&(s[a].__=t,r=e(s[a],r,i,n));return r}t.__e!=r&&(n&&(r&&t.type&&!r.parentNode&&(r=sX(t)),i.insertBefore(t.__e,r||null)),r=t.__e);do r=r&&r.nextSibling;while(null!=r&&8==r.nodeType)return r}(p,l,e,m):"function"==typeof p.type&&void 0!==g?l=g:f&&(l=f.nextSibling),p.__u&=-7);return r.__e=y,l}function s5(e,t,r){"-"==t[0]?e.setProperty(t,null==r?"":r):e[t]=null==r?"":"number"!=typeof r||s$.test(t)?r:r+"px"}function s3(e,t,r,i,n){var s,a;e:if("style"==t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)r&&t in r||s5(e.style,t,"");if(r)for(t in r)i&&r[t]==i[t]||s5(e.style,t,r[t])}else if("o"==t[0]&&"n"==t[1])s=t!=(t=t.replace(sj,"$1")),t=(a=t.toLowerCase())in e||"onFocusOut"==t||"onFocusIn"==t?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=r,r?i?r.u=i.u:(r.u=sW,e.addEventListener(t,s?sF:sB,s)):e.removeEventListener(t,s?sF:sB,s);else{if("http://www.w3.org/2000/svg"==n)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==r?"":r;break e}catch(e){}"function"==typeof r||(null==r||!1===r&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==r?"":r))}}function s8(e){return function(t){if(this.l){var r=this.l[t.type+e];if(null==t.t)t.t=sW++;else if(t.t<r.u)return;return r(sR.event?sR.event(t):t)}}}function s4(e,t,r,i,n,s,a,o,l,c){var d,u,h,p,f,y,g,m,w,v,b,_,E,I,A,S=t.type;if(void 0!==t.constructor)return null;128&r.__u&&(l=!!(32&r.__u),s=[o=t.__e=r.__e]),(d=sR.__b)&&d(t);e:if("function"==typeof S)try{if(m=t.props,w="prototype"in S&&S.prototype.render,v=(d=S.contextType)&&i[d.__c],b=d?v?v.props.value:d.__:i,r.__c?g=(u=t.__c=r.__c).__=u.__E:(w?t.__c=u=new S(m,b):(t.__c=u=new sQ(m,b),u.constructor=S,u.render=ae),v&&v.sub(u),u.state||(u.state={}),u.__n=i,h=u.__d=!0,u.__h=[],u._sb=[]),w&&null==u.__s&&(u.__s=u.state),w&&null!=S.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=sV({},u.__s)),sV(u.__s,S.getDerivedStateFromProps(m,u.__s))),p=u.props,f=u.state,u.__v=t,h)w&&null==S.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),w&&null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(w&&null==S.getDerivedStateFromProps&&m!==p&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(m,b),t.__v==r.__v||!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(m,u.__s,b)){t.__v!=r.__v&&(u.props=m,u.state=u.__s,u.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(e){e&&(e.__=t)}),sz.push.apply(u.__h,u._sb),u._sb=[],u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(m,u.__s,b),w&&null!=u.componentDidUpdate&&u.__h.push(function(){u.componentDidUpdate(p,f,y)})}if(u.context=b,u.props=m,u.__P=e,u.__e=!1,_=sR.__r,E=0,w)u.state=u.__s,u.__d=!1,_&&_(t),d=u.render(u.props,u.state,u.context),sz.push.apply(u.__h,u._sb),u._sb=[];else do u.__d=!1,_&&_(t),d=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++E<25)u.state=u.__s,null!=u.getChildContext&&(i=sV(sV({},i),u.getChildContext())),w&&!h&&null!=u.getSnapshotBeforeUpdate&&(y=u.getSnapshotBeforeUpdate(p,f)),I=null!=d&&d.type===sY&&null==d.key?function e(t){return"object"!=typeof t||null==t||t.__b>0?t:sK(t)?t.map(e):sV({},t)}(d.props.children):d,o=s2(e,sK(I)?I:[I],t,r,i,n,s,a,o,l,c),u.base=t.__e,t.__u&=-161,u.__h.length&&a.push(u),g&&(u.__E=u.__=null)}catch(e){if(t.__v=null,l||null!=s)if(e.then){for(t.__u|=l?160:128;o&&8==o.nodeType&&o.nextSibling;)o=o.nextSibling;s[s.indexOf(o)]=null,t.__e=o}else{for(A=s.length;A--;)sJ(s[A]);s6(t)}else t.__e=r.__e,t.__k=r.__k,e.then||s6(t);sR.__e(e,t,r)}else null==s&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):o=t.__e=function(e,t,r,i,n,s,a,o,l){var c,d,u,h,p,f,y,g=r.props||sH,m=t.props,w=t.type;if("svg"==w?n="http://www.w3.org/2000/svg":"math"==w?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),null!=s){for(c=0;c<s.length;c++)if((p=s[c])&&"setAttribute"in p==!!w&&(w?p.localName==w:3==p.nodeType)){e=p,s[c]=null;break}}if(null==e){if(null==w)return document.createTextNode(m);e=document.createElementNS(n,w,m.is&&m),o&&(sR.__m&&sR.__m(t,s),o=!1),s=null}if(null==w)g===m||o&&e.data==m||(e.data=m);else{if(s=s&&sO.call(e.childNodes),!o&&null!=s)for(g={},c=0;c<e.attributes.length;c++)g[(p=e.attributes[c]).name]=p.value;for(c in g)p=g[c],"dangerouslySetInnerHTML"==c?u=p:"children"==c||c in m||"value"==c&&"defaultValue"in m||"checked"==c&&"defaultChecked"in m||s3(e,c,null,p,n);for(c in m)p=m[c],"children"==c?h=p:"dangerouslySetInnerHTML"==c?d=p:"value"==c?f=p:"checked"==c?y=p:o&&"function"!=typeof p||g[c]===p||s3(e,c,p,g[c],n);if(d)o||u&&(d.__html==u.__html||d.__html==e.innerHTML)||(e.innerHTML=d.__html),t.__k=[];else if(u&&(e.innerHTML=""),s2("template"==t.type?e.content:e,sK(h)?h:[h],t,r,i,"foreignObject"==w?"http://www.w3.org/1999/xhtml":n,s,a,s?s[0]:r.__k&&sX(r,0),o,l),null!=s)for(c=s.length;c--;)sJ(s[c]);o||(c="value","progress"==w&&null==f?e.removeAttribute("value"):null==f||f===e[c]&&("progress"!=w||f)&&("option"!=w||f==g[c])||s3(e,c,f,g[c],n),c="checked",null!=y&&y!=e[c]&&s3(e,c,y,g[c],n))}return e}(r.__e,t,r,i,n,s,a,l,c);return(d=sR.diffed)&&d(t),128&t.__u?void 0:o}function s6(e){e&&(e.__c&&(e.__c.__e=!0),e.__k&&e.__k.some(s6))}function s9(e,t,r){for(var i=0;i<r.length;i++)s7(r[i],r[++i],r[++i]);sR.__c&&sR.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){sR.__e(e,t.__v)}})}function s7(e,t,r){try{if("function"==typeof e){var i="function"==typeof e.__u;i&&e.__u(),i&&null==t||(e.__u=e(t))}else e.current=t}catch(e){sR.__e(e,r)}}function ae(e,t,r){return this.constructor(e,r)}function at(e,t,r){var i,n,s,a;t==document&&(t=document.documentElement),sR.__&&sR.__(e,t),n=(i="function"==typeof r)?null:r&&r.__k||t.__k,s=[],a=[],s4(t,e=(!i&&r||t).__k=sG(sY,null,[e]),n||sH,sH,t.namespaceURI,!i&&r?[r]:n?null:t.firstChild?sO.call(t.childNodes):null,s,!i&&r?r:n?n.__e:t.firstChild,i,a),s9(s,e,a)}sO=sz.slice,sR={__e:function(e,t,r,i){for(var n,s,a;t=t.__;)if((n=t.__c)&&!n.__)try{if((s=n.constructor)&&null!=s.getDerivedStateFromError&&(n.setState(s.getDerivedStateFromError(e)),a=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e,i||{}),a=n.__d),a)return n.__E=n}catch(t){e=t}throw e}},sN=0,sQ.prototype.setState=function(e,t){var r;r=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=sV({},this.state),"function"==typeof e&&(e=e(sV({},r),this.props)),e&&sV(r,e),null!=e&&this.__v&&(t&&this._sb.push(t),s0(this))},sQ.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),s0(this))},sQ.prototype.render=sY,sM=[],sD="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,sL=function(e,t){return e.__v.__b-t.__v.__b},s1.__r=0,sj=/(PointerCapture)$|Capture$/i,sW=0,sB=s8(!1),sF=s8(!0);var ar,ai,an,as,aa=0,ao=[],al=sR,ac=al.__b,ad=al.__r,au=al.diffed,ah=al.__c,ap=al.unmount,af=al.__;function ay(e,t){al.__h&&al.__h(ai,e,aa||t),aa=0;var r=ai.__H||(ai.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function ag(e,t,r){var i=ay(ar++,2);if(i.t=e,!i.__c&&(i.__=[r?r(t):a_(void 0,t),function(e){var t=i.__N?i.__N[0]:i.__[0],r=i.t(t,e);t!==r&&(i.__N=[r,i.__[1]],i.__c.setState({}))}],i.__c=ai,!ai.__f)){var n=function(e,t,r){if(!i.__c.__H)return!0;var n=i.__c.__H.__.filter(function(e){return e.__c});if(n.every(function(e){return!e.__N}))return!s||s.call(this,e,t,r);var a=i.__c.props!==e;return n.some(function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(a=!0)}}),s&&s.call(this,e,t,r)||a};ai.__f=!0;var s=ai.shouldComponentUpdate,a=ai.componentWillUpdate;ai.componentWillUpdate=function(e,t,r){if(this.__e){var i=s;s=void 0,n(e,t,r),s=i}a&&a.call(this,e,t,r)},ai.shouldComponentUpdate=n}return i.__N||i.__}function am(){for(var e;e=ao.shift();){var t=e.__H;if(e.__P&&t)try{t.__h.some(av),t.__h.some(ab),t.__h=[]}catch(r){t.__h=[],al.__e(r,e.__v)}}}al.__b=function(e){ai=null,ac&&ac(e)},al.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),af&&af(e,t)},al.__r=function(e){ad&&ad(e),ar=0;var t=(ai=e.__c).__H;t&&(an===ai?(t.__h=[],ai.__h=[],t.__.some(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(t.__h.some(av),t.__h.some(ab),t.__h=[],ar=0)),an=ai},al.diffed=function(e){au&&au(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==ao.push(t)&&as===al.requestAnimationFrame||((as=al.requestAnimationFrame)||function(e){var t,r=function(){clearTimeout(i),aw&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(r,35);aw&&(t=requestAnimationFrame(r))})(am)),t.__H.__.some(function(e){e.u&&(e.__H=e.u),e.u=void 0})),an=ai=null},al.__c=function(e,t){t.some(function(e){try{e.__h.some(av),e.__h=e.__h.filter(function(e){return!e.__||ab(e)})}catch(r){t.some(function(e){e.__h&&(e.__h=[])}),t=[],al.__e(r,e.__v)}}),ah&&ah(e,t)},al.unmount=function(e){ap&&ap(e);var t,r=e.__c;r&&r.__H&&(r.__H.__.some(function(e){try{av(e)}catch(e){t=e}}),r.__H=void 0,t&&al.__e(t,r.__v))};var aw="function"==typeof requestAnimationFrame;function av(e){var t=ai,r=e.__c;"function"==typeof r&&(e.__c=void 0,r()),ai=t}function ab(e){var t=ai;e.__c=e.__(),ai=t}function a_(e,t){return"function"==typeof t?t(e):t}class aE{constructor(){this.items=new Map,this.nextItemKey=0,this.root=null,this.darkMode=sT()}attach(e){this.root=document.createElement("div"),this.root.className="-cbwsdk-snackbar-root",e.appendChild(this.root),this.render()}presentItem(e){let t=this.nextItemKey++;return this.items.set(t,e),this.render(),()=>{this.items.delete(t),this.render()}}clear(){this.items.clear(),this.render()}render(){this.root&&at(sG("div",null,sG(aI,{darkMode:this.darkMode},Array.from(this.items.entries()).map(([e,t])=>sG(aA,Object.assign({},t,{key:e}))))),this.root)}}let aI=e=>sG("div",{class:(0,sq.clsx)("-cbwsdk-snackbar-container")},sG("style",null,".-cbwsdk-css-reset .-gear-container{margin-left:16px !important;margin-right:9px !important;display:flex;align-items:center;justify-content:center;width:24px;height:24px;transition:opacity .25s}.-cbwsdk-css-reset .-gear-container *{user-select:none}.-cbwsdk-css-reset .-gear-container svg{opacity:0;position:absolute}.-cbwsdk-css-reset .-gear-icon{height:12px;width:12px;z-index:10000}.-cbwsdk-css-reset .-cbwsdk-snackbar{align-items:flex-end;display:flex;flex-direction:column;position:fixed;right:0;top:0;z-index:2147483647}.-cbwsdk-css-reset .-cbwsdk-snackbar *{user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance{display:flex;flex-direction:column;margin:8px 16px 0 16px;overflow:visible;text-align:left;transform:translateX(0);transition:opacity .25s,transform .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header:hover .-gear-container svg{opacity:1}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header{display:flex;align-items:center;background:#fff;overflow:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-cblogo{margin:8px 8px 8px 8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-message{color:#000;font-size:13px;line-height:1.5;user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu{background:#fff;transition:opacity .25s ease-in-out,transform .25s linear,visibility 0s;visibility:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;opacity:0;flex-direction:column;padding-left:8px;padding-right:8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:last-child{margin-bottom:8px !important}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover{background:#f5f7f8;border-radius:6px;transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover span{color:#050f19;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover svg path{fill:#000;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item{visibility:inherit;height:35px;margin-top:8px;margin-bottom:0;display:flex;flex-direction:row;align-items:center;padding:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item *{visibility:inherit;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover{background:rgba(223,95,103,.2);transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover svg path{fill:#df5f67;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover span{color:#df5f67;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-info{color:#aaa;font-size:13px;margin:0 8px 0 32px;position:absolute}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-hidden{opacity:0;text-align:left;transform:translateX(25%);transition:opacity .5s linear}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-expanded .-cbwsdk-snackbar-instance-menu{opacity:1;display:flex;transform:translateY(8px);visibility:visible}"),sG("div",{class:"-cbwsdk-snackbar"},e.children)),aA=({autoExpand:e,message:t,menuItems:r})=>{var i,n,s,a;let[o,l]=(aa=1,ag(a_,!0)),[c,d]=(aa=1,ag(a_,null!=e&&e));return i=()=>{let e=[window.setTimeout(()=>{l(!1)},1),window.setTimeout(()=>{d(!0)},1e4)];return()=>{e.forEach(window.clearTimeout)}},n=ay(ar++,3),!al.__s&&(s=n.__H,a=void 0,!s||s.length!==a.length||a.some(function(e,t){return e!==s[t]}))&&(n.__=i,n.u=void 0,ai.__H.__h.push(n)),sG("div",{class:(0,sq.clsx)("-cbwsdk-snackbar-instance",o&&"-cbwsdk-snackbar-instance-hidden",c&&"-cbwsdk-snackbar-instance-expanded")},sG("div",{class:"-cbwsdk-snackbar-instance-header",onClick:()=>{d(!c)}},sG("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEuNDkyIDEwLjQxOWE4LjkzIDguOTMgMCAwMTguOTMtOC45M2gxMS4xNjNhOC45MyA4LjkzIDAgMDE4LjkzIDguOTN2MTEuMTYzYTguOTMgOC45MyAwIDAxLTguOTMgOC45M0gxMC40MjJhOC45MyA4LjkzIDAgMDEtOC45My04LjkzVjEwLjQxOXoiIGZpbGw9IiMxNjUyRjAiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjQxOSAwSDIxLjU4QzI3LjMzNSAwIDMyIDQuNjY1IDMyIDEwLjQxOVYyMS41OEMzMiAyNy4zMzUgMjcuMzM1IDMyIDIxLjU4MSAzMkgxMC40MkM0LjY2NSAzMiAwIDI3LjMzNSAwIDIxLjU4MVYxMC40MkMwIDQuNjY1IDQuNjY1IDAgMTAuNDE5IDB6bTAgMS40ODhhOC45MyA4LjkzIDAgMDAtOC45MyA4LjkzdjExLjE2M2E4LjkzIDguOTMgMCAwMDguOTMgOC45M0gyMS41OGE4LjkzIDguOTMgMCAwMDguOTMtOC45M1YxMC40MmE4LjkzIDguOTMgMCAwMC04LjkzLTguOTNIMTAuNDJ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS45OTggMjYuMDQ5Yy01LjU0OSAwLTEwLjA0Ny00LjQ5OC0xMC4wNDctMTAuMDQ3IDAtNS41NDggNC40OTgtMTAuMDQ2IDEwLjA0Ny0xMC4wNDYgNS41NDggMCAxMC4wNDYgNC40OTggMTAuMDQ2IDEwLjA0NiAwIDUuNTQ5LTQuNDk4IDEwLjA0Ny0xMC4wNDYgMTAuMDQ3eiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xMi43NjIgMTQuMjU0YzAtLjgyMi42NjctMS40ODkgMS40ODktMS40ODloMy40OTdjLjgyMiAwIDEuNDg4LjY2NiAxLjQ4OCAxLjQ4OXYzLjQ5N2MwIC44MjItLjY2NiAxLjQ4OC0xLjQ4OCAxLjQ4OGgtMy40OTdhMS40ODggMS40ODggMCAwMS0xLjQ4OS0xLjQ4OHYtMy40OTh6IiBmaWxsPSIjMTY1MkYwIi8+PC9zdmc+",class:"-cbwsdk-snackbar-instance-header-cblogo"})," ",sG("div",{class:"-cbwsdk-snackbar-instance-header-message"},t),sG("div",{class:"-gear-container"},!c&&sG("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},sG("circle",{cx:"12",cy:"12",r:"12",fill:"#F5F7F8"})),sG("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDYuNzV2LTEuNWwtMS43Mi0uNTdjLS4wOC0uMjctLjE5LS41Mi0uMzItLjc3bC44MS0xLjYyLTEuMDYtMS4wNi0xLjYyLjgxYy0uMjQtLjEzLS41LS4yNC0uNzctLjMyTDYuNzUgMGgtMS41bC0uNTcgMS43MmMtLjI3LjA4LS41My4xOS0uNzcuMzJsLTEuNjItLjgxLTEuMDYgMS4wNi44MSAxLjYyYy0uMTMuMjQtLjI0LjUtLjMyLjc3TDAgNS4yNXYxLjVsMS43Mi41N2MuMDguMjcuMTkuNTMuMzIuNzdsLS44MSAxLjYyIDEuMDYgMS4wNiAxLjYyLS44MWMuMjQuMTMuNS4yMy43Ny4zMkw1LjI1IDEyaDEuNWwuNTctMS43MmMuMjctLjA4LjUyLS4xOS43Ny0uMzJsMS42Mi44MSAxLjA2LTEuMDYtLjgxLTEuNjJjLjEzLS4yNC4yMy0uNS4zMi0uNzdMMTIgNi43NXpNNiA4LjVhMi41IDIuNSAwIDAxMC01IDIuNSAyLjUgMCAwMTAgNXoiIGZpbGw9IiMwNTBGMTkiLz48L3N2Zz4=",class:"-gear-icon",title:"Expand"}))),r&&r.length>0&&sG("div",{class:"-cbwsdk-snackbar-instance-menu"},r.map((e,t)=>sG("div",{class:(0,sq.clsx)("-cbwsdk-snackbar-instance-menu-item",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-is-red"),onClick:e.onClick,key:t},sG("svg",{width:e.svgWidth,height:e.svgHeight,viewBox:"0 0 10 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},sG("path",{"fill-rule":e.defaultFillRule,"clip-rule":e.defaultClipRule,d:e.path,fill:"#AAAAAA"})),sG("span",{class:(0,sq.clsx)("-cbwsdk-snackbar-instance-menu-item-info",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-info-is-red")},e.info)))))},aS="M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z";class ak{constructor(){this.attached=!1,this.snackbar=new aE}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");let e=document.documentElement,t=document.createElement("div");t.className="-cbwsdk-css-reset",e.appendChild(t),this.snackbar.attach(t),this.attached=!0,sC()}showConnecting(e){let t;return t=e.isUnlinkedErrorState?{autoExpand:!0,message:"Connection lost",menuItems:[{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:"M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z",defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]}:{message:"Confirm on phone",menuItems:[{isRed:!0,info:"Cancel transaction",svgWidth:"11",svgHeight:"11",path:"M10.3711 1.52346L9.21775 0.370117L5.37109 4.21022L1.52444 0.370117L0.371094 1.52346L4.2112 5.37012L0.371094 9.21677L1.52444 10.3701L5.37109 6.53001L9.21775 10.3701L10.3711 9.21677L6.53099 5.37012L10.3711 1.52346Z",defaultFillRule:"inherit",defaultClipRule:"inherit",onClick:e.onCancel},{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:aS,defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]},this.snackbar.presentItem(t)}}class aT{constructor(){this.root=null,this.darkMode=sT()}attach(){let e=document.documentElement;this.root=document.createElement("div"),this.root.className="-cbwsdk-css-reset",e.appendChild(this.root),sC()}present(e){this.render(e)}clear(){this.render(null)}render(e){!this.root||(at(null,this.root),e&&at(sG(aC,Object.assign({},e,{onDismiss:()=>{this.clear()},darkMode:this.darkMode})),this.root))}}let aC=({title:e,buttonText:t,darkMode:r,onButtonClick:i,onDismiss:n})=>sG(aI,{darkMode:r},sG("div",{class:"-cbwsdk-redirect-dialog"},sG("style",null,".-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;transition:opacity .25s;background-color:rgba(10,11,13,.5)}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop-hidden{opacity:0}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box{display:block;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);padding:20px;border-radius:8px;background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box p{display:block;font-weight:400;font-size:14px;line-height:20px;padding-bottom:12px;color:#5b636e}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box button{appearance:none;border:none;background:none;color:#0052ff;padding:0;text-decoration:none;display:block;font-weight:600;font-size:16px;line-height:24px}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark{background-color:#0a0b0d;color:#fff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark button{color:#0052ff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light{background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light button{color:#0052ff}"),sG("div",{class:"-cbwsdk-redirect-dialog-backdrop",onClick:n}),sG("div",{class:(0,sq.clsx)("-cbwsdk-redirect-dialog-box",r?"dark":"light")},sG("p",null,e),sG("button",{onClick:i},t)))),ax="https://www.walletlink.org";class aP{constructor(){this.attached=!1,this.redirectDialog=new aT}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");this.redirectDialog.attach(),this.attached=!0}redirectToCoinbaseWallet(e){let t=new URL("https://go.cb-w.com/walletlink");t.searchParams.append("redirect_url",function(){try{if(function(){try{return null!==window.frameElement}catch(e){return!1}}()&&window.top)return window.top.location;return window.location}catch(e){return window.location}}().href),e&&t.searchParams.append("wl_url",e);let r=document.createElement("a");r.target="cbw-opener",r.href=t.href,r.rel="noreferrer noopener",r.click()}openCoinbaseWalletDeeplink(e){this.redirectDialog.present({title:"Redirecting to Coinbase Wallet...",buttonText:"Open",onButtonClick:()=>{this.redirectToCoinbaseWallet(e)}}),setTimeout(()=>{this.redirectToCoinbaseWallet(e)},99)}showConnecting(e){return()=>{this.redirectDialog.clear()}}}class aO{constructor(e){this.chainCallbackParams={chainId:"",jsonRpcUrl:""},this.isMobileWeb=function(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null==(e=null==window?void 0:window.navigator)?void 0:e.userAgent)}(),this.linkedUpdated=e=>{this.isLinked=e;let t=this.storage.getItem(sf);if(e&&(this._session.linked=e),this.isUnlinkedErrorState=!1,t){let r=t.split(" "),i="true"===this.storage.getItem("IsStandaloneSigning");""===r[0]||e||!this._session.linked||i||(this.isUnlinkedErrorState=!0)}},this.metadataUpdated=(e,t)=>{this.storage.setItem(e,t)},this.chainUpdated=(e,t)=>{(this.chainCallbackParams.chainId!==e||this.chainCallbackParams.jsonRpcUrl!==t)&&(this.chainCallbackParams={chainId:e,jsonRpcUrl:t},this.chainCallback&&this.chainCallback(t,Number.parseInt(e,10)))},this.accountUpdated=e=>{this.accountsCallback&&this.accountsCallback([e]),aO.accountRequestCallbackIds.size>0&&(Array.from(aO.accountRequestCallbackIds.values()).forEach(t=>{this.invokeCallback(t,{method:"requestEthereumAccounts",result:[e]})}),aO.accountRequestCallbackIds.clear())},this.resetAndReload=this.resetAndReload.bind(this),this.linkAPIUrl=e.linkAPIUrl,this.storage=e.storage,this.metadata=e.metadata,this.accountsCallback=e.accountsCallback,this.chainCallback=e.chainCallback;const{session:t,ui:r,connection:i}=this.subscribe();this._session=t,this.connection=i,this.relayEventManager=new sb,this.ui=r,this.ui.attach()}subscribe(){let e=sk.load(this.storage)||sk.create(this.storage),{linkAPIUrl:t}=this,r=new sv({session:e,linkAPIUrl:t,listener:this}),i=this.isMobileWeb?new aP:new ak;return r.connect(),{session:e,ui:i,connection:r}}resetAndReload(){this.connection.destroy().then(()=>{let e=sk.load(this.storage);(null==e?void 0:e.id)===this._session.id&&nh.clearAll(),document.location.reload()}).catch(e=>{})}signEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:n$(e.weiValue),data:nH(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?n$(e.gasPriceInWei):null,maxFeePerGas:e.gasPriceInWei?n$(e.gasPriceInWei):null,maxPriorityFeePerGas:e.gasPriceInWei?n$(e.gasPriceInWei):null,gasLimit:e.gasLimit?n$(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!1}})}signAndSubmitEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:n$(e.weiValue),data:nH(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?n$(e.gasPriceInWei):null,maxFeePerGas:e.maxFeePerGas?n$(e.maxFeePerGas):null,maxPriorityFeePerGas:e.maxPriorityFeePerGas?n$(e.maxPriorityFeePerGas):null,gasLimit:e.gasLimit?n$(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!0}})}submitEthereumTransaction(e,t){return this.sendRequest({method:"submitEthereumTransaction",params:{signedTransaction:nH(e,!0),chainId:t}})}getWalletLinkSession(){return this._session}sendRequest(e){let t=null,r=nB(8),i=i=>{this.publishWeb3RequestCanceledEvent(r),this.handleErrorResponse(r,e.method,i),null==t||t()};return new Promise((n,s)=>{t=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:i,onResetConnection:this.resetAndReload}),this.relayEventManager.callbacks.set(r,e=>{if(null==t||t(),sy(e))return s(Error(e.errorMessage));n(e)}),this.publishWeb3RequestEvent(r,e)})}publishWeb3RequestEvent(e,t){let r={type:"WEB3_REQUEST",id:e,request:t};this.publishEvent("Web3Request",r,!0).then(e=>{}).catch(e=>{this.handleWeb3ResponseMessage(r.id,{method:t.method,errorMessage:e.message})}),this.isMobileWeb&&this.openCoinbaseWalletDeeplink(t.method)}openCoinbaseWalletDeeplink(e){if(this.ui instanceof aP)switch(e){case"requestEthereumAccounts":case"switchEthereumChain":return;default:window.addEventListener("blur",()=>{window.addEventListener("focus",()=>{this.connection.checkUnseenEvents()},{once:!0})},{once:!0}),this.ui.openCoinbaseWalletDeeplink()}}publishWeb3RequestCanceledEvent(e){this.publishEvent("Web3RequestCanceled",{type:"WEB3_REQUEST_CANCELED",id:e},!1).then()}publishEvent(e,t,r){return this.connection.publishEvent(e,t,r)}handleWeb3ResponseMessage(e,t){if("requestEthereumAccounts"===t.method){aO.accountRequestCallbackIds.forEach(e=>this.invokeCallback(e,t)),aO.accountRequestCallbackIds.clear();return}this.invokeCallback(e,t)}handleErrorResponse(e,t,r){var i;let n=null!=(i=null==r?void 0:r.message)?i:"Unspecified error message.";this.handleWeb3ResponseMessage(e,{method:t,errorMessage:n})}invokeCallback(e,t){let r=this.relayEventManager.callbacks.get(e);r&&(r(t),this.relayEventManager.callbacks.delete(e))}requestEthereumAccounts(){let{appName:e,appLogoUrl:t}=this.metadata,r={method:"requestEthereumAccounts",params:{appName:e,appLogoUrl:t}},i=nB(8);return new Promise((e,t)=>{this.relayEventManager.callbacks.set(i,r=>{if(sy(r))return t(Error(r.errorMessage));e(r)}),aO.accountRequestCallbackIds.add(i),this.publishWeb3RequestEvent(i,r)})}watchAsset(e,t,r,i,n,s){let a={method:"watchAsset",params:{type:e,options:{address:t,symbol:r,decimals:i,image:n},chainId:s}},o=null,l=nB(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),sy(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}addEthereumChain(e,t,r,i,n,s){let a={method:"addEthereumChain",params:{chainId:e,rpcUrls:t,blockExplorerUrls:i,chainName:n,iconUrls:r,nativeCurrency:s}},o=null,l=nB(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),sy(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}switchEthereumChain(e,t){let r={method:"switchEthereumChain",params:Object.assign({chainId:e},{address:t})},i=null,n=nB(8),s=e=>{this.publishWeb3RequestCanceledEvent(n),this.handleErrorResponse(n,r.method,e),null==i||i()};return i=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:s,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(n,r=>(null==i||i(),sy(r)&&r.errorCode)?t(nO({code:r.errorCode,message:"Unrecognized chain ID. Try adding the chain using addEthereumChain first."})):sy(r)?t(Error(r.errorMessage)):void e(r)),this.publishWeb3RequestEvent(n,r)})}}aO.accountRequestCallbackIds=new Set;let aR="DefaultChainId",aN="DefaultJsonRpcUrl";class aM{constructor(e){this._relay=null,this._addresses=[],this.metadata=e.metadata,this._storage=new nh("walletlink",ax),this.callback=e.callback||null;const t=this._storage.getItem(sf);if(t){const e=t.split(" ");""!==e[0]&&(this._addresses=e.map(e=>nQ(e)))}this.initializeRelay()}getSession(){let{id:e,secret:t}=this.initializeRelay().getWalletLinkSession();return{id:e,secret:t}}async handshake(){await this._eth_requestAccounts()}get selectedAddress(){return this._addresses[0]||void 0}get jsonRpcUrl(){var e;return null!=(e=this._storage.getItem(aN))?e:void 0}set jsonRpcUrl(e){this._storage.setItem(aN,e)}updateProviderInfo(e,t){var r;this.jsonRpcUrl=e;let i=this.getChainId();this._storage.setItem(aR,t.toString(10)),n0(t)!==i&&(null==(r=this.callback)||r.call(this,"chainChanged",nK(t)))}async watchAsset(e){let t=Array.isArray(e)?e[0]:e;if(!t.type)throw nS("Type is required");if((null==t?void 0:t.type)!=="ERC20")throw nS(`Asset of type '${t.type}' is not supported`);if(!(null==t?void 0:t.options))throw nS("Options are required");if(!(null==t?void 0:t.options.address))throw nS("Address is required");let r=this.getChainId(),{address:i,symbol:n,image:s,decimals:a}=t.options,o=this.initializeRelay(),l=await o.watchAsset(t.type,i,n,a,s,null==r?void 0:r.toString());return!sy(l)&&!!l.result}async addEthereumChain(e){var t,r;let i=e[0];if((null==(t=i.rpcUrls)?void 0:t.length)===0)throw nS("please pass in at least 1 rpcUrl");if(!i.chainName||""===i.chainName.trim())throw nS("chainName is a required field");if(!i.nativeCurrency)throw nS("nativeCurrency is a required field");let n=Number.parseInt(i.chainId,16);if(n===this.getChainId())return!1;let s=this.initializeRelay(),{rpcUrls:a=[],blockExplorerUrls:o=[],chainName:l,iconUrls:c=[],nativeCurrency:d}=i,u=await s.addEthereumChain(n.toString(),a,c,o,l,d);if(sy(u))return!1;if((null==(r=u.result)?void 0:r.isApproved)===!0)return this.updateProviderInfo(a[0],n),null;throw nk("unable to add ethereum chain")}async switchEthereumChain(e){let t=Number.parseInt(e[0].chainId,16),r=this.initializeRelay(),i=await r.switchEthereumChain(t.toString(10),this.selectedAddress||void 0);if(sy(i))throw i;let n=i.result;return n.isApproved&&n.rpcUrl.length>0&&this.updateProviderInfo(n.rpcUrl,t),null}async cleanup(){this.callback=null,this._relay&&this._relay.resetAndReload(),this._storage.clear()}_setAddresses(e,t){var r;if(!Array.isArray(e))throw Error("addresses is not an array");let i=e.map(e=>nQ(e));JSON.stringify(i)!==JSON.stringify(this._addresses)&&(this._addresses=i,null==(r=this.callback)||r.call(this,"accountsChanged",i),this._storage.setItem(sf,i.join(" ")))}async request(e){let t=e.params||[];switch(e.method){case"eth_accounts":return[...this._addresses];case"eth_coinbase":return this.selectedAddress||null;case"net_version":return this.getChainId().toString(10);case"eth_chainId":return nK(this.getChainId());case"eth_requestAccounts":return this._eth_requestAccounts();case"eth_ecRecover":case"personal_ecRecover":return this.ecRecover(e);case"personal_sign":return this.personalSign(e);case"eth_signTransaction":return this._eth_signTransaction(t);case"eth_sendRawTransaction":return this._eth_sendRawTransaction(t);case"eth_sendTransaction":return this._eth_sendTransaction(t);case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":return this.signTypedData(e);case"wallet_addEthereumChain":return this.addEthereumChain(t);case"wallet_switchEthereumChain":return this.switchEthereumChain(t);case"wallet_watchAsset":return this.watchAsset(t);default:if(!this.jsonRpcUrl)throw nk("No RPC URL set for chain");return so(e,this.jsonRpcUrl)}}_ensureKnownAddress(e){let t=nQ(e);if(!this._addresses.map(e=>nQ(e)).includes(t))throw Error("Unknown Ethereum address")}_prepareTransactionParams(e){let t=e.from?nQ(e.from):this.selectedAddress;if(!t)throw Error("Ethereum address is unavailable");this._ensureKnownAddress(t);let r=e.to?nQ(e.to):null,i=null!=e.value?n1(e.value):BigInt(0),n=e.data?nX(e.data):ed.Buffer.alloc(0),s=null!=e.nonce?n0(e.nonce):null,a=null!=e.gasPrice?n1(e.gasPrice):null,o=null!=e.maxFeePerGas?n1(e.maxFeePerGas):null,l=null!=e.maxPriorityFeePerGas?n1(e.maxPriorityFeePerGas):null;return{fromAddress:t,toAddress:r,weiValue:i,data:n,nonce:s,gasPriceInWei:a,maxFeePerGas:o,maxPriorityFeePerGas:l,gasLimit:null!=e.gas?n1(e.gas):null,chainId:e.chainId?n0(e.chainId):this.getChainId()}}async ecRecover(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw nS();let i=this.initializeRelay(),n=await i.sendRequest({method:"ethereumAddressFromSignedMessage",params:{message:nz(r[0]),signature:nz(r[1]),addPrefix:"personal_ecRecover"===t}});if(sy(n))throw n;return n.result}getChainId(){var e;return Number.parseInt(null!=(e=this._storage.getItem(aR))?e:"1",10)}async _eth_requestAccounts(){var e,t;if(this._addresses.length>0)return null==(e=this.callback)||e.call(this,"connect",{chainId:nK(this.getChainId())}),this._addresses;let r=this.initializeRelay(),i=await r.requestEthereumAccounts();if(sy(i))throw i;if(!i.result)throw Error("accounts received is empty");return this._setAddresses(i.result),null==(t=this.callback)||t.call(this,"connect",{chainId:nK(this.getChainId())}),this._addresses}async personalSign({params:e}){if(!Array.isArray(e))throw nS();let t=e[1],r=e[0];this._ensureKnownAddress(t);let i=this.initializeRelay(),n=await i.sendRequest({method:"signEthereumMessage",params:{address:nQ(t),message:nz(r),addPrefix:!0,typedDataJson:null}});if(sy(n))throw n;return n.result}async _eth_signTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signEthereumTransaction(t);if(sy(i))throw i;return i.result}async _eth_sendRawTransaction(e){let t=nX(e[0]),r=this.initializeRelay(),i=await r.submitEthereumTransaction(t,this.getChainId());if(sy(i))throw i;return i.result}async _eth_sendTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signAndSubmitEthereumTransaction(t);if(sy(i))throw i;return i.result}async signTypedData(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw nS();let i=r[+("eth_signTypedData_v1"===t)],n=r[+("eth_signTypedData_v1"!==t)];this._ensureKnownAddress(i);let s=this.initializeRelay(),a=await s.sendRequest({method:"signEthereumMessage",params:{address:nQ(i),message:nH(({eth_signTypedData_v1:sp.default.hashForSignTypedDataLegacy,eth_signTypedData_v3:sp.default.hashForSignTypedData_v3,eth_signTypedData_v4:sp.default.hashForSignTypedData_v4,eth_signTypedData:sp.default.hashForSignTypedData_v4})[t]({data:function(e){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw nS(`Not a JSON string or an object: ${String(e)}`)}(n)}),!0),typedDataJson:JSON.stringify(n,null,2),addPrefix:!1}});if(sy(a))throw a;return a.result}initializeRelay(){return this._relay||(this._relay=new aO({linkAPIUrl:ax,storage:this._storage,metadata:this.metadata,accountsCallback:this._setAddresses.bind(this),chainCallback:this.updateProviderInfo.bind(this)})),this._relay}}let aU="SignerType",aD=new nh("CBWSDK","SignerConfigurator");async function aL(e){let{communicator:t,metadata:r,handshakeRequest:i,callback:n}=e;aj(t,r,n).catch(()=>{});let s={id:crypto.randomUUID(),event:"selectSignerType",data:Object.assign(Object.assign({},e.preference),{handshakeRequest:i})},{data:a}=await t.postRequestAndWaitForResponse(s);return a}async function aj(e,t,r){await e.onMessage(({event:e})=>"WalletLinkSessionRequest"===e);let i=new aM({metadata:t,callback:r});e.postMessage({event:"WalletLinkUpdate",data:{session:i.getSession()}}),await i.handshake(),e.postMessage({event:"WalletLinkUpdate",data:{connected:!0}})}let aW=`Coinbase Wallet SDK requires the Cross-Origin-Opener-Policy header to not be set to 'same-origin'. This is to ensure that the SDK can communicate with the Coinbase Smart Wallet app.

Please see https://www.smartwallet.dev/guides/tips/popup-tips#cross-origin-opener-policy for more information.`,{checkCrossOriginOpenerPolicy:aB,getCrossOriginOpenerPolicy:aF}={getCrossOriginOpenerPolicy:()=>void 0===p?"undefined":p,checkCrossOriginOpenerPolicy:async()=>{if("u"<typeof window){p="non-browser-env";return}try{let e=`${window.location.origin}${window.location.pathname}`,t=await fetch(e,{method:"HEAD"});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let r=t.headers.get("Cross-Origin-Opener-Policy");p=null!=r?r:"null","same-origin"===p&&console.error(aW)}catch(e){console.error("Error checking Cross-Origin-Opener-Policy:",e.message),p="error"}}},aq={isRed:!1,info:"Retry",svgWidth:"10",svgHeight:"11",path:aS,defaultFillRule:"evenodd",defaultClipRule:"evenodd"},aH=null;class az{constructor({url:e="https://keys.coinbase.com/connect",metadata:t,preference:r}){this.popup=null,this.listeners=new Map,this.postMessage=async e=>{(await this.waitForPopupLoaded()).postMessage(e,this.url.origin)},this.postRequestAndWaitForResponse=async e=>{let t=this.onMessage(({requestId:t})=>t===e.id);return this.postMessage(e),await t},this.onMessage=async e=>new Promise((t,r)=>{let i=r=>{if(r.origin!==this.url.origin)return;let n=r.data;e(n)&&(t(n),window.removeEventListener("message",i),this.listeners.delete(i))};window.addEventListener("message",i),this.listeners.set(i,{reject:r})}),this.disconnect=()=>{var e;(e=this.popup)&&!e.closed&&e.close(),this.popup=null,this.listeners.forEach(({reject:e},t)=>{e(nT("Request rejected")),window.removeEventListener("message",t)}),this.listeners.clear()},this.waitForPopupLoaded=async()=>this.popup&&!this.popup.closed?(this.popup.focus(),this.popup):(this.popup=await function(e){let t=(window.innerWidth-420)/2+window.screenX,r=(window.innerHeight-540)/2+window.screenY;function i(){let i=`wallet_${crypto.randomUUID()}`,n=window.open(e,i,`width=420, height=540, left=${t}, top=${r}`);return(null==n||n.focus(),n)?n:null}var n=e;for(let[e,t]of Object.entries({sdkName:sa,sdkVersion:ss,origin:window.location.origin,coop:aF()}))n.searchParams.append(e,t.toString());let s=i();if(!s){let e=function(){if(!aH){let e=document.createElement("div");e.className="-cbwsdk-css-reset",document.body.appendChild(e),(aH=new aE).attach(e)}return aH}();return new Promise((t,r)=>{e.presentItem({autoExpand:!0,message:"Popup was blocked. Try again.",menuItems:[Object.assign(Object.assign({},aq),{onClick:()=>{(s=i())?t(s):r(nk("Popup window was blocked")),e.clear()}})]})})}return Promise.resolve(s)}(this.url),this.onMessage(({event:e})=>"PopupUnload"===e).then(this.disconnect).catch(()=>{}),this.onMessage(({event:e})=>"PopupLoaded"===e).then(e=>{this.postMessage({requestId:e.id,data:{version:ss,metadata:this.metadata,preference:this.preference,location:window.location.toString()}})}).then(()=>{if(!this.popup)throw nk();return this.popup})),this.url=new URL(e),this.metadata=t,this.preference=r}}var a$=e.i(571650),a$=a$;class aK extends a$.default{}var aV=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r};class aJ extends aK{constructor(e){var{metadata:t}=e,r=e.preference,{keysUrl:i}=r,n=aV(r,["keysUrl"]);super(),this.signer=null,this.isCoinbaseWallet=!0,this.metadata=t,this.preference=n,this.communicator=new az({url:i,metadata:t,preference:n});const s=aD.getItem(aU);s&&(this.signer=this.initSigner(s))}async request(e){try{if(!function(e){if(!e||"object"!=typeof e||Array.isArray(e))throw nS({message:"Expected a single, non-array, object argument.",data:e});let{method:t,params:r}=e;if("string"!=typeof t||0===t.length)throw nS({message:"'args.method' must be a non-empty string.",data:e});if(void 0!==r&&!Array.isArray(r)&&("object"!=typeof r||null===r))throw nS({message:"'args.params' must be an object or array if provided.",data:e});switch(t){case"eth_sign":case"eth_signTypedData_v2":case"eth_subscribe":case"eth_unsubscribe":throw nx()}}(e),!this.signer)switch(e.method){case"eth_requestAccounts":{let t=await this.requestSignerSelection(e),r=this.initSigner(t);await r.handshake(e),this.signer=r,aD.setItem(aU,t);break}case"wallet_sendCalls":{let t=this.initSigner("scw");await t.handshake({method:"handshake"});let r=await t.request(e);return await t.cleanup(),r}case"wallet_getCallsStatus":return so(e,"https://rpc.wallet.coinbase.com");case"net_version":return 1;case"eth_chainId":return nK(1);default:throw nC("Must call 'eth_requestAccounts' before other methods")}return await this.signer.request(e)}catch(i){let e,t,{code:r}=i;return r===ng&&this.disconnect(),Promise.reject((e=function(e,{shouldIncludeStack:t=!1}={}){var r,i;let n={};if(e&&"object"==typeof e&&!Array.isArray(e)&&nI(e,"code")&&Number.isInteger(r=e.code)&&(nv[r.toString()]||(i=r)>=-32099&&i<=-32e3))n.code=e.code,e.message&&"string"==typeof e.message?(n.message=e.message,nI(e,"data")&&(n.data=e.data)):(n.message=n_(n.code),n.data={originalError:nE(e)});else n.code=nf,n.message=nA(e,"message")?e.message:nb,n.data={originalError:nE(e)};return t&&(n.stack=nA(e,"stack")?e.stack:void 0),n}(function(e){var t;if("string"==typeof e)return{message:e,code:nf};if(sy(e)){let r=e.errorMessage,i=null!=(t=e.errorCode)?t:r.match(/(denied|rejected)/i)?ny:void 0;return Object.assign(Object.assign({},e),{message:r,code:i,data:{method:e.method}})}return e}(i),{shouldIncludeStack:!0}),(t=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors")).searchParams.set("version",ss),t.searchParams.set("code",e.code.toString()),t.searchParams.set("message",e.message),Object.assign(Object.assign({},e),{docUrl:t.href})))}}async enable(){return console.warn('.enable() has been deprecated. Please use .request({ method: "eth_requestAccounts" }) instead.'),await this.request({method:"eth_requestAccounts"})}async disconnect(){var e;await (null==(e=this.signer)?void 0:e.cleanup()),this.signer=null,nh.clearAll(),this.emit("disconnect",nP("User initiated disconnection"))}requestSignerSelection(e){return aL({communicator:this.communicator,preference:this.preference,metadata:this.metadata,handshakeRequest:e,callback:this.emit.bind(this)})}initSigner(e){return function(e){let{signerType:t,metadata:r,communicator:i,callback:n}=e;switch(t){case"scw":return new sh({metadata:r,callback:n,communicator:i});case"walletlink":return new aM({metadata:r,callback:n})}}({signerType:e,metadata:this.metadata,communicator:this.communicator,callback:this.emit.bind(this)})}}let aG={options:"all"};function aZ(e){new nh("CBWSDK").setItem("VERSION",ss),aB();let t={metadata:{appName:e.appName||"Dapp",appLogoUrl:e.appLogoUrl||"",appChainIds:e.appChainIds||[]},preference:Object.assign(aG,null!=(r=e.preference)?r:{})};var r,i=t.preference;if(i){if(!["all","smartWalletOnly","eoaOnly"].includes(i.options))throw Error(`Invalid options: ${i.options}`);if(i.attribution&&void 0!==i.attribution.auto&&void 0!==i.attribution.dataSuffix)throw Error("Attribution cannot contain both auto and dataSuffix properties")}let n=null;return{getProvider:()=>{var e;let r;return n||(n=null!=(e=function({metadata:e,preference:t}){var r,i;let{appName:n,appLogoUrl:s,appChainIds:a}=e;if("smartWalletOnly"!==t.options){let e=globalThis.coinbaseWalletExtension;if(e)return null==(r=e.setAppInfo)||r.call(e,n,s,a,t),e}let o=function(){var e,t;try{let r=globalThis;return null!=(e=r.ethereum)?e:null==(t=r.top)?void 0:t.ethereum}catch(e){return}}();if(null==o?void 0:o.isCoinbaseBrowser)return null==(i=o.setAppInfo)||i.call(o,n,s,a,t),o}(r={metadata:t.metadata,preference:t.preference}))?e:new aJ(r)),n}}}var aY=e.i(205384),aQ=e.i(768820),aX=e.i(70233),a0=e.i(894978),a1=e.i(371507);let a2="/api/v1/sessions",a5="/api/v1/sessions/logout",a3="/api/v1/siwe/init",a8="/api/v1/siwe/authenticate",a4="/api/v1/siwe/link",a6="/api/v1/siwe/link_smart_wallet",a9="/api/v1/siwe/unlink",a7="/api/v1/siwe/transfer",oe="/api/v1/siws/init",ot="/api/v1/siws/authenticate",or="/api/v1/siws/link",oi="/api/v1/siws/unlink",on="/api/v1/siws/transfer",os="/api/v1/farcaster/init",oa="/api/v1/farcaster/authenticate",oo="/api/v1/farcaster/link",ol="/api/v1/farcaster/status",oc="/api/v1/farcaster/unlink",od="/api/v1/farcaster/transfer",ou="/api/v1/passwordless/init",oh="/api/v1/passwordless/authenticate",op="/api/v1/passwordless/link",of="/api/v1/passwordless/unlink",oy="/api/v1/passwordless/update",og="/api/v1/passwordless/transfer",om="/api/v1/passwordless_sms/init",ow="/api/v1/passwordless_sms/link",ov="/api/v1/passwordless_sms/unlink",ob="/api/v1/passwordless_sms/authenticate",o_="/api/v1/passwordless_sms/update",oE="/api/v1/passwordless_sms/transfer",oI="/api/v1/oauth/init",oA="/api/v1/oauth/authenticate",oS="/api/v1/oauth/link",ok="/api/v1/oauth/unlink",oT="/api/v1/oauth/transfer",oC="/api/v1/passkeys/link/init",ox="/api/v1/passkeys/authenticate/init",oP="/api/v1/passkeys/register/init",oO="/api/v1/passkeys/link",oR="/api/v1/passkeys/authenticate",oN="/api/v1/passkeys/register",oM="/api/v1/telegram/authenticate",oU="/api/v1/telegram/link",oD="/api/v1/telegram/unlink",oL="/api/v1/telegram/transfer",oj="/api/v1/mfa/passwordless_sms/init",oW="/api/v1/mfa/passkeys/init",oB="/api/v1/users/me/accept_terms",oF="/api/v1/analytics_events",oq="/api/v1/custom_jwt_account/authenticate",oH="/api/v1/custom_jwt_account/link",oz="/api/v1/guest/authenticate",o$="/api/v1/plugins/moonpay_on_ramp/sign",oK="/api/v1/funding/coinbase_on_ramp/init",oV="/api/v1/funding/coinbase_on_ramp/status",oJ="/api/v1/wallets/revoke",oG="/api/v1/users/me",oZ="/api/v1/scan/transaction";e.s(["$",()=>a7,"A",()=>a5,"B",()=>oF,"C",()=>oz,"D",()=>oj,"E",()=>oW,"F",()=>oB,"G",()=>of,"H",()=>ov,"I",()=>a9,"J",()=>oi,"K",()=>ok,"L",()=>oc,"M",()=>oD,"N",()=>oJ,"O",()=>o$,"P",()=>oK,"Q",()=>oV,"R",()=>a3,"S",()=>a8,"T",()=>a4,"U",()=>a6,"V",()=>oe,"W",()=>ot,"X",()=>oT,"Y",()=>on,"Z",()=>oL,"_",()=>od,"a",()=>op,"a0",()=>oE,"a1",()=>og,"a2",()=>or,"a3",()=>oG,"a4",()=>oZ,"a5",()=>"api/v2/farcaster/init","a6",()=>"api/v2/farcaster/authenticate","a8",()=>"/api/v1/recovery/oauth/authenticate","a9",()=>"/api/v1/recovery/oauth/init_icloud","aa",()=>"/api/v1/recovery/oauth/init","b",()=>ou,"c",()=>oo,"d",()=>os,"e",()=>ol,"f",()=>oa,"g",()=>oS,"h",()=>oI,"i",()=>oN,"j",()=>oR,"k",()=>oO,"l",()=>oP,"m",()=>ox,"n",()=>oC,"o",()=>oA,"p",()=>oh,"q",()=>ob,"r",()=>ow,"s",()=>om,"t",()=>o_,"u",()=>oy,"v",()=>oM,"w",()=>oU,"x",()=>oq,"y",()=>oH,"z",()=>a2],866979);var oY=e.i(746435),oQ=e.i(697781),oX=e.i(97146),o0=e.i(909311),o1=e.i(404574);function o2(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}function o5(){let e=[],t={addEventListener:(e,r,i,n)=>(e.addEventListener(r,i,n),t.add(()=>e.removeEventListener(r,i,n))),requestAnimationFrame(...e){let r=requestAnimationFrame(...e);return t.add(()=>cancelAnimationFrame(r))},nextFrame:(...e)=>t.requestAnimationFrame(()=>t.requestAnimationFrame(...e)),setTimeout(...e){let r=setTimeout(...e);return t.add(()=>clearTimeout(r))},microTask(...e){let r={current:!0};return o2(()=>{r.current&&e[0]()}),t.add(()=>{r.current=!1})},style(e,t,r){let i=e.style.getPropertyValue(t);return Object.assign(e.style,{[t]:r}),this.add(()=>{Object.assign(e.style,{[t]:i})})},group(e){let t=o5();return e(t),this.add(()=>t.dispose())},add:t=>(e.includes(t)||e.push(t),()=>{let r=e.indexOf(t);if(r>=0)for(let t of e.splice(r,1))t()}),dispose(){for(let t of e.splice(0))t()}};return t}function o3(){let[e]=(0,W.useState)(o5);return(0,W.useEffect)(()=>()=>e.dispose(),[e]),e}e.s(["disposables",()=>o5],464427),e.s(["useDisposables",()=>o3],555361);var o8=Object.defineProperty,o4=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?o8(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let o6=new class{constructor(){o4(this,"current",this.detect()),o4(this,"handoffState","pending"),o4(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"u"<typeof window||"u"<typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},o9=(e,t)=>{o6.isServer?(0,W.useEffect)(e,t):(0,W.useLayoutEffect)(e,t)};function o7(e){let t=(0,W.useRef)(e);return o9(()=>{t.current=e},[e]),t}e.s(["useIsoMorphicEffect",()=>o9],279116);let le=function(e){let t=o7(e);return W.default.useCallback((...e)=>t.current(...e),[t])};function lt(){let e=(0,W.useRef)(!1);return o9(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function lr(){let e,t=(e="u"<typeof document,"useSyncExternalStore"in W&&(0,W.useSyncExternalStore)(()=>()=>{},()=>!1,()=>!e)),[r,i]=W.useState(o6.isHandoffComplete);return r&&!1===o6.isHandoffComplete&&i(!1),W.useEffect(()=>{!0!==r&&i(!0)},[r]),W.useEffect(()=>o6.handoff(),[]),!t&&r}e.s(["useEvent",()=>le],5741);let li=Symbol();function ln(e,t=!0){return Object.assign(e,{[li]:t})}function ls(...e){let t=(0,W.useRef)(e);(0,W.useEffect)(()=>{t.current=e},[e]);let r=le(e=>{for(let r of t.current)null!=r&&("function"==typeof r?r(e):r.current=e)});return e.every(e=>null==e||(null==e?void 0:e[li]))?void 0:r}e.s(["optionalRef",()=>ln,"useSyncRefs",()=>ls],285972);var la=e.i(914655);void 0!==la.default&&"u">typeof globalThis&&"u">typeof Element&&(null==(P_=null==la.default?void 0:la.default.env)?void 0:P_.NODE_ENV)==="test"&&void 0===(null==(PE=null==Element?void 0:Element.prototype)?void 0:PE.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var lo=((f=lo||{})[f.None=0]="None",f[f.Closed=1]="Closed",f[f.Enter=2]="Enter",f[f.Leave=4]="Leave",f);function ll(e){let t={};for(let r in e)!0===e[r]&&(t[`data-${r}`]="");return t}function lc(e,t,r,i){let[n,s]=(0,W.useState)(r),{hasFlag:a,addFlag:o,removeFlag:l}=function(e=0){let[t,r]=(0,W.useState)(e),i=(0,W.useCallback)(e=>r(e),[]),n=(0,W.useCallback)(e=>r(t=>t|e),[]),s=(0,W.useCallback)(e=>(t&e)===e,[t]);return{flags:t,setFlag:i,addFlag:n,hasFlag:s,removeFlag:(0,W.useCallback)(e=>r(t=>t&~e),[]),toggleFlag:(0,W.useCallback)(e=>r(t=>t^e),[])}}(e&&n?3:0),c=(0,W.useRef)(!1),d=(0,W.useRef)(!1);return o9(()=>{var n;if(e){if(r&&s(!0),!t){r&&o(3);return}return null==(n=null==i?void 0:i.start)||n.call(i,r),function(e,{prepare:t,run:r,done:i,inFlight:n}){let s=o5();return function(e,{inFlight:t,prepare:r}){if(null!=t&&t.current)return r();let i=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=i}(e,{prepare:t,inFlight:n}),s.nextFrame(()=>{r(),s.requestAnimationFrame(()=>{s.add(function(e,t){var r,i;let n=o5();if(!e)return n.dispose;let s=!1;n.add(()=>{s=!0});let a=null!=(i=null==(r=e.getAnimations)?void 0:r.call(e).filter(e=>e instanceof CSSTransition))?i:[];return 0===a.length?t():Promise.allSettled(a.map(e=>e.finished)).then(()=>{s||t()}),n.dispose}(e,i))})}),s.dispose}(t,{inFlight:c,prepare(){d.current?d.current=!1:d.current=c.current,c.current=!0,d.current||(r?(o(3),l(4)):(o(4),l(2)))},run(){d.current?r?(l(3),o(4)):(l(4),o(3)):r?l(1):o(1)},done(){var e,n,a,o;d.current&&(null!=(o=null==(a=(n=t).getAnimations)?void 0:a.call(n))?o:[]).some(e=>e instanceof CSSTransition&&"finished"!==e.playState)||(c.current=!1,l(7),r||s(!1),null==(e=null==i?void 0:i.end)||e.call(i,r))}})}},[e,r,t,o3()]),e?[n,{closed:a(1),enter:a(2),leave:a(4),transition:a(2)||a(4)}]:[r,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}e.s(["transitionDataAttributes",()=>ll,"useTransition",()=>lc],437421);let ld=(0,W.createContext)(null);ld.displayName="OpenClosedContext";var lu=((y=lu||{})[y.Open=1]="Open",y[y.Closed=2]="Closed",y[y.Closing=4]="Closing",y[y.Opening=8]="Opening",y);function lh(){return(0,W.useContext)(ld)}function lp({value:e,children:t}){return W.default.createElement(ld.Provider,{value:e},t)}function lf({children:e}){return W.default.createElement(ld.Provider,{value:null},e)}function ly(...e){return Array.from(new Set(e.flatMap(e=>"string"==typeof e?e.split(" "):[]))).filter(Boolean).join(" ")}function lg(e,t,...r){if(e in t){let i=t[e];return"function"==typeof i?i(...r):i}let i=Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(e=>`"${e}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,lg),i}e.s(["OpenClosedProvider",()=>lp,"ResetOpenClosedProvider",()=>lf,"State",()=>lu,"useOpenClosed",()=>lh],623388),e.s(["match",()=>lg],957932);var lm=((g=lm||{})[g.None=0]="None",g[g.RenderStrategy=1]="RenderStrategy",g[g.Static=2]="Static",g),lw=((m=lw||{})[m.Unmount=0]="Unmount",m[m.Hidden=1]="Hidden",m);function lv(){let e,t,r=(e=(0,W.useRef)([]),t=(0,W.useCallback)(t=>{for(let r of e.current)null!=r&&("function"==typeof r?r(t):r.current=t)},[]),(...r)=>{if(!r.every(e=>null==e))return e.current=r,t});return(0,W.useCallback)(e=>(function({ourProps:e,theirProps:t,slot:r,defaultTag:i,features:n,visible:s=!0,name:a,mergeRefs:o}){o=null!=o?o:l_;let l=lE(t,e);if(s)return lb(l,r,i,a,o);let c=null!=n?n:0;if(2&c){let{static:e=!1,...t}=l;if(e)return lb(t,r,i,a,o)}if(1&c){let{unmount:e=!0,...t}=l;return lg(+!e,{0:()=>null,1:()=>lb({...t,hidden:!0,style:{display:"none"}},r,i,a,o)})}return lb(l,r,i,a,o)})({mergeRefs:r,...e}),[r])}function lb(e,t={},r,i,n){let{as:s=r,children:a,refName:o="ref",...l}=lk(e,["unmount","static"]),c=void 0!==e.ref?{[o]:e.ref}:{},d="function"==typeof a?a(t):a;"className"in l&&l.className&&"function"==typeof l.className&&(l.className=l.className(t)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let u={};if(t){let e=!1,r=[];for(let[i,n]of Object.entries(t))"boolean"==typeof n&&(e=!0),!0===n&&r.push(i.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`));if(e)for(let e of(u["data-headlessui-state"]=r.join(" "),r))u[`data-${e}`]=""}if(lT(s)&&(Object.keys(lS(l)).length>0||Object.keys(lS(u)).length>0))if(!(0,W.isValidElement)(d)||Array.isArray(d)&&d.length>1||lT(d.type)){if(Object.keys(lS(l)).length>0)throw Error(['Passing props on "Fragment"!',"",`The current component <${i} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(lS(l)).concat(Object.keys(lS(u))).map(e=>`  - ${e}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(e=>`  - ${e}`).join(`
`)].join(`
`))}else{var h;let e=d.props,t=null==e?void 0:e.className,r="function"==typeof t?(...e)=>ly(t(...e),l.className):ly(t,l.className),i=lE(d.props,lS(lk(l,["ref"])));for(let e in u)e in i&&delete u[e];return(0,W.cloneElement)(d,Object.assign({},i,u,c,{ref:n((h=d,W.default.version.split(".")[0]>="19"?h.props.ref:h.ref),c.ref)},r?{className:r}:{}))}return(0,W.createElement)(s,Object.assign({},lk(l,["ref"]),!lT(s)&&c,!lT(s)&&u),d)}function l_(...e){return e.every(e=>null==e)?void 0:t=>{for(let r of e)null!=r&&("function"==typeof r?r(t):r.current=t)}}function lE(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];if(t.disabled||t["aria-disabled"])for(let e in r)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(e)&&(r[e]=[e=>{var t;return null==(t=null==e?void 0:e.preventDefault)?void 0:t.call(e)}]);for(let e in r)Object.assign(t,{[e](t,...i){for(let n of r[e]){if((t instanceof Event||(null==t?void 0:t.nativeEvent)instanceof Event)&&t.defaultPrevented)return;n(t,...i)}}});return t}function lI(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];for(let e in r)Object.assign(t,{[e](...t){for(let i of r[e])null==i||i(...t)}});return t}function lA(e){var t;return Object.assign((0,W.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function lS(e){let t=Object.assign({},e);for(let e in t)void 0===t[e]&&delete t[e];return t}function lk(e,t=[]){let r=Object.assign({},e);for(let e of t)e in r&&delete r[e];return r}function lT(e){return e===W.Fragment||e===Symbol.for("react.fragment")}function lC(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||!lT(null!=(t=e.as)?t:lM)||1===W.default.Children.count(e.children)}e.s(["RenderFeatures",()=>lm,"RenderStrategy",()=>lw,"compact",()=>lS,"forwardRefWithAs",()=>lA,"isFragment",()=>lT,"mergeProps",()=>lI,"useRender",()=>lv],621418);let lx=(0,W.createContext)(null);lx.displayName="TransitionContext";var lP=((w=lP||{}).Visible="visible",w.Hidden="hidden",w);let lO=(0,W.createContext)(null);function lR(e){return"children"in e?lR(e.children):e.current.filter(({el:e})=>null!==e.current).filter(({state:e})=>"visible"===e).length>0}function lN(e,t){let r=o7(e),i=(0,W.useRef)([]),n=lt(),s=o3(),a=le((e,t=lw.Hidden)=>{let a=i.current.findIndex(({el:t})=>t===e);-1!==a&&(lg(t,{[lw.Unmount](){i.current.splice(a,1)},[lw.Hidden](){i.current[a].state="hidden"}}),s.microTask(()=>{var e;!lR(i)&&n.current&&(null==(e=r.current)||e.call(r))}))}),o=le(e=>{let t=i.current.find(({el:t})=>t===e);return t?"visible"!==t.state&&(t.state="visible"):i.current.push({el:e,state:"visible"}),()=>a(e,lw.Unmount)}),l=(0,W.useRef)([]),c=(0,W.useRef)(Promise.resolve()),d=(0,W.useRef)({enter:[],leave:[]}),u=le((e,r,i)=>{l.current.splice(0),t&&(t.chains.current[r]=t.chains.current[r].filter(([t])=>t!==e)),null==t||t.chains.current[r].push([e,new Promise(e=>{l.current.push(e)})]),null==t||t.chains.current[r].push([e,new Promise(e=>{Promise.all(d.current[r].map(([e,t])=>t)).then(()=>e())})]),"enter"===r?c.current=c.current.then(()=>null==t?void 0:t.wait.current).then(()=>i(r)):i(r)}),h=le((e,t,r)=>{Promise.all(d.current[t].splice(0).map(([e,t])=>t)).then(()=>{var e;null==(e=l.current.shift())||e()}).then(()=>r(t))});return(0,W.useMemo)(()=>({children:i,register:o,unregister:a,onStart:u,onStop:h,wait:c,chains:d}),[o,a,i,u,h,d,c])}lO.displayName="NestingContext";let lM=W.Fragment,lU=lm.RenderStrategy,lD=lA(function(e,t){let{show:r,appear:i=!1,unmount:n=!0,...s}=e,a=(0,W.useRef)(null),o=ls(...lC(e)?[a,t]:null===t?[]:[t]);lr();let l=lh();if(void 0===r&&null!==l&&(r=(l&lu.Open)===lu.Open),void 0===r)throw Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[c,d]=(0,W.useState)(r?"visible":"hidden"),u=lN(()=>{r||d("hidden")}),[h,p]=(0,W.useState)(!0),f=(0,W.useRef)([r]);o9(()=>{!1!==h&&f.current[f.current.length-1]!==r&&(f.current.push(r),p(!1))},[f,r]);let y=(0,W.useMemo)(()=>({show:r,appear:i,initial:h}),[r,i,h]);o9(()=>{r?d("visible"):lR(u)||null===a.current||d("hidden")},[r,u]);let g={unmount:n},m=le(()=>{var t;h&&p(!1),null==(t=e.beforeEnter)||t.call(e)}),w=le(()=>{var t;h&&p(!1),null==(t=e.beforeLeave)||t.call(e)}),v=lv();return W.default.createElement(lO.Provider,{value:u},W.default.createElement(lx.Provider,{value:y},v({ourProps:{...g,as:W.Fragment,children:W.default.createElement(lL,{ref:o,...g,...s,beforeEnter:m,beforeLeave:w})},theirProps:{},defaultTag:W.Fragment,features:lU,visible:"visible"===c,name:"Transition"})))}),lL=lA(function(e,t){var r,i;let{transition:n=!0,beforeEnter:s,afterEnter:a,beforeLeave:o,afterLeave:l,enter:c,enterFrom:d,enterTo:u,entered:h,leave:p,leaveFrom:f,leaveTo:y,...g}=e,[m,w]=(0,W.useState)(null),v=(0,W.useRef)(null),b=lC(e),_=ls(...b?[v,t,w]:null===t?[]:[t]),E=null==(r=g.unmount)||r?lw.Unmount:lw.Hidden,{show:I,appear:A,initial:S}=function(){let e=(0,W.useContext)(lx);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[k,T]=(0,W.useState)(I?"visible":"hidden"),C=function(){let e=(0,W.useContext)(lO);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:x,unregister:P}=C;o9(()=>x(v),[x,v]),o9(()=>{if(E===lw.Hidden&&v.current)return I&&"visible"!==k?void T("visible"):lg(k,{hidden:()=>P(v),visible:()=>x(v)})},[k,v,x,P,I,E]);let O=lr();o9(()=>{if(b&&O&&"visible"===k&&null===v.current)throw Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[v,k,O,b]);let R=S&&!A,N=A&&I&&S,M=(0,W.useRef)(!1),U=lN(()=>{M.current||(T("hidden"),P(v))},C),D=le(e=>{M.current=!0,U.onStart(v,e?"enter":"leave",e=>{"enter"===e?null==s||s():"leave"===e&&(null==o||o())})}),L=le(e=>{let t=e?"enter":"leave";M.current=!1,U.onStop(v,t,e=>{"enter"===e?null==a||a():"leave"===e&&(null==l||l())}),"leave"!==t||lR(U)||(T("hidden"),P(v))});(0,W.useEffect)(()=>{b&&n||(D(I),L(I))},[I,b,n]);let[,j]=lc(!(!n||!b||!O||R),m,I,{start:D,end:L}),B=lS({ref:_,className:(null==(i=ly(g.className,N&&c,N&&d,j.enter&&c,j.enter&&j.closed&&d,j.enter&&!j.closed&&u,j.leave&&p,j.leave&&!j.closed&&f,j.leave&&j.closed&&y,!j.transition&&I&&h))?void 0:i.trim())||void 0,...ll(j)}),F=0;"visible"===k&&(F|=lu.Open),"hidden"===k&&(F|=lu.Closed),I&&"hidden"===k&&(F|=lu.Opening),I||"visible"!==k||(F|=lu.Closing);let q=lv();return W.default.createElement(lO.Provider,{value:U},W.default.createElement(lp,{value:F},q({ourProps:B,theirProps:g,defaultTag:lM,features:lU,visible:"visible"===k,name:"Transition.Child"})))}),lj=lA(function(e,t){let r=null!==(0,W.useContext)(lx),i=null!==lh();return W.default.createElement(W.default.Fragment,null,!r&&i?W.default.createElement(lD,{ref:t,...e}):W.default.createElement(lL,{ref:t,...e}))}),lW=Object.assign(lD,{Child:lj,Root:lD});var lB=((v=lB||{}).Space=" ",v.Enter="Enter",v.Escape="Escape",v.Backspace="Backspace",v.Delete="Delete",v.ArrowLeft="ArrowLeft",v.ArrowUp="ArrowUp",v.ArrowRight="ArrowRight",v.ArrowDown="ArrowDown",v.Home="Home",v.End="End",v.PageUp="PageUp",v.PageDown="PageDown",v.Tab="Tab",v);function lF(e,t,r,i){let n=o7(r);(0,W.useEffect)(()=>{function r(e){n.current(e)}return(e=null!=e?e:window).addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)},[e,t,i])}e.s(["Keys",()=>lB],152594);class lq extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return void 0===t&&(t=this.factory(e),this.set(e,t)),t}}var lH=Object.defineProperty,lz=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},l$=(e,t,r)=>(lz(e,t,"read from private field"),r?r.call(e):t.get(e)),lK=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},lV=(e,t,r,i)=>(lz(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);class lJ{constructor(e){lK(this,PI,{}),lK(this,PA,new lq(()=>new Set)),lK(this,PS,new Set),((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lH(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"disposables",o5()),lV(this,PI,e),o6.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return l$(this,PI)}subscribe(e,t){if(o6.isServer)return()=>{};let r={selector:e,callback:t,current:e(l$(this,PI))};return l$(this,PS).add(r),this.disposables.add(()=>{l$(this,PS).delete(r)})}on(e,t){return o6.isServer?()=>{}:(l$(this,PA).get(e).add(t),this.disposables.add(()=>{l$(this,PA).get(e).delete(t)}))}send(e){let t=this.reduce(l$(this,PI),e);if(t!==l$(this,PI)){for(let e of(lV(this,PI,t),l$(this,PS))){let t=e.selector(l$(this,PI));lG(e.current,t)||(e.current=t,e.callback(t))}for(let t of l$(this,PA).get(e.type))t(l$(this,PI),e)}}}function lG(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&lZ(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size===t.size&&lZ(e.entries(),t.entries()):!!(lY(e)&&lY(t))&&lZ(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()))}function lZ(e,t){for(;;){let r=e.next(),i=t.next();if(r.done&&i.done)return!0;if(r.done||i.done||!Object.is(r.value,i.value))return!1}}function lY(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||null===Object.getPrototypeOf(t)}function lQ(e){let[t,r]=e(),i=o5();return(...e)=>{t(...e),i.dispose(),i.microTask(r)}}PI=new WeakMap,PA=new WeakMap,PS=new WeakMap,e.s(["Machine",()=>lJ,"batch",()=>lQ,"shallowEqual",()=>lG],756345);var lX=Object.defineProperty,l0=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lX(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r},l1=((b=l1||{})[b.Push=0]="Push",b[b.Pop=1]="Pop",b);let l2={0(e,t){let r=t.id,i=e.stack,n=e.stack.indexOf(r);if(-1!==n){let t=e.stack.slice();return t.splice(n,1),t.push(r),i=t,{...e,stack:i}}return{...e,stack:[...e.stack,r]}},1(e,t){let r=t.id,i=e.stack.indexOf(r);if(-1===i)return e;let n=e.stack.slice();return n.splice(i,1),{...e,stack:n}}};class l5 extends lJ{constructor(){super(...arguments),l0(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),l0(this,"selectors",{isTop:(e,t)=>e.stack[e.stack.length-1]===t,inStack:(e,t)=>e.stack.includes(t)})}static new(){return new l5({stack:[]})}reduce(e,t){return lg(t.type,l2,e,t)}}let l3=new lq(()=>l5.new());e.s(["ActionTypes",()=>l1,"stackMachines",()=>l3],719036);var l8=e.i(129852);function l4(e,t,r=lG){return(0,l8.useSyncExternalStoreWithSelector)(le(t=>e.subscribe(l6,t)),le(()=>e.state),le(()=>e.state),le(t),r)}function l6(e){return e}function l9(e,t){let r=(0,W.useId)(),i=l3.get(t),[n,s]=l4(i,(0,W.useCallback)(e=>[i.selectors.isTop(e,r),i.selectors.inStack(e,r)],[i,r]));return o9(()=>{if(e)return i.actions.push(r),()=>i.actions.pop(r)},[i,e,r]),!!e&&(!s||n)}function l7(e){var t;return o6.isServer?null:null==e?document:null!=(t=null==e?void 0:e.ownerDocument)?t:document}function ce(e){var t,r;return o6.isServer?null:null==e?document:null!=(r=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))?r:document}function ct(e){var t,r;return null!=(r=null==(t=ce(e))?void 0:t.activeElement)?r:null}function cr(e){return ct(e)===e}e.s(["useSlice",()=>l4],892009),e.s(["getActiveElement",()=>ct,"getOwnerDocument",()=>l7,"getRootNode",()=>ce,"isActiveElement",()=>cr],327422);let ci=new Map,cn=new Map;function cs(e){var t;let r=null!=(t=cn.get(e))?t:0;return cn.set(e,r+1),0!==r||(ci.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0),()=>(function(e){var t;let r=null!=(t=cn.get(e))?t:1;if(1===r?cn.delete(e):cn.set(e,r-1),1!==r)return;let i=ci.get(e);i&&(null===i["aria-hidden"]?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",i["aria-hidden"]),e.inert=i.inert,ci.delete(e))})(e)}function ca(e,{allowed:t,disallowed:r}={}){let i=l9(e,"inert-others");o9(()=>{var e,n;if(!i)return;let s=o5();for(let t of null!=(e=null==r?void 0:r())?e:[])t&&s.add(cs(t));let a=null!=(n=null==t?void 0:t())?n:[];for(let e of a){if(!e)continue;let t=l7(e);if(!t)continue;let r=e.parentElement;for(;r&&r!==t.body;){for(let e of r.children)a.some(t=>e.contains(t))||s.add(cs(e));r=r.parentElement}}return s.dispose},[i,t,r])}function co(e){return"object"==typeof e&&null!==e&&"nodeType"in e}function cl(e){return co(e)&&"tagName"in e}function cc(e){return cl(e)&&"accessKey"in e}function cd(e){return cl(e)&&"tabIndex"in e}function cu(e){return cl(e)&&"style"in e}function ch(e){return cc(e)&&"IFRAME"===e.nodeName}function cp(e){return cc(e)&&"INPUT"===e.nodeName}function cf(e){return cc(e)&&"LABEL"===e.nodeName}function cy(e){return cc(e)&&"FIELDSET"===e.nodeName}function cg(e){return cc(e)&&"LEGEND"===e.nodeName}function cm(e){return!!cl(e)&&e.matches('a[href],audio[controls],button,details,embed,iframe,img[usemap],input:not([type="hidden"]),label,select,textarea,video[controls]')}function cw(e,t,r){let i=o7(e=>{let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&r()});(0,W.useEffect)(()=>{if(!e)return;let r=null===t?null:cc(t)?t:t.current;if(!r)return;let n=o5();if("u">typeof ResizeObserver){let e=new ResizeObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}if("u">typeof IntersectionObserver){let e=new IntersectionObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}return()=>n.dispose()},[t,i,e])}e.s(["useInertOthers",()=>ca],436392),e.s(["hasInlineStyle",()=>cu,"isElement",()=>cl,"isHTMLElement",()=>cc,"isHTMLFieldSetElement",()=>cy,"isHTMLIframeElement",()=>ch,"isHTMLInputElement",()=>cp,"isHTMLLabelElement",()=>cf,"isHTMLLegendElement",()=>cg,"isHTMLorSVGElement",()=>cd,"isInteractiveElement",()=>cm,"isNode",()=>co],291329),e.s(["useOnDisappear",()=>cw],85905);let cv=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),cb=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var c_=((_=c_||{})[_.First=1]="First",_[_.Previous=2]="Previous",_[_.Next=4]="Next",_[_.Last=8]="Last",_[_.WrapAround=16]="WrapAround",_[_.NoScroll=32]="NoScroll",_[_.AutoFocus=64]="AutoFocus",_),cE=((E=cE||{})[E.Error=0]="Error",E[E.Overflow=1]="Overflow",E[E.Success=2]="Success",E[E.Underflow=3]="Underflow",E),cI=((I=cI||{})[I.Previous=-1]="Previous",I[I.Next=1]="Next",I);function cA(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(cv)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}var cS=((A=cS||{})[A.Strict=0]="Strict",A[A.Loose=1]="Loose",A);function ck(e,t=0){var r;return e!==(null==(r=l7(e))?void 0:r.body)&&lg(t,{0:()=>e.matches(cv),1(){let t=e;for(;null!==t;){if(t.matches(cv))return!0;t=t.parentElement}return!1}})}function cT(e){o5().nextFrame(()=>{let t=ct(e);t&&cd(t)&&!ck(t,0)&&cx(e)})}var cC=((S=cC||{})[S.Keyboard=0]="Keyboard",S[S.Mouse=1]="Mouse",S);function cx(e){null==e||e.focus({preventScroll:!0})}function cP(e,t=e=>e){return e.slice().sort((e,r)=>{let i=t(e),n=t(r);if(null===i||null===n)return 0;let s=i.compareDocumentPosition(n);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function cO(e,t,r=null===e?document.body:ce(e)){return cR(cA(r),t,{relativeTo:e})}function cR(e,t,{sorted:r=!0,relativeTo:i=null,skipElements:n=[]}={}){var s,a,o;let l=Array.isArray(e)?e.length>0?ce(e[0]):document:ce(e),c=Array.isArray(e)?r?cP(e):e:64&t?function(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(cb)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}(e):cA(e);n.length>0&&c.length>1&&(c=c.filter(e=>!n.some(t=>null!=t&&"current"in t?(null==t?void 0:t.current)===e:t===e))),i=null!=i?i:null==l?void 0:l.activeElement;let d=(()=>{if(5&t)return 1;if(10&t)return -1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=(()=>{if(1&t)return 0;if(2&t)return Math.max(0,c.indexOf(i))-1;if(4&t)return Math.max(0,c.indexOf(i))+1;if(8&t)return c.length-1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),h=32&t?{preventScroll:!0}:{},p=0,f=c.length,y;do{if(p>=f||p+f<=0)return 0;let e=u+p;if(16&t)e=(e+f)%f;else{if(e<0)return 3;if(e>=f)return 1}null==(y=c[e])||y.focus(h),p+=d}while(y!==ct(y))return 6&t&&null!=(o=null==(a=null==(s=y)?void 0:s.matches)?void 0:a.call(s,"textarea,input"))&&o&&y.select(),2}function cN(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function cM(){return cN()||/Android/gi.test(window.navigator.userAgent)}function cU(e,t,r,i){let n=o7(r);(0,W.useEffect)(()=>{if(e)return document.addEventListener(t,r,i),()=>document.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function cD(e,t,r,i){let n=o7(r);(0,W.useEffect)(()=>{if(e)return window.addEventListener(t,r,i),()=>window.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function cL(e,t,r){let i=o7(r),n=(0,W.useCallback)(function(e,r){if(e.defaultPrevented)return;let n=r(e);if(null!==n&&n.getRootNode().contains(n)&&n.isConnected){for(let r of function e(t){return"function"==typeof t?e(t()):Array.isArray(t)||t instanceof Set?t:[t]}(t))if(null!==r&&(r.contains(n)||e.composed&&e.composedPath().includes(r)))return;return ck(n,cS.Loose)||-1===n.tabIndex||e.preventDefault(),i.current(e,n)}},[i,t]),s=(0,W.useRef)(null);cU(e,"pointerdown",e=>{var t,r;cM()||(s.current=(null==(r=null==(t=e.composedPath)?void 0:t.call(e))?void 0:r[0])||e.target)},!0),cU(e,"pointerup",e=>{if(cM()||!s.current)return;let t=s.current;return s.current=null,n(e,()=>t)},!0);let a=(0,W.useRef)({x:0,y:0});cU(e,"touchstart",e=>{a.current.x=e.touches[0].clientX,a.current.y=e.touches[0].clientY},!0),cU(e,"touchend",e=>{let t={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};if(!(Math.abs(t.x-a.current.x)>=30||Math.abs(t.y-a.current.y)>=30))return n(e,()=>cd(e.target)?e.target:null)},!0),cD(e,"blur",e=>n(e,()=>ch(window.document.activeElement)?window.document.activeElement:null),!0)}function cj(...e){return(0,W.useMemo)(()=>l7(...e),[...e])}"u">typeof window&&"u">typeof document&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{1===e.detail?delete document.documentElement.dataset.headlessuiFocusVisible:0===e.detail&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0)),e.s(["Focus",()=>c_,"FocusResult",()=>cE,"FocusableMode",()=>cS,"focusElement",()=>cx,"focusFrom",()=>cO,"focusIn",()=>cR,"focusableSelector",()=>cv,"isFocusableElement",()=>ck,"restoreFocusIfNecessary",()=>cT,"sortByDomNode",()=>cP],622039),e.s(["useDocumentEvent",()=>cU],157516),e.s(["useOutsideClick",()=>cL],813170),e.s(["useOwnerDocument",()=>cj],644546);var cW=((k=cW||{})[k.None=1]="None",k[k.Focusable=2]="Focusable",k[k.Hidden=4]="Hidden",k);let cB=lA(function(e,t){var r;let{features:i=1,...n}=e,s={ref:t,"aria-hidden":(2&i)==2||(null!=(r=n["aria-hidden"])?r:void 0),hidden:(4&i)==4||void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(4&i)==4&&(2&i)!=2&&{display:"none"}}};return lv()({ourProps:s,theirProps:n,slot:{},defaultTag:"span",name:"Hidden"})}),cF=(0,W.createContext)(null);function cq({children:e,node:t}){let[r,i]=(0,W.useState)(null),n=cH(null!=t?t:r);return W.default.createElement(cF.Provider,{value:n},e,null===n&&W.default.createElement(cB,{features:cW.Hidden,ref:e=>{var t,r;if(e){for(let n of null!=(r=null==(t=l7(e))?void 0:t.querySelectorAll("html > *, body > *"))?r:[])if(n!==document.body&&n!==document.head&&cl(n)&&null!=n&&n.contains(e)){i(n);break}}}}))}function cH(e=null){var t;return null!=(t=(0,W.useContext)(cF))?t:e}function cz(e){let t={};for(let r of e)Object.assign(t,r(t));return t}let c$=(Po=()=>new Map,Pl={PUSH(e,t){var r;let i=null!=(r=this.get(e))?r:{doc:e,count:0,d:o5(),meta:new Set,computedMeta:{}};return i.count++,i.meta.add(t),i.computedMeta=cz(i.meta),this.set(e,i),this},POP(e,t){let r=this.get(e);return r&&(r.count--,r.meta.delete(t),r.computedMeta=cz(r.meta)),this},SCROLL_PREVENT(e){let t,r={doc:e.doc,d:e.d,meta:()=>e.computedMeta},i=[cN()?{before({doc:e,d:t,meta:r}){function i(e){for(let t of r().containers)for(let r of t())if(r.contains(e))return!0;return!1}t.microTask(()=>{var r;if("auto"!==window.getComputedStyle(e.documentElement).scrollBehavior){let r=o5();r.style(e.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>r.dispose()))}let n=null!=(r=window.scrollY)?r:window.pageYOffset,s=null;t.addEventListener(e,"click",t=>{if(cd(t.target))try{let r=t.target.closest("a");if(!r)return;let{hash:n}=new URL(r.href),a=e.querySelector(n);cd(a)&&!i(a)&&(s=a)}catch{}},!0),t.group(r=>{t.addEventListener(e,"touchstart",e=>{if(r.dispose(),cd(e.target)&&cu(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&i(t.parentElement);)t=t.parentElement;r.style(t,"overscrollBehavior","contain")}else r.style(e.target,"touchAction","none")})}),t.addEventListener(e,"touchmove",e=>{if(cd(e.target)&&!cp(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&""!==t.dataset.headlessuiPortal&&!(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)t=t.parentElement;""===t.dataset.headlessuiPortal&&e.preventDefault()}else e.preventDefault()},{passive:!1}),t.add(()=>{var e;n!==(null!=(e=window.scrollY)?e:window.pageYOffset)&&window.scrollTo(0,n),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)})})}}:{},{before({doc:e}){var r;let i=e.documentElement;t=Math.max(0,(null!=(r=e.defaultView)?r:window).innerWidth-i.clientWidth)},after({doc:e,d:r}){let i=e.documentElement,n=Math.max(0,i.clientWidth-i.offsetWidth),s=Math.max(0,t-n);r.style(i,"paddingRight",`${s}px`)}},{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}];i.forEach(({before:e})=>null==e?void 0:e(r)),i.forEach(({after:e})=>null==e?void 0:e(r))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}},T=Po(),C=new Set,{getSnapshot:()=>T,subscribe:e=>(C.add(e),()=>C.delete(e)),dispatch(e,...t){let r=Pl[e].call(T,...t);r&&(T=r,C.forEach(e=>e()))}});function cK(e,t,r=()=>[document.body]){!function(e,t,r=()=>({containers:[]})){let i=(0,W.useSyncExternalStore)(c$.subscribe,c$.getSnapshot,c$.getSnapshot),n=t?i.get(t):void 0;n&&n.count,o9(()=>{if(!(!t||!e))return c$.dispatch("PUSH",t,r),()=>c$.dispatch("POP",t,r)},[e,t])}(l9(e,"scroll-lock"),t,e=>{var t;return{containers:[...null!=(t=e.containers)?t:[],r]}})}function cV(e){return(0,W.useMemo)(()=>e,Object.values(e))}c$.subscribe(()=>{let e=c$.getSnapshot(),t=new Map;for(let[r]of e)t.set(r,r.documentElement.style.overflow);for(let r of e.values()){let e="hidden"===t.get(r.doc),i=0!==r.count;(i&&!e||!i&&e)&&c$.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),0===r.count&&c$.dispatch("TEARDOWN",r)}}),e.s(["useScrollLock",()=>cK],359948),e.s(["useSlot",()=>cV],855481);let cJ=(0,W.createContext)(()=>{});function cG({value:e,children:t}){return W.default.createElement(cJ.Provider,{value:e},t)}let cZ=(0,W.createContext)(!1);function cY(e){return W.default.createElement(cZ.Provider,{value:e.force},e.children)}let cQ=(0,W.createContext)(void 0);function cX(){return(0,W.useContext)(cQ)}e.s(["useDisabled",()=>cX],475835);let c0=(0,W.createContext)(null);function c1(){let[e,t]=(0,W.useState)([]);return[e.length>0?e.join(" "):void 0,(0,W.useMemo)(()=>function(e){let r=le(e=>(t(t=>[...t,e]),()=>t(t=>{let r=t.slice(),i=r.indexOf(e);return -1!==i&&r.splice(i,1),r}))),i=(0,W.useMemo)(()=>({register:r,slot:e.slot,name:e.name,props:e.props,value:e.value}),[r,e.slot,e.name,e.props,e.value]);return W.default.createElement(c0.Provider,{value:i},e.children)},[t])]}c0.displayName="DescriptionContext";let c2=Object.assign(lA(function(e,t){let r=(0,W.useId)(),i=cX(),{id:n=`headlessui-description-${r}`,...s}=e,a=function e(){let t=(0,W.useContext)(c0);if(null===t){let t=Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,e),t}return t}(),o=ls(t);o9(()=>a.register(n),[n,a.register]);let l=cV({...a.slot,disabled:i||!1}),c={ref:o,...a.props,id:n};return lv()({ourProps:c,theirProps:s,slot:l,defaultTag:"p",name:a.name||"Description"})}),{});function c5(e){let t=le(e),r=(0,W.useRef)(!1);(0,W.useEffect)(()=>(r.current=!1,()=>{r.current=!0,o2(()=>{r.current&&t()})}),[t])}e.s(["Description",()=>c2,"useDescriptions",()=>c1],879058),e.s(["useOnUnmount",()=>c5],676389);var c3=((x=c3||{})[x.Forwards=0]="Forwards",x[x.Backwards=1]="Backwards",x);function c8(e,t){let r=(0,W.useRef)([]),i=le(e);(0,W.useEffect)(()=>{let e=[...r.current];for(let[n,s]of t.entries())if(r.current[n]!==s){let n=i(t,e);return r.current=t,n}},[i,...t])}let c4=[];function c6(){"loading"!==document.readyState&&((()=>{function e(e){if(!cd(e.target)||e.target===document.body||c4[0]===e.target)return;let t=e.target;t=t.closest(cv),c4.unshift(null!=t?t:e.target),(c4=c4.filter(e=>null!=e&&e.isConnected)).splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})})(),document.removeEventListener("DOMContentLoaded",c6))}function c9(e){if(!e)return new Set;if("function"==typeof e)return new Set(e());let t=new Set;for(let r of e.current)cl(r.current)&&t.add(r.current);return t}"u">typeof window&&"u">typeof document&&(document.addEventListener("DOMContentLoaded",c6),c6());var c7=((P=c7||{})[P.None=0]="None",P[P.InitialFocus=1]="InitialFocus",P[P.TabLock=2]="TabLock",P[P.FocusLock=4]="FocusLock",P[P.RestoreFocus=8]="RestoreFocus",P[P.AutoFocus=16]="AutoFocus",P);let de=Object.assign(lA(function(e,t){let r,i=(0,W.useRef)(null),n=ls(i,t),{initialFocus:s,initialFocusFallback:a,containers:o,features:l=15,...c}=e;lr()||(l=0);let d=cj(i.current);!function(e,{ownerDocument:t}){let r=!!(8&e),i=function(e=!0){let t=(0,W.useRef)(c4.slice());return c8(([e],[r])=>{!0===r&&!1===e&&o2(()=>{t.current.splice(0)}),!1===r&&!0===e&&(t.current=c4.slice())},[e,c4,t]),le(()=>{var e;return null!=(e=t.current.find(e=>null!=e&&e.isConnected))?e:null})}(r);c8(()=>{r||cr(null==t?void 0:t.body)&&cx(i())},[r]),c5(()=>{r&&cx(i())})}(l,{ownerDocument:d});let u=function(e,{ownerDocument:t,container:r,initialFocus:i,initialFocusFallback:n}){let s=(0,W.useRef)(null),a=l9(!!(1&e),"focus-trap#initial-focus"),o=lt();return c8(()=>{if(0===e)return;if(!a){null!=n&&n.current&&cx(n.current);return}let l=r.current;l&&o2(()=>{if(!o.current)return;let r=null==t?void 0:t.activeElement;if(null!=i&&i.current){if((null==i?void 0:i.current)===r){s.current=r;return}}else if(l.contains(r)){s.current=r;return}if(null!=i&&i.current)cx(i.current);else{if(16&e){if(cR(l,c_.First|c_.AutoFocus)!==cE.Error)return}else if(cR(l,c_.First)!==cE.Error)return;if(null!=n&&n.current&&(cx(n.current),(null==t?void 0:t.activeElement)===n.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}s.current=null==t?void 0:t.activeElement})},[n,a,e]),s}(l,{ownerDocument:d,container:i,initialFocus:s,initialFocusFallback:a});!function(e,{ownerDocument:t,container:r,containers:i,previousActiveElement:n}){let s=lt(),a=!!(4&e);lF(null==t?void 0:t.defaultView,"focus",e=>{if(!a||!s.current)return;let t=c9(i);cc(r.current)&&t.add(r.current);let o=n.current;if(!o)return;let l=e.target;cc(l)?dt(t,l)?(n.current=l,cx(l)):(e.preventDefault(),e.stopPropagation(),cx(o)):cx(n.current)},!0)}(l,{ownerDocument:d,container:i,containers:o,previousActiveElement:u});let h=(r=(0,W.useRef)(0),cD(!0,"keydown",e=>{"Tab"===e.key&&(r.current=+!!e.shiftKey)},!0),r),p=le(e=>{if(!cc(i.current))return;let t=i.current;lg(h.current,{[c3.Forwards]:()=>{cR(t,c_.First,{skipElements:[e.relatedTarget,a]})},[c3.Backwards]:()=>{cR(t,c_.Last,{skipElements:[e.relatedTarget,a]})}})}),f=l9(!!(2&l),"focus-trap#tab-lock"),y=o3(),g=(0,W.useRef)(!1),m=lv();return W.default.createElement(W.default.Fragment,null,f&&W.default.createElement(cB,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:cW.Focusable}),m({ourProps:{ref:n,onKeyDown(e){"Tab"==e.key&&(g.current=!0,y.requestAnimationFrame(()=>{g.current=!1}))},onBlur(e){if(!(4&l))return;let t=c9(o);cc(i.current)&&t.add(i.current);let r=e.relatedTarget;cd(r)&&"true"!==r.dataset.headlessuiFocusGuard&&(dt(t,r)||(g.current?cR(i.current,lg(h.current,{[c3.Forwards]:()=>c_.Next,[c3.Backwards]:()=>c_.Previous})|c_.WrapAround,{relativeTo:e.target}):cd(e.target)&&cx(e.target)))}},theirProps:c,defaultTag:"div",name:"FocusTrap"}),f&&W.default.createElement(cB,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:cW.Focusable}))}),{features:c7});function dt(e,t){for(let r of e)if(r.contains(t))return!0;return!1}var dr=e.i(181409);let di=W.Fragment,dn=lA(function(e,t){let{ownerDocument:r=null,...i}=e,n=(0,W.useRef)(null),s=ls(ln(e=>{n.current=e}),t),a=cj(n.current),o=function(e){let t=(0,W.useContext)(cZ),r=(0,W.useContext)(da),[i,n]=(0,W.useState)(()=>{var i;if(!t&&null!==r)return null!=(i=r.current)?i:null;if(o6.isServer)return null;let n=null==e?void 0:e.getElementById("headlessui-portal-root");if(n)return n;if(null===e)return null;let s=e.createElement("div");return s.setAttribute("id","headlessui-portal-root"),e.body.appendChild(s)});return(0,W.useEffect)(()=>{null!==i&&(null!=e&&e.body.contains(i)||null==e||e.body.appendChild(i))},[i,e]),(0,W.useEffect)(()=>{t||null!==r&&n(r.current)},[r,n,t]),i}(null!=r?r:a),l=(0,W.useContext)(dl),c=o3(),d=lv();return c5(()=>{var e;o&&o.childNodes.length<=0&&(null==(e=o.parentElement)||e.removeChild(o))}),o?(0,dr.createPortal)(W.default.createElement("div",{"data-headlessui-portal":"",ref:e=>{c.dispose(),l&&e&&c.add(l.register(e))}},d({ourProps:{ref:s},theirProps:i,slot:{},defaultTag:di,name:"Portal"})),o):null}),ds=W.Fragment,da=(0,W.createContext)(null),dl=(0,W.createContext)(null);function dc(){let e=(0,W.useContext)(dl),t=(0,W.useRef)([]),r=le(r=>(t.current.push(r),e&&e.register(r),()=>i(r))),i=le(r=>{let i=t.current.indexOf(r);-1!==i&&t.current.splice(i,1),e&&e.unregister(r)}),n=(0,W.useMemo)(()=>({register:r,unregister:i,portals:t}),[r,i,t]);return[t,(0,W.useMemo)(()=>function({children:e}){return W.default.createElement(dl.Provider,{value:n},e)},[n])]}let dd=lA(function(e,t){let r=ls(t),{enabled:i=!0,ownerDocument:n,...s}=e,a=lv();return i?W.default.createElement(dn,{...s,ownerDocument:n,ref:r}):a({ourProps:{ref:r},theirProps:s,slot:{},defaultTag:di,name:"Portal"})}),du=lA(function(e,t){let{target:r,...i}=e,n={ref:ls(t)},s=lv();return W.default.createElement(da.Provider,{value:r},s({ourProps:n,theirProps:i,defaultTag:ds,name:"Popover.Group"}))}),dh=Object.assign(dd,{Group:du});e.s(["Portal",()=>dh,"PortalGroup",()=>du,"useNestedPortals",()=>dc],854569);var dp=((O=dp||{})[O.Open=0]="Open",O[O.Closed=1]="Closed",O),df=((R=df||{})[R.SetTitleId=0]="SetTitleId",R);let dy={0:(e,t)=>e.titleId===t.id?e:{...e,titleId:t.id}},dg=(0,W.createContext)(null);function dm(e){let t=(0,W.useContext)(dg);if(null===t){let t=Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,dm),t}return t}function dw(e,t){return lg(t.type,dy,e,t)}dg.displayName="DialogContext";let dv=lA(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-${r}`,open:n,onClose:s,initialFocus:a,role:o="dialog",autoFocus:l=!0,__demoMode:c=!1,unmount:d=!1,...u}=e,h=(0,W.useRef)(!1);o="dialog"===o||"alertdialog"===o?o:(h.current||(h.current=!0,console.warn(`Invalid role [${o}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog");let p=lh();void 0===n&&null!==p&&(n=(p&lu.Open)===lu.Open);let f=(0,W.useRef)(null),y=ls(f,t),g=cj(f.current),m=+!n,[w,v]=(0,W.useReducer)(dw,{titleId:null,descriptionId:null,panelRef:(0,W.createRef)()}),b=le(()=>s(!1)),_=le(e=>v({type:0,id:e})),E=!!lr()&&0===m,[I,A]=dc(),S=cH(),{resolveContainers:k}=function({defaultContainers:e=[],portals:t,mainTreeNode:r}={}){let i=le(()=>{var i,n;let s=l7(r),a=[];for(let t of e)null!==t&&(cl(t)?a.push(t):"current"in t&&cl(t.current)&&a.push(t.current));if(null!=t&&t.current)for(let e of t.current)a.push(e);for(let e of null!=(i=null==s?void 0:s.querySelectorAll("html > *, body > *"))?i:[])e!==document.body&&e!==document.head&&cl(e)&&"headlessui-portal-root"!==e.id&&(r&&(e.contains(r)||e.contains(null==(n=null==r?void 0:r.getRootNode())?void 0:n.host))||a.some(t=>e.contains(t))||a.push(e));return a});return{resolveContainers:i,contains:le(e=>i().some(t=>t.contains(e)))}}({mainTreeNode:S,portals:I,defaultContainers:[{get current(){var T;return null!=(T=w.panelRef.current)?T:f.current}}]}),C=null!==p&&(p&lu.Closing)===lu.Closing;ca(!c&&!C&&E,{allowed:le(()=>{var e,t;return[null!=(t=null==(e=f.current)?void 0:e.closest("[data-headlessui-portal]"))?t:null]}),disallowed:le(()=>{var e;return[null!=(e=null==S?void 0:S.closest("body > *:not(#headlessui-portal-root)"))?e:null]})});let x=l3.get(null);o9(()=>{if(E)return x.actions.push(i),()=>x.actions.pop(i)},[x,i,E]);let P=l4(x,(0,W.useCallback)(e=>x.selectors.isTop(e,i),[x,i]));cL(P,k,e=>{e.preventDefault(),b()}),function(e,t="u">typeof document?document.defaultView:null,r){let i=l9(e,"escape");lF(t,"keydown",e=>{i&&(e.defaultPrevented||e.key===lB.Escape&&r(e))})}(P,null==g?void 0:g.defaultView,e=>{e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),b()}),cK(!c&&!C&&E,g,k),cw(E,f,b);let[O,R]=c1(),N=(0,W.useMemo)(()=>[{dialogState:m,close:b,setTitleId:_,unmount:d},w],[m,b,_,d,w]),M=cV({open:0===m}),U={ref:y,id:i,role:o,tabIndex:-1,"aria-modal":c?void 0:0===m||void 0,"aria-labelledby":w.titleId,"aria-describedby":O,unmount:d},D=!function(){var e;let[t]=(0,W.useState)(()=>"u">typeof window&&"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)"):null),[r,i]=(0,W.useState)(null!=(e=null==t?void 0:t.matches)&&e);return o9(()=>{if(t)return t.addEventListener("change",e),()=>t.removeEventListener("change",e);function e(e){i(e.matches)}},[t]),r}(),L=c7.None;E&&!c&&(L|=c7.RestoreFocus,L|=c7.TabLock,l&&(L|=c7.AutoFocus),D&&(L|=c7.InitialFocus));let j=lv();return W.default.createElement(lf,null,W.default.createElement(cY,{force:!0},W.default.createElement(dh,null,W.default.createElement(dg.Provider,{value:N},W.default.createElement(du,{target:f},W.default.createElement(cY,{force:!1},W.default.createElement(R,{slot:M},W.default.createElement(A,null,W.default.createElement(de,{initialFocus:a,initialFocusFallback:f,containers:k,features:L},W.default.createElement(cG,{value:b},j({ourProps:U,theirProps:u,slot:M,defaultTag:db,features:d_,visible:0===m,name:"Dialog"})))))))))))}),db="div",d_=lm.RenderStrategy|lm.Static,dE=lA(function(e,t){let{transition:r=!1,open:i,...n}=e,s=lh(),a=e.hasOwnProperty("open")||null!==s,o=e.hasOwnProperty("onClose");if(!a&&!o)throw Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!a)throw Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!o)throw Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!s&&"boolean"!=typeof e.open)throw Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if("function"!=typeof e.onClose)throw Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return(void 0!==i||r)&&!n.static?W.default.createElement(cq,null,W.default.createElement(lW,{show:i,transition:r,unmount:n.unmount},W.default.createElement(dv,{ref:t,...n}))):W.default.createElement(cq,null,W.default.createElement(dv,{ref:t,open:i,...n}))}),dI=lA(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-panel-${r}`,transition:n=!1,...s}=e,[{dialogState:a,unmount:o},l]=dm("Dialog.Panel"),c=ls(t,l.panelRef),d=cV({open:0===a}),u=le(e=>{e.stopPropagation()}),h=n?lj:W.Fragment,p=lv();return W.default.createElement(h,{...n?{unmount:o}:{}},p({ourProps:{ref:c,id:i,onClick:u},theirProps:s,slot:d,defaultTag:"div",name:"Dialog.Panel"}))}),dA=Object.assign(dE,{Panel:dI,Title:(lA(function(e,t){let{transition:r=!1,...i}=e,[{dialogState:n,unmount:s}]=dm("Dialog.Backdrop"),a=cV({open:0===n}),o=r?lj:W.Fragment,l=lv();return W.default.createElement(o,{...r?{unmount:s}:{}},l({ourProps:{ref:t,"aria-hidden":!0},theirProps:i,slot:a,defaultTag:"div",name:"Dialog.Backdrop"}))}),lA(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-title-${r}`,...n}=e,[{dialogState:s,setTitleId:a}]=dm("Dialog.Title"),o=ls(t);(0,W.useEffect)(()=>(a(i),()=>a(null)),[i,a]);let l=cV({open:0===s});return lv()({ourProps:{ref:o,id:i},theirProps:n,slot:l,defaultTag:"h2",name:"Dialog.Title"})})),Description:c2});var dS=e.i(679877),dk=e.i(33898),dT=e.i(550483),dC=e.i(12791),dx=e.i(571232),dP=e.i(300059);class dO extends Error{constructor(e,t={}){const r=(()=>{if(t.cause instanceof dO){if(t.cause.details)return t.cause.details;if(t.cause.shortMessage)return t.cause.shortMessage}return t.cause&&"details"in t.cause&&"string"==typeof t.cause.details?t.cause.details:t.cause?.message?t.cause.message:t.details})(),i=t.cause instanceof dO&&t.cause.docsPath||t.docsPath,n=`https://oxlib.sh${i??""}`;super([e||"An error occurred.",...t.metaMessages?["",...t.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${n}`:void 0]:[]].filter(e=>"string"==typeof e).join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=t.cause,this.details=r,this.docs=n,this.docsPath=i,this.shortMessage=e}walk(e){return function e(t,r){return r?.(t)?t:t&&"object"==typeof t&&"cause"in t&&t.cause?e(t.cause,r):r?null:t}(this,e)}}function dR(e,t){if(dq(e)>t)throw new dV({givenSize:dq(e),maxSize:t})}function dN(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;let n=e.replace("0x","");if(n.length>2*i)throw new dG({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n["right"===r?"padEnd":"padStart"](2*i,"0")}`}function dM(e,t,r){return JSON.stringify(e,(e,r)=>"function"==typeof t?t(e,r):"bigint"==typeof r?r.toString()+"#__bigint":r,r)}let dU=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function dD(...e){return`0x${e.reduce((e,t)=>e+t.replace("0x",""),"")}`}function dL(e){return e instanceof Uint8Array?dj(e):Array.isArray(e)?dj(new Uint8Array(e)):e}function dj(e,t={}){let r="";for(let t=0;t<e.length;t++)r+=dU[e[t]];let i=`0x${r}`;return"number"==typeof t.size?(dR(i,t.size),dB(i,t.size)):i}function dW(e,t={}){var r;let i,{signed:n,size:s}=t,a=BigInt(e);s?i=n?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o="bigint"==typeof i&&n?-i-1n:0;if(i&&a>i||a<o){let t="bigint"==typeof e?"n":"";throw new dz({max:i?`${i}${t}`:void 0,min:`${o}${t}`,signed:n,size:s,value:`${e}${t}`})}let l=(n&&a<0?(1n<<BigInt(8*s))+BigInt(a):a).toString(16),c=`0x${l}`;return s?(r=c,dN(r,{dir:"left",size:s})):c}function dB(e,t){return dN(e,{dir:"right",size:t})}function dF(e,t,r,i={}){let{strict:n}=i;if("number"==typeof t&&t>0&&t>dq(e)-1)throw new dJ({offset:t,position:"start",size:dq(e)});let s=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return n&&function(e,t,r){if("number"==typeof t&&"number"==typeof r&&dq(e)!==r-t)throw new dJ({offset:r,position:"end",size:dq(e)})}(s,t,r),s}function dq(e){return Math.ceil((e.length-2)/2)}function dH(e){return function(e,t={}){let{dir:r="left"}=t,i=e.replace("0x",""),n=0;for(let e=0;e<i.length-1;e++)if("0"===i["left"===r?e:i.length-e-1].toString())n++;else break;return"0"===(i="left"===r?i.slice(n):i.slice(0,i.length-n))?"0x":"right"===r&&i.length%2==1?`0x${i}0`:`0x${i}`}(e,{dir:"left"})}class dz extends dO{constructor({max:e,min:t,signed:r,size:i,value:n}){super(`Number \`${n}\` is not in safe${i?` ${8*i}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${t}\` to \`${e}\`)`:`(above \`${t}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class d$ extends dO{constructor(e){super(`Value \`${"object"==typeof e?dM(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class dK extends dO{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class dV extends dO{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class dJ extends dO{constructor({offset:e,position:t,size:r}){super(`Slice ${"start"===t?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class dG extends dO{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function dZ(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}let dY=new TextEncoder;function dQ(e){var t;return e instanceof Uint8Array?e:"string"==typeof e?dX(e):(t=e)instanceof Uint8Array?t:new Uint8Array(t)}function dX(e,t={}){let{size:r}=t,i=e;r&&(dR(e,r),i=dB(e,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);let s=n.length/2,a=new Uint8Array(s);for(let e=0,t=0;e<s;e++){let r=dZ(n.charCodeAt(t++)),i=dZ(n.charCodeAt(t++));if(void 0===r||void 0===i)throw new dO(`Invalid byte sequence ("${n[t-2]}${n[t-1]}" in "${n}").`);a[e]=16*r+i}return a}class d0 extends dO{constructor(e){super(`Value \`${"object"==typeof e?dM(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class d1 extends dO{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class d2 extends dO{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let d5=2n**256n-1n;function d3(e,t={}){let{recovered:r}=t;if(void 0===e.r||void 0===e.s||r&&void 0===e.yParity)throw new uy({signature:e});if(e.r<0n||e.r>d5)throw new ug({value:e.r});if(e.s<0n||e.s>d5)throw new um({value:e.s});if("number"==typeof e.yParity&&0!==e.yParity&&1!==e.yParity)throw new uw({value:e.yParity})}function d8(e){return d4(dj(e))}function d4(e){if(130!==e.length&&132!==e.length)throw new uf({signature:e});let t=BigInt(dF(e,0,32)),r=BigInt(dF(e,32,64)),i=(()=>{let t=Number(`0x${e.slice(130)}`);if(!Number.isNaN(t))try{return uh(t)}catch{throw new uw({value:t})}})();return void 0===i?{r:t,s:r}:{r:t,s:r,yParity:i}}function d6(e){if(void 0!==e.r&&void 0!==e.s)return d9(e)}function d9(e){let t="string"==typeof e?d4(e):e instanceof Uint8Array?d8(e):"string"==typeof e.r?ur(e):e.v?ut(e):{r:e.r,s:e.s,...void 0!==e.yParity?{yParity:e.yParity}:{}};return d3(t),t}function d7(e){return ue(dj(e))}function ue(e){let{r:t,s:r}=dP.secp256k1.Signature.fromDER(dL(e).slice(2));return{r:t,s:r}}function ut(e){return{r:e.r,s:e.s,yParity:uh(e.v)}}function ur(e){let t=(()=>{let t=e.v?Number(e.v):void 0,r=e.yParity?Number(e.yParity):void 0;if("number"==typeof t&&"number"!=typeof r&&(r=uh(t)),"number"!=typeof r)throw new uw({value:e.yParity});return r})();return{r:BigInt(e.r),s:BigInt(e.s),yParity:t}}function ui(e){let[t,r,i]=e;return d9({r:"0x"===r?0n:BigInt(r),s:"0x"===i?0n:BigInt(i),yParity:"0x"===t?0:Number(t)})}function un(e){return dX(us(e))}function us(e){d3(e);let t=e.r,r=e.s;return dD(dW(t,{size:32}),dW(r,{size:32}),"number"==typeof e.yParity?dW(up(e.yParity),{size:1}):"0x")}function ua(e){return new dP.secp256k1.Signature(e.r,e.s).toDERRawBytes()}function uo(e){let t=new dP.secp256k1.Signature(e.r,e.s);return`0x${t.toDERHex()}`}function ul(e){return{r:e.r,s:e.s,v:up(e.yParity)}}function uc(e){let{r:t,s:r,yParity:i}=e;return{r:dW(t,{size:32}),s:dW(r,{size:32}),yParity:0===i?"0x0":"0x1"}}function ud(e){let{r:t,s:r,yParity:i}=e;return[i?"0x01":"0x",0n===t?"0x":dH(dW(t)),0n===r?"0x":dH(dW(r))]}function uu(e,t={}){try{return d3(e,t),!0}catch{return!1}}function uh(e){if(0===e||27===e)return 0;if(1===e||28===e)return 1;if(e>=35)return+(e%2==0);throw new uv({value:e})}function up(e){if(0===e)return 27;if(1===e)return 28;throw new uw({value:e})}class uf extends dO{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${dq(dL(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class uy extends dO{constructor({signature:e}){super(`Signature \`${dM(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class ug extends dO{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class um extends dO{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class uw extends dO{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class uv extends dO{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}e.s(["InvalidRError",()=>ug,"InvalidSError",()=>um,"InvalidSerializedSizeError",()=>uf,"InvalidVError",()=>uv,"InvalidYParityError",()=>uw,"MissingPropertiesError",()=>uy,"assert",()=>d3,"extract",()=>d6,"from",()=>d9,"fromBytes",()=>d8,"fromDerBytes",()=>d7,"fromDerHex",()=>ue,"fromHex",()=>d4,"fromLegacy",()=>ut,"fromRpc",()=>ur,"fromTuple",()=>ui,"toBytes",()=>un,"toDerBytes",()=>ua,"toDerHex",()=>uo,"toHex",()=>us,"toLegacy",()=>ul,"toRpc",()=>uc,"toTuple",()=>ud,"vToYParity",()=>uh,"validate",()=>uu,"yParityToV",()=>up],190189);var ub=e.i(190189),ub=ub;class u_ extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}let uE={checksum:new u_(8192)}.checksum;var uI=e.i(626014);function uA(e,t={}){let{as:r="string"==typeof e?"Hex":"Bytes"}=t,i=(0,uI.keccak_256)(dQ(e));return"Bytes"===r?i:dj(i)}function uS(e,t={}){let{compressed:r}=t,{prefix:i,x:n,y:s}=e;if(!1===r||"bigint"==typeof n&&"bigint"==typeof s){if(4!==i)throw new uP({prefix:i,cause:new uR});return}if(!0===r||"bigint"==typeof n&&void 0===s){if(3!==i&&2!==i)throw new uP({prefix:i,cause:new uO});return}throw new ux({publicKey:e})}function uk(e){let t=(()=>{if(function(e,t={}){let{strict:r=!1}=t;try{return!function(e,t={}){let{strict:r=!1}=t;if(!e||"string"!=typeof e)throw new d$(e);if(r&&!/^0x[0-9a-fA-F]*$/.test(e)||!e.startsWith("0x"))throw new dK(e)}(e,{strict:r}),!0}catch{return!1}}(e))return uT(e);if(function(e){try{if(!(e instanceof Uint8Array)&&(!e||"object"!=typeof e||!("BYTES_PER_ELEMENT"in e)||1!==e.BYTES_PER_ELEMENT||"Uint8Array"!==e.constructor.name))throw new d0(e);return!0}catch{return!1}}(e))return uT(dj(e));let{prefix:t,x:r,y:i}=e;return"bigint"==typeof r&&"bigint"==typeof i?{prefix:t??4,x:r,y:i}:{prefix:t,x:r}})();return uS(t),t}function uT(e){if(132!==e.length&&130!==e.length&&68!==e.length)throw new uN({publicKey:e});if(130===e.length)return{prefix:4,x:BigInt(dF(e,0,32)),y:BigInt(dF(e,32,64))};if(132===e.length){let t=Number(dF(e,0,1));return{prefix:t,x:BigInt(dF(e,1,33)),y:BigInt(dF(e,33,65))}}return{prefix:Number(dF(e,0,1)),x:BigInt(dF(e,1,33))}}function uC(e,t={}){uS(e);let{prefix:r,x:i,y:n}=e,{includePrefix:s=!0}=t;return dD(s?dW(r,{size:1}):"0x",dW(i,{size:32}),"bigint"==typeof n?dW(n,{size:32}):"0x")}class ux extends dO{constructor({publicKey:e}){super(`Value \`${dM(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class uP extends dO{constructor({prefix:e,cause:t}){super(`Prefix "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class uO extends dO{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class uR extends dO{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class uN extends dO{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${dq(dL(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let uM=/^0x[a-fA-F0-9]{40}$/;function uU(e,t={}){let{strict:r=!0}=t;if(!uM.test(e))throw new uL({address:e,cause:new uj});if(r){if(e.toLowerCase()===e)return;if(uD(e)!==e)throw new uL({address:e,cause:new uW})}}function uD(e){if(uE.has(e))return uE.get(e);uU(e,{strict:!1});let t=e.substring(2).toLowerCase(),r=uA(function(e,t={}){let{size:r}=t,i=dY.encode(e);if("number"==typeof r){var n;if(i.length>r)throw new d1({givenSize:i.length,maxSize:r});return n=i,function(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;if(e.length>i)throw new d2({size:e.length,targetSize:i,type:"Bytes"});let n=new Uint8Array(i);for(let t=0;t<i;t++){let s="right"===r;n[s?t:i-t-1]=e[s?t:e.length-t-1]}return n}(n,{dir:"right",size:r})}return i}(t),{as:"Bytes"}),i=t.split("");for(let e=0;e<40;e+=2)r[e>>1]>>4>=8&&i[e]&&(i[e]=i[e].toUpperCase()),(15&r[e>>1])>=8&&i[e+1]&&(i[e+1]=i[e+1].toUpperCase());let n=`0x${i.join("")}`;return uE.set(e,n),n}class uL extends dO{constructor({address:e,cause:t}){super(`Address "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class uj extends dO{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class uW extends dO{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}let uB=dP.secp256k1;function uF(e={}){let{as:t="Hex"}=e,r=uz({as:t}),i=uq({privateKey:r});return{privateKey:r,publicKey:i}}function uq(e){let{privateKey:t}=e;return uk(dP.secp256k1.ProjectivePoint.fromPrivateKey(dL(t).slice(2)))}function uH(e){let{as:t="Hex",privateKey:r,publicKey:i}=e,n=dP.secp256k1.ProjectivePoint.fromHex(uC(i).slice(2)).multiply(dP.secp256k1.utils.normPrivateKeyToScalar(dL(r).slice(2))).toRawBytes(!0);return"Hex"===t?dj(n):n}function uz(e={}){let{as:t="Hex"}=e,r=dP.secp256k1.utils.randomPrivateKey();return"Hex"===t?dj(r):r}function u$(e){return function(e,t={}){let r=uA(`0x${uC(e).slice(4)}`).substring(26);return function(e,t={}){let{checksum:r=!1}=t;return(uU(e),r)?uD(e):e}(`0x${r}`,t)}(uK(e))}function uK(e){let{payload:t,signature:r}=e,{r:i,s:n,yParity:s}=r;return uk(new dP.secp256k1.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(dL(t).substring(2)))}function uV(e){let{extraEntropy:t=!1,hash:r,payload:i,privateKey:n}=e,{r:s,s:a,recovery:o}=dP.secp256k1.sign(dQ(i),dQ(n),{extraEntropy:"boolean"==typeof t?t:dL(t).slice(2),lowS:!0,...r?{prehash:!0}:{}});return{r:s,s:a,yParity:o}}function uJ(e){let{address:t,hash:r,payload:i,publicKey:n,signature:s}=e;if(t){var a;return a=u$({payload:i,signature:s}),uU(t,{strict:!1}),uU(a,{strict:!1}),t.toLowerCase()===a.toLowerCase()}return dP.secp256k1.verify(s,dQ(i),function(e,t={}){return dX(uC(e,t))}(n),...r?[{prehash:!0,lowS:!0}]:[])}e.s(["createKeyPair",()=>uF,"getPublicKey",()=>uq,"getSharedSecret",()=>uH,"noble",0,uB,"randomPrivateKey",()=>uz,"recoverAddress",()=>u$,"recoverPublicKey",()=>uK,"sign",()=>uV,"verify",()=>uJ],924892);var uG=e.i(924892),uG=uG,uZ=e.i(344048),uY=e.i(265436),uQ=e.i(60969),uX=e.i(232232);e.i(852081);var u0=e.i(624792),u1=e.i(97224),u2=e.i(198323),u5=e.i(208910),u3=e.i(774789),u8=e.i(135022),u4=e.i(14526);let u6="custom_context";var u9=Object.defineProperty,u7=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?u9(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class he{constructor(e){u7(this,"nodeValue"),u7(this,"sizeInBytes"),u7(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class ht{constructor(e){u7(this,"lengthInNodes"),u7(this,"sizeInBytes"),u7(this,"head"),u7(this,"tail"),u7(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let t=new he(e);if(t.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=t):this.head=t,this.tail=t,this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let t=e.value;return e=e.next,{done:!1,value:t}}}}}var hr=Object.defineProperty,hi=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?hr(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class hn{constructor(e,t=1024e3){hi(this,"logs"),hi(this,"level"),hi(this,"levelValue"),hi(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=u8.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new ht(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===u8.levels.values.error?console.error(e):t===u8.levels.values.warn?console.warn(e):t===u8.levels.values.debug?console.debug(e):t===u8.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append((0,u4.safeJsonStringify)({timestamp:new Date().toISOString(),log:e}));let t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new ht(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let t=this.getLogArray();return t.push((0,u4.safeJsonStringify)({extraMetadata:e})),new Blob(t,{type:"application/json"})}}var hs=Object.defineProperty;class ha{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?hs(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new hn(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}var ho=Object.defineProperty;class hl{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?ho(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new hn(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var hc=Object.defineProperty,hd=Object.defineProperties,hu=Object.getOwnPropertyDescriptors,hh=Object.getOwnPropertySymbols,hp=Object.prototype.hasOwnProperty,hf=Object.prototype.propertyIsEnumerable,hy=(e,t,r)=>t in e?hc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hg=(e,t)=>{for(var r in t||(t={}))hp.call(t,r)&&hy(e,r,t[r]);if(hh)for(var r of hh(t))hf.call(t,r)&&hy(e,r,t[r]);return e};function hm(e,t=u6){return e[t]||""}function hw(e,t,r=u6){let i=function(e,t,r=u6){let i=hm(e,r);return i.trim()?`${i}/${t}`:t}(e,t,r);return function(e,t,r=u6){return e[r]=t,e}(e.child({context:i}),i,r)}function hv(e){var t,r,i,n;let s,a,o,l;return"u">typeof e.loggerOverride&&"string"!=typeof e.loggerOverride?{logger:e.loggerOverride,chunkLoggerController:null}:"u">typeof window?(l=new ha(null==(i=(r=e).opts)?void 0:i.level,r.maxSizeInBytes),{logger:(0,u8.default)((a=hg({},r.opts),o={level:"trace",browser:hd(hg({},null==(n=r.opts)?void 0:n.browser),hu({write:e=>l.write(e)}))},hd(a,hu(o)))),chunkLoggerController:l}):(s=new hl(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes),{logger:(0,u8.default)(hd(hg({},e.opts),hu({level:"trace"})),s),chunkLoggerController:s})}function hb(e){let[t,r]=e.split(":");return{namespace:t,reference:r}}function h_(e,t=[]){let r=[];return Object.keys(e).forEach(i=>{if(t.length&&!t.includes(i))return;let n=e[i];r.push(...n.accounts)}),r}function hE(e,t){return e.includes(":")?[e]:t.chains||[]}var hI=Object.defineProperty,hA=Object.defineProperties,hS=Object.getOwnPropertyDescriptors,hk=Object.getOwnPropertySymbols,hT=Object.prototype.hasOwnProperty,hC=Object.prototype.propertyIsEnumerable,hx=(e,t,r)=>t in e?hI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hP=(e,t)=>{for(var r in t||(t={}))hT.call(t,r)&&hx(e,r,t[r]);if(hk)for(var r of hk(t))hC.call(t,r)&&hx(e,r,t[r]);return e},hO=(e,t,r)=>hx(e,"symbol"!=typeof t?t+"":t,r);let hR="react-native",hN="node",hM="browser";function hU(){return"u">typeof la.default&&"u">typeof la.default.versions&&"u">typeof la.default.versions.node}function hD(){return!(0,dC.getDocument)()&&!!(0,dC.getNavigator)()&&"ReactNative"===navigator.product}function hL(){return!hU()&&!!(0,dC.getNavigator)()&&!!(0,dC.getDocument)()}function hj(){return hD()?hR:hU()?hN:hL()?hM:"unknown"}function hW(){var t;try{return hD()&&"u">typeof(null==e.g?void 0:e.g.Application)?null==(t=e.g.Application)?void 0:t.applicationId:void 0}catch{return}}function hB(){return(0,dx.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function hF(t,r,i){var n;let s,a=function(){if(hj()===hR&&"u">typeof(null==e.g?void 0:e.g.Platform)){let{OS:t,Version:r}=e.g.Platform;return[t,r].join("-")}let t=(0,dk.detect)();if(null===t)return"unknown";let r=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[r,t.name,t.version].join("-"):[r,t.version].join("-")}(),o=(s=hj())===hM?[s,(null==(n=(0,dC.getLocation)())?void 0:n.host)||"unknown"].join(":"):s;return[[t,r].join("-"),["js",i].join("-"),a,o].join("/")}function hq(e,t){return e.filter(e=>t.includes(e)).length===e.length}function hH(e){return Object.fromEntries(e.entries())}function hz(e){return new Map(Object.entries(e))}function h$(e=dT.FIVE_MINUTES,t){let r,i,n,s,a=(0,dT.toMiliseconds)(e||dT.FIVE_MINUTES);return{resolve:e=>{n&&r&&(clearTimeout(n),r(e),s=Promise.resolve(e))},reject:e=>{n&&i&&(clearTimeout(n),i(e))},done:()=>new Promise((e,o)=>{if(s)return e(s);n=setTimeout(()=>{let e=Error(t);s=Promise.reject(e),o(e)},a),r=e,i=o})}}function hK(e,t,r){return new Promise(async(i,n)=>{let s=setTimeout(()=>n(Error(r)),t);try{let t=await e;i(t)}catch(e){n(e)}clearTimeout(s)})}function hV(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function hJ(e){let[t,r]=e.split(":"),i={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof r)i.topic=r;else if("id"===t&&Number.isInteger(Number(r)))i.id=Number(r);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return i}function hG(e,t){return(0,dT.fromMiliseconds)((t||Date.now())+(0,dT.toMiliseconds)(e))}function hZ(e){return Date.now()>=(0,dT.toMiliseconds)(e)}function hY(e,t){return`${e}${t?`:${t}`:""}`}function hQ(e=[],t=[]){return[...new Set([...e,...t])]}async function hX({id:t,topic:r,wcDeepLink:i}){var n,s;try{if(!i)return;let a="string"==typeof i?JSON.parse(i):i,o=a?.href;if("string"!=typeof o)return;let l=function(e,t,r){let i=`requestId=${t}&sessionTopic=${r}`;e.endsWith("/")&&(e=e.slice(0,-1));let n=`${e}`;if(e.startsWith("https://t.me")){let t=e.includes("?")?"&startapp=":"?startapp=";n=`${n}${t}${function(e,t=!1){let r=ed.Buffer.from(e).toString("base64");return t?r.replace(/[=]/g,""):r}(i,!0)}`}else n=`${n}/wc?${i}`;return n}(o,t,r),c=hj();if(c===hM){let e;if(!(null!=(n=(0,dC.getDocument)())&&n.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");s=l,e="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?("u">typeof window&&(window.TelegramWebviewProxy||window.Telegram||window.TelegramWebviewProxyProto)||s.startsWith("https://")||s.startsWith("http://"))&&(e="_blank"):e="_top",window.open(s,e,"noreferrer noopener")}else c===hR&&"u">typeof(null==e.g?void 0:e.g.Linking)&&await e.g.Linking.openURL(l)}catch(e){console.error(e)}}async function h0(e,t){let r="";try{if(hL()&&(r=localStorage.getItem(t)))return r;r=await e.getItem(t)}catch(e){console.error(e)}return r}function h1(e,t){if(!e.includes(t))return null;let r=e.split(/([&,?,=])/),i=r.indexOf(t);return r[i+2]}function h2(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function h5(){return"u">typeof la.default&&"true"===la.default.env.IS_VITEST}function h3(e){return ed.Buffer.from(e,"base64").toString("utf-8")}class h8{constructor({limit:e}){hO(this,"limit"),hO(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let e=this.set.values().next().value;e&&this.set.delete(e)}this.set.add(e)}}has(e){return this.set.has(e)}}let h4=BigInt(0x100000000-1),h6=BigInt(32);function h9(e,t=!1){return t?{h:Number(e&h4),l:Number(e>>h6&h4)}:{h:0|Number(e>>h6&h4),l:0|Number(e&h4)}}function h7(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:a}=h9(e[s],t);[i[s],n[s]]=[r,a]}return[i,n]}let pe=(e,t,r)=>e>>>r,pt=(e,t,r)=>e<<32-r|t>>>r,pr=(e,t,r)=>e>>>r|t<<32-r,pi=(e,t,r)=>e<<32-r|t>>>r,pn=(e,t,r)=>e<<64-r|t>>>r-32,ps=(e,t,r)=>e>>>r-32|t<<64-r;function pa(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}let po=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),pl=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0,pc=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),pd=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0,pu=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0),ph=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0,pp="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function pf(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function py(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function pg(e,...t){if(!pf(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function pm(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");py(e.outputLen),py(e.blockLen)}function pw(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function pv(e,t){pg(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function pb(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function p_(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function pE(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function pI(e,t){return e<<32-t|e>>>t}let pA=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function pS(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}let pk=pA?e=>e:e=>pS(e),pT=pA?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=pS(e[t]);return e},pC="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,px=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function pP(e){if(pg(e),pC)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=px[e[r]];return t}function pO(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function pR(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(pC)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=pO(e.charCodeAt(n)),s=pO(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i}function pN(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function pM(e){return"string"==typeof e&&(e=pN(e)),pg(e),e}function pU(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];pg(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}class pD{}function pL(e){let t=t=>e().update(pM(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function pj(e=32){if(pp&&"function"==typeof pp.getRandomValues)return pp.getRandomValues(new Uint8Array(e));if(pp&&"function"==typeof pp.randomBytes)return Uint8Array.from(pp.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}let pW=BigInt(0),pB=BigInt(1),pF=BigInt(2),pq=BigInt(7),pH=BigInt(256),pz=BigInt(113),p$=[],pK=[],pV=[];for(let e=0,t=pB,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],p$.push(2*(5*i+r)),pK.push((e+1)*(e+2)/2%64);let n=pW;for(let e=0;e<7;e++)(t=(t<<pB^(t>>pq)*pz)%pH)&pF&&(n^=pB<<(pB<<BigInt(e))-pB);pV.push(n)}let pJ=h7(pV,!0),pG=pJ[0],pZ=pJ[1],pY=(e,t,r)=>r>32?t<<r-32|e>>>64-r:e<<r|t>>>32-r,pQ=(e,t,r)=>r>32?e<<r-32|t>>>64-r:t<<r|e>>>32-r;class pX extends pD{constructor(e,t,r,i=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,py(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=pb(this.state)}clone(){return this._cloneInto()}keccak(){pT(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=pY(s,a,1)^r[i],l=pQ(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=pK[r],s=pY(t,n,i),a=pQ(t,n,i),o=p$[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=pG[i],e[1]^=pZ[i]}p_(r)}(this.state32,this.rounds),pT(this.state32),this.posOut=0,this.pos=0}update(e){pw(this),pg(e=pM(e));let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){pw(this,!1),pg(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return py(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(pv(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,p_(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new pX(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}let p0=pL(()=>new pX(136,1,32));class p1 extends pD{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=pE(this.buffer)}update(e){pw(this),pg(e=pM(e));let{view:t,buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);if(a===i){let t=pE(e);for(;i<=n-s;s+=i)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){pw(this),pv(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:n}=this,{pos:s}=this;t[s++]=128,p_(this.buffer.subarray(s)),this.padOffset>i-s&&(this.process(r,0),s=0);for(let e=s;e<i;e++)t[e]=0;(function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)})(r,i-8,BigInt(8*this.length),n),this.process(r,0);let a=pE(e),o=this.outputLen;if(o%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=o/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)a.setUint32(4*e,c[e],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=n,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let p2=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),p5=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),p3=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),p8=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),p4=new Uint32Array(64);class p6 extends p1{constructor(e=32){super(64,e,8,!1),this.A=0|p2[0],this.B=0|p2[1],this.C=0|p2[2],this.D=0|p2[3],this.E=0|p2[4],this.F=0|p2[5],this.G=0|p2[6],this.H=0|p2[7]}get(){let{A:e,B:t,C:r,D:i,E:n,F:s,G:a,H:o}=this;return[e,t,r,i,n,s,a,o]}set(e,t,r,i,n,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)p4[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=p4[e-15],r=p4[e-2],i=pI(t,7)^pI(t,18)^t>>>3,n=pI(r,17)^pI(r,19)^r>>>10;p4[e]=n+p4[e-7]+i+p4[e-16]|0}let{A:r,B:i,C:n,D:s,E:a,F:o,G:l,H:c}=this;for(let e=0;e<64;e++){var d,u,h,p;let t=c+(pI(a,6)^pI(a,11)^pI(a,25))+((d=a)&o^~d&l)+p8[e]+p4[e]|0,f=(pI(r,2)^pI(r,13)^pI(r,22))+((u=r)&(h=i)^u&(p=n)^h&p)|0;c=l,l=o,o=a,a=s+t|0,s=n,n=i,i=r,r=t+f|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,a=a+this.E|0,o=o+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,i,n,s,a,o,l,c)}roundClean(){p_(p4)}destroy(){this.set(0,0,0,0,0,0,0,0),p_(this.buffer)}}let p9=h7(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),p7=p9[0],fe=p9[1],ft=new Uint32Array(80),fr=new Uint32Array(80);class fi extends p1{constructor(e=64){super(128,e,16,!1),this.Ah=0|p3[0],this.Al=0|p3[1],this.Bh=0|p3[2],this.Bl=0|p3[3],this.Ch=0|p3[4],this.Cl=0|p3[5],this.Dh=0|p3[6],this.Dl=0|p3[7],this.Eh=0|p3[8],this.El=0|p3[9],this.Fh=0|p3[10],this.Fl=0|p3[11],this.Gh=0|p3[12],this.Gl=0|p3[13],this.Hh=0|p3[14],this.Hl=0|p3[15]}get(){let{Ah:e,Al:t,Bh:r,Bl:i,Ch:n,Cl:s,Dh:a,Dl:o,Eh:l,El:c,Fh:d,Fl:u,Gh:h,Gl:p,Hh:f,Hl:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|n,this.Cl=0|s,this.Dh=0|a,this.Dl=0|o,this.Eh=0|l,this.El=0|c,this.Fh=0|d,this.Fl=0|u,this.Gh=0|h,this.Gl=0|p,this.Hh=0|f,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)ft[r]=e.getUint32(t),fr[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|ft[e-15],r=0|fr[e-15],i=pr(t,r,1)^pr(t,r,8)^pe(t,r,7),n=pi(t,r,1)^pi(t,r,8)^pt(t,r,7),s=0|ft[e-2],a=0|fr[e-2],o=pr(s,a,19)^pn(s,a,61)^pe(s,a,6),l=pc(n,pi(s,a,19)^ps(s,a,61)^pt(s,a,6),fr[e-7],fr[e-16]),c=pd(l,i,o,ft[e-7],ft[e-16]);ft[e]=0|c,fr[e]=0|l}let{Ah:r,Al:i,Bh:n,Bl:s,Ch:a,Cl:o,Dh:l,Dl:c,Eh:d,El:u,Fh:h,Fl:p,Gh:f,Gl:y,Hh:g,Hl:m}=this;for(let e=0;e<80;e++){let t=pr(d,u,14)^pr(d,u,18)^pn(d,u,41),w=pi(d,u,14)^pi(d,u,18)^ps(d,u,41),v=d&h^~d&f,b=pu(m,w,u&p^~u&y,fe[e],fr[e]),_=ph(b,g,t,v,p7[e],ft[e]),E=0|b,I=pr(r,i,28)^pn(r,i,34)^pn(r,i,39),A=pi(r,i,28)^ps(r,i,34)^ps(r,i,39),S=r&n^r&a^n&a,k=i&s^i&o^s&o;g=0|f,m=0|y,f=0|h,y=0|p,h=0|d,p=0|u,({h:d,l:u}=pa(0|l,0|c,0|_,0|E)),l=0|a,c=0|o,a=0|n,o=0|s,n=0|r,s=0|i;let T=po(E,A,k);r=pl(T,_,I,S),i=0|T}({h:r,l:i}=pa(0|this.Ah,0|this.Al,0|r,0|i)),({h:n,l:s}=pa(0|this.Bh,0|this.Bl,0|n,0|s)),({h:a,l:o}=pa(0|this.Ch,0|this.Cl,0|a,0|o)),({h:l,l:c}=pa(0|this.Dh,0|this.Dl,0|l,0|c)),({h:d,l:u}=pa(0|this.Eh,0|this.El,0|d,0|u)),({h,l:p}=pa(0|this.Fh,0|this.Fl,0|h,0|p)),({h:f,l:y}=pa(0|this.Gh,0|this.Gl,0|f,0|y)),({h:g,l:m}=pa(0|this.Hh,0|this.Hl,0|g,0|m)),this.set(r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m)}roundClean(){p_(ft,fr)}destroy(){p_(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class fn extends fi{constructor(){super(48),this.Ah=0|p5[0],this.Al=0|p5[1],this.Bh=0|p5[2],this.Bl=0|p5[3],this.Ch=0|p5[4],this.Cl=0|p5[5],this.Dh=0|p5[6],this.Dl=0|p5[7],this.Eh=0|p5[8],this.El=0|p5[9],this.Fh=0|p5[10],this.Fl=0|p5[11],this.Gh=0|p5[12],this.Gl=0|p5[13],this.Hh=0|p5[14],this.Hl=0|p5[15]}}let fs=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class fa extends fi{constructor(){super(32),this.Ah=0|fs[0],this.Al=0|fs[1],this.Bh=0|fs[2],this.Bl=0|fs[3],this.Ch=0|fs[4],this.Cl=0|fs[5],this.Dh=0|fs[6],this.Dl=0|fs[7],this.Eh=0|fs[8],this.El=0|fs[9],this.Fh=0|fs[10],this.Fl=0|fs[11],this.Gh=0|fs[12],this.Gl=0|fs[13],this.Hh=0|fs[14],this.Hl=0|fs[15]}}let fo=pL(()=>new p6),fl=pL(()=>new fi),fc=pL(()=>new fn),fd=pL(()=>new fa),fu=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),fh=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),fp=new Uint32Array(32);function ff(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=fp[2*e],c=fp[2*e+1],d=fp[2*t],u=fp[2*t+1],h=fp[2*r],p=fp[2*r+1],f=fp[2*i],y=fp[2*i+1],g=po(l,d,a);c=pl(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:f,Dl:y}),({h:p,l:h}=pa(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:pr(u,d,24),Bl:pi(u,d,24)}),fp[2*e]=l,fp[2*e+1]=c,fp[2*t]=d,fp[2*t+1]=u,fp[2*r]=h,fp[2*r+1]=p,fp[2*i]=f,fp[2*i+1]=y}function fy(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=fp[2*e],c=fp[2*e+1],d=fp[2*t],u=fp[2*t+1],h=fp[2*r],p=fp[2*r+1],f=fp[2*i],y=fp[2*i+1],g=po(l,d,a);c=pl(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:pr(y,f,16),Dl:pi(y,f,16)}),({h:p,l:h}=pa(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:pn(u,d,63),Bl:ps(u,d,63)}),fp[2*e]=l,fp[2*e+1]=c,fp[2*t]=d,fp[2*t+1]=u,fp[2*r]=h,fp[2*r+1]=p,fp[2*i]=f,fp[2*i+1]=y}class fg extends pD{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,py(e),py(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=pb(this.buffer)}update(e){pw(this),pg(e=pM(e));let{blockLen:t,buffer:r,buffer32:i}=this,n=e.length,s=e.byteOffset,a=e.buffer;for(let o=0;o<n;){this.pos===t&&(pT(i),this.compress(i,0,!1),pT(i),this.pos=0);let l=Math.min(t-this.pos,n-o),c=s+o;if(l===t&&!(c%4)&&o+l<n){let e=new Uint32Array(a,c,Math.floor((n-o)/4));pT(e);for(let r=0;o+t<n;r+=i.length,o+=t)this.length+=t,this.compress(e,r,!1);pT(e);continue}r.set(e.subarray(o,o+l),this.pos),this.pos+=l,this.length+=l,o+=l}return this}digestInto(e){pw(this),pv(e,this);let{pos:t,buffer32:r}=this;this.finished=!0,p_(this.buffer.subarray(t)),pT(r),this.compress(r,0,!0),pT(r);let i=pb(e);this.get().forEach((e,t)=>i[t]=pk(e))}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){let{buffer:t,length:r,finished:i,destroyed:n,outputLen:s,pos:a}=this;return e||(e=new this.constructor({dkLen:s})),e.set(...this.get()),e.buffer.set(t),e.destroyed=n,e.finished=i,e.length=r,e.pos=a,e.outputLen=s,e}clone(){return this._cloneInto()}}class fm extends fg{constructor(e={}){const t=void 0===e.dkLen?64:e.dkLen;super(128,t),this.v0l=0|fh[0],this.v0h=0|fh[1],this.v1l=0|fh[2],this.v1h=0|fh[3],this.v2l=0|fh[4],this.v2h=0|fh[5],this.v3l=0|fh[6],this.v3h=0|fh[7],this.v4l=0|fh[8],this.v4h=0|fh[9],this.v5l=0|fh[10],this.v5h=0|fh[11],this.v6l=0|fh[12],this.v6h=0|fh[13],this.v7l=0|fh[14],this.v7h=0|fh[15],function(e,t={},r,i,n){if(py(64),e<0||e>64)throw Error("outputLen bigger than keyLen");let{key:s,salt:a,personalization:o}=t;if(void 0!==s&&(s.length<1||s.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==a&&16!==a.length)throw Error("salt must be undefined or 16");if(void 0!==o&&16!==o.length)throw Error("personalization must be undefined or 16")}(t,e,0,0,0);let{key:r,personalization:i,salt:n}=e,s=0;if(void 0!==r&&(s=(r=pM(r)).length),this.v0l^=this.outputLen|s<<8|0x1010000,void 0!==n){const e=pb(n=pM(n));this.v4l^=pk(e[0]),this.v4h^=pk(e[1]),this.v5l^=pk(e[2]),this.v5h^=pk(e[3])}if(void 0!==i){const e=pb(i=pM(i));this.v6l^=pk(e[0]),this.v6h^=pk(e[1]),this.v7l^=pk(e[2]),this.v7h^=pk(e[3])}if(void 0!==r){const e=new Uint8Array(this.blockLen);e.set(r),this.update(e)}}get(){let{v0l:e,v0h:t,v1l:r,v1h:i,v2l:n,v2h:s,v3l:a,v3h:o,v4l:l,v4h:c,v5l:d,v5h:u,v6l:h,v6h:p,v7l:f,v7h:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.v0l=0|e,this.v0h=0|t,this.v1l=0|r,this.v1h=0|i,this.v2l=0|n,this.v2h=0|s,this.v3l=0|a,this.v3h=0|o,this.v4l=0|l,this.v4h=0|c,this.v5l=0|d,this.v5h=0|u,this.v6l=0|h,this.v6h=0|p,this.v7l=0|f,this.v7h=0|y}compress(e,t,r){this.get().forEach((e,t)=>fp[t]=e),fp.set(fh,16);let{h:i,l:n}=h9(BigInt(this.length));fp[24]=fh[8]^n,fp[25]=fh[9]^i,r&&(fp[28]=~fp[28],fp[29]=~fp[29]);let s=0;for(let r=0;r<12;r++)ff(0,4,8,12,e,t+2*fu[s++]),fy(0,4,8,12,e,t+2*fu[s++]),ff(1,5,9,13,e,t+2*fu[s++]),fy(1,5,9,13,e,t+2*fu[s++]),ff(2,6,10,14,e,t+2*fu[s++]),fy(2,6,10,14,e,t+2*fu[s++]),ff(3,7,11,15,e,t+2*fu[s++]),fy(3,7,11,15,e,t+2*fu[s++]),ff(0,5,10,15,e,t+2*fu[s++]),fy(0,5,10,15,e,t+2*fu[s++]),ff(1,6,11,12,e,t+2*fu[s++]),fy(1,6,11,12,e,t+2*fu[s++]),ff(2,7,8,13,e,t+2*fu[s++]),fy(2,7,8,13,e,t+2*fu[s++]),ff(3,4,9,14,e,t+2*fu[s++]),fy(3,4,9,14,e,t+2*fu[s++]);this.v0l^=fp[0]^fp[16],this.v0h^=fp[1]^fp[17],this.v1l^=fp[2]^fp[18],this.v1h^=fp[3]^fp[19],this.v2l^=fp[4]^fp[20],this.v2h^=fp[5]^fp[21],this.v3l^=fp[6]^fp[22],this.v3h^=fp[7]^fp[23],this.v4l^=fp[8]^fp[24],this.v4h^=fp[9]^fp[25],this.v5l^=fp[10]^fp[26],this.v5h^=fp[11]^fp[27],this.v6l^=fp[12]^fp[28],this.v6h^=fp[13]^fp[29],this.v7l^=fp[14]^fp[30],this.v7h^=fp[15]^fp[31],p_(fp)}destroy(){this.destroyed=!0,p_(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let fw=(Pc=e=>new fm(e),(N=(e,t)=>Pc(t).update(pM(e)).digest()).outputLen=(M=Pc({})).outputLen,N.blockLen=M.blockLen,N.create=e=>Pc(e),N);function fv(e){let t=`Ethereum Signed Message:
${e.length}`,r=new TextEncoder().encode(t+e);return"0x"+ed.Buffer.from(p0(r)).toString("hex")}async function fb(e,t,r,i,n,s){switch(r.t){case"eip191":var a,o,l;let c;return await (a=e,o=t,l=r.s,c=ub.fromHex(l),uG.recoverAddress({payload:fv(o),signature:c}).toLowerCase()===a.toLowerCase());case"eip1271":return await f_(e,t,r.s,i,n,s);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function f_(e,t,r,i,n,s){let a=hb(i);if(!a.namespace||!a.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let a="0x1626ba7e",o=r.substring(2),l=(o.length/2).toString(16).padStart(64,"0"),c=(t.startsWith("0x")?t:fv(t)).substring(2),d=a+c+"0000000000000000000000000000000000000000000000000000000000000040"+l+o,u=await fetch(`${s||"https://rpc.walletconnect.org/v1"}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:d},"latest"]})}),{result:h}=await u.json();return!!h&&h.slice(0,a.length).toLowerCase()===a.toLowerCase()}catch(e){return console.error("isValidEip1271Signature: ",e),!1}}function fE(e){let t=new Uint8Array(fo(function(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if("object"==typeof e&&null!=e&&e.data)return new Uint8Array(Object.values(e.data));if("object"==typeof e&&e)return new Uint8Array(Object.values(e));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(e)));return uZ.default.encode(t)}function fI(e){let t=ed.Buffer.from(e,"base64"),r=(0,uY.decode)(t).txn;if(!r)throw Error("Invalid signed transaction: missing 'txn' field");let i=(0,uQ.encode)(r),n=ed.Buffer.from("TX"),s=fd(ed.Buffer.concat([n,ed.Buffer.from(i)]));return oQ.base32.encode(s).replace(/=+$/,"")}function fA(e){let t=[],r=BigInt(e);for(;r>=BigInt(128);)t.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return t.push(Number(r)),ed.Buffer.from(t)}var fS=Object.defineProperty,fk=Object.defineProperties,fT=Object.getOwnPropertyDescriptors,fC=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,fP=Object.prototype.propertyIsEnumerable,fO=(e,t,r)=>t in e?fS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;let fR=e=>e?.split(":"),fN=e=>{let t=e&&fR(e);if(t)return t[2]+":"+t[3]},fM=e=>{let t=e&&fR(e);if(t)return t.pop()};async function fU(e){let{cacao:t,projectId:r}=e,{s:i,p:n}=t,s=fD(n,n.iss),a=fM(n.iss);return await fb(a,s,i,fN(n.iss),r)}let fD=(e,t)=>{let r=`${e.domain} wants you to sign in with your Ethereum account:`,i=fM(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let n=e.statement||void 0,s=`URI: ${e.aud||e.uri}`,a=`Version: ${e.version}`,o=`Chain ID: ${(e=>{let t=e&&fR(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)}`,l=`Nonce: ${e.nonce}`,c=`Issued At: ${e.iat}`,d=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,h=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join("")}`:void 0,f=fq(e.resources);return f&&(n=function(e="",t){fL(t);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(r))return e;let i=[],n=0;Object.keys(t.att).forEach(e=>{let r=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));r.sort((e,t)=>e.action.localeCompare(t.action));let s={};r.forEach(e=>{s[e.ability]||(s[e.ability]=[]),s[e.ability].push(e.action)});let a=Object.keys(s).map(t=>(n++,`(${n}) '${t}': '${s[t].join("', '")}' for '${e}'.`));i.push(a.join(", ").replace(".,","."))});let s=i.join(" "),a=`${r}${s}`;return`${e?e+" ":""}${a}`}(n,fW(f))),[r,i,"",n,"",s,a,o,l,c,d,u,h,p].filter(e=>null!=e).join(`
`)};function fL(e){if(!e)throw Error("No recap provided, value is undefined");if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(null!=t&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let r=e.att[t];if(Array.isArray(r)||"object"!=typeof r)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(e=>{let t=r[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if("object"!=typeof t)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function fj(e){return fL(e),`urn:recap:${ed.Buffer.from(JSON.stringify(e)).toString("base64").replace(/=/g,"")}`}function fW(e){var t;let r=(t=e.replace("urn:recap:",""),JSON.parse(ed.Buffer.from(t,"base64").toString("utf-8")));return fL(r),r}function fB(e){var t;let r=fW(e);fL(r);let i=null==(t=r.att)?void 0:t.eip155;return i?Object.keys(i).map(e=>e.split("/")[1]):[]}function fF(e){let t=fW(e);fL(t);let r=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=e?.[0])&&t.chains&&r.push(e[0].chains)})}),[...new Set(r.flat())]}function fq(e){if(!e)return;let t=e?.[e.length-1];return t&&t.includes("urn:recap:")?t:void 0}function fH(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function fz(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function f$(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function fK(e,...t){if(!fH(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function fV(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function fJ(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function fG(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let fZ=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function fY(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e);else if(fH(e))e=f0(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function fQ(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw Error("invalid output, must be aligned");return t}function fX(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)}function f0(e){return Uint8Array.from(e)}let f1=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),f2=f1("expand 16-byte k"),f5=f1("expand 32-byte k"),f3=fJ(f2),f8=fJ(f5);function f4(e,t){return e<<t|e>>>32-t}function f6(e){return e.byteOffset%4==0}let f9=0x100000000-1,f7=new Uint32Array,ye=(e,t)=>255&e[t++]|(255&e[t++])<<8;class yt{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,fK(e=fY(e),32);const t=ye(e,0),r=ye(e,2),i=ye(e,4),n=ye(e,6),s=ye(e,8),a=ye(e,10),o=ye(e,12),l=ye(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|o<<5)&8065,this.r[8]=(o>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let t=0;t<8;t++)this.pad[t]=ye(e,16+2*t)}process(e,t,r=!1){let{h:i,r:n}=this,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],d=n[5],u=n[6],h=n[7],p=n[8],f=n[9],y=ye(e,t+0),g=ye(e,t+2),m=ye(e,t+4),w=ye(e,t+6),v=ye(e,t+8),b=ye(e,t+10),_=ye(e,t+12),E=ye(e,t+14),I=i[0]+(8191&y),A=i[1]+((y>>>13|g<<3)&8191),S=i[2]+((g>>>10|m<<6)&8191),k=i[3]+((m>>>7|w<<9)&8191),T=i[4]+((w>>>4|v<<12)&8191),C=i[5]+(v>>>1&8191),x=i[6]+((v>>>14|b<<2)&8191),P=i[7]+((b>>>11|_<<5)&8191),O=i[8]+((_>>>8|E<<8)&8191),R=i[9]+(E>>>5|2048*!r),N=0,M=0+I*s+5*f*A+5*p*S+5*h*k+5*u*T;N=M>>>13,M&=8191,M+=5*d*C+5*c*x+5*l*P+5*o*O+5*a*R,N+=M>>>13,M&=8191;let U=N+I*a+A*s+5*f*S+5*p*k+5*h*T;N=U>>>13,U&=8191,U+=5*u*C+5*d*x+5*c*P+5*l*O+5*o*R,N+=U>>>13,U&=8191;let D=N+I*o+A*a+S*s+5*f*k+5*p*T;N=D>>>13,D&=8191,D+=5*h*C+5*u*x+5*d*P+5*c*O+5*l*R,N+=D>>>13,D&=8191;let L=N+I*l+A*o+S*a+k*s+5*f*T;N=L>>>13,L&=8191,L+=5*p*C+5*h*x+5*u*P+5*d*O+5*c*R,N+=L>>>13,L&=8191;let j=N+I*c+A*l+S*o+k*a+T*s;N=j>>>13,j&=8191,j+=5*f*C+5*p*x+5*h*P+5*u*O+5*d*R,N+=j>>>13,j&=8191;let W=N+I*d+A*c+S*l+k*o+T*a;N=W>>>13,W&=8191,W+=C*s+5*f*x+5*p*P+5*h*O+5*u*R,N+=W>>>13,W&=8191;let B=N+I*u+A*d+S*c+k*l+T*o;N=B>>>13,B&=8191,B+=C*a+x*s+5*f*P+5*p*O+5*h*R,N+=B>>>13,B&=8191;let F=N+I*h+A*u+S*d+k*c+T*l;N=F>>>13,F&=8191,F+=C*o+x*a+P*s+5*f*O+5*p*R,N+=F>>>13,F&=8191;let q=N+I*p+A*h+S*u+k*d+T*c;N=q>>>13,q&=8191,q+=C*l+x*o+P*a+O*s+5*f*R,N+=q>>>13,q&=8191;let H=N+I*f+A*p+S*h+k*u+T*d;N=H>>>13,H&=8191,H+=C*c+x*l+P*o+O*a+R*s,N+=H>>>13,H&=8191,M=8191&(N=(N=(N<<2)+N|0)+M|0),N>>>=13,U+=N,i[0]=M,i[1]=U,i[2]=D,i[3]=L,i[4]=j,i[5]=W,i[6]=B,i[7]=F,i[8]=q,i[9]=H}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=i,i=e[t]>>>13,e[t]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+i,i=r[t]>>>13,r[t]&=8191;r[9]-=8192;let n=(1^i)-1;for(let e=0;e<10;e++)r[e]&=n;n=~n;for(let t=0;t<10;t++)e[t]=e[t]&n|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=65535&s;for(let r=1;r<8;r++)s=(e[r]+t[r]|0)+(s>>>16)|0,e[r]=65535&s;fG(r)}update(e){fV(this),fK(e=fY(e));let{buffer:t,blockLen:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(r-this.pos,i-n);if(s===r){for(;r<=i-n;n+=r)this.process(e,n);continue}t.set(e.subarray(n,n+s),this.pos),this.pos+=s,n+=s,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){fG(this.h,this.r,this.buffer,this.pad)}digestInto(e){fV(this),function(e,t){fK(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let t=0;t<8;t++)e[n++]=r[t]>>>0,e[n++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let yr=(Pd=e=>new yt(e),(U=(e,t)=>Pd(t).update(fY(e)).digest()).outputLen=(D=Pd(new Uint8Array(32))).outputLen,U.blockLen=D.blockLen,U.create=e=>Pd(e),U),yi=function(e,t){let{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:a}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return f$(n),f$(a),fz(s),fz(r),(t,o,l,c,d=0)=>{fK(t),fK(o),fK(l);let u=l.length;if(void 0===c&&(c=new Uint8Array(u)),fK(c),f$(d),d<0||d>=f9)throw Error("arx: counter overflow");if(c.length<u)throw Error(`arx: output (${c.length}) is shorter than data (${u})`);let h=[],p=t.length,f,y;if(32===p)h.push(f=f0(t)),y=f8;else if(16===p&&r)(f=new Uint8Array(32)).set(t),f.set(t,16),y=f3,h.push(f);else throw Error(`arx: invalid 32-byte key, got length=${p}`);f6(o)||h.push(o=f0(o));let g=fJ(f);if(i){if(24!==o.length)throw Error("arx: extended nonce must be 24 bytes");i(y,g,fJ(o.subarray(0,16)),g),o=o.subarray(16)}let m=16-n;if(m!==o.length)throw Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){let e=new Uint8Array(12);e.set(o,s?0:12-o.length),o=e,h.push(o)}return function(e,t,r,i,n,s,a,o){let l=n.length,c=new Uint8Array(64),d=fJ(c),u=f6(n)&&f6(s),h=u?fJ(n):f7,p=u?fJ(s):f7;for(let f=0;f<l;a++){if(e(t,r,i,d,a,o),a>=f9)throw Error("arx: counter overflow");let y=Math.min(64,l-f);if(u&&64===y){let e=f/4;if(f%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)p[r=e+t]=h[r]^d[t];f+=64;continue}for(let e=0,t;e<y;e++)s[t=f+e]=n[t]^c[e];f+=y}}(e,y,g,fJ(o),l,c,d,a),fG(...h),c}}(function(e,t,r,i,n,s=20){let a=e[0],o=e[1],l=e[2],c=e[3],d=t[0],u=t[1],h=t[2],p=t[3],f=t[4],y=t[5],g=t[6],m=t[7],w=r[0],v=r[1],b=r[2],_=a,E=o,I=l,A=c,S=d,k=u,T=h,C=p,x=f,P=y,O=g,R=m,N=n,M=w,U=v,D=b;for(let e=0;e<s;e+=2)x=x+(N=f4(N^(_=_+S|0),16))|0,_=_+(S=f4(S^x,12))|0,x=x+(N=f4(N^_,8))|0,S=f4(S^x,7),P=P+(M=f4(M^(E=E+k|0),16))|0,E=E+(k=f4(k^P,12))|0,P=P+(M=f4(M^E,8))|0,k=f4(k^P,7),O=O+(U=f4(U^(I=I+T|0),16))|0,I=I+(T=f4(T^O,12))|0,O=O+(U=f4(U^I,8))|0,T=f4(T^O,7),R=R+(D=f4(D^(A=A+C|0),16))|0,A=A+(C=f4(C^R,12))|0,R=R+(D=f4(D^A,8))|0,C=f4(C^R,7),O=O+(D=f4(D^(_=_+k|0),16))|0,_=_+(k=f4(k^O,12))|0,O=O+(D=f4(D^_,8))|0,k=f4(k^O,7),R=R+(N=f4(N^(E=E+T|0),16))|0,E=E+(T=f4(T^R,12))|0,R=R+(N=f4(N^E,8))|0,T=f4(T^R,7),x=x+(M=f4(M^(I=I+C|0),16))|0,I=I+(C=f4(C^x,12))|0,x=x+(M=f4(M^I,8))|0,C=f4(C^x,7),P=P+(U=f4(U^(A=A+S|0),16))|0,A=A+(S=f4(S^P,12))|0,P=P+(U=f4(U^A,8))|0,S=f4(S^P,7);let L=0;i[L++]=a+_|0,i[L++]=o+E|0,i[L++]=l+I|0,i[L++]=c+A|0,i[L++]=d+S|0,i[L++]=u+k|0,i[L++]=h+T|0,i[L++]=p+C|0,i[L++]=f+x|0,i[L++]=y+P|0,i[L++]=g+O|0,i[L++]=m+R|0,i[L++]=n+N|0,i[L++]=w+M|0,i[L++]=v+U|0,i[L++]=b+D|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),yn=new Uint8Array(16),ys=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(yn.subarray(r))},ya=new Uint8Array(32);function yo(e,t,r,i,n){var s,a;let o,l,c=e(t,r,ya),d=yr.create(c);n&&ys(d,n),ys(d,i);let u=(s=i.length,a=n?n.length:0,fz(!0),fX(l=new DataView((o=new Uint8Array(16)).buffer,o.byteOffset,o.byteLength),0,BigInt(a),!0),fX(l,8,BigInt(s),!0),o);d.update(u);let h=d.digest();return fG(c,u),h}let yl=((e,t)=>{function r(i,...n){if(fK(i),!fZ)throw Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){let t=n[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?fK(t):fK(t,e.nonceLength)}let s=e.tagLength;s&&void 0!==n[1]&&fK(n[1]);let a=t(i,...n),o=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");fK(t)}},l=!1;return{encrypt(e,t){if(l)throw Error("cannot encrypt() twice with same key + nonce");return l=!0,fK(e),o(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(fK(e),s&&e.length<s)throw Error("invalid ciphertext length: smaller than tagLength="+s);return o(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(r,e),r})({blockSize:64,nonceLength:12,tagLength:16},(e,t,r)=>({encrypt(i,n){let s=i.length;(n=fQ(s+16,n,!1)).set(i);let a=n.subarray(0,-16);yi(e,t,a,a,1);let o=yo(yi,e,t,a,r);return n.set(o,s),fG(o),n},decrypt(i,n){n=fQ(i.length-16,n,!1);let s=i.subarray(0,-16),a=i.subarray(-16),o=yo(yi,e,t,s,r);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(a,o))throw Error("invalid tag");return n.set(i.subarray(0,-16)),yi(e,t,n,n,1),fG(o),n}}));class yc extends pD{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,pm(e);const r=pM(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),p_(n)}update(e){return pw(this),this.iHash.update(e),this}digestInto(e){pw(this),pg(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:a}=this;return e.finished=i,e.destroyed=n,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let yd=(e,t,r)=>new yc(e,t).update(r).digest();yd.create=(e,t)=>new yc(e,t);let yu=Uint8Array.from([0]),yh=Uint8Array.of(),yp=BigInt(0),yf=BigInt(1);function yy(e,t=""){if("boolean"!=typeof e)throw Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e}function yg(e,t,r=""){let i=pf(e),n=e?.length,s=void 0!==t;if(!i||s&&n!==t)throw Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(i?`length=${n}`:`type=${typeof e}`));return e}function ym(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function yw(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?yp:BigInt("0x"+e)}function yv(e){return pg(e),yw(pP(Uint8Array.from(e).reverse()))}function yb(e,t){return pR(e.toString(16).padStart(2*t,"0"))}function y_(e,t){return yb(e,t).reverse()}function yE(e,t,r){let i;if("string"==typeof t)try{i=pR(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(pf(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let n=i.length;if("number"==typeof r&&n!==r)throw Error(e+" of length "+r+" expected, got "+n);return i}let yI=e=>"bigint"==typeof e&&yp<=e;function yA(e,t,r,i){if(!(yI(t)&&yI(r)&&yI(i))||!(r<=t)||!(t<i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}function yS(e){let t;for(t=0;e>yp;e>>=yf,t+=1);return t}let yk=e=>(yf<<BigInt(e))-yf;function yT(e,t,r={}){if(!e||"object"!=typeof e)throw Error("expected valid options object");function i(t,r,i){let n=e[t];if(i&&void 0===n)return;let s=typeof n;if(s!==r||null===n)throw Error(`param "${t}" is invalid: expected ${r}, got ${s}`)}Object.entries(t).forEach(([e,t])=>i(e,t,!1)),Object.entries(r).forEach(([e,t])=>i(e,t,!0))}function yC(e){let t=new WeakMap;return(r,...i)=>{let n=t.get(r);if(void 0!==n)return n;let s=e(r,...i);return t.set(r,s),s}}let yx=BigInt(0),yP=BigInt(1),yO=BigInt(2),yR=BigInt(3),yN=BigInt(4),yM=BigInt(5),yU=BigInt(7),yD=BigInt(8),yL=BigInt(9),yj=BigInt(16);function yW(e,t){let r=e%t;return r>=yx?r:t+r}function yB(e,t,r){let i=e;for(;t-- >yx;)i*=i,i%=r;return i}function yF(e,t){if(e===yx)throw Error("invert: expected non-zero number");if(t<=yx)throw Error("invert: expected positive modulus, got "+t);let r=yW(e,t),i=t,n=yx,s=yP;for(;r!==yx;){let e=i/r,t=i%r,a=n-s*e;i=r,r=t,n=s,s=a}if(i!==yP)throw Error("invert: does not exist");return yW(n,t)}function yq(e,t,r){if(!e.eql(e.sqr(t),r))throw Error("Cannot find square root")}function yH(e,t){let r=(e.ORDER+yP)/yN,i=e.pow(t,r);return yq(e,i,t),i}function yz(e,t){let r=(e.ORDER-yM)/yD,i=e.mul(t,yO),n=e.pow(i,r),s=e.mul(t,n),a=e.mul(e.mul(s,yO),n),o=e.mul(s,e.sub(a,e.ONE));return yq(e,o,t),o}function y$(e){if(e<yR)throw Error("sqrt is not defined for small field");let t=e-yP,r=0;for(;t%yO===yx;)t/=yO,r++;let i=yO,n=yZ(e);for(;1===yJ(n,i);)if(i++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return yH;let s=n.pow(i,t),a=(t+yP)/yO;return function(e,i){if(e.is0(i))return i;if(1!==yJ(e,i))throw Error("Cannot find square root");let n=r,o=e.mul(e.ONE,s),l=e.pow(i,t),c=e.pow(i,a);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===n)throw Error("Cannot find square root");let i=yP<<BigInt(n-t-1),s=e.pow(o,i);n=t,o=e.sqr(s),l=e.mul(l,o),c=e.mul(c,s)}return c}}let yK=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yV(e,t,r=!1){let i=Array(t.length).fill(r?e.ZERO:void 0),n=t.reduce((t,r,n)=>e.is0(r)?t:(i[n]=t,e.mul(t,r)),e.ONE),s=e.inv(n);return t.reduceRight((t,r,n)=>e.is0(r)?t:(i[n]=e.mul(t,i[n]),e.mul(t,r)),s),i}function yJ(e,t){let r=(e.ORDER-yP)/yO,i=e.pow(t,r),n=e.eql(i,e.ONE),s=e.eql(i,e.ZERO),a=e.eql(i,e.neg(e.ONE));if(!n&&!s&&!a)throw Error("invalid Legendre symbol result");return n?1:s?0:-1}function yG(e,t){void 0!==t&&py(t);let r=void 0!==t?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function yZ(e,t,r=!1,i={}){let n;if(e<=yx)throw Error("invalid field: expected ORDER > 0, got "+e);let s,a,o=!1,l;if("object"==typeof t&&null!=t){if(i.sqrt||r)throw Error("cannot specify opts in two arguments");t.BITS&&(s=t.BITS),t.sqrt&&(a=t.sqrt),"boolean"==typeof t.isLE&&(r=t.isLE),"boolean"==typeof t.modFromBytes&&(o=t.modFromBytes),l=t.allowedLengths}else"number"==typeof t&&(s=t),i.sqrt&&(a=i.sqrt);let{nBitLength:c,nByteLength:d}=yG(e,s);if(d>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let u=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:d,MASK:yk(c),ZERO:yx,ONE:yP,allowedLengths:l,create:t=>yW(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return yx<=t&&t<e},is0:e=>e===yx,isValidNot0:e=>!u.is0(e)&&u.isValid(e),isOdd:e=>(e&yP)===yP,neg:t=>yW(-t,e),eql:(e,t)=>e===t,sqr:t=>yW(t*t,e),add:(t,r)=>yW(t+r,e),sub:(t,r)=>yW(t-r,e),mul:(t,r)=>yW(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<yx)throw Error("invalid exponent, negatives unsupported");if(r===yx)return e.ONE;if(r===yP)return t;let i=e.ONE,n=t;for(;r>yx;)r&yP&&(i=e.mul(i,n)),n=e.sqr(n),r>>=yP;return i})(u,e,t),div:(t,r)=>yW(t*yF(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>yF(t,e),sqrt:a||(t=>{let r,i,s,a,o,l;return n||(n=e%yN===yR?yH:e%yD===yM?yz:e%yj===yL?(r=yZ(e),s=(i=y$(e))(r,r.neg(r.ONE)),a=i(r,s),o=i(r,r.neg(s)),l=(e+yU)/yj,(e,t)=>{let r=e.pow(t,l),i=e.mul(r,s),n=e.mul(r,a),c=e.mul(r,o),d=e.eql(e.sqr(i),t),u=e.eql(e.sqr(n),t);r=e.cmov(r,i,d),i=e.cmov(c,n,u);let h=e.eql(e.sqr(i),t),p=e.cmov(r,i,h);return yq(e,p,t),p}):y$(e)),n(u,t)}),toBytes:e=>r?y_(e,d):yb(e,d),fromBytes:(t,i=!0)=>{if(l){if(!l.includes(t.length)||t.length>d)throw Error("Field.fromBytes: expected "+l+" bytes, got "+t.length);let e=new Uint8Array(d);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==d)throw Error("Field.fromBytes: expected "+d+" bytes, got "+t.length);let n=r?yv(t):yw(pP(t));if(o&&(n=yW(n,e)),!i&&!u.isValid(n))throw Error("invalid field element: outside of range 0..ORDER");return n},invertBatch:e=>yV(u,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(u)}function yY(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function yQ(e){let t=yY(e);return t+Math.ceil(t/2)}let yX=BigInt(0),y0=BigInt(1);function y1(e,t){let r=t.negate();return e?r:t}function y2(e,t){let r=yV(e.Fp,t.map(e=>e.Z));return t.map((t,i)=>e.fromAffine(t.toAffine(r[i])))}function y5(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function y3(e,t){y5(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1),n=2**e;return{windows:r,windowSize:i,mask:yk(e),maxNumber:n,shiftBy:BigInt(e)}}function y8(e,t,r){let{windowSize:i,mask:n,maxNumber:s,shiftBy:a}=r,o=Number(e&n),l=e>>a;o>i&&(o-=s,l+=y0);let c=t*i;return{nextN:l,offset:c+Math.abs(o)-1,isZero:0===o,isNeg:o<0,isNegF:t%2!=0,offsetF:c}}let y4=new WeakMap,y6=new WeakMap;function y9(e){return y6.get(e)||1}function y7(e){if(e!==yX)throw Error("invalid wNAF")}class ge{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>yX;)t&y0&&(r=r.add(i)),i=i.double(),t>>=y0;return r}precomputeWindow(e,t){let{windows:r,windowSize:i}=y3(t,this.bits),n=[],s=e,a=s;for(let e=0;e<r;e++){a=s,n.push(a);for(let e=1;e<i;e++)a=a.add(s),n.push(a);s=a.double()}return n}wNAF(e,t,r){if(!this.Fn.isValid(r))throw Error("invalid scalar");let i=this.ZERO,n=this.BASE,s=y3(e,this.bits);for(let e=0;e<s.windows;e++){let{nextN:a,offset:o,isZero:l,isNeg:c,isNegF:d,offsetF:u}=y8(r,e,s);r=a,l?n=n.add(y1(d,t[u])):i=i.add(y1(c,t[o]))}return y7(r),{p:i,f:n}}wNAFUnsafe(e,t,r,i=this.ZERO){let n=y3(e,this.bits);for(let e=0;e<n.windows&&r!==yX;e++){let{nextN:s,offset:a,isZero:o,isNeg:l}=y8(r,e,n);if(r=s,!o){let e=t[a];i=i.add(l?e.negate():e)}}return y7(r),i}getPrecomputes(e,t,r){let i=y4.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(i=r(i)),y4.set(t,i))),i}cached(e,t,r){let i=y9(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){let n=y9(e);return 1===n?this._unsafeLadder(e,t,i):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,i)}createCache(e,t){y5(t,this.bits),y6.set(e,t),y4.delete(e)}hasCache(e){return 1!==y9(e)}}function gt(e,t,r){if(!t)return yZ(e,{isLE:r});if(t.ORDER!==e)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return yT(t,yK.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),t}BigInt(0),BigInt(1),BigInt(2),BigInt(8),pN("HashToScalar-");let gr=BigInt(0),gi=BigInt(1),gn=BigInt(2),gs=BigInt(1),ga=BigInt(2),go=BigInt(3),gl=BigInt(5),gc=BigInt(8),gd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),gu={p:gd,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:gc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},gh=function(e){let{P:t,type:r,adjustScalarBytes:i,powPminus2:n,randomBytes:s}=(yT(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})),a="x25519"===r;if(!a&&"x448"!==r)throw Error("invalid type");let o=s||pj,l=a?255:448,c=a?32:56,d=BigInt(a?9:5),u=BigInt(a?121665:39081),h=a?gn**BigInt(254):gn**BigInt(447),p=h+(a?BigInt(8)*gn**BigInt(251)-gi:BigInt(4)*gn**BigInt(445)-gi)+gi,f=e=>yW(e,t),y=y_(f(d),c);function g(e,r){let s,o=function(e,r){yA("u",e,gr,t),yA("scalar",r,h,p);let i=gi,s=gr,a=e,o=gi,c=gr;for(let t=BigInt(l-1);t>=gr;t--){let n=r>>t&gi;c^=n,({x_2:i,x_3:a}=w(c,i,a)),({x_2:s,x_3:o}=w(c,s,o)),c=n;let l=i+s,d=f(l*l),h=i-s,p=f(h*h),y=d-p,g=a+o,m=f((a-o)*l),v=f(g*h),b=m+v,_=m-v;a=f(b*b),o=f(e*f(_*_)),i=f(d*p),s=f(y*(d+f(u*y)))}return{x_2:i,x_3:a}=w(c,i,a),{x_2:s,x_3:o}=w(c,s,o),f(i*n(s))}((s=yE("u coordinate",r,c),a&&(s[31]&=127),f(yv(s))),yv(i(yE("scalar",e,c))));if(o===gr)throw Error("invalid private or public key received");return y_(f(o),c)}function m(e){return g(e,y)}function w(e,t,r){let i=f(e*(t-r));return{x_2:t=f(t-i),x_3:r=f(r+i)}}let v={secretKey:c,publicKey:c,seed:c},b=(e=o(c))=>(pg(e,v.seed),e);return{keygen:function(e){let t=b(e);return{secretKey:t,publicKey:m(t)}},getSharedSecret:(e,t)=>g(e,t),getPublicKey:e=>m(e),scalarMult:g,scalarMultBase:m,utils:{randomSecretKey:b,randomPrivateKey:b},GuBytes:y.slice(),lengths:v}}({P:L=yZ(gu.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:e=>{let t,r,i,n,s,a,o,l,c,d,u,h,p,f,{pow_p_5_8:y,b2:g}=(t=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),a=yB(s=e*e%gd*e%gd,ga,gd)*s%gd,o=yB(a,gs,gd)*e%gd,l=yB(o,gl,gd)*o%gd,c=yB(l,t,gd)*l%gd,d=yB(c,r,gd)*c%gd,u=yB(d,i,gd)*d%gd,h=yB(u,n,gd)*u%gd,p=yB(h,n,gd)*u%gd,f=yB(p,t,gd)*l%gd,{pow_p_5_8:yB(f,ga,gd)*e%gd,b2:s});return yW(yB(y,go,L)*g,L)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}}),gp=(e,t)=>(e+(e>=0?t:-t)/gv)/t;function gf(e){if(!["compact","recovered","der"].includes(e))throw Error('Signature format must be "compact", "recovered", or "der"');return e}function gy(e,t){let r={};for(let i of Object.keys(t))r[i]=void 0===e[i]?t[i]:e[i];return yy(r.lowS,"lowS"),yy(r.prehash,"prehash"),void 0!==r.format&&gf(r.format),r}let gg={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=gg;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,n=ym(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let s=i>127?ym(n.length/2|128):"";return ym(e)+s+n+t},decode(e,t){let{Err:r}=gg,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let n=t[i++],s=0;if(128&n){let e=127&n;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let a=t.subarray(i,i+e);if(a.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===a[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of a)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;let a=t.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+s)}}},_int:{encode(e){let{Err:t}=gg;if(e<gm)throw new t("integer: negative integers are not allowed");let r=ym(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=gg;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return yw(pP(e))}},toSig(e){let{Err:t,_int:r,_tlv:i}=gg,n=yE("signature",e),{v:s,l:a}=i.decode(48,n);if(a.length)throw new t("invalid signature: left bytes after parsing");let{v:o,l:l}=i.decode(2,s),{v:c,l:d}=i.decode(2,l);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(o),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=gg,i=t.encode(2,r.encode(e.r)),n=t.encode(2,r.encode(e.s));return t.encode(48,i+n)}},gm=BigInt(0),gw=BigInt(1),gv=BigInt(2),gb=BigInt(3),g_=BigInt(4);function gE(e,t){let r,{BYTES:i}=e;if("bigint"==typeof t)r=t;else{let n=yE("private key",t);try{r=e.fromBytes(n)}catch{throw Error(`invalid private key: expected ui8a of size ${i}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw Error("invalid private key: out of range [1..N-1]");return r}function gI(e){return Uint8Array.of(e?2:3)}function gA(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function gS(e,t){let r=t=>(function(e){let t,{CURVE:r,curveOpts:i,hash:n,ecdsaOpts:s}=function(e){let t,r,i,n,{CURVE:s,curveOpts:a}=(t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,i=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0,n={Fp:r,Fn:yZ(t.n,{BITS:e.nBitLength,allowedLengths:i,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes},{CURVE:t,curveOpts:n}),o={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:s,curveOpts:a,hash:e.hash,ecdsaOpts:o}}(e),a=function(e,t,r={}){pm(t),yT(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let i=r.randomBytes||pj,n=r.hmac||((e,...r)=>yd(t,e,pU(...r))),{Fp:s,Fn:a}=e,{ORDER:o,BITS:l}=a,{keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p}=function(e,t={}){let{Fn:r}=e,i=t.randomBytes||pj,n=Object.assign(gA(e.Fp,r),{seed:yQ(r.ORDER)});function s(e){try{return!!gE(r,e)}catch{return!1}}function a(e=i(n.seed)){return function(e,t,r=!1){let i=e.length,n=yY(t),s=yQ(t);if(i<16||i<s||i>1024)throw Error("expected "+s+"-1024 bytes of input, got "+i);let a=yW(r?yv(e):yw(pP(e)),t-yP)+yP;return r?y_(a,n):yb(a,n)}(yg(e,n.seed,"seed"),r.ORDER)}function o(t,i=!0){return e.BASE.multiply(gE(r,t)).toBytes(i)}function l(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;let{secretKey:i,publicKey:s,publicKeyUncompressed:a}=n;if(r.allowedLengths||i===s)return;let o=yE("key",t).length;return o===s||o===a}return Object.freeze({getPublicKey:o,getSharedSecret:function(t,i,n=!0){if(!0===l(t))throw Error("first arg must be private key");if(!1===l(i))throw Error("second arg must be public key");let s=gE(r,t);return e.fromHex(i).multiply(s).toBytes(n)},keygen:function(e){let t=a(e);return{secretKey:t,publicKey:o(t)}},Point:e,utils:{isValidSecretKey:s,isValidPublicKey:function(t,r){let{publicKey:i,publicKeyUncompressed:s}=n;try{let n=t.length;return(!0!==r||n===i)&&(!1!==r||n===s)&&!!e.fromBytes(t)}catch{return!1}},randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:e=>gE(r,e),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},lengths:n})}(e,r),f={prehash:!1,lowS:"boolean"==typeof r.lowS&&r.lowS,format:void 0,extraEntropy:!1},y="compact";function g(e,t){if(!a.isValidNot0(t))throw Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class m{constructor(e,t,r){this.r=g("r",e),this.s=g("s",t),null!=r&&(this.recovery=r),Object.freeze(this)}static fromBytes(e,t=y){var r,i;let n,s;if(r=e,gf(i=t),s=p.signature,yg(r,"compact"===i?s:"recovered"===i?s+1:void 0,`${i} signature`),"der"===t){let{r:t,s:r}=gg.toSig(yg(e));return new m(t,r)}"recovered"===t&&(n=e[0],t="compact",e=e.subarray(1));let o=a.BYTES,l=e.subarray(0,o),c=e.subarray(o,2*o);return new m(a.fromBytes(l),a.fromBytes(c),n)}static fromHex(e,t){return this.fromBytes(pR(e),t)}addRecoveryBit(e){return new m(this.r,this.s,e)}recoverPublicKey(t){let r=s.ORDER,{r:i,s:n,recovery:l}=this;if(null==l||![0,1,2,3].includes(l))throw Error("recovery id invalid");if(o*gv<r&&l>1)throw Error("recovery id is ambiguous for h>1 curve");let c=2===l||3===l?i+o:i;if(!s.isValid(c))throw Error("recovery id 2 or 3 invalid");let d=s.toBytes(c),u=e.fromBytes(pU(gI((1&l)==0),d)),h=a.inv(c),p=v(yE("msgHash",t)),f=a.create(-p*h),y=a.create(n*h),g=e.BASE.multiplyUnsafe(f).add(u.multiplyUnsafe(y));if(g.is0())throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>o>>gw}toBytes(e=y){if(gf(e),"der"===e)return pR(gg.hexFromSig(this));let t=a.toBytes(this.r),r=a.toBytes(this.s);if("recovered"===e){if(null==this.recovery)throw Error("recovery bit must be present");return pU(Uint8Array.of(this.recovery),t,r)}return pU(t,r)}toHex(e){return pP(this.toBytes(e))}assertValidity(){}static fromCompact(e){return m.fromBytes(yE("sig",e),"compact")}static fromDER(e){return m.fromBytes(yE("sig",e),"der")}normalizeS(){return this.hasHighS()?new m(this.r,a.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return pP(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return pP(this.toBytes("compact"))}}let w=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=yw(pP(e)),r=8*e.length-l;return r>0?t>>BigInt(r):t},v=r.bits2int_modN||function(e){return a.create(w(e))},b=yk(l);function _(e){return yA("num < 2^"+l,e,gm,b),a.toBytes(e)}function E(e,r){return yg(e,void 0,"message"),r?yg(t(e),void 0,"prehashed message"):e}return Object.freeze({keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p,Point:e,sign:function(r,s,l={}){let{seed:c,k2sig:d}=function(t,r,n){if(["recovered","canonical"].some(e=>e in n))throw Error("sign() legacy options not supported");let{lowS:s,prehash:l,extraEntropy:c}=gy(n,f),d=v(t=E(t,l)),u=gE(a,r),h=[_(u),_(d)];if(null!=c&&!1!==c){let e=!0===c?i(p.secretKey):c;h.push(yE("extraEntropy",e))}return{seed:pU(...h),k2sig:function(t){let r=w(t);if(!a.isValidNot0(r))return;let i=a.inv(r),n=e.BASE.multiply(r).toAffine(),l=a.create(n.x);if(l===gm)return;let c=a.create(i*a.create(d+l*u));if(c===gm)return;let h=2*(n.x!==l)|Number(n.y&gw),p=c;return s&&c>o>>gw&&(p=a.neg(c),h^=1),new m(l,p,h)}}}(r=yE("message",r),s,l);return(function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=e=>new Uint8Array(e),n=i(e),s=i(e),a=0,o=()=>{n.fill(1),s.fill(0),a=0},l=(...e)=>r(s,n,...e),c=(e=i(0))=>{s=l(Uint8Array.of(0),e),n=l(),0!==e.length&&(s=l(Uint8Array.of(1),e),n=l())},d=()=>{if(a++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=l()).slice();r.push(t),e+=n.length}return pU(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(d()));)c();return o(),r}})(t.outputLen,a.BYTES,n)(c,d)},verify:function(t,r,i,n={}){let{lowS:s,prehash:o,format:l}=gy(n,f);if(i=yE("publicKey",i),r=E(yE("message",r),o),"strict"in n)throw Error("options.strict was renamed to lowS");let c=void 0===l?function(e){let t,r="string"==typeof e||pf(e),i=!r&&null!==e&&"object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!r&&!i)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(i)t=new m(e.r,e.s);else if(r){try{t=m.fromBytes(yE("sig",e),"der")}catch(e){if(!(e instanceof gg.Err))throw e}if(!t)try{t=m.fromBytes(yE("sig",e),"compact")}catch{return!1}}return t||!1}(t):m.fromBytes(yE("sig",t),l);if(!1===c)return!1;try{let t=e.fromBytes(i);if(s&&c.hasHighS())return!1;let{r:n,s:o}=c,l=v(r),d=a.inv(o),u=a.create(l*d),h=a.create(n*d),p=e.BASE.multiplyUnsafe(u).add(t.multiplyUnsafe(h));return!p.is0()&&a.create(p.x)===n}catch{return!1}},recoverPublicKey:function(e,t,r={}){let{prehash:i}=gy(r,f);return t=E(t,i),m.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:m,hash:t})}(function(e,t={}){let r=function(e,t,r={},i){if(void 0===i&&(i="edwards"===e),!t||"object"!=typeof t)throw Error(`expected valid ${e} CURVE object`);for(let e of["p","n","h"]){let r=t[e];if(!("bigint"==typeof r&&r>yX))throw Error(`CURVE.${e} must be positive bigint`)}let n=gt(t.p,r.Fp,i),s=gt(t.n,r.Fn,i);for(let r of["Gx","Gy","a","weierstrass"===e?"b":"d"])if(!n.isValid(t[r]))throw Error(`CURVE.${r} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:n,Fn:s}}("weierstrass",e,t),{Fp:i,Fn:n}=r,s=r.CURVE,{h:a,n:o}=s;yT(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:l}=t;if(l&&(!i.is0(s.a)||"bigint"!=typeof l.beta||!Array.isArray(l.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let c=gA(i,n);function d(){if(!i.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let u=t.toBytes||function(e,t,r){let{x:n,y:s}=t.toAffine(),a=i.toBytes(n);return(yy(r,"isCompressed"),r)?(d(),pU(gI(!i.isOdd(s)),a)):pU(Uint8Array.of(4),a,i.toBytes(s))},h=t.fromBytes||function(e){yg(e,void 0,"Point");let{publicKey:t,publicKeyUncompressed:r}=c,n=e.length,s=e[0],a=e.subarray(1);if(n===t&&(2===s||3===s)){let e,t=i.fromBytes(a);if(!i.isValid(t))throw Error("bad point: is not on curve, wrong x");let r=p(t);try{e=i.sqrt(r)}catch(e){throw Error("bad point: is not on curve, sqrt error"+(e instanceof Error?": "+e.message:""))}return d(),(1&s)==1!==i.isOdd(e)&&(e=i.neg(e)),{x:t,y:e}}if(n===r&&4===s){let e=i.BYTES,t=i.fromBytes(a.subarray(0,e)),r=i.fromBytes(a.subarray(e,2*e));if(!f(t,r))throw Error("bad point: is not on curve");return{x:t,y:r}}throw Error(`bad point: got length ${n}, expected compressed=${t} or uncompressed=${r}`)};function p(e){let t=i.sqr(e),r=i.mul(t,e);return i.add(i.add(r,i.mul(e,s.a)),s.b)}function f(e,t){let r=i.sqr(t),n=p(e);return i.eql(r,n)}if(!f(s.Gx,s.Gy))throw Error("bad curve params: generator point");let y=i.mul(i.pow(s.a,gb),g_),g=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(y,g)))throw Error("bad curve params: a or b");function m(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw Error(`bad point coordinate ${e}`);return t}function w(e){if(!(e instanceof I))throw Error("ProjectivePoint expected")}function v(e){if(!l||!l.basises)throw Error("no endo");return function(e,t,r){let[[i,n],[s,a]]=t,o=gp(a*e,r),l=gp(-n*e,r),c=e-o*i-l*s,d=-o*n-l*a,u=c<gm,h=d<gm;u&&(c=-c),h&&(d=-d);let p=yk(Math.ceil(yS(r)/2))+gw;if(c<gm||c>=p||d<gm||d>=p)throw Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:c,k2neg:h,k2:d}}(e,l.basises,n.ORDER)}let b=yC((e,t)=>{let{X:r,Y:n,Z:s}=e;if(i.eql(s,i.ONE))return{x:r,y:n};let a=e.is0();null==t&&(t=a?i.ONE:i.inv(s));let o=i.mul(r,t),l=i.mul(n,t),c=i.mul(s,t);if(a)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw Error("invZ was invalid");return{x:o,y:l}}),_=yC(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.Y))return;throw Error("bad point: ZERO")}let{x:r,y:n}=e.toAffine();if(!i.isValid(r)||!i.isValid(n))throw Error("bad point: x or y not field elements");if(!f(r,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function E(e,t,r,n,s){return r=new I(i.mul(r.X,e),r.Y,r.Z),t=y1(n,t),r=y1(s,r),t.add(r)}class I{constructor(e,t,r){this.X=m("x",e),this.Y=m("y",t,!0),this.Z=m("z",r),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof I)throw Error("projective point not allowed");return i.is0(t)&&i.is0(r)?I.ZERO:new I(t,r,i.ONE)}static fromBytes(e){let t=I.fromAffine(h(yg(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return I.fromBytes(yE("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return S.createCache(this,e),t||this.multiply(gb),this}assertValidity(){_(this)}hasEvenY(){let{y:e}=this.toAffine();if(!i.isOdd)throw Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){w(e);let{X:t,Y:r,Z:n}=this,{X:s,Y:a,Z:o}=e,l=i.eql(i.mul(t,o),i.mul(s,n)),c=i.eql(i.mul(r,o),i.mul(a,n));return l&&c}negate(){return new I(this.X,i.neg(this.Y),this.Z)}double(){let{a:e,b:t}=s,r=i.mul(t,gb),{X:n,Y:a,Z:o}=this,l=i.ZERO,c=i.ZERO,d=i.ZERO,u=i.mul(n,n),h=i.mul(a,a),p=i.mul(o,o),f=i.mul(n,a);return f=i.add(f,f),d=i.mul(n,o),d=i.add(d,d),l=i.mul(e,d),c=i.mul(r,p),c=i.add(l,c),l=i.sub(h,c),c=i.add(h,c),c=i.mul(l,c),l=i.mul(f,l),d=i.mul(r,d),p=i.mul(e,p),f=i.sub(u,p),f=i.mul(e,f),f=i.add(f,d),d=i.add(u,u),u=i.add(d,u),u=i.add(u,p),u=i.mul(u,f),c=i.add(c,u),p=i.mul(a,o),p=i.add(p,p),u=i.mul(p,f),l=i.sub(l,u),d=i.mul(p,h),d=i.add(d,d),new I(l,c,d=i.add(d,d))}add(e){w(e);let{X:t,Y:r,Z:n}=this,{X:a,Y:o,Z:l}=e,c=i.ZERO,d=i.ZERO,u=i.ZERO,h=s.a,p=i.mul(s.b,gb),f=i.mul(t,a),y=i.mul(r,o),g=i.mul(n,l),m=i.add(t,r),v=i.add(a,o);m=i.mul(m,v),v=i.add(f,y),m=i.sub(m,v),v=i.add(t,n);let b=i.add(a,l);return v=i.mul(v,b),b=i.add(f,g),v=i.sub(v,b),b=i.add(r,n),c=i.add(o,l),b=i.mul(b,c),c=i.add(y,g),b=i.sub(b,c),u=i.mul(h,v),c=i.mul(p,g),u=i.add(c,u),c=i.sub(y,u),u=i.add(y,u),d=i.mul(c,u),y=i.add(f,f),y=i.add(y,f),g=i.mul(h,g),v=i.mul(p,v),y=i.add(y,g),g=i.sub(f,g),g=i.mul(h,g),v=i.add(v,g),f=i.mul(y,v),d=i.add(d,f),f=i.mul(b,v),c=i.mul(m,c),c=i.sub(c,f),f=i.mul(m,y),u=i.mul(b,u),new I(c,d,u=i.add(u,f))}subtract(e){return this.add(e.negate())}is0(){return this.equals(I.ZERO)}multiply(e){let r,i,{endo:s}=t;if(!n.isValidNot0(e))throw Error("invalid scalar: out of range");let a=e=>S.cached(this,e,e=>y2(I,e));if(s){let{k1neg:t,k1:n,k2neg:o,k2:l}=v(e),{p:c,f:d}=a(n),{p:u,f:h}=a(l);i=d.add(h),r=E(s.beta,c,u,t,o)}else{let{p:t,f:n}=a(e);r=t,i=n}return y2(I,[r,i])[0]}multiplyUnsafe(e){let{endo:r}=t;if(!n.isValid(e))throw Error("invalid scalar: out of range");if(e===gm||this.is0())return I.ZERO;if(e===gw)return this;if(S.hasCache(this))return this.multiply(e);if(!r)return S.unsafe(this,e);{let{k1neg:t,k1:i,k2neg:n,k2:s}=v(e),{p1:a,p2:o}=function(e,t,r,i){let n=t,s=e.ZERO,a=e.ZERO;for(;r>yX||i>yX;)r&y0&&(s=s.add(n)),i&y0&&(a=a.add(n)),n=n.double(),r>>=y0,i>>=y0;return{p1:s,p2:a}}(I,this,i,s);return E(r.beta,a,o,t,n)}}multiplyAndAddUnsafe(e,t,r){let i=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return i.is0()?void 0:i}toAffine(e){return b(this,e)}isTorsionFree(){let{isTorsionFree:e}=t;return a===gw||(e?e(I,this):S.unsafe(this,o).is0())}clearCofactor(){let{clearCofactor:e}=t;return a===gw?this:e?e(I,this):this.multiplyUnsafe(a)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}toBytes(e=!0){return yy(e,"isCompressed"),this.assertValidity(),u(I,this,e)}toHex(e=!0){return pP(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return y2(I,e)}static msm(e,t){return function(e,t,r,i){(function(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}(i,t);let n=r.length,s=i.length;if(n!==s)throw Error("arrays of points and scalars must have equal length");let a=e.ZERO,o=yS(BigInt(n)),l=1;o>12?l=o-3:o>4?l=o-2:o>0&&(l=2);let c=yk(l),d=Array(Number(c)+1).fill(a),u=Math.floor((t.BITS-1)/l)*l,h=a;for(let e=u;e>=0;e-=l){d.fill(a);for(let t=0;t<s;t++){let n=Number(i[t]>>BigInt(e)&c);d[n]=d[n].add(r[t])}let t=a;for(let e=d.length-1,r=a;e>0;e--)r=r.add(d[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<l;e++)h=h.double()}return h}(I,n,e,t)}static fromPrivateKey(e){return I.BASE.multiply(gE(n,e))}}I.BASE=new I(s.Gx,s.Gy,i.ONE),I.ZERO=new I(i.ZERO,i.ONE,i.ZERO),I.Fp=i,I.Fn=n;let A=n.BITS,S=new ge(I,t.endo?Math.ceil(A/2):A);return I.BASE.precompute(8),I}(r,i),n,s);return t=a.Point,Object.assign({},a,{ProjectivePoint:t,CURVE:Object.assign({},e,yG(t.Fn.ORDER,t.Fn.BITS))})})({...e,hash:t});return{...r(t),create:r}}let gk={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},gT={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},gC={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},gx=yZ(gk.p),gP=yZ(gT.p),gO=yZ(gC.p),gR=gS({...gk,Fp:gx,lowS:!1},fo);gS({...gT,Fp:gP,lowS:!1},fc),gS({...gC,Fp:gO,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},fl);let gN="base10",gM="base16",gU="base64pad",gD="base64url",gL="utf8";function gj(){let e=pj(32);return(0,u0.toString)(e,gM)}function gW(e){let t=fo((0,u1.fromString)(e,gM));return(0,u0.toString)(t,gM)}function gB(e){let t=fo((0,u1.fromString)(e,gL));return(0,u0.toString)(t,gM)}function gF(e){return(0,u1.fromString)(`${e}`,gN)}function gq(e){return Number((0,u0.toString)(e,gN))}function gH(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function gz(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4;return t+"=".repeat(r)}function g$(e){if(2===gq(e.type))return(0,u0.toString)((0,u2.concat)([e.type,e.sealed]),gU);if(1===gq(e.type)){if(typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,u0.toString)((0,u2.concat)([e.type,e.senderPublicKey,e.iv,e.sealed]),gU)}return(0,u0.toString)((0,u2.concat)([e.type,e.iv,e.sealed]),gU)}function gK(e){let t=(e.encoding||gU)===gD?gz(e.encoded):e.encoded,r=(0,u1.fromString)(t,gU),i=r.slice(0,1);if(1===gq(i)){let e=r.slice(1,33),t=r.slice(33,45);return{type:i,sealed:r.slice(45),iv:t,senderPublicKey:e}}if(2===gq(i))return{type:i,sealed:r.slice(1),iv:pj(12)};let n=r.slice(1,13);return{type:i,sealed:r.slice(13),iv:n}}function gV(e){let t=e?.type||0;if(1===t){if(typeof e?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function gJ(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function gG(e){return e?.relay||{protocol:"irn"}}function gZ(e){let t=u5.RELAY_JSONRPC[e];if(typeof t>"u")throw Error(`Relay Protocol not supported: ${e}`);return t}var gY=Object.defineProperty,gQ=Object.defineProperties,gX=Object.getOwnPropertyDescriptors,g0=Object.getOwnPropertySymbols,g1=Object.prototype.hasOwnProperty,g2=Object.prototype.propertyIsEnumerable,g5=(e,t,r)=>t in e?gY(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g3=(e,t)=>{for(var r in t||(t={}))g1.call(t,r)&&g5(e,r,t[r]);if(g0)for(var r of g0(t))g2.call(t,r)&&g5(e,r,t[r]);return e};function g8(e){var t;if(!e.includes("wc:")){let t=h3(e);null!=t&&t.includes("wc:")&&(e=t)}let r=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,n=e.substring(0,r),s=e.substring(r+1,i).split("@"),a=Object.fromEntries(new URLSearchParams("u">typeof i?e.substring(i):"").entries()),o="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:n,topic:(t=s[0]).startsWith("//")?t.substring(2):t,version:parseInt(s[1],10),symKey:a.symKey,relay:function(e,t="-"){let r={},i="relay"+t;return Object.keys(e).forEach(t=>{if(t.startsWith(i)){let n=t.replace(i,""),s=e[t];r[n]=s}}),r}(a),methods:o,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function g4(e){let t=new URLSearchParams;return Object.entries(g3(g3(gQ(g3({},function(e,t="-"){let r={};return Object.keys(e).forEach(i=>{e[i]&&(r["relay"+t+i]=e[i])}),r}(e.relay)),gX({symKey:e.symKey})),e.expiryTimestamp&&{expiryTimestamp:e.expiryTimestamp.toString()}),e.methods&&{methods:e.methods.join(",")})).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),`${e.protocol}:${e.topic}@${e.version}?${t}`}function g6(e,t,r){return`${e}?wc_ev=${r}&topic=${t}`}var g9=Object.defineProperty,g7=Object.defineProperties,me=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,mr=Object.prototype.hasOwnProperty,mi=Object.prototype.propertyIsEnumerable,mn=(e,t,r)=>t in e?g9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ms=(e,t)=>{for(var r in t||(t={}))mr.call(t,r)&&mn(e,r,t[r]);if(mt)for(var r of mt(t))mi.call(t,r)&&mn(e,r,t[r]);return e},ma=(e,t)=>g7(e,me(t));function mo(e){let t=[];return e.forEach(e=>{let[r,i]=e.split(":");t.push(`${r}:${i}`)}),t}function ml(e){return e.includes(":")}function mc(e){return ml(e)?e.split(":")[0]:e}function md(e){var t,r,i;let n={};if(!mm(e))return n;for(let[s,a]of Object.entries(e)){let e=ml(s)?[s]:a.chains,o=a.methods||[],l=a.events||[],c=mc(s);n[c]=ma(ms({},n[c]),{chains:hQ(e,null==(t=n[c])?void 0:t.chains),methods:hQ(o,null==(r=n[c])?void 0:r.methods),events:hQ(l,null==(i=n[c])?void 0:i.events)})}return n}function mu(e,t){var r;let i,n=(r=t=t.map(e=>e.replace("did:pkh:","")),i={},r?.forEach(e=>{var t;let[r,n]=e.split(":");i[r]||(i[r]={accounts:[],chains:[],events:[],methods:[]}),i[r].accounts.push(e),null==(t=i[r].chains)||t.push(`${r}:${n}`)}),i);for(let[t,r]of Object.entries(n))r.methods?r.methods=hQ(r.methods,e):r.methods=e,r.events=["chainChanged","accountsChanged"];return n}let mh={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},mp={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function mf(e,t){let{message:r,code:i}=mp[e];return{message:t?`${r} ${t}`:r,code:i}}function my(e,t){let{message:r,code:i}=mh[e];return{message:t?`${r} ${t}`:r,code:i}}function mg(e,t){return!!Array.isArray(e)&&(!("u">typeof t)||!e.length||e.every(t))}function mm(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function mw(e){return typeof e>"u"}function mv(e,t){return!!(t&&mw(e))||"string"==typeof e&&!!e.trim().length}function mb(e,t){return!!(t&&mw(e))||"number"==typeof e&&!isNaN(e)}function m_(e){return!!(mv(e,!1)&&e.includes(":"))&&2===e.split(":").length}function mE(e){let t=!0;return mg(e)?e.length&&(t=e.every(e=>mv(e,!1))):t=!1,t}function mI(e,t){let r=null;return Object.values(e).forEach(e=>{var i;let n;if(r)return;let s=(i=`${t}, namespace`,n=null,mE(e?.methods)?mE(e?.events)||(n=my("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):n=my("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),n);s&&(r=s)}),r}function mA(e,t){let r=null;if(e&&mm(e)){let i,n=mI(e,t);n&&(r=n);let s=(i=null,Object.values(e).forEach(e=>{var r,n;let s;if(i)return;let a=(r=e?.accounts,n=`${t} namespace`,s=null,mg(r)?r.forEach(e=>{s||function(e){if(mv(e,!1)&&e.includes(":")){let t=e.split(":");if(3===t.length){let e=t[0]+":"+t[1];return!!t[2]&&m_(e)}}return!1}(e)||(s=my("UNSUPPORTED_ACCOUNTS",`${n}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):s=my("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s);a&&(i=a)}),i);s&&(r=s)}else r=mf("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function mS(e){return mv(e.protocol,!0)}function mk(e){return"u">typeof e}function mT(e,t){let r;return!(!m_(t)||!(r=[],Object.values(e).forEach(e=>{r.push(...mo(e.accounts))}),r).includes(t))}function mC(e,t,r){var i,n;let s,a,o=null,l=(s={},Object.keys(i=e).forEach(e=>{var t;e.includes(":")?s[e]=i[e]:null==(t=i[e].chains)||t.forEach(t=>{s[t]={methods:i[e].methods,events:i[e].events}})}),s),c=(a={},Object.keys(n=t).forEach(e=>{if(e.includes(":"))a[e]=n[e];else{let t=mo(n[e].accounts);t?.forEach(t=>{a[t]={accounts:n[e].accounts.filter(e=>e.includes(`${t}:`)),methods:n[e].methods,events:n[e].events}})}}),a),d=Object.keys(l),u=Object.keys(c),h=mx(Object.keys(e)),p=mx(Object.keys(t)),f=h.filter(e=>!p.includes(e));return f.length&&(o=mf("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(t).toString()}`)),hq(d,u)||(o=mf("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${u.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(":")||o)return;let i=mo(t[e].accounts);i.includes(e)||(o=mf("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${i.toString()}`))}),d.forEach(e=>{o||(hq(l[e].methods,c[e].methods)?hq(l[e].events,c[e].events)||(o=mf("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${e}`)):o=mf("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${e}`))}),o}function mx(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function mP(){let e=hj();return new Promise(t=>{switch(e){case hM:t(hL()&&navigator?.onLine);break;case hR:t(mO());break;default:t(!0)}})}async function mO(){if(hD()&&null!=e.g&&e.g.NetInfo){let t=await (null==e.g?void 0:e.g.NetInfo.fetch());return t?.isConnected}return!0}let mR={};class mN{static get(e){return mR[e]}static set(e,t){mR[e]=t}static delete(e){delete mR[e]}}function mM(e){return new Uint8Array(e.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function mU({logger:e,name:t}){let r="string"==typeof e?hv({opts:{level:e,name:t}}).logger:e;return r.level="string"==typeof e?e:e.level,r}var mD=e.i(710600),mL=e.i(404359);e.i(736653);var mj=e.i(862570),mW=Object.defineProperty,mB=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mW(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class mF extends mj.IEvents{constructor(e){super(),this.opts=e,mB(this,"protocol","wc"),mB(this,"version",2)}}var mq=Object.defineProperty;class mH extends mj.IEvents{constructor(e,t){super(),this.core=e,this.logger=t,((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mq(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"records",new Map)}}class mz{constructor(e,t){this.logger=e,this.core=t}}class m$ extends mj.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class mK extends mj.IEvents{constructor(e){super()}}class mV{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}}class mJ extends mj.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class mG extends mj.IEvents{constructor(e,t){super(),this.core=e,this.logger=t}}class mZ{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}}class mY{constructor(e,t){this.projectId=e,this.logger=t}}class mQ{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}}var mX=Object.defineProperty,m0=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mX(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};dS.default;class m1{constructor(e){this.opts=e,m0(this,"protocol","wc"),m0(this,"version",2)}}dS.EventEmitter;class m2{constructor(e){this.client=e}}var m5=e.i(409482);e.i(660075);var m3=e.i(669941),m8=e.i(139434),m4=e.i(327026);let m6="core",m9=`wc@2:${m6}:`,m7={database:":memory:"},we="client_ed25519_seed",wt=dT.ONE_DAY,wr=dT.SIX_HOURS,wi="wss://relay.walletconnect.org",wn="relayer_message",ws="relayer_message_ack",wa="relayer_connection_stalled",wo="relayer_publish",wl="payload",wc="connect",wd="disconnect",wu="error",wh="2.22.4",wp="link_mode",wf="relay",wy="inbound",wg="WALLETCONNECT_LINK_MODE_APPS",wm="subscription_created",ww="subscription_deleted",wv=(dT.THIRTY_DAYS,dT.FIVE_SECONDS,dT.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:dT.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:dT.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:dT.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:0},res:{ttl:dT.ONE_DAY,prompt:!1,tag:0}}}),wb="pairing_create",w_="pairing_delete",wE="history_created",wI="history_updated",wA="history_deleted",wS="expirer_created",wk="expirer_deleted",wT="expirer_expired",wC=(dT.ONE_DAY,"https://verify.walletconnect.org"),wx=`${wC}/v3`,wP=["https://verify.walletconnect.com",wC],wO="malformed_pairing_uri",wR="session_approve_started";var wN=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(255!==r[a])throw TypeError(s+" is ambiguous");r[a]=n}var o=e.length,l=e.charAt(0),c=Math.log(o)/Math.log(256),d=Math.log(256)/Math.log(o);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,n=0;e[t]===l;)i++,t++;for(var s=(e.length-t)*c+1>>>0,a=new Uint8Array(s);e[t];){var d=r[e.charCodeAt(t)];if(255===d)return;for(var u=0,h=s-1;(0!==d||u<n)&&-1!==h;h--,u++)d+=o*a[h]>>>0,a[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw Error("Non-zero carry");n=u,t++}if(" "!==e[t]){for(var p=s-n;p!==s&&0===a[p];)p++;for(var f=new Uint8Array(i+(s-p)),y=i;p!==s;)f[y++]=a[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,n=0,s=t.length;n!==s&&0===t[n];)n++,r++;for(var a=(s-n)*d+1>>>0,c=new Uint8Array(a);n!==s;){for(var u=t[n],h=0,p=a-1;(0!==u||h<i)&&-1!==p;p--,h++)u+=256*c[p]>>>0,c[p]=u%o>>>0,u=u/o>>>0;if(0!==u)throw Error("Non-zero carry");i=h,n++}for(var f=a-i;f!==a&&0===c[f];)f++;for(var y=l.repeat(r);f<a;++f)y+=e.charAt(c[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};let wM=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")};class wU{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class wD{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return wj(this,e)}}class wL{constructor(e){this.decoders=e}or(e){return wj(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let wj=(e,t)=>new wL({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class wW{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new wU(e,t,r),this.decoder=new wD(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let wB=({name:e,prefix:t,encode:r,decode:i})=>new wW(e,t,r,i),wF=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:n}=wN(r,t);return wB({prefix:e,name:t,encode:i,decode:e=>wM(n(e))})},wq=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>wB({prefix:t,name:e,encode:e=>((e,t,r)=>{let i="="===t[t.length-1],n=(1<<r)-1,s="",a=0,o=0;for(let i=0;i<e.length;++i)for(o=o<<8|e[i],a+=8;a>r;)a-=r,s+=t[n&o>>a];if(a&&(s+=t[n&o<<r-a]),i)for(;s.length*r&7;)s+="=";return s})(e,i,r),decode:t=>((e,t,r,i)=>{let n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let a=new Uint8Array(s*r/8|0),o=0,l=0,c=0;for(let t=0;t<s;++t){let s=n[e[t]];if(void 0===s)throw SyntaxError(`Non-${i} character`);l=l<<r|s,(o+=r)>=8&&(o-=8,a[c++]=255&l>>o)}if(o>=r||255&l<<8-o)throw SyntaxError("Unexpected end of data");return a})(t,i,r,e)});var wH=Object.freeze({__proto__:null,identity:wB({prefix:"\0",name:"identity",encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)})}),wz=Object.freeze({__proto__:null,base2:wq({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),w$=Object.freeze({__proto__:null,base8:wq({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),wK=Object.freeze({__proto__:null,base10:wF({prefix:"9",name:"base10",alphabet:"0123456789"})}),wV=Object.freeze({__proto__:null,base16:wq({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:wq({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),wJ=Object.freeze({__proto__:null,base32:wq({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:wq({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:wq({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:wq({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:wq({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:wq({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:wq({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:wq({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:wq({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),wG=Object.freeze({__proto__:null,base36:wF({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:wF({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),wZ=Object.freeze({__proto__:null,base58btc:wF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:wF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),wY=Object.freeze({__proto__:null,base64:wq({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:wq({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:wq({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:wq({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let wQ=Array.from(""),wX=wQ.reduce((e,t,r)=>(e[r]=t,e),[]),w0=wQ.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);var w1=Object.freeze({__proto__:null,base256emoji:wB({prefix:"",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=wX[t],"")},decode:function(e){let t=[];for(let r of e){let e=w0[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}})});function w2(e,t,r){t=t||[],r=r||0;for(var i=r;e>=0x80000000;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,w2.bytes=r-i+1,t}var w5=function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10};let w3=(e,t,r=0)=>(w2(e,t,r),t),w8=(e,t)=>{let r=t.byteLength,i=w5(e),n=i+w5(r),s=new Uint8Array(n+r);return w3(e,s,0),w3(r,s,i),s.set(t,n),new w4(e,r,t,s)};class w4{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let w6=({name:e,code:t,encode:r})=>new w9(e,t,r);class w9{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?w8(this.code,t):t.then(e=>w8(this.code,e))}throw Error("Unknown type, must be binary type")}}let w7=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t));var ve=Object.freeze({__proto__:null,sha256:w6({name:"sha2-256",code:18,encode:w7("SHA-256")}),sha512:w6({name:"sha2-512",code:19,encode:w7("SHA-512")})}),vt=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:wM,digest:e=>w8(0,wM(e))}});new TextEncoder,new TextDecoder;let vr={...wH,...wz,...w$,...wK,...wV,...wJ,...wG,...wZ,...wY,...w1};function vi(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function vn(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...ve,...vt});let vs=vn("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),va=vn("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{let t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?vi(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),vo={utf8:vs,"utf-8":vs,hex:vr.base16,latin1:va,ascii:va,binary:va,...vr};var vl=Object.defineProperty,vc=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vl(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vd{constructor(e,t){this.core=e,this.logger=t,vc(this,"keychain",new Map),vc(this,"name","keychain"),vc(this,"version","0.3"),vc(this,"initialized",!1),vc(this,"storagePrefix",m9),vc(this,"init",async()=>{if(!this.initialized){let e=await this.getKeyChain();"u">typeof e&&(this.keychain=e),this.initialized=!0}}),vc(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),vc(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),vc(this,"get",e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>"u"){let{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}),vc(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=hw(t,this.name)}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,hH(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?hz(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var vu=Object.defineProperty,vh=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vu(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vp{constructor(e,t,r){this.core=e,this.logger=t,vh(this,"name","crypto"),vh(this,"keychain"),vh(this,"randomSessionIdentifier",gj()),vh(this,"initialized",!1),vh(this,"clientId"),vh(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),vh(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),vh(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let e=await this.getClientSeed(),t=uX.generateKeyPair(e),r=uX.encodeIss(t.publicKey);return this.clientId=r,r}),vh(this,"generateKeyPair",()=>{let e,t;this.isInitialized();let r=(e=gh.utils.randomPrivateKey(),t=gh.getPublicKey(e),{privateKey:(0,u0.toString)(e,gM),publicKey:(0,u0.toString)(t,gM)});return this.setPrivateKey(r.publicKey,r.privateKey)}),vh(this,"signJWT",async e=>{this.isInitialized();let t=await this.getClientSeed(),r=uX.generateKeyPair(t),i=this.randomSessionIdentifier;return await uX.signJWT(i,e,wt,r)}),vh(this,"generateSharedKey",(e,t,r)=>{var i,n,s;let a,o;this.isInitialized();let l=(i=this.getPrivateKey(e),a=gh.getSharedSecret((0,u1.fromString)(i,gM),(0,u1.fromString)(t,gM)),n=void 0,o=function(e,t,r,i=32){pm(e),py(i);let n=e.outputLen;if(i>255*n)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(i/n);void 0===r&&(r=yh);let a=new Uint8Array(s*n),o=yd.create(e,t),l=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<s;e++)yu[0]=e+1,l.update(0===e?yh:c).update(r).update(yu).digestInto(c),a.set(c,n*e),o._cloneInto(l);return o.destroy(),l.destroy(),p_(c,yu),a.slice(0,i)}(fo,(s=void 0,pm(fo),void 0===s&&(s=new Uint8Array(fo.outputLen)),yd(fo,pM(s),pM(a))),n,32),(0,u0.toString)(o,gM));return this.setSymKey(l,r)}),vh(this,"setSymKey",async(e,t)=>{this.isInitialized();let r=t||gW(e);return await this.keychain.set(r,e),r}),vh(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),vh(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),vh(this,"encode",async(e,t,r)=>{this.isInitialized();let i=gV(r),n=(0,u4.safeJsonStringify)(t);if(2===i.type){var s;let e,t,i;return s=r?.encoding,e=gF(2),t=pj(12),i=g$({type:e,sealed:(0,u1.fromString)(n,gL),iv:t}),s===gD?gH(i):i}if(gJ(i)){let t=i.senderPublicKey,r=i.receiverPublicKey;e=await this.generateSharedKey(t,r)}let a=this.getSymKey(e),{type:o,senderPublicKey:l}=i;return function(e){let t=gF("u">typeof e.type?e.type:0);if(1===gq(t)&&typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let r="u">typeof e.senderPublicKey?(0,u1.fromString)(e.senderPublicKey,gM):void 0,i="u">typeof e.iv?(0,u1.fromString)(e.iv,gM):pj(12),n=g$({type:t,sealed:yl((0,u1.fromString)(e.symKey,gM),i).encrypt((0,u1.fromString)(e.message,gL)),iv:i,senderPublicKey:r});return e.encoding===gD?gH(n):n}({type:o,symKey:a,message:n,senderPublicKey:l,encoding:r?.encoding})}),vh(this,"decode",async(e,t,r)=>{let i;this.isInitialized();let n=gV({type:gq((i=gK({encoded:t,encoding:r?.encoding})).type),senderPublicKey:"u">typeof i.senderPublicKey?(0,u0.toString)(i.senderPublicKey,gM):void 0,receiverPublicKey:r?.receiverPublicKey});if(2===n.type){let e=function(e,t){let{sealed:r}=gK({encoded:e,encoding:t});return(0,u0.toString)(r,gL)}(t,r?.encoding);return(0,u4.safeJsonParse)(e)}if(gJ(n)){let t=n.receiverPublicKey,r=n.senderPublicKey;e=await this.generateSharedKey(t,r)}try{let i=this.getSymKey(e),n=function(e){let t=(0,u1.fromString)(e.symKey,gM),{sealed:r,iv:i}=gK({encoded:e.encoded,encoding:e.encoding}),n=yl(t,i).decrypt(r);if(null===n)throw Error("Failed to decrypt");return(0,u0.toString)(n,gL)}({symKey:i,encoded:t,encoding:r?.encoding});return(0,u4.safeJsonParse)(n)}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),vh(this,"getPayloadType",(e,t=gU)=>gq(gK({encoded:e,encoding:t}).type)),vh(this,"getPayloadSenderPublicKey",(e,t=gU)=>{let r=gK({encoded:e,encoding:t});return r.senderPublicKey?(0,u0.toString)(r.senderPublicKey,gM):void 0}),this.core=e,this.logger=hw(t,this.name),this.keychain=r||new vd(this.core,this.logger)}get context(){return hm(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(we)}catch{e=gj(),await this.keychain.set(we,e)}return function(e,t="utf8"){let r=vo[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?vi(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var vf=Object.defineProperty,vy=Object.defineProperties,vg=Object.getOwnPropertyDescriptors,vm=Object.getOwnPropertySymbols,vw=Object.prototype.hasOwnProperty,vv=Object.prototype.propertyIsEnumerable,vb=(e,t,r)=>t in e?vf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v_=(e,t,r)=>vb(e,"symbol"!=typeof t?t+"":t,r);class vE extends mz{constructor(e,t){super(e,t),this.logger=e,this.core=t,v_(this,"messages",new Map),v_(this,"messagesWithoutClientAck",new Map),v_(this,"name","messages"),v_(this,"version","0.3"),v_(this,"initialized",!1),v_(this,"storagePrefix",m9),v_(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let e=await this.getRelayerMessages();"u">typeof e&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();"u">typeof t&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),v_(this,"set",async(e,t,r)=>{this.isInitialized();let i=gB(t),n=this.messages.get(e);if(typeof n>"u"&&(n={}),"u">typeof n[i])return i;if(n[i]=t,this.messages.set(e,n),r===wy){let r=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,vy(((e,t)=>{for(var r in t||(t={}))vw.call(t,r)&&vb(e,r,t[r]);if(vm)for(var r of vm(t))vv.call(t,r)&&vb(e,r,t[r]);return e})({},r),vg({[i]:t})))}return await this.persist(),i}),v_(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),v_(this,"getWithoutAck",e=>{this.isInitialized();let t={};for(let r of e){let e=this.messagesWithoutClientAck.get(r)||{};t[r]=Object.values(e)}return t}),v_(this,"has",(e,t)=>(this.isInitialized(),"u">typeof this.get(e)[gB(t)])),v_(this,"ack",async(e,t)=>{this.isInitialized();let r=this.messagesWithoutClientAck.get(e);if(typeof r>"u")return;let i=gB(t);delete r[i],0===Object.keys(r).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,r),await this.persist()}),v_(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=hw(e,this.name),this.core=t}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,hH(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,hH(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?hz(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof e?hz(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var vI=Object.defineProperty,vA=Object.defineProperties,vS=Object.getOwnPropertyDescriptors,vk=Object.getOwnPropertySymbols,vT=Object.prototype.hasOwnProperty,vC=Object.prototype.propertyIsEnumerable,vx=(e,t,r)=>t in e?vI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vP=(e,t)=>{for(var r in t||(t={}))vT.call(t,r)&&vx(e,r,t[r]);if(vk)for(var r of vk(t))vC.call(t,r)&&vx(e,r,t[r]);return e},vO=(e,t,r)=>vx(e,"symbol"!=typeof t?t+"":t,r);class vR extends m${constructor(e,t){super(e,t),this.relayer=e,this.logger=t,vO(this,"events",new dS.EventEmitter),vO(this,"name","publisher"),vO(this,"queue",new Map),vO(this,"publishTimeout",(0,dT.toMiliseconds)(dT.ONE_MINUTE)),vO(this,"initialPublishTimeout",(0,dT.toMiliseconds)(15*dT.ONE_SECOND)),vO(this,"needsTransportRestart",!1),vO(this,"publish",async(e,t,r)=>{var i,n,s,a,o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}});let l=r?.ttl||wr,c=r?.prompt||!1,d=r?.tag||0,u=r?.id||(0,m3.getBigIntRpcId)().toString(),h=gZ(gG().protocol),p={id:u,method:r?.publishMethod||h.publish,params:vP({topic:e,message:t,ttl:l,prompt:c,tag:d,attestation:r?.attestation},r?.tvf)},f=`Failed to publish payload, please try again. id:${u} tag:${d}`;try{mw(null==(i=p.params)?void 0:i.prompt)&&(null==(n=p.params)||delete n.prompt),mw(null==(s=p.params)?void 0:s.tag)&&(null==(a=p.params)||delete a.tag);let o=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=p.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(wo,t),e())};this.relayer.events.on(wo,t);let i=hK(new Promise((e,t)=>{this.rpcPublish(p,r).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${d}`);try{await i,this.events.removeListener(wo,t)}catch(e){this.queue.set(u,{request:p,opts:r,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:e,message:t,opts:r}}),await hK(o,this.publishTimeout,f)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(o=r?.internal)&&o.throwOnFailedPublish)throw e}finally{this.queue.delete(u)}}),vO(this,"publishCustom",async e=>{var t,r,i,n,s;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:e});let{payload:a,opts:o={}}=e,{attestation:l,tvf:c,publishMethod:d,prompt:u,tag:h,ttl:p=dT.FIVE_MINUTES}=o,f=o.id||(0,m3.getBigIntRpcId)().toString(),y=gZ(gG().protocol),g=d||y.publish,m={id:f,method:g,params:vP(vA(vP({},a),vS({ttl:p,prompt:u,tag:h,attestation:l})),c)},w=`Failed to publish custom payload, please try again. id:${f} tag:${h}`;try{mw(null==(t=m.params)?void 0:t.prompt)&&(null==(r=m.params)||delete r.prompt),mw(null==(i=m.params)?void 0:i.tag)&&(null==(n=m.params)||delete n.tag);let e=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=m.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(wo,t),e())};this.relayer.events.on(wo,t);let r=hK(new Promise((e,t)=>{this.rpcPublish(m,o).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${g} id:${f} tag:${h}`);try{await r,this.events.removeListener(wo,t)}catch(e){this.queue.set(f,{request:m,opts:o,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:f,payload:a,opts:o}}),await hK(e,this.publishTimeout,w)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(s=o?.internal)&&s.throwOnFailedPublish)throw e}finally{this.queue.delete(f)}}),vO(this,"on",(e,t)=>{this.events.on(e,t)}),vO(this,"once",(e,t)=>{this.events.once(e,t)}),vO(this,"off",(e,t)=>{this.events.off(e,t)}),vO(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=hw(t,this.name),this.registerEventListeners()}get context(){return hm(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=await this.relayer.request(e);return this.relayer.events.emit(wo,vP(vP({},e),t)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var r;let i=e.attempt+1;this.queue.set(t,vA(vP({},e),vS({attempt:i}))),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${null==(r=e.request.params)?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(wa);return}this.checkQueue()}),this.relayer.on(ws,e=>{this.removeRequestFromQueue(e.id.toString())})}}var vN=Object.defineProperty,vM=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vN(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vU{constructor(){vM(this,"map",new Map),vM(this,"set",(e,t)=>{let r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),vM(this,"get",e=>this.map.get(e)||[]),vM(this,"exists",(e,t)=>this.get(e).includes(t)),vM(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,t))return;let i=r.filter(e=>e!==t);i.length?this.map.set(e,i):this.map.delete(e)}),vM(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var vD=Object.defineProperty,vL=Object.defineProperties,vj=Object.getOwnPropertyDescriptors,vW=Object.getOwnPropertySymbols,vB=Object.prototype.hasOwnProperty,vF=Object.prototype.propertyIsEnumerable,vq=(e,t,r)=>t in e?vD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vH=(e,t)=>{for(var r in t||(t={}))vB.call(t,r)&&vq(e,r,t[r]);if(vW)for(var r of vW(t))vF.call(t,r)&&vq(e,r,t[r]);return e},vz=(e,t,r)=>vq(e,"symbol"!=typeof t?t+"":t,r);class v$ extends mJ{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,vz(this,"subscriptions",new Map),vz(this,"topicMap",new vU),vz(this,"events",new dS.EventEmitter),vz(this,"name","subscription"),vz(this,"version","0.3"),vz(this,"pending",new Map),vz(this,"cached",[]),vz(this,"initialized",!1),vz(this,"storagePrefix",m9),vz(this,"subscribeTimeout",(0,dT.toMiliseconds)(dT.ONE_MINUTE)),vz(this,"initialSubscribeTimeout",(0,dT.toMiliseconds)(15*dT.ONE_SECOND)),vz(this,"clientId"),vz(this,"batchSubscribeTopicsLimit",500),vz(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),vz(this,"subscribe",async(e,t)=>{var r;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{let i=gG(t),n={topic:e,relay:i,transportType:t?.transportType};null!=(r=t?.internal)&&r.skipSubscribe||this.pending.set(e,n);let s=await this.rpcSubscribe(e,i,t);return"string"==typeof s&&(this.onSubscribe(s,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),s}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}),vz(this,"unsubscribe",async(e,t)=>{this.isInitialized(),"u">typeof t?.id?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),vz(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),vz(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),vz(this,"on",(e,t)=>{this.events.on(e,t)}),vz(this,"once",(e,t)=>{this.events.once(e,t)}),vz(this,"off",(e,t)=>{this.events.off(e,t)}),vz(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),vz(this,"start",async()=>{await this.onConnect()}),vz(this,"stop",async()=>{await this.onDisconnect()}),vz(this,"restart",async()=>{await this.restore(),await this.onRestart()}),vz(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),vz(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(wm,async e=>{this.logger.info(`Emitting ${wm}`),this.logger.debug({type:"event",event:wm,data:e}),await this.persist()}),this.events.on(ww,async e=>{this.logger.info(`Emitting ${ww}`),this.logger.debug({type:"event",event:ww,data:e}),await this.persist()})}),this.relayer=e,this.logger=hw(t,this.name),this.clientId=""}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let r=this.topicMap.get(e);await Promise.all(r.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{let i=gG(r);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);let n=my("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}async rpcSubscribe(e,t,r){var i,n;let s=await this.getSubscriptionId(e);if(null!=(i=r?.internal)&&i.skipSubscribe)return s;r&&r?.transportType!==wf||await this.restartToComplete({topic:e,id:e,relay:t});let a={method:gZ(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let o=null==(n=r?.internal)?void 0:n.throwOnFailedPublish;try{if(r?.transportType===wp)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(e=>this.logger.warn(e))},(0,dT.toMiliseconds)(dT.ONE_SECOND)),s;let t=new Promise(async t=>{let r=i=>{i.topic===e&&(this.events.removeListener(wm,r),t(i.id))};this.events.on(wm,r);try{let i=await hK(new Promise((e,t)=>{this.relayer.request(a).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(wm,r),t(i)}catch{}}),i=await hK(t,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!i&&o)throw Error(`Subscribing to ${e} failed, please try again`);return i?s:null}catch(e){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(wa),o)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t={method:gZ(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await hK(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(wa)}}async rpcBatchFetchMessages(e){let t;if(!e.length)return;let r={method:gZ(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{t=await await hK(new Promise((e,t)=>{this.relayer.request(r).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(wa)}return t}rpcUnsubscribe(e,t,r){let i={method:gZ(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,vL(vH({},t),vj({id:e}))),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,vH({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,vH({},t)),this.topicMap.set(t.topic,e),this.events.emit(wm,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(ww,vL(vH({},r),vj({reason:t})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit("subscription_resubscribed")}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(e=>{var t;return e.topic===(null==(t=this.subscriptions.get(e.id))?void 0:t.topic)})){let{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>vL(vH({},e),vj({id:await this.getSubscriptionId(e.topic)}))))))}async batchFetchMessages(e){var t;if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await (t=(0,dT.toMiliseconds)(dT.ONE_SECOND),new Promise(e=>setTimeout(e,t))),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}async restartToComplete(e){this.relayer.connected||this.relayer.connecting||(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return gB(e+await this.getClientId())}}var vK=Object.defineProperty,vV=Object.getOwnPropertySymbols,vJ=Object.prototype.hasOwnProperty,vG=Object.prototype.propertyIsEnumerable,vZ=(e,t,r)=>t in e?vK(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vY=(e,t)=>{for(var r in t||(t={}))vJ.call(t,r)&&vZ(e,r,t[r]);if(vV)for(var r of vV(t))vG.call(t,r)&&vZ(e,r,t[r]);return e},vQ=(e,t,r)=>vZ(e,"symbol"!=typeof t?t+"":t,r);class vX extends mK{constructor(t){var r;super(t),vQ(this,"protocol","wc"),vQ(this,"version",2),vQ(this,"core"),vQ(this,"logger"),vQ(this,"events",new dS.EventEmitter),vQ(this,"provider"),vQ(this,"messages"),vQ(this,"subscriber"),vQ(this,"publisher"),vQ(this,"name","relayer"),vQ(this,"transportExplicitlyClosed",!1),vQ(this,"initialized",!1),vQ(this,"connectionAttemptInProgress",!1),vQ(this,"relayUrl"),vQ(this,"projectId"),vQ(this,"packageName"),vQ(this,"bundleId"),vQ(this,"hasExperiencedNetworkDisruption",!1),vQ(this,"pingTimeout"),vQ(this,"heartBeatTimeout",(0,dT.toMiliseconds)(dT.THIRTY_SECONDS+dT.FIVE_SECONDS)),vQ(this,"reconnectTimeout"),vQ(this,"connectPromise"),vQ(this,"reconnectInProgress",!1),vQ(this,"requestsInFlight",[]),vQ(this,"connectTimeout",(0,dT.toMiliseconds)(15*dT.ONE_SECOND)),vQ(this,"request",async e=>{var t,r;this.logger.debug("Publishing Request Payload");let i=e.id||(0,m3.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");let n=`${i}:${(null==(r=e.params)?void 0:r.tag)||""}`;this.requestsInFlight.push(n);let s=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),s}catch(e){throw this.logger.debug(`Failed to Publish Request: ${i}`),e}}),vQ(this,"resetPingTimeout",()=>{hU()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,r,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(i=null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.terminate)||i.call(r)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),vQ(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),vQ(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),vQ(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),vQ(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit("relayer_error",e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),vQ(this,"registerProviderListeners",()=>{this.provider.on(wl,this.onPayloadHandler),this.provider.on(wc,this.onConnectHandler),this.provider.on(wd,this.onDisconnectHandler),this.provider.on(wu,this.onProviderErrorHandler)}),this.core=t.core,this.logger=mU({logger:null!=(r=t.logger)?r:"error",name:this.name}),this.messages=new vE(this.logger,t.core),this.subscriber=new v$(this,this.logger),this.publisher=new vR(this,this.logger),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||wi,hD()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="android"?this.packageName=hW():hD()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="ios"&&(this.bundleId=hW()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return hm(this.logger)}get connected(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===1}get connecting(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===0||void 0!==this.connectPromise}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:wf},"outbound")}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var r,i,n;this.isInitialized(),null!=t&&t.transportType&&t?.transportType!=="relay"||await this.toEstablishConnection();let s=typeof(null==(r=t?.internal)?void 0:r.throwOnFailedPublish)>"u"||(null==(i=t?.internal)?void 0:i.throwOnFailedPublish),a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"",o,l=t=>{t.topic===e&&(this.subscriber.off(wm,l),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(wm,l)}),new Promise(async(r,i)=>{a=await this.subscriber.subscribe(e,vY({internal:{throwOnFailedPublish:s}},t)).catch(e=>{s&&i(e)})||a,r()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await hK(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await mP())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);for(let e of(this.logger.debug(`Batch of ${t.length} message events sorted`),t))try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,"Error while processing batch message event: "+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:r}=e;if(!t.sessionExists){let e=hG(dT.FIVE_MINUTES);await this.core.pairing.pairings.set(r,{topic:r,expiry:e,relay:{protocol:"irn"},active:!1})}this.events.emit(wn,e),await this.recordMessageEvent(e,wy)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let r=()=>{t(Error("Connection interrupted while trying to connect"))};this.provider.once(wd,r),await hK(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(wd,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,r)=>{let i=()=>{t(Error("Connection interrupted while trying to subscribe"))};this.provider.once(wd,i),await this.subscriber.start().then(e).catch(r).finally(()=>{this.provider.off(wd,i)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop(),this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,dT.toMiliseconds)(+t))),t++}}startPingTimeout(){var e,t,r,i,n;if(hU())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new m5.JsonRpcProvider(new m4.default(function({protocol:e,version:t,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a,bundleId:o,packageName:l}){var c,d;let u,h=r.split("?"),p=hF(e,t,i),f=(c=h[1]||"",d={auth:n,ua:p,projectId:s,useOnCloseEvent:a||void 0,packageName:l||void 0,bundleId:o||void 0},u=new URLSearchParams(c),Object.entries(d).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,t])=>{null!=t&&u.set(e,String(t))}),u.toString());return h[0]+"?"+f}({sdkVersion:wh,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:r,message:i}=e;await this.messages.set(r,i,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:r}=e;if(!r||0===r.length)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let i=this.messages.has(t,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,m8.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;let t=e.params,{topic:r,message:i,publishedAt:n,attestation:s}=t.data,a={topic:r,message:i,publishedAt:n,transportType:wf,attestation:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(vY({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else(0,m8.isJsonRpcResponse)(e)&&this.events.emit(ws,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,wy),this.events.emit(wn,e))}async acknowledgePayload(e){let t=(0,m3.formatJsonRpcResult)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(wl,this.onPayloadHandler),this.provider.off(wc,this.onConnectHandler),this.provider.off(wd,this.onDisconnectHandler),this.provider.off(wu,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await mP();(function(t){var r,i;switch(hj()){case hM:r=t,!hD()&&hL()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)));break;case hR:i=t,hD()&&null!=e.g&&e.g.NetInfo&&e.g?.NetInfo.addEventListener(e=>i(e?.isConnected))}})(async e=>{t!==e&&(t=e,e?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,async()=>{var e;if(!this.transportExplicitlyClosed&&!this.connected&&(!(hL()&&(0,dC.getDocument)())||(null==(e=(0,dC.getDocument)())?void 0:e.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,dT.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function v0(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function v1(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let v2="[object Arguments]",v5="[object Object]";function v3(){}function v8(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}var v4=Object.defineProperty,v6=Object.getOwnPropertySymbols,v9=Object.prototype.hasOwnProperty,v7=Object.prototype.propertyIsEnumerable,be=(e,t,r)=>t in e?v4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bt=(e,t)=>{for(var r in t||(t={}))v9.call(t,r)&&be(e,r,t[r]);if(v6)for(var r of v6(t))v7.call(t,r)&&be(e,r,t[r]);return e},br=(e,t,r)=>be(e,"symbol"!=typeof t?t+"":t,r);class bi extends mV{constructor(e,t,r,i=m9,n){super(e,t,r,i),this.core=e,this.logger=t,this.name=r,br(this,"map",new Map),br(this,"version","0.3"),br(this,"cached",[]),br(this,"initialized",!1),br(this,"getKey"),br(this,"storagePrefix",m9),br(this,"recentlyDeleted",[]),br(this,"recentlyDeletedLimit",200),br(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{var t;this.getKey&&null!==e&&!mw(e)?this.map.set(this.getKey(e),e):(null==(t=e?.proposer)?void 0:t.publicKey)?this.map.set(e.id,e):e?.topic&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),br(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),br(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),br(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(r=>{var i;return i=t[r],function e(t,r,i,n,s,a,o){let l=o(t,r,i,n,s,a);if(void 0!==l)return l;if(typeof t==typeof r)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return t===r;case"number":return t===r||Object.is(t,r)}return function t(r,i,n,s){if(Object.is(r,i))return!0;let a=v1(r),o=v1(i);if(a===v2&&(a=v5),o===v2&&(o=v5),a!==o)return!1;switch(a){case"[object String]":return r.toString()===i.toString();case"[object Number]":{let e=r.valueOf(),t=i.valueOf();return e===t||Number.isNaN(e)&&Number.isNaN(t)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),i.valueOf());case"[object RegExp]":return r.source===i.source&&r.flags===i.flags;case"[object Function]":return r===i}let l=(n=n??new Map).get(r),c=n.get(i);if(null!=l&&null!=c)return l===i;n.set(r,i),n.set(i,r);try{switch(a){case"[object Map]":if(r.size!==i.size)return!1;for(let[t,a]of r.entries())if(!i.has(t)||!e(a,i.get(t),t,r,i,n,s))return!1;return!0;case"[object Set]":{if(r.size!==i.size)return!1;let t=Array.from(r.values()),a=Array.from(i.values());for(let o=0;o<t.length;o++){let l=t[o],c=a.findIndex(t=>e(l,t,void 0,r,i,n,s));if(-1===c)return!1;a.splice(c,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof ed.Buffer&&ed.Buffer.isBuffer(r)!==ed.Buffer.isBuffer(i)||r.length!==i.length)return!1;for(let t=0;t<r.length;t++)if(!e(r[t],i[t],t,r,i,n,s))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===i.byteLength&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object DataView]":return r.byteLength===i.byteLength&&r.byteOffset===i.byteOffset&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object Error]":return r.name===i.name&&r.message===i.message;case v5:{if(!(t(r.constructor,i.constructor,n,s)||v8(r)&&v8(i)))return!1;let a=[...Object.keys(r),...v0(r)],o=[...Object.keys(i),...v0(i)];if(a.length!==o.length)return!1;for(let t=0;t<a.length;t++){let o=a[t],l=r[o];if(!Object.hasOwn(i,o))return!1;let c=i[o];if(!e(l,c,o,r,i,n,s))return!1}return!0}default:return!1}}finally{n.delete(r),n.delete(i)}}(t,r,a,o)}(i,e[r],void 0,void 0,void 0,void 0,v3)})):this.values)),br(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});let r=bt(bt({},this.getData(e)),t);this.map.set(e,r),await this.persist()}),br(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=hw(t,this.name),this.storagePrefix=i,this.getKey=n}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=mf("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var bn=Object.defineProperty,bs=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bn(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class ba{constructor(e,t){this.core=e,this.logger=t,bs(this,"name","pairing"),bs(this,"version","0.3"),bs(this,"events",new dS.default),bs(this,"pairings"),bs(this,"initialized",!1),bs(this,"storagePrefix",m9),bs(this,"ignoredPayloadTypes",[1]),bs(this,"registeredMethods",[]),bs(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),bs(this,"register",({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),bs(this,"create",async e=>{this.isInitialized();let t=gj(),r=await this.core.crypto.setSymKey(t),i=hG(dT.FIVE_MINUTES),n={protocol:"irn"},s={topic:r,expiry:i,relay:n,active:!1,methods:e?.methods},a=g4({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:t,relay:n,expiryTimestamp:i,methods:e?.methods});return this.events.emit(wb,s),this.core.expirer.set(r,i),await this.pairings.set(r,s),await this.core.relayer.subscribe(r,{transportType:e?.transportType,internal:e?.internal}),{topic:r,uri:a}}),bs(this,"pair",async e=>{let t;this.isInitialized();let r=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:["pairing_started"]}});this.isValidPair(e,r);let{topic:i,symKey:n,relay:s,expiryTimestamp:a,methods:o}=g8(e.uri);if(r.props.properties.topic=i,r.addTrace("pairing_uri_validation_success"),r.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(i)){if(t=this.pairings.get(i),r.addTrace("existing_pairing"),t.active)throw r.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);r.addTrace("pairing_not_expired")}let l=a||hG(dT.FIVE_MINUTES),c={topic:i,relay:s,expiry:l,active:!1,methods:o};this.core.expirer.set(i,l),await this.pairings.set(i,c),r.addTrace("store_new_pairing"),e.activatePairing&&await this.activate({topic:i}),this.events.emit(wb,c),r.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(n,i),r.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError("no_internet_connection")}try{await this.core.relayer.subscribe(i,{relay:s})}catch(e){throw r.setError("subscribe_pairing_topic_failure"),e}return r.addTrace("subscribe_pairing_topic_success"),c}),bs(this,"activate",async({topic:e})=>{this.isInitialized();let t=hG(dT.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),bs(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,"wc_pairingPing",{}),{done:r,resolve:i,reject:n}=h$();this.events.once(hY("pairing_ping",e),({error:e})=>{e?n(e):i()}),await r()}}),bs(this,"updateExpiry",async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),bs(this,"updateMetadata",async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),bs(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),bs(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",my("USER_DISCONNECTED")),await this.deletePairing(t))}),bs(this,"formatUriFromPairing",e=>{this.isInitialized();let{topic:t,relay:r,expiry:i,methods:n}=e,s=this.core.crypto.keychain.get(t);return g4({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:s,relay:r,expiryTimestamp:i,methods:n})}),bs(this,"sendRequest",async(e,t,r)=>{let i=(0,m3.formatJsonRpcRequest)(t,r),n=await this.core.crypto.encode(e,i),s=wv[t].req;return this.core.history.set(e,i),this.core.relayer.publish(e,n,s),i.id}),bs(this,"sendResult",async(e,t,r)=>{let i=(0,m3.formatJsonRpcResult)(e,r),n=await this.core.crypto.encode(t,i),s=wv[(await this.core.history.get(t,e)).request.method].res;await this.core.relayer.publish(t,n,s),await this.core.history.resolve(i)}),bs(this,"sendError",async(e,t,r)=>{let i=(0,m3.formatJsonRpcError)(e,r),n=await this.core.crypto.encode(t,i),s=(await this.core.history.get(t,e)).request.method,a=wv[s]?wv[s].res:wv.unregistered_method.res;await this.core.relayer.publish(t,n,a),await this.core.history.resolve(i)}),bs(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,my("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),bs(this,"cleanup",async()=>{let e=this.pairings.getAll().filter(e=>hZ(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),bs(this,"onRelayEventRequest",async e=>{let{topic:t,payload:r}=e;switch(r.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,r);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,r);default:return await this.onUnknownRpcMethodRequest(t,r)}}),bs(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r}=e,i=(await this.core.history.get(t,r.id)).request.method;return"wc_pairingPing"===i?this.onPairingPingResponse(t,r):this.onUnknownRpcMethodResponse(i)}),bs(this,"onPairingPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.events.emit("pairing_ping",{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bs(this,"onPairingPingResponse",(e,t)=>{let{id:r}=t;setTimeout(()=>{(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("pairing_ping",r),{}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("pairing_ping",r),{error:t.error})},500)}),bs(this,"onPairingDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(w_,{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bs(this,"onUnknownRpcMethodRequest",async(e,t)=>{let{id:r,method:i}=t;try{if(this.registeredMethods.includes(i))return;let t=my("WC_METHOD_UNSUPPORTED",i);await this.sendError(r,e,t),this.logger.error(t)}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bs(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(my("WC_METHOD_UNSUPPORTED",e))}),bs(this,"isValidPair",(e,t)=>{var r;if(!mk(e)){let{message:r}=mf("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(wO),Error(r)}if(!function(e){function t(e){try{return"u">typeof new URL(e)}catch{return!1}}try{if(mv(e,!1)){if(t(e))return!0;let r=h3(e);return t(r)}}catch{}return!1}(e.uri)){let{message:r}=mf("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(wO),Error(r)}let i=g8(e?.uri);if(!(null!=(r=i?.relay)&&r.protocol)){let{message:e}=mf("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(wO),Error(e)}if(!(null!=i&&i.symKey)){let{message:e}=mf("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(wO),Error(e)}if(null!=i&&i.expiryTimestamp&&(0,dT.toMiliseconds)(i?.expiryTimestamp)<Date.now()){t.setError("pairing_expired");let{message:e}=mf("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(e)}}),bs(this,"isValidPing",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),bs(this,"isValidDisconnect",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),bs(this,"isValidPairingTopic",async e=>{if(!mv(e,!1)){let{message:t}=mf("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=mf("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(hZ(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=mf("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=hw(t,this.name),this.pairings=new bi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return hm(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(wn,async e=>{let{topic:t,message:r,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==wp&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let e=await this.core.crypto.decode(t,r);(0,m8.isJsonRpcRequest)(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):(0,m8.isJsonRpcResponse)(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,r)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(wT,async e=>{let{topic:t}=hJ(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}var bo=Object.defineProperty,bl=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bo(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bc extends mH{constructor(e,t){super(e,t),this.core=e,this.logger=t,bl(this,"records",new Map),bl(this,"events",new dS.EventEmitter),bl(this,"name","history"),bl(this,"version","0.3"),bl(this,"cached",[]),bl(this,"initialized",!1),bl(this,"storagePrefix",m9),bl(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),bl(this,"set",(e,t,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;let i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r,expiry:hG(dT.THIRTY_DAYS)};this.records.set(i.id,i),this.persist(),this.events.emit(wE,i)}),bl(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,m8.isJsonRpcError)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(wI,t))}),bl(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),bl(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(r=>{r.topic===e&&("u">typeof t&&r.id!==t||(this.records.delete(r.id),this.events.emit(wA,r)))}),this.persist()}),bl(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),bl(this,"on",(e,t)=>{this.events.on(e,t)}),bl(this,"once",(e,t)=>{this.events.once(e,t)}),bl(this,"off",(e,t)=>{this.events.off(e,t)}),bl(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=hw(t,this.name)}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if("u">typeof t.response)return;let r={topic:t.topic,request:(0,m3.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(wE,e=>{this.logger.info(`Emitting ${wE}`),this.logger.debug({type:"event",event:wE,record:e})}),this.events.on(wI,e=>{this.logger.info(`Emitting ${wI}`),this.logger.debug({type:"event",event:wI,record:e})}),this.events.on(wA,e=>{this.logger.info(`Emitting ${wA}`),this.logger.debug({type:"event",event:wA,record:e})}),this.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,dT.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(wA,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var bd=Object.defineProperty,bu=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bd(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bh extends mG{constructor(e,t){super(e,t),this.core=e,this.logger=t,bu(this,"expirations",new Map),bu(this,"events",new dS.EventEmitter),bu(this,"name","expirer"),bu(this,"version","0.3"),bu(this,"cached",[]),bu(this,"initialized",!1),bu(this,"storagePrefix",m9),bu(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),bu(this,"has",e=>{try{let t=this.formatTarget(e);return"u">typeof this.getExpiration(t)}catch{return!1}}),bu(this,"set",(e,t)=>{this.isInitialized();let r=this.formatTarget(e),i={target:r,expiry:t};this.expirations.set(r,i),this.checkExpiry(r,i),this.events.emit(wS,{target:r,expiration:i})}),bu(this,"get",e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),bu(this,"del",e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),r=this.getExpiration(t);this.expirations.delete(t),this.events.emit(wk,{target:t,expiration:r})}}),bu(this,"on",(e,t)=>{this.events.on(e,t)}),bu(this,"once",(e,t)=>{this.events.once(e,t)}),bu(this,"off",(e,t)=>{this.events.off(e,t)}),bu(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=hw(t,this.name)}get context(){return hm(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return hV("topic",e);if("number"==typeof e)return hV("id",e);let{message:t}=mf("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:r}=t;(0,dT.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(wT,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(wS,e=>{this.logger.info(`Emitting ${wS}`),this.logger.debug({type:"event",event:wS,data:e}),this.persist()}),this.events.on(wT,e=>{this.logger.info(`Emitting ${wT}`),this.logger.debug({type:"event",event:wT,data:e}),this.persist()}),this.events.on(wk,e=>{this.logger.info(`Emitting ${wk}`),this.logger.debug({type:"event",event:wk,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}}var bp=Object.defineProperty,bf=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bp(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class by extends mZ{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,bf(this,"name","verify-api"),bf(this,"abortController"),bf(this,"isDevEnv"),bf(this,"verifyUrlV3",wx),bf(this,"storagePrefix",m9),bf(this,"version",2),bf(this,"publicKey"),bf(this,"fetchPromise"),bf(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,dT.toMiliseconds)(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),bf(this,"register",async e=>{if(!hL()||this.isDevEnv)return;let t=window.location.origin,{id:r,decryptedId:i}=e,n=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${r}&decryptedId=${i}`;try{let e=(0,dC.getDocument)(),t=this.startAbortTimer(5*dT.ONE_SECOND),i=await new Promise((i,s)=>{let a=()=>{window.removeEventListener("message",l),e.body.removeChild(o),s("attestation aborted")};this.abortController.signal.addEventListener("abort",a);let o=e.createElement("iframe");o.src=n,o.style.display="none",o.addEventListener("error",a,{signal:this.abortController.signal});let l=n=>{if(n.data&&"string"==typeof n.data)try{let s=JSON.parse(n.data);if("verify_attestation"===s.type){if((0,uX.decodeJWT)(s.attestation).payload.id!==r)return;clearInterval(t),e.body.removeChild(o),this.abortController.signal.removeEventListener("abort",a),window.removeEventListener("message",l),i(null===s.attestation?"":s.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(o),window.addEventListener("message",l,{signal:this.abortController.signal})});return this.logger.debug(i,"jwt attestation"),i}catch(e){this.logger.warn(e)}return""}),bf(this,"resolve",async e=>{if(this.isDevEnv)return"";let{attestationId:t,hash:r,encryptedId:i}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,uX.decodeJWT)(t).payload.id!==i)return;let e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!r)return;let n=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(r,n)}),bf(this,"fetchAttestation",async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let r=this.startAbortTimer(5*dT.ONE_SECOND),i=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(r),200===i.status?await i.json():void 0}),bf(this,"getVerifyUrl",e=>{let t=e||wC;return wP.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${wC}`),t=wC),t}),bf(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(dT.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),bf(this,"persistPublicKey",async e=>{this.logger.debug(e,"persisting public key to local storage"),await this.store.setItem(this.storeKey,e),this.publicKey=e}),bf(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),bf(this,"isValidJwtAttestation",async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}let r=await this.fetchAndPersistPublicKey();try{if(r)return this.validateAttestation(e,r)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}}),bf(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),bf(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),bf(this,"validateAttestation",(e,t)=>{let r=function(e,t){let r,i,[n,s,a]=e.split("."),o=ed.Buffer.from(gz(a),"base64");if(64!==o.length)throw Error("Invalid signature length");let l=o.slice(0,32),c=o.slice(32,64),d=fo(`${n}.${s}`),u=(r=ed.Buffer.from(t.x,"base64"),i=ed.Buffer.from(t.y,"base64"),(0,u2.concat)([new Uint8Array([4]),r,i]));if(!gR.verify((0,u2.concat)([l,c]),d,u))throw Error("Invalid signature");return(0,uX.decodeJWT)(e).payload}(e,t.publicKey),i={hasExpired:(0,dT.toMiliseconds)(r.exp)<Date.now(),payload:r};if(i.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:i.payload.origin,isScam:i.payload.isScam,isVerified:i.payload.isVerified}}),this.logger=hw(t,this.name),this.abortController=new AbortController,this.isDevEnv=h5(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return hm(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,dT.toMiliseconds)(e))}}var bg=Object.defineProperty,bm=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bg(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bw extends mY{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,bm(this,"context","echo"),bm(this,"registerDeviceToken",async e=>{let{clientId:t,token:r,notificationType:i,enableEncrypted:n=!1}=e,s=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:i,token:r,always_raw:n})})}),this.logger=hw(t,this.context)}}var bv=Object.defineProperty,bb=Object.getOwnPropertySymbols,b_=Object.prototype.hasOwnProperty,bE=Object.prototype.propertyIsEnumerable,bI=(e,t,r)=>t in e?bv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bA=(e,t)=>{for(var r in t||(t={}))b_.call(t,r)&&bI(e,r,t[r]);if(bb)for(var r of bb(t))bE.call(t,r)&&bI(e,r,t[r]);return e},bS=(e,t,r)=>bI(e,"symbol"!=typeof t?t+"":t,r);class bk extends mQ{constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,bS(this,"context","event-client"),bS(this,"storagePrefix",m9),bS(this,"storageVersion",.1),bS(this,"events",new Map),bS(this,"shouldPersist",!1),bS(this,"init",async()=>{if(!h5())try{let e={eventId:h2(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:hF(this.core.relayer.protocol,this.core.relayer.version,wh)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),bS(this,"createEvent",e=>{let{event:t="ERROR",type:r="",properties:{topic:i,trace:n}}=e,s=h2(),a=this.core.projectId||"",o=bA({eventId:s,timestamp:Date.now(),props:{event:t,type:r,properties:{topic:i,trace:n}},bundleId:a,domain:this.getAppDomain()},this.setMethods(s));return this.telemetryEnabled&&(this.events.set(s,o),this.shouldPersist=!0),o}),bS(this,"getEvent",e=>{let{eventId:t,topic:r}=e;if(t)return this.events.get(t);let i=Array.from(this.events.values()).find(e=>e.props.properties.topic===r);if(i)return bA(bA({},i),this.setMethods(i.eventId))}),bS(this,"deleteEvent",e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),bS(this,"setEventListeners",()=>{this.core.heartbeat.on(mD.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,dT.fromMiliseconds)(Date.now())-(0,dT.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),bS(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),bS(this,"addTrace",(e,t)=>{let r=this.events.get(e);r&&(r.props.properties.trace.push(t),this.events.set(e,r),this.shouldPersist=!0)}),bS(this,"setError",(e,t)=>{let r=this.events.get(e);r&&(r.props.type=t,r.timestamp=Date.now(),this.events.set(e,r),this.shouldPersist=!0)}),bS(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),bS(this,"restore",async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,bA(bA({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),bS(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let e=[];for(let[t,r]of this.events)r.props.type&&e.push(r);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),bS(this,"sendEvent",async e=>{let t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${wh}${t}`,{method:"POST",body:JSON.stringify(e)})}),bS(this,"getAppDomain",()=>hB().url),this.logger=hw(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var bT=Object.defineProperty,bC=Object.getOwnPropertySymbols,bx=Object.prototype.hasOwnProperty,bP=Object.prototype.propertyIsEnumerable,bO=(e,t,r)=>t in e?bT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bR=(e,t)=>{for(var r in t||(t={}))bx.call(t,r)&&bO(e,r,t[r]);if(bC)for(var r of bC(t))bP.call(t,r)&&bO(e,r,t[r]);return e},bN=(e,t,r)=>bO(e,"symbol"!=typeof t?t+"":t,r);class bM extends mF{constructor(e){var t;super(e),bN(this,"protocol","wc"),bN(this,"version",2),bN(this,"name",m6),bN(this,"relayUrl"),bN(this,"projectId"),bN(this,"customStoragePrefix"),bN(this,"events",new dS.EventEmitter),bN(this,"logger"),bN(this,"heartbeat"),bN(this,"relayer"),bN(this,"crypto"),bN(this,"storage"),bN(this,"history"),bN(this,"expirer"),bN(this,"pairing"),bN(this,"verify"),bN(this,"echoClient"),bN(this,"linkModeSupportedApps"),bN(this,"eventClient"),bN(this,"initialized",!1),bN(this,"logChunkController"),bN(this,"on",(e,t)=>this.events.on(e,t)),bN(this,"once",(e,t)=>this.events.once(e,t)),bN(this,"off",(e,t)=>this.events.off(e,t)),bN(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),bN(this,"dispatchEnvelope",({topic:e,message:t,sessionExists:r})=>{if(!e||!t)return;let i={topic:e,message:t,publishedAt:Date.now(),transportType:wp};this.relayer.onLinkMessageEvent(i,{sessionExists:r})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(e){console.warn("Failed to copy global core",e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||wi,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const{logger:i,chunkLoggerController:n}=hv({opts:function(e){return hd(hg({},e),hu({level:e?.level||"info"}))}({level:"string"==typeof e?.logger&&e.logger?e.logger:"error",name:m6}),maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=n,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=hw(i,this.name),this.heartbeat=new mD.HeartBeat,this.crypto=new vp(this,this.logger,e?.keychain),this.history=new bc(this,this.logger),this.expirer=new bh(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new mL.default(bR(bR({},m7),e?.storageOptions)),this.relayer=new vX({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ba(this,this.logger),this.verify=new by(this,this.logger,this.storage),this.echoClient=new bw(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new bk(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new bM(e);await t.initialize();let r=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t}get context(){return hm(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(wg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(wg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(e){console.warn("Failed to get global WalletConnect core",e);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(e){console.warn("Failed to set global WalletConnect core",e)}}isGlobalCoreDisabled(){try{return"u">typeof la.default&&"true"===la.default.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let bU="client",bD=`wc@2:${bU}:`,bL="WALLETCONNECT_DEEPLINK_CHOICE",bj=(dT.THIRTY_DAYS,"Proposal expired"),bW=dT.SEVEN_DAYS,bB={wc_sessionPropose:{req:{ttl:dT.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:1104},res:{ttl:dT.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:1106},res:{ttl:dT.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:dT.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:dT.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:1112},res:{ttl:dT.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:dT.ONE_DAY,prompt:!1,tag:1114},res:{ttl:dT.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:dT.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:dT.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:dT.FIVE_MINUTES,prompt:!1,tag:1119}}},bF={min:dT.FIVE_MINUTES,max:dT.SEVEN_DAYS},bq="IDLE",bH="ACTIVE",bz={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},b$=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],bK="wc@1.5:auth:",bV=`${bK}:PUB_KEY`;var bJ=Object.defineProperty,bG=Object.defineProperties,bZ=Object.getOwnPropertyDescriptors,bY=Object.getOwnPropertySymbols,bQ=Object.prototype.hasOwnProperty,bX=Object.prototype.propertyIsEnumerable,b0=(e,t,r)=>t in e?bJ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b1=(e,t)=>{for(var r in t||(t={}))bQ.call(t,r)&&b0(e,r,t[r]);if(bY)for(var r of bY(t))bX.call(t,r)&&b0(e,r,t[r]);return e},b2=(e,t,r)=>b0(e,"symbol"!=typeof t?t+"":t,r);class b5 extends m2{constructor(t){super(t),b2(this,"name","engine"),b2(this,"events",new dS.default),b2(this,"initialized",!1),b2(this,"requestQueue",{state:bq,queue:[]}),b2(this,"sessionRequestQueue",{state:bq,queue:[]}),b2(this,"emittedSessionRequests",new h8({limit:500})),b2(this,"requestQueueDelay",dT.ONE_SECOND),b2(this,"expectedPairingMethodMap",new Map),b2(this,"recentlyDeletedMap",new Map),b2(this,"recentlyDeletedLimit",200),b2(this,"relayMessageCache",[]),b2(this,"pendingSessions",new Map),b2(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(bB)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,dT.toMiliseconds)(this.requestQueueDelay)))}),b2(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=bG(b1({},e),bZ({requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}}));await this.isValidConnect(t),t.optionalNamespaces=function(e,t){var r,i,n,s,a,o;let l=md(e),c=md(t),d={};for(let e of Object.keys(l).concat(Object.keys(c)))d[e]={chains:hQ(null==(r=l[e])?void 0:r.chains,null==(i=c[e])?void 0:i.chains),methods:hQ(null==(n=l[e])?void 0:n.methods,null==(s=c[e])?void 0:s.methods),events:hQ(null==(a=l[e])?void 0:a.events,null==(o=c[e])?void 0:o.events)};return d}(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=t,l=r,c,d=!1;try{if(l){let e=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),e}if(!l||!d){let{topic:e,uri:t}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=e,c=t}if(!l){let{message:e}=mf("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw Error(e)}let u=await this.client.core.crypto.generateKeyPair(),h=bB.wc_sessionPropose.req.ttl||dT.FIVE_MINUTES,p=hG(h),f=bG(b1(b1({requiredNamespaces:i,optionalNamespaces:n,relays:o??[{protocol:"irn"}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},s&&{sessionProperties:s}),a&&{scopedProperties:a}),bZ({id:(0,m3.payloadId)()})),y=hY("session_connect",f.id),{reject:g,resolve:m,done:w}=h$(h,bj),v=({id:e})=>{e===f.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(f.id),this.events.emit(y,{error:{message:bj,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(y,({error:e,session:t})=>{this.client.events.off("proposal_expire",v),e?g(e):t&&m(t)}),await this.sendProposeSession({proposal:f,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f.id}}}),await this.setProposal(f.id,f),{uri:c,approval:w}}),b2(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error("pair() failed"),e}}),b2(this,"approve",async e=>{var t,r,i;let n=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[wR]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw n.setError("no_internet_connection"),e}try{await this.isValidProposalId(e?.id)}catch(t){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),n.setError("proposal_not_found"),t}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError("session_approve_namespace_validation_failure"),e}let{id:s,relayProtocol:a,namespaces:o,sessionProperties:l,scopedProperties:c,sessionConfig:d}=e,u=this.client.proposal.get(s);this.client.core.eventClient.deleteEvent({eventId:n.eventId});let{pairingTopic:h,proposer:p,requiredNamespaces:f,optionalNamespaces:y}=u,g=null==(r=this.client.core.eventClient)?void 0:r.getEvent({topic:h});g||(g=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:wR,properties:{topic:h,trace:[wR,"session_namespaces_validation_success"]}}));let m=await this.client.core.crypto.generateKeyPair(),w=p.publicKey,v=await this.client.core.crypto.generateSharedKey(m,w),b=b1(b1(b1({relay:{protocol:a??"irn"},namespaces:o,controller:{publicKey:m,metadata:this.client.metadata},expiry:hG(bW)},l&&{sessionProperties:l}),c&&{scopedProperties:c}),d&&{sessionConfig:d});g.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(v,{transportType:wf,internal:{skipSubscribe:!0}})}catch(e){throw g.setError("subscribe_session_topic_failure"),e}g.addTrace("subscribe_session_topic_success");let _=bG(b1({},b),bZ({topic:v,requiredNamespaces:f,optionalNamespaces:y,pairingTopic:h,acknowledged:!1,self:b.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:wf}));await this.client.session.set(v,_),g.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:v,proposal:u,pairingProposalResponse:{relay:{protocol:a??"irn"},responderPublicKey:m},sessionSettleRequest:b,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:s}}}),g.addTrace("session_approve_publish_success")}catch(e){throw this.client.logger.error(e),this.client.session.delete(v,my("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(v),e}return this.client.core.eventClient.deleteEvent({eventId:g.eventId}),await this.client.core.pairing.updateMetadata({topic:h,metadata:p.metadata}),await this.deleteProposal(s),await this.client.core.pairing.activate({topic:h}),await this.setExpiry(v,hG(bW)),{topic:v,acknowledged:()=>Promise.resolve(this.client.session.get(v))}}),b2(this,"reject",async e=>{let t;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error("reject() -> isValidReject() failed"),e}let{id:r,reason:i}=e;try{t=this.client.proposal.get(r).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),e}t&&await this.sendError({id:r,topic:t,error:i,rpcOpts:bB.wc_sessionPropose.reject}),await this.deleteProposal(r)}),b2(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error("update() -> isValidUpdate() failed"),e}let{topic:t,namespaces:r}=e,{done:i,resolve:n,reject:s}=h$(),a=(0,m3.payloadId)(),o=(0,m3.getBigIntRpcId)().toString(),l=this.client.session.get(t).namespaces;return this.events.once(hY("session_update",a),({error:e})=>{e?s(e):n()}),await this.client.session.update(t,{namespaces:r}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:o}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:l}),s(e)}),{acknowledged:i}}),b2(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error("extend() -> isValidExtend() failed"),e}let{topic:t}=e,r=(0,m3.payloadId)(),{done:i,resolve:n,reject:s}=h$();return this.events.once(hY("session_extend",r),({error:e})=>{e?s(e):n()}),await this.setExpiry(t,hG(bW)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(e=>{s(e)}),{acknowledged:i}}),b2(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error("request() -> isValidRequest() failed"),e}let{chainId:t,request:r,topic:i,expiry:n=bB.wc_sessionRequest.req.ttl}=e,s=this.client.session.get(i);s?.transportType===wf&&await this.confirmOnlineStateOrThrow();let a=(0,m3.payloadId)(),o=(0,m3.getBigIntRpcId)().toString(),{done:l,resolve:c,reject:d}=h$(n,"Request expired. Please try again.");this.events.once(hY("session_request",a),({error:e,result:t})=>{e?d(e):c(t)});let u="wc_sessionRequest",h=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);if(h)return await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:{request:bG(b1({},r),bZ({expiryTimestamp:hG(n)})),chainId:t},expiry:n,throwOnFailedPublish:!0,appLink:h}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),await l();let p={request:bG(b1({},r),bZ({expiryTimestamp:hG(n)})),chainId:t};return await Promise.all([new Promise(async e=>{await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:p,expiry:n,throwOnFailedPublish:!0,tvf:this.getTVFParams(a,p)}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),e()}),new Promise(async e=>{var t;if(!(null!=(t=s.sessionConfig)&&t.disableDeepLink)){let e=await h0(this.client.core.storage,bL);await hX({id:a,topic:i,wcDeepLink:e})}e()}),l()]).then(e=>e[2])}),b2(this,"respond",async e=>{var t,r;this.isInitialized();let i=this.client.core.eventClient.createEvent({properties:{topic:e?.topic||(null==(r=null==(t=e?.response)?void 0:t.id)?void 0:r.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_validation_failure"),e}i.addTrace("session_request_response_validation_success");let{topic:n,response:s}=e,{id:a}=s,o=this.client.session.get(n);o.transportType===wf&&await this.confirmOnlineStateOrThrow();let l=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);try{i.addTrace("session_request_response_publish_started"),(0,m8.isJsonRpcResult)(s)?await this.sendResult({id:a,topic:n,result:s.result,throwOnFailedPublish:!0,appLink:l}):(0,m8.isJsonRpcError)(s)&&await this.sendError({id:a,topic:n,error:s.error,appLink:l}),this.cleanupAfterResponse(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_publish_failure"),e}}),b2(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error("ping() -> isValidPing() failed"),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=(0,m3.payloadId)(),r=(0,m3.getBigIntRpcId)().toString(),{done:i,resolve:n,reject:s}=h$();this.events.once(hY("session_ping",e),({error:e})=>{e?s(e):n()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:r}),i()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),b2(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:r,chainId:i}=e,n=(0,m3.getBigIntRpcId)().toString(),s=(0,m3.payloadId)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:r,chainId:i},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:s})}),b2(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:my("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=mf("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw Error(e)}}),b2(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>(function(e,t){let{requiredNamespaces:r}=t,i=Object.keys(e.namespaces),n=Object.keys(r),s=!0;return!!hq(n,i)&&(i.forEach(t=>{let{accounts:i,methods:n,events:a}=e.namespaces[t],o=mo(i),l=r[t];hq(hE(t,l),o)&&hq(l.methods,n)&&hq(l.events,a)||(s=!1)}),s)})(t,e)))),b2(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),b2(this,"authenticate",async(e,t)=>{var r,i,n,s,a;let o;this.isInitialized(),this.isValidAuthenticate(e);let l=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(r=this.client.metadata.redirect)?void 0:r.linkMode),c=l?wp:wf;c===wf&&await this.confirmOnlineStateOrThrow();let{chains:d,statement:u="",uri:h,domain:p,nonce:f,type:y,exp:g,nbf:m,methods:w=[],expiry:v}=e,b=[...e.resources||[]],{topic:_,uri:E}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:c});this.client.logger.info({message:"Generated new pairing",pairing:{topic:_,uri:E}});let I=await this.client.core.crypto.generateKeyPair(),A=gW(I);if(await Promise.all([this.client.auth.authKeys.set(bV,{responseTopic:A,publicKey:I}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:_})]),await this.client.core.relayer.subscribe(A,{transportType:c}),this.client.logger.info(`sending request to new pairing topic: ${_}`),w.length>0){let e,t,{namespace:r}=hb(d[0]),o=fj(function(e,t,r,i={}){return r?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:function(e,t,r={}){return Object.assign({},...(t=t?.sort((e,t)=>e.localeCompare(t))).map(t=>({[`${e}/${t}`]:[r]})))}(t,r,i)}}}(r,"request",w));fq(b)&&(i=o,n=b.pop(),o=fj((s=fW(i),a=fW(n),fL(s),fL(a),e=Object.keys(s.att).concat(Object.keys(a.att)).sort((e,t)=>e.localeCompare(t)),t={att:{}},e.forEach(e=>{var r,i;Object.keys((null==(r=s.att)?void 0:r[e])||{}).concat(Object.keys((null==(i=a.att)?void 0:i[e])||{})).sort((e,t)=>e.localeCompare(t)).forEach(r=>{var i,n;t.att[e]=fk(((e,t)=>{for(var r in t||(t={}))fx.call(t,r)&&fO(e,r,t[r]);if(fC)for(var r of fC(t))fP.call(t,r)&&fO(e,r,t[r]);return e})({},t.att[e]),fT({[r]:(null==(i=s.att[e])?void 0:i[r])||(null==(n=a.att[e])?void 0:n[r])}))})}),t))),b.push(o)}let S=v&&v>bB.wc_sessionAuthenticate.req.ttl?v:bB.wc_sessionAuthenticate.req.ttl,k={authPayload:{type:y??"caip122",chains:d,statement:u,aud:h,domain:p,version:"1",nonce:f,iat:new Date().toISOString(),exp:g,nbf:m,resources:b},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:hG(S)},T={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:d,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:_,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:hG(bB.wc_sessionPropose.req.ttl),id:(0,m3.payloadId)()},{done:C,resolve:x,reject:P}=h$(S,"Request expired"),O=(0,m3.payloadId)(),R=hY("session_connect",T.id),N=hY("session_request",O),M=async({error:e,session:t})=>{this.events.off(N,U),e?P(e):t&&x({session:t})},U=async e=>{var r,i,n;let s;if(await this.deletePendingAuthRequest(O,{message:"fulfilled",code:0}),e.error){let t=my("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(R,M),P(e.error.message))}await this.deleteProposal(T.id),this.events.off(R,M);let{cacaos:a,responder:o}=e.result,l=[],d=[];for(let e of a){await fU({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,"Signature verification failed"),P(my("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:t}=e,r=fq(t.resources),i=[fN(t.iss)],n=fM(t.iss);if(r){let e=fB(r),t=fF(r);l.push(...e),i.push(...t)}for(let e of i)d.push(`${e}:${n}`)}let u=await this.client.core.crypto.generateSharedKey(I,o.publicKey);l.length>0&&(s={topic:u,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:o,controller:o.publicKey,expiry:hG(bW),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:_,namespaces:mu([...new Set(l)],[...new Set(d)]),transportType:c},await this.client.core.relayer.subscribe(u,{transportType:c}),await this.client.session.set(u,s),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:o.metadata}),s=this.client.session.get(u)),null!=(r=this.client.metadata.redirect)&&r.linkMode&&null!=(i=o.metadata.redirect)&&i.linkMode&&null!=(n=o.metadata.redirect)&&n.universal&&t&&(this.client.core.addLinkModeSupportedApp(o.metadata.redirect.universal),this.client.session.update(u,{transportType:wp})),x({auths:a,session:s})};this.events.once(R,M),this.events.once(N,U);try{if(l){let e=(0,m3.formatJsonRpcRequest)("wc_sessionAuthenticate",k,O);this.client.core.history.set(_,e);let r=await this.client.core.crypto.encode("",e,{type:2,encoding:gD});o=g6(t,_,r)}else await Promise.all([this.sendRequest({topic:_,method:"wc_sessionAuthenticate",params:k,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:O}),this.sendRequest({topic:_,method:"wc_sessionPropose",params:T,expiry:bB.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(e){throw this.events.off(R,M),this.events.off(N,U),e}return await this.setProposal(T.id,T),await this.setAuthRequest(O,{request:bG(b1({},k),bZ({verifyContext:{}})),pairingTopic:_,transportType:c}),{uri:o??E,response:C}}),b2(this,"approveSessionAuthenticate",async e=>{let t,{id:r,auths:i}=e,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(e){throw n.setError("no_internet_connection"),e}let s=this.getPendingAuthRequest(r);if(!s)throw n.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${r}`);let a=s.transportType||wf;a===wf&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),c=gW(o),d={type:1,receiverPublicKey:o,senderPublicKey:l},u=[],h=[];for(let e of i){if(!await fU({cacao:e,projectId:this.client.core.projectId})){n.setError("invalid_cacao");let e=my("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:c,error:e,encodeOpts:d}),Error(e.message)}n.addTrace("cacaos_verified");let{p:t}=e,i=fq(t.resources),s=[fN(t.iss)],a=fM(t.iss);if(i){let e=fB(i),t=fF(i);u.push(...e),s.push(...t)}for(let e of s)h.push(`${e}:${a}`)}let p=await this.client.core.crypto.generateSharedKey(l,o);if(n.addTrace("create_authenticated_session_topic"),u?.length>0){t={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:o,metadata:s.requester.metadata},controller:o,expiry:hG(bW),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:s.pairingTopic,namespaces:mu([...new Set(u)],[...new Set(h)]),transportType:a},n.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(e){throw n.setError("subscribe_authenticated_session_topic_failure"),e}n.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(p,t),n.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:s.pairingTopic,metadata:s.requester.metadata})}n.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:c,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(s.requester.metadata,a)})}catch(e){throw n.setError("authenticated_session_approve_publish_failure"),e}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:s.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:t}}),b2(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();let{id:t,reason:r}=e,i=this.getPendingAuthRequest(t);if(!i)throw Error(`Could not find pending auth request with id ${t}`);i.transportType===wf&&await this.confirmOnlineStateOrThrow();let n=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),a=gW(n);await this.sendError({id:t,topic:a,error:r,encodeOpts:{type:1,receiverPublicKey:n,senderPublicKey:s},rpcOpts:bB.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.deleteProposal(t)}),b2(this,"formatAuthMessage",e=>{this.isInitialized();let{request:t,iss:r}=e;return fD(t,r)}),b2(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),b2(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(r=>{var i,n;return(null==(i=r.peerMetadata)?void 0:i.url)&&(null==(n=r.peerMetadata)?void 0:n.url)===e.peer.metadata.url&&r.topic&&r.topic!==t.topic});if(0===r.length)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(e){this.client.logger.error(e)}}),b2(this,"deleteSession",async e=>{var t;let{topic:r,expirerHasDeleted:i=!1,emitEvent:n=!0,id:s=0}=e,{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,my("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(bL).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===r&&this.deletePendingSessionRequest(e.id,my("USER_DISCONNECTED"))}),r===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=bq),n&&this.client.events.emit("session_delete",{id:s,topic:r})}),b2(this,"deleteProposal",async(e,t)=>{if(t)try{let t=this.client.proposal.get(e),r=this.client.core.eventClient.getEvent({topic:t.pairingTopic});r?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(e,my("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),b2(this,"deletePendingSessionRequest",async(e,t,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),r&&(this.sessionRequestQueue.state=bq,this.client.events.emit("session_request_expire",{id:e}))}),b2(this,"deletePendingAuthRequest",async(e,t,r=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)])}),b2(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),b2(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,hG(bB.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),b2(this,"setAuthRequest",async(e,t)=>{let{request:r,pairingTopic:i,transportType:n=wf}=t;this.client.core.expirer.set(e,r.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:e,pairingTopic:i,verifyContext:r.verifyContext,transportType:n})}),b2(this,"setPendingSessionRequest",async e=>{let{id:t,topic:r,params:i,verifyContext:n}=e,s=i.request.expiryTimestamp||hG(bB.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,s),await this.client.pendingRequest.set(t,{id:t,topic:r,params:i,verifyContext:n})}),b2(this,"sendRequest",async t=>{let r,i,{topic:n,method:s,params:a,expiry:o,relayRpcId:l,clientRpcId:c,throwOnFailedPublish:d,appLink:u,tvf:h,publishOpts:p={}}=t,f=(0,m3.formatJsonRpcRequest)(s,a,c),y=!!u;try{let e=y?gD:gU;r=await this.client.core.crypto.encode(n,f,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),e}if(b$.includes(s)){let e=gB(JSON.stringify(f)),t=gB(r);i=await this.client.core.verify.register({id:t,decryptedId:e})}let g=b1(b1({},bB[s].req),p);if(g.attestation=i,o&&(g.ttl=o),l&&(g.id=l),this.client.core.history.set(n,f),y){let t=g6(u,n,r);await e.g.Linking.openURL(t,this.client.name)}else{let e;g.tvf=bG(b1({},h),bZ({correlationId:f.id})),d?(e=b1({},g.internal),g.internal=bG(e,bZ({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(n,r,g)):this.client.core.relayer.publish(n,r,g).catch(e=>this.client.logger.error(e))}return f.id}),b2(this,"sendProposeSession",async e=>{let{proposal:t,publishOpts:r}=e,i=(0,m3.formatJsonRpcRequest)("wc_sessionPropose",t,t.id);this.client.core.history.set(t.pairingTopic,i);let n=await this.client.core.crypto.encode(t.pairingTopic,i,{encoding:gU}),s=gB(JSON.stringify(i)),a=gB(n),o=await this.client.core.verify.register({id:a,decryptedId:s});await this.client.core.relayer.publishCustom({payload:{pairingTopic:t.pairingTopic,sessionProposal:n},opts:bG(b1({},r),bZ({publishMethod:"wc_proposeSession",attestation:o}))})}),b2(this,"sendApproveSession",async e=>{let{sessionTopic:t,pairingProposalResponse:r,proposal:i,sessionSettleRequest:n,publishOpts:s}=e,a=(0,m3.formatJsonRpcResult)(i.id,r),o=await this.client.core.crypto.encode(i.pairingTopic,a,{encoding:gU}),l=(0,m3.formatJsonRpcRequest)("wc_sessionSettle",n,s?.id),c=await this.client.core.crypto.encode(t,l,{encoding:gU});this.client.core.history.set(t,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:t,pairingTopic:i.pairingTopic,sessionProposalResponse:o,sessionSettlementRequest:c},opts:bG(b1({},s),bZ({publishMethod:"wc_approveSession"}))})}),b2(this,"sendResult",async t=>{let r,i,n,{id:s,topic:a,result:o,throwOnFailedPublish:l,encodeOpts:c,appLink:d}=t,u=(0,m3.formatJsonRpcResult)(s,o),h=d&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=h?gD:gU;r=await this.client.core.crypto.encode(a,u,(e=b1({},c||{}),t={encoding:i},bG(e,bZ(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),e}try{let e=(i=await this.client.core.history.get(a,s)).request;try{n=this.getTVFParams(s,e.params,o)}catch(e){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${e?.message}`)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${s}) failed`),e}if(h){let t=g6(d,a,r);await e.g.Linking.openURL(t,this.client.name)}else{let e,t=bB[i.request.method].res;t.tvf=bG(b1({},n),bZ({correlationId:s})),l?(e=b1({},t.internal),t.internal=bG(e,bZ({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(a,r,t)):this.client.core.relayer.publish(a,r,t).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(u)}),b2(this,"sendError",async t=>{let r,i,{id:n,topic:s,error:a,encodeOpts:o,rpcOpts:l,appLink:c}=t,d=(0,m3.formatJsonRpcError)(n,a),u=c&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=u?gD:gU;r=await this.client.core.crypto.encode(s,d,(e=b1({},o||{}),t={encoding:i},bG(e,bZ(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),e}try{i=await this.client.core.history.get(s,n)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),e}if(u){let t=g6(c,s,r);await e.g.Linking.openURL(t,this.client.name)}else{let e=i.request.method,t=l||bB[e].res;this.client.core.relayer.publish(s,r,t)}await this.client.core.history.resolve(d)}),b2(this,"cleanup",async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let r=!1;hZ(t.expiry)&&(r=!0),this.client.core.crypto.keychain.has(t.topic)||(r=!0),r&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{hZ(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),b2(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),b2(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),b2(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===bH)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=bH;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=bq}),b2(this,"processRequest",async e=>{let{topic:t,payload:r,attestation:i,transportType:n,encryptedId:s}=e,a=r.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:r,attestation:i,encryptedId:s});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,r);case"wc_sessionPing":return await this.onSessionPingRequest(t,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(t,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),b2(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r,transportType:i}=e,n=(await this.client.core.history.get(t,r.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,r);case"wc_sessionExtend":return this.onSessionExtendResponse(t,r);case"wc_sessionPing":return this.onSessionPingResponse(t,r);case"wc_sessionRequest":return this.onSessionRequestResponse(t,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,r);default:return this.client.logger.info(`Unsupported response method ${n}`)}}),b2(this,"onRelayEventUnknownPayload",e=>{let{topic:t}=e,{message:r}=mf("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(r)}),b2(this,"shouldIgnorePairingRequest",e=>{let{topic:t,requestMethod:r}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(r))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),b2(this,"onSessionProposeRequest",async e=>{let{topic:t,payload:r,attestation:i,encryptedId:n}=e,{params:s,id:a}=r;try{let e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),e?.setError("proposal_listener_not_found")),this.isValidConnect(b1({},r.params));let o=s.expiryTimestamp||hG(bB.wc_sessionPropose.req.ttl),l=b1({id:a,pairingTopic:t,expiryTimestamp:o,attestation:i,encryptedId:n},s);await this.setProposal(a,l);let c=await this.getVerifyContext({attestationId:i,hash:gB(JSON.stringify(r)),encryptedId:n,metadata:l.proposer.metadata});e?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:a,params:l,verifyContext:c})}catch(e){await this.sendError({id:a,topic:t,error:e,rpcOpts:bB.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),b2(this,"onSessionProposeResponse",async(e,t,r)=>{let{id:i}=t;if((0,m8.isJsonRpcResult)(t)){let{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});let s=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:s});let a=s.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});let o=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});let l=await this.client.core.crypto.generateSharedKey(a,o);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:e,proposalId:i,publicKey:a});let c=await this.client.core.relayer.subscribe(l,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:c}),await this.client.core.pairing.activate({topic:e})}else if((0,m8.isJsonRpcError)(t)){await this.deleteProposal(i);let e=hY("session_connect",i);if(0===this.events.listenerCount(e))throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),b2(this,"onSessionSettleRequest",async(e,t)=>{let{id:r,params:i}=t;try{let r,n;this.isValidSessionSettleRequest(i);let{relay:s,controller:a,expiry:o,namespaces:l,sessionProperties:c,scopedProperties:d,sessionConfig:u}=t.params,h=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!h)return this.client.logger.error(`Pending session not found for topic ${e}`);let p=this.client.proposal.get(h.proposalId),f=(r=b1(b1(b1({topic:e,relay:s,expiry:o,namespaces:l,acknowledged:!0,pairingTopic:h.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:h.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},c&&{sessionProperties:c}),d&&{scopedProperties:d}),u&&{sessionConfig:u}),n={transportType:wf},bG(r,bZ(n)));await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit("session_connect",{session:f}),this.events.emit(hY("session_connect",h.proposalId),{session:f}),this.pendingSessions.delete(h.proposalId),this.deleteProposal(h.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:t.id,topic:e,result:!0})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),b2(this,"onSessionSettleResponse",async(e,t)=>{let{id:r}=t;(0,m8.isJsonRpcResult)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(hY("session_approve",r),{})):(0,m8.isJsonRpcError)(t)&&(await this.client.session.delete(e,my("USER_DISCONNECTED")),this.events.emit(hY("session_approve",r),{error:t.error}))}),b2(this,"onSessionUpdateRequest",async(e,t)=>{let{params:r,id:i}=t;try{let t=`${e}_session_update`,n=mN.get(t);if(n&&this.isRequestOutOfSync(n,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:e,error:my("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(b1({topic:e},r));try{mN.set(t,i),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:e,result:!0})}catch(e){throw mN.delete(t),e}this.client.events.emit("session_update",{id:i,topic:e,params:r})}catch(t){await this.sendError({id:i,topic:e,error:t}),this.client.logger.error(t)}}),b2(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),b2(this,"onSessionUpdateResponse",(e,t)=>{let{id:r}=t,i=hY("session_update",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("session_update",r),{}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("session_update",r),{error:t.error})}),b2(this,"onSessionExtendRequest",async(e,t)=>{let{id:r}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,hG(bW)),await this.sendResult({id:r,topic:e,result:!0}),this.client.events.emit("session_extend",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),b2(this,"onSessionExtendResponse",(e,t)=>{let{id:r}=t,i=hY("session_extend",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("session_extend",r),{}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("session_extend",r),{error:t.error})}),b2(this,"onSessionPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),b2(this,"onSessionPingResponse",(e,t)=>{let{id:r}=t,i=hY("session_ping",r);setTimeout(()=>{if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners 2176`);(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("session_ping",r),{}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("session_ping",r),{error:t.error})},500)}),b2(this,"onSessionDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await Promise.all([new Promise(t=>{this.client.core.relayer.once(wo,async()=>{t(await this.deleteSession({topic:e,id:r}))})}),this.sendResult({id:r,topic:e,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:my("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),b2(this,"onSessionRequest",async e=>{var t,r,i;let{topic:n,payload:s,attestation:a,encryptedId:o,transportType:l}=e,{id:c,params:d}=s;try{await this.isValidRequest(b1({topic:n},d));let e=this.client.session.get(n),s=await this.getVerifyContext({attestationId:a,hash:gB(JSON.stringify((0,m3.formatJsonRpcRequest)("wc_sessionRequest",d,c))),encryptedId:o,metadata:e.peer.metadata,transportType:l}),u={id:c,topic:n,params:d,verifyContext:s};await this.setPendingSessionRequest(u),l===wp&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(r=e.peer.metadata.redirect)?void 0:r.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(u):(this.addSessionRequestToSessionRequestQueue(u),this.processSessionRequestQueue())}catch(e){await this.sendError({id:c,topic:n,error:e}),this.client.logger.error(e)}}),b2(this,"onSessionRequestResponse",(e,t)=>{let{id:r}=t,i=hY("session_request",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("session_request",r),{result:t.result}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("session_request",r),{error:t.error})}),b2(this,"onSessionEventRequest",async(e,t)=>{let{id:r,params:i}=t;try{let t=`${e}_session_event_${i.event.name}`,n=mN.get(t);if(n&&this.isRequestOutOfSync(n,r))return void this.client.logger.info(`Discarding out of sync request - ${r}`);this.isValidEmit(b1({topic:e},i)),this.client.events.emit("session_event",{id:r,topic:e,params:i}),mN.set(t,r)}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),b2(this,"onSessionAuthenticateResponse",(e,t)=>{let{id:r}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,m8.isJsonRpcResult)(t)?this.events.emit(hY("session_request",r),{result:t.result}):(0,m8.isJsonRpcError)(t)&&this.events.emit(hY("session_request",r),{error:t.error})}),b2(this,"onSessionAuthenticateRequest",async e=>{var t;let{topic:r,payload:i,attestation:n,encryptedId:s,transportType:a}=e;try{let{requester:e,authPayload:o,expiryTimestamp:l}=i.params,c=await this.getVerifyContext({attestationId:n,hash:gB(JSON.stringify(i)),encryptedId:s,metadata:e.metadata,transportType:a}),d={requester:e,pairingTopic:r,id:i.id,authPayload:o,verifyContext:c,expiryTimestamp:l};await this.setAuthRequest(i.id,{request:d,pairingTopic:r,transportType:a}),a===wp&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:i.params,id:i.id,verifyContext:c})}catch(s){this.client.logger.error(s);let e=i.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),n=this.getAppLinkIfEnabled(i.params.requester.metadata,a);await this.sendError({id:i.id,topic:r,error:s,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:t},rpcOpts:bB.wc_sessionAuthenticate.autoReject,appLink:n})}}),b2(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),b2(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=bq,this.processSessionRequestQueue()},(0,dT.toMiliseconds)(this.requestQueueDelay))}),b2(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{let r=this.client.core.history.pending;r.length>0&&r.filter(t=>t.topic===e&&"wc_sessionRequest"===t.request.method).forEach(e=>{let r=hY("session_request",e.request.id);if(0===this.events.listenerCount(r))throw Error(`emitting ${r} without any listeners`);this.events.emit(hY("session_request",e.request.id),{error:t})})}),b2(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===bH)return void this.client.logger.info("session request queue is already active.");let e=this.sessionRequestQueue.queue[0];if(!e)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),b2(this,"emitSessionRequest",e=>{this.emittedSessionRequests.has(e.id)?this.client.logger.warn({id:e.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${e.id}`):(this.sessionRequestQueue.state=bH,this.emittedSessionRequests.add(e.id),this.client.events.emit("session_request",e))}),b2(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,m3.formatJsonRpcRequest)("wc_sessionPropose",bG(b1({},t),bZ({requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties})),t.id),attestation:t.attestation,encryptedId:t.encryptedId})}),b2(this,"isValidConnect",async e=>{let t;if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=e;if(mw(r)||await this.isValidPairingTopic(r),t=!1,o?o&&mg(o)&&o.length&&o.forEach(e=>{t=mS(e)}):t=!0,!t){let{message:e}=mf("MISSING_OR_INVALID",`connect() relays: ${o}`);throw Error(e)}if(i&&!mw(i)&&0!==mm(i)){let e="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(i,"requiredNamespaces")}if(n&&!mw(n)&&0!==mm(n)&&this.validateNamespaces(n,"optionalNamespaces"),s&&!mw(s)&&this.validateSessionProps(s,"sessionProperties"),a&&!mw(a)){this.validateSessionProps(a,"scopedProperties");let e=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(t=>e.includes(t.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),b2(this,"validateNamespaces",(e,t)=>{let r=function(e,t,r){let i=null;if(e&&mm(e)){let n,s=mI(e,t);s&&(i=s);let a=(n=null,Object.entries(e).forEach(([e,i])=>{var s,a;let o;if(n)return;let l=(s=hE(e,i),a=`${t} ${r}`,o=null,mg(s)&&s.length?s.forEach(e=>{o||m_(e)||(o=my("UNSUPPORTED_CHAINS",`${a}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):m_(e)||(o=my("UNSUPPORTED_CHAINS",`${a}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o);l&&(n=l)}),n);a&&(i=a)}else i=mf("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return i}(e,"connect()",t);if(r)throw Error(r.message)}),b2(this,"isValidApprove",async e=>{if(!mk(e))throw Error(mf("MISSING_OR_INVALID",`approve() params: ${e}`).message);let{id:t,namespaces:r,relayProtocol:i,sessionProperties:n,scopedProperties:s}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let a=this.client.proposal.get(t),o=mA(r,"approve()");if(o)throw Error(o.message);let l=mC(a.requiredNamespaces,r,"approve()");if(l)throw Error(l.message);if(!mv(i,!0)){let{message:e}=mf("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw Error(e)}if(n&&!mw(n)&&this.validateSessionProps(n,"sessionProperties"),s&&!mw(s)){this.validateSessionProps(s,"scopedProperties");let e=new Set(Object.keys(r));if(!Object.keys(s).every(t=>e.has(t.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(s)}, approved namespaces: ${Array.from(e).join(", ")}`)}}),b2(this,"isValidReject",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`reject() params: ${e}`);throw Error(t)}let{id:t,reason:r}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!r||"object"!=typeof r||!r.code||!mb(r.code,!1)||!r.message||!mv(r.message,!1)){let{message:e}=mf("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw Error(e)}}),b2(this,"isValidSessionSettleRequest",e=>{let t;if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:r,controller:i,namespaces:n,expiry:s}=e;if(!mS(r)){let{message:e}=mf("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(e)}let a=(t=null,mv(i?.publicKey,!1)||(t=mf("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),t);if(a)throw Error(a.message);let o=mA(n,"onSessionSettleRequest()");if(o)throw Error(o.message);if(hZ(s)){let{message:e}=mf("EXPIRED","onSessionSettleRequest()");throw Error(e)}}),b2(this,"isValidUpdate",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let i=this.client.session.get(t),n=mA(r,"update()");if(n)throw Error(n.message);let s=mC(i.requiredNamespaces,r,"update()");if(s)throw Error(s.message)}),b2(this,"isValidExtend",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),b2(this,"isValidRequest",async e=>{var t;let r;if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`request() params: ${e}`);throw Error(t)}let{topic:i,request:n,chainId:s,expiry:a}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);let{namespaces:o}=this.client.session.get(i);if(!mT(o,s)){let{message:e}=mf("MISSING_OR_INVALID",`request() chainId: ${s}`);throw Error(e)}if(mw(n)||!mv(n.method,!1)){let{message:e}=mf("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw Error(e)}if(!(mv(t=n.method,!1)&&(r=[],Object.values(o).forEach(e=>{mo(e.accounts).includes(s)&&r.push(...e.methods)}),r).includes(t))){let{message:e}=mf("MISSING_OR_INVALID",`request() method: ${n.method}`);throw Error(e)}if(a&&(!mb(a,!1)||!(a<=bF.max)||!(a>=bF.min))){let{message:e}=mf("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${bF.min} and ${bF.max}`);throw Error(e)}}),b2(this,"isValidRespond",async e=>{var t;if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`respond() params: ${e}`);throw Error(t)}let{topic:r,response:i}=e;try{await this.isValidSessionTopic(r)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(mw(i)||mw(i.result)&&mw(i.error)||!mb(i.id,!1)||!mv(i.jsonrpc,!1)){let{message:e}=mf("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw Error(e)}let n=this.client.pendingRequest.get(i.id);if(n.topic!==r){let{message:e}=mf("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${n.topic}, received topic: ${r}`);throw Error(e)}}),b2(this,"isValidPing",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),b2(this,"isValidEmit",async e=>{var t;let r;if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`emit() params: ${e}`);throw Error(t)}let{topic:i,event:n,chainId:s}=e;await this.isValidSessionTopic(i);let{namespaces:a}=this.client.session.get(i);if(!mT(a,s)){let{message:e}=mf("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw Error(e)}if(mw(n)||!mv(n.name,!1)||!(mv(t=n.name,!1)&&(r=[],Object.values(a).forEach(e=>{mo(e.accounts).includes(s)&&r.push(...e.events)}),r).includes(t))){let{message:e}=mf("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw Error(e)}}),b2(this,"isValidDisconnect",async e=>{if(!mk(e)){let{message:t}=mf("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),b2(this,"isValidAuthenticate",e=>{let{chains:t,uri:r,domain:i,nonce:n}=e;if(!Array.isArray(t)||0===t.length)throw Error("chains is required and must be a non-empty array");if(!mv(r,!1))throw Error("uri is required parameter");if(!mv(i,!1))throw Error("domain is required parameter");if(!mv(n,!1))throw Error("nonce is required parameter");if([...new Set(t.map(e=>hb(e).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:s}=hb(t[0]);if("eip155"!==s)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),b2(this,"getVerifyContext",async e=>{let{attestationId:t,hash:r,encryptedId:i,metadata:n,transportType:s}=e,a={verified:{verifyUrl:n.verifyUrl||wC,validation:"UNKNOWN",origin:n.url||""}};try{if(s===wp){let e=this.getAppLinkIfEnabled(n,s);return a.verified.validation=e&&new URL(e).origin===new URL(n.url).origin?"VALID":"INVALID",a}let e=await this.client.core.verify.resolve({attestationId:t,hash:r,encryptedId:i,verifyUrl:n.verifyUrl});e&&(a.verified.origin=e.origin,a.verified.isScam=e.isScam,a.verified.validation=e.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),b2(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((r,i)=>{if(null==r){let{message:n}=mf("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${r} for key ${Object.keys(e)[i]}`);throw Error(n)}})}),b2(this,"getPendingAuthRequest",e=>{let t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),b2(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let r of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(r)}}}),b2(this,"checkRecentlyDeleted",e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:r}=mf("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw Error(r)}}),b2(this,"isLinkModeEnabled",(t,r)=>{var i,n,s,a,o,l,c,d,u;return!!t&&r===wp&&(null==(n=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:n.linkMode)===!0&&(null==(a=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:a.universal)!==void 0&&(null==(l=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:l.universal)!==""&&(null==(c=t?.redirect)?void 0:c.universal)!==void 0&&(null==(d=t?.redirect)?void 0:d.universal)!==""&&(null==(u=t?.redirect)?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&"u">typeof(null==e.g?void 0:e.g.Linking)}),b2(this,"getAppLinkIfEnabled",(e,t)=>{var r;return this.isLinkModeEnabled(e,t)?null==(r=e?.redirect)?void 0:r.universal:void 0}),b2(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;let t=h1(e,"topic")||"",r=decodeURIComponent(h1(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:wp}),this.client.core.dispatchEnvelope({topic:t,message:r,sessionExists:i})}),b2(this,"registerLinkModeListeners",async()=>{var t;if(h5()||hD()&&null!=(t=this.client.metadata.redirect)&&t.linkMode){let t=null==e.g?void 0:e.g.Linking;if("u">typeof t){t.addEventListener("url",this.handleLinkModeMessage,this.client.name);let e=await t.getInitialURL();e&&setTimeout(()=>{this.handleLinkModeMessage({url:e})},50)}}}),b2(this,"getTVFParams",(e,t,r)=>{var i,n,s;if(!(null!=(i=t.request)&&i.method))return{};let a={correlationId:e,rpcMethods:[t.request.method],chainId:t.chainId};try{a.txHashes=this.extractTxHashesFromResult(t.request,r),a.contractAddresses=this.isValidContractData(t.request.params)?[null==(s=null==(n=t.request.params)?void 0:n[0])?void 0:s.to]:[]}catch(e){this.client.logger.warn(e,"Error getting TVF params")}return a}),b2(this,"isValidContractData",e=>{var t;if(!e)return!1;try{let r=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!r.startsWith("0x"))return!1;let i=r.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),b2(this,"extractTxHashesFromResult",(e,t)=>{var r,i,n,s,a;try{if(!t)return[];let o=e.method,l=bz[o];if("sui_signTransaction"===o){let e,r,i,s;return[(n=t.transactionBytes,e=new Uint8Array(ed.Buffer.from(n,"base64")),r=Array.from("TransactionData::").map(e=>e.charCodeAt(0)),(i=new Uint8Array(r.length+e.length)).set(r),i.set(e,r.length),s=fw(i,{dkLen:32}),uZ.default.encode(s))]}if("near_signTransaction"===o)return[fE(t)];if("near_signTransactions"===o)return t.map(e=>fE(e));if("xrpl_signTransactionFor"===o||"xrpl_signTransaction"===o)return[null==(r=t.tx_json)?void 0:r.hash];if("polkadot_signTransaction"===o){let r,n,s,a;return[(i={transaction:e.params.transactionPayload,signature:t.signature},s=Uint8Array.from(ed.Buffer.from(i.signature,"hex")),a=function({publicKey:e,signature:t,payload:r}){var i,n,s;let a,o=mM(r.method),l=128|parseInt((null==(i=r.version)?void 0:i.toString())||"4"),c=(n=r.address,a=uZ.default.decode(n)[0],42===a?0:60===a?2:1),d="00"===r.era?new Uint8Array([0]):mM(r.era);if(1!==d.length&&2!==d.length)throw Error("Invalid era length");let u=parseInt(r.nonce,16),h=new Uint8Array([255&u,u>>8&255]),p=new Uint8Array([0,...e,c,...t,...d,...h,...function(e){if(e<BigInt(1)<<BigInt(6))return new Uint8Array([Number(e<<BigInt(2))]);if(e<BigInt(1)<<BigInt(14)){let t=e<<BigInt(2)|BigInt(1);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255))])}if(e<BigInt(1)<<BigInt(30)){let t=e<<BigInt(2)|BigInt(2);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255)),Number(t>>BigInt(16)&BigInt(255)),Number(t>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(s=r.tip).startsWith("0x")?s.slice(2):s}`)),...o]);return new Uint8Array([...function(e){if(e<64)return new Uint8Array([e<<2]);if(e<16384){let t=e<<2|1;return new Uint8Array([255&t,t>>8&255])}if(e<0x40000000){let t=e<<2|2;return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(p.length+1),l,...p])}({publicKey:function(e){let t=uZ.default.decode(e);if(t.length<33)throw Error("Too short to contain a public key");return t.slice(1,33)}(i.transaction.address),signature:s,payload:i.transaction}),r=mM(ed.Buffer.from(a).toString("hex")),n=(0,u3.blake2b)(r,void 0,32),"0x"+ed.Buffer.from(n).toString("hex"))]}if("algo_signTxn"===o)return mg(t)?t.map(e=>fI(e)):[fI(t)];if("cosmos_signDirect"===o){let e,r,i,n,s;return[(e=ed.Buffer.from(t.signed.bodyBytes,"base64"),r=ed.Buffer.from(t.signed.authInfoBytes,"base64"),i=ed.Buffer.from(t.signature.signature,"base64"),(n=[]).push(ed.Buffer.from([10])),n.push(fA(e.length)),n.push(e),n.push(ed.Buffer.from([18])),n.push(fA(r.length)),n.push(r),n.push(ed.Buffer.from([26])),n.push(fA(i.length)),n.push(i),s=fo(ed.Buffer.concat(n)),ed.Buffer.from(s).toString("hex").toUpperCase())]}if("wallet_sendCalls"===o){let e=[];try{if("string"==typeof t)return e.push(t),e;if("object"!=typeof t)return e;null!=t&&t.id&&e.push(t.id);let r=null==(a=null==(s=t?.capabilities)?void 0:s.caip345)?void 0:a.transactionHashes;r&&e.push(...r)}catch(e){console.warn("getWalletSendCallsHashes failed: ",e)}return e}if("string"==typeof t)return[t];let c=t[l.key];if(mg(c))return"solana_signAllTransactions"===o?c.map(e=>(function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);let i=r[0];if(0===i)throw Error("No signatures found");if(r.length<1+64*i)throw Error("Transaction data too short for claimed signature count");if(r.length<100)throw Error("Transaction too short");let n=ed.Buffer.from(e,"base64").slice(1,65);return uZ.default.encode(n)})(e)):c;if("string"==typeof c)return[c]}catch(e){this.client.logger.warn(e,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,r]of Object.entries(t))for(let t of r)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=mf("NOT_INITIALIZED",this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(wn,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:r,attestation:i,transportType:n}=e,{publicKey:s}=this.client.auth.authKeys.keys.includes(bV)?this.client.auth.authKeys.get(bV):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,r,{receiverPublicKey:s,encoding:n===wp?gD:gU});(0,m8.isJsonRpcRequest)(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:i,transportType:n,encryptedId:gB(r)})):(0,m8.isJsonRpcResponse)(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:n}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:n}),await this.client.core.relayer.messages.ack(t,r)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(wT,async e=>{let{topic:t,id:r}=hJ(e.target);return r&&this.client.pendingRequest.keys.includes(r)?await this.deletePendingSessionRequest(r,mf("EXPIRED"),!0):r&&this.client.auth.requests.keys.includes(r)?await this.deletePendingAuthRequest(r,mf("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r})))})}registerPairingEvents(){this.client.core.pairing.events.on(wb,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(w_,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!mv(e,!1)){let{message:t}=mf("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=mf("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(hZ(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=mf("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!mv(e,!1)){let{message:t}=mf("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=mf("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw Error(t)}if(hZ(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=mf("EXPIRED",`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=mf("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(mv(e,!1)){let{message:t}=mf("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=mf("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if("number"!=typeof e){let{message:t}=mf("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=mf("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw Error(t)}if(hZ(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=mf("EXPIRED",`proposal id: ${e}`);throw Error(t)}}}class b3 extends bi{constructor(e,t){super(e,t,"proposal",bD),this.core=e,this.logger=t}}class b8 extends bi{constructor(e,t){super(e,t,"session",bD),this.core=e,this.logger=t}}class b4 extends bi{constructor(e,t){super(e,t,"request",bD,e=>e.id),this.core=e,this.logger=t}}class b6 extends bi{constructor(e,t){super(e,t,"authKeys",bK,()=>bV),this.core=e,this.logger=t}}class b9 extends bi{constructor(e,t){super(e,t,"pairingTopics",bK),this.core=e,this.logger=t}}class b7 extends bi{constructor(e,t){super(e,t,"requests",bK,e=>e.id),this.core=e,this.logger=t}}var _e=Object.defineProperty,_t=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?_e(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class _r{constructor(e,t){this.core=e,this.logger=t,_t(this,"authKeys"),_t(this,"pairingTopics"),_t(this,"requests"),this.authKeys=new b6(this.core,this.logger),this.pairingTopics=new b9(this.core,this.logger),this.requests=new b7(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var _i=Object.defineProperty,_n=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?_i(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class _s extends m1{constructor(e){super(e),_n(this,"protocol","wc"),_n(this,"version",2),_n(this,"name",bU),_n(this,"metadata"),_n(this,"core"),_n(this,"logger"),_n(this,"events",new dS.EventEmitter),_n(this,"engine"),_n(this,"session"),_n(this,"proposal"),_n(this,"pendingRequest"),_n(this,"auth"),_n(this,"signConfig"),_n(this,"on",(e,t)=>this.events.on(e,t)),_n(this,"once",(e,t)=>this.events.once(e,t)),_n(this,"off",(e,t)=>this.events.off(e,t)),_n(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),_n(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),_n(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"update",async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"request",async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"find",e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),_n(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),_n(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||bU,this.metadata=function(e){var t,r;let i=hB();try{let n,s;return null!=e&&e.url&&i.url&&new URL(e.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),e.url=i.url),null!=(t=e?.icons)&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>""!==e)),n=hP(hP({},i),e),s={url:e?.url||i.url,name:e?.name||i.name,description:e?.description||i.description,icons:null!=(r=e?.icons)&&r.length&&e.icons.length>0?e.icons:i.icons},hA(n,hS(s))}catch(t){return console.warn("Error populating app metadata",t),e||i}}(e?.metadata),this.signConfig=e?.signConfig;const t=mU({logger:e?.logger||"error",name:this.name});this.logger=t,this.core=e?.core||new bM(e),this.session=new b8(this.core,this.logger),this.proposal=new b3(this.core,this.logger),this.pendingRequest=new b4(this.core,this.logger),this.engine=new b5(this),this.auth=new _r(this.core,this.logger)}static async init(e){let t=new _s(e);return await t.initialize(),t}get context(){return hm(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var _a=e.i(646274);function _o(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function _l(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function _c(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let _d="[object String]",_u="[object Number]",_h="[object Boolean]",_p="[object Arguments]";function _f(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function _y(e,t,r,i=new Map,n){let s=n?.(e,t,r,i);if(null!=s)return s;if(_o(e))return e;if(i.has(e))return i.get(e);if(Array.isArray(e)){let t=Array(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=_y(e[s],s,r,i,n);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[s,a]of(i.set(e,t),e))t.set(s,_y(a,s,r,i,n));return t}if(e instanceof Set){let t=new Set;for(let s of(i.set(e,t),e))t.add(_y(s,void 0,r,i,n));return t}if("u">typeof ed.Buffer&&ed.Buffer.isBuffer(e))return e.subarray();if(_f(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=_y(e[s],s,r,i,n);return t}if(e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return i.set(e,t),_g(t,e,r,i,n),t}if("u">typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return i.set(e,t),_g(t,e,r,i,n),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return i.set(e,t),_g(t,e,r,i,n),t}if(e instanceof Error){let t=new e.constructor;return i.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,_g(t,e,r,i,n),t}if("object"==typeof e&&function(e){switch(_c(e)){case _p:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case _h:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case _u:case"[object Object]":case"[object RegExp]":case"[object Set]":case _d:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return i.set(e,t),_g(t,e,r,i,n),t}return e}function _g(e,t,r=e,i,n){let s=[...Object.keys(t),..._l(t)];for(let a=0;a<s.length;a++){let o=s[a],l=Object.getOwnPropertyDescriptor(e,o);(null==l||l.writable)&&(e[o]=_y(t[o],o,r,i,n))}}function _m(e){var t;return t=(t,r,i,n)=>{let s;if(null!=s)return s;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case _u:case _d:case _h:{let t=new e.constructor(e?.valueOf());return _g(t,e),t}case _p:{let t={};return _g(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}},_y(e,void 0,e,new Map,t)}function _w(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===_c(e)}function _v(e){return"object"==typeof e&&null!==e}function _b(){}let __="error",_E="universal_provider",_I=`wc@2:${_E}:`,_A="https://rpc.walletconnect.org/v1/",_S="generic",_k=`${_A}bundler`,_T="call_status",_C="default_chain_changed";var _x=Object.defineProperty,_P=Object.defineProperties,_O=Object.getOwnPropertyDescriptors,_R=Object.getOwnPropertySymbols,_N=Object.prototype.hasOwnProperty,_M=Object.prototype.propertyIsEnumerable,_U=(e,t,r)=>t in e?_x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_D=(e,t)=>{for(var r in t||(t={}))_N.call(t,r)&&_U(e,r,t[r]);if(_R)for(var r of _R(t))_M.call(t,r)&&_U(e,r,t[r]);return e},_L=(e,t)=>_P(e,_O(t));function _j(e,t,r){var i;let n=hb(e);return(null==(i=t.rpcMap)?void 0:i[n.reference])||`${_A}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function _W(e){return e.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function _B(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>{var r,i;return(null==(r=t?.chains)?void 0:r.length)&&(null==(i=t?.chains)?void 0:i.length)>0}))}function _F(e={},t={}){return function(e,...t){return function(e,...t){let r=t.slice(0,-1),i=t[t.length-1],n=e;for(let e=0;e<r.length;e++)n=function e(t,r,i,n){if(_o(t)&&(t=Object(t)),null==r||"object"!=typeof r)return t;if(n.has(r))return function(e){if(_o(e))return e;if(Array.isArray(e)||_f(e)||e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),r=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new r(e);if(e instanceof RegExp){let t=new r(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new r(e.buffer.slice(0));if(e instanceof Error){let t=new r(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}return"u">typeof File&&e instanceof File?new r([e],e.name,{type:e.type,lastModified:e.lastModified}):"object"==typeof e?Object.assign(Object.create(t),e):e}(n.get(r));if(n.set(r,t),Array.isArray(r)){r=r.slice();for(let e=0;e<r.length;e++)r[e]=r[e]??void 0}let s=[...Object.keys(r),..._l(r)];for(let a=0;a<s.length;a++){let o=s[a],l=r[o],c=t[o];if(_w(l)&&(l={...l}),_w(c)&&(c={...c}),"u">typeof ed.Buffer&&ed.Buffer.isBuffer(l)&&(l=_m(l)),Array.isArray(l))if("object"==typeof c&&null!=c){let e=[],t=Reflect.ownKeys(c);for(let r=0;r<t.length;r++){let i=t[r];e[i]=c[i]}c=e}else c=[];let d=i(c,l,o,t,r,n);null!=d?t[o]=d:Array.isArray(l)||_v(c)&&_v(l)?t[o]=e(c,l,i,n):null==c&&function(e){if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){let t=e[Symbol.toStringTag];return null!=t&&!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(l)?t[o]=e({},l,i,n):null==c&&_f(l)?t[o]=_m(l):(void 0===c||void 0!==l)&&(t[o]=l)}return t}(n,r[e],i,new Map);return n}(e,...t,_b)}(_B(_q(e)),_B(_q(t)))}function _q(e){var t,r,i,n,s;let a={};if(!mm(e))return a;for(let[o,l]of Object.entries(e)){let e=ml(o)?[o]:l.chains,c=l.methods||[],d=l.events||[],u=l.rpcMap||{},h=mc(o);a[h]=_L(_D(_D({},a[h]),l),{chains:hQ(e,null==(t=a[h])?void 0:t.chains),methods:hQ(c,null==(r=a[h])?void 0:r.methods),events:hQ(d,null==(i=a[h])?void 0:i.events)}),(mm(u)||mm((null==(n=a[h])?void 0:n.rpcMap)||{}))&&(a[h].rpcMap=_D(_D({},u),null==(s=a[h])?void 0:s.rpcMap))}return a}function _H(e){return e.includes(":")?e.split(":")[2]:e}function _z(e){let t={};for(let[r,i]of Object.entries(e)){let e=i.methods||[],n=i.events||[],s=i.accounts||[],a=ml(r)?[r]:i.chains?i.chains:_W(i.accounts);t[r]={chains:a,methods:e,events:n,accounts:s}}return t}function _$(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):isNaN(Number(e=e.includes(":")?e.split(":")[1]:e))?e:Number(e)}let _K={},_V=e=>_K[e],_J=(e,t)=>{_K[e]=t};var _G=Object.defineProperty,_Z=Object.getOwnPropertySymbols,_Y=Object.prototype.hasOwnProperty,_Q=Object.prototype.propertyIsEnumerable,_X=(e,t,r)=>t in e?_G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_0=(e,t)=>{for(var r in t||(t={}))_Y.call(t,r)&&_X(e,r,t[r]);if(_Z)for(var r of _Z(t))_Q.call(t,r)&&_X(e,r,t[r]);return e};let _1="eip155",_2=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],_5=e=>e&&e.startsWith("0x")?BigInt(e).toString(10):e,_3=e=>e&&e.startsWith("0x")?e:`0x${BigInt(e).toString(16)}`,_8=e=>Object.keys(e).filter(e=>_2.includes(e)).reduce((t,r)=>(t[r]=_4(e[r]),t),{}),_4=e=>"string"==typeof e&&function(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!==t&&!Array.isArray(t)}catch{return!1}}(e)?JSON.parse(e):e;var _6=Object.defineProperty;class _9{constructor(e){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?_6(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return r||(r=new _9(e)),r}}var _7=Object.defineProperty,Ee=Object.defineProperties,Et=Object.getOwnPropertyDescriptors,Er=Object.getOwnPropertySymbols,Ei=Object.prototype.hasOwnProperty,En=Object.prototype.propertyIsEnumerable,Es=(e,t,r)=>t in e?_7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;async function Ea(e,t){let r,i=hb(e.result.capabilities.caip345.caip2),n=e.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(e=>Eo(i.reference,e,t))),a=s.filter(e=>"fulfilled"===e.status).map(e=>e.value).filter(e=>e);s.filter(e=>"rejected"===e.status).forEach(e=>console.warn("Failed to fetch transaction receipt:",e.reason));let o=!a.length||a.some(e=>!e),l=a.every(e=>e?.status==="0x1"),c=a.every(e=>e?.status==="0x0"),d=a.some(e=>e?.status==="0x0");return o?r=100:l?r=200:c?r=500:d&&(r=600),{id:e.result.id,version:e.request.version,atomic:e.request.atomicRequired,chainId:e.request.chainId,capabilities:e.result.capabilities,receipts:a,status:r}}async function Eo(e,t,r){return await r(parseInt(e)).request((0,m3.formatJsonRpcRequest)("eth_getTransactionReceipt",[t]))}async function El({sendCalls:e,storage:t}){let r=await t.getItem(_T);await t.setItem(_T,Ee(((e,t)=>{for(var r in t||(t={}))Ei.call(t,r)&&Es(e,r,t[r]);if(Er)for(var r of Er(t))En.call(t,r)&&Es(e,r,t[r]);return e})({},r),Et({[e.result.id]:{request:e.request,result:e.result,expiry:hG(86400)}})))}async function Ec({resultId:e,storage:t}){let r=await t.getItem(_T);if(r){for(let i in delete r[e],await t.setItem(_T,r),r)hZ(r[i].expiry)&&delete r[i];await t.setItem(_T,r)}}async function Ed({resultId:e,storage:t}){let r=await t.getItem(_T),i=r?.[e];if(i&&!hZ(i.expiry))return i;await Ec({resultId:e,storage:t})}var Eu=Object.defineProperty,Eh=Object.defineProperties,Ep=Object.getOwnPropertyDescriptors,Ef=Object.getOwnPropertySymbols,Ey=Object.prototype.hasOwnProperty,Eg=Object.prototype.propertyIsEnumerable,Em=(e,t,r)=>t in e?Eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ew=(e,t)=>{for(var r in t||(t={}))Ey.call(t,r)&&Em(e,r,t[r]);if(Ef)for(var r of Ef(t))Eg.call(t,r)&&Em(e,r,t[r]);return e},Ev=(e,t,r)=>Em(e,"symbol"!=typeof t?t+"":t,r);class Eb{constructor(e){Ev(this,"name","eip155"),Ev(this,"client"),Ev(this,"chainId"),Ev(this,"namespace"),Ev(this,"httpProviders"),Ev(this,"events"),Ev(this,"storage"),this.namespace=e.namespace,this.events=_V("events"),this.client=_V("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=_9.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(_C,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let r=t||_j(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return new m5.JsonRpcProvider(new _a.HttpConnection(r,_V("disableProviderPing")))}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=parseInt(t.includes(":")?t.split(":")[1]:t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(e){let t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=Eh(Ew({},this.httpProviders),Ep({[t]:this.createHttpProvider(t)})),this.httpProviders[t])}async handleSwitchChain(e){var t,r;let i=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0",n=parseInt(i=i.startsWith("0x")?i:`0x${i}`,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:null==(r=this.namespace.chains)?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,i,n,s;let a,o=null==(r=null==(t=e.request)?void 0:t.params)?void 0:r[0],l=(null==(n=null==(i=e.request)?void 0:i.params)?void 0:n[1])||[];if(!o)throw Error("Missing address parameter in `wallet_getCapabilities` request");let c=this.client.session.get(e.topic),d=(null==(s=c?.sessionProperties)?void 0:s.capabilities)||{},u=`${o}${l.join(",")}`,h=d?.[u];if(h)return h;try{a=((e,t,r)=>{let{sessionProperties:i={},scopedProperties:n={}}=e,s={};if(!mm(n)&&!mm(i))return;let a=_8(i);for(let e of r){let r=_5(e);if(!r)continue;s[_3(r)]=a;let i=n?.[`${_1}:${r}`];if(i){let e=i?.[`${_1}:${r}:${t}`];s[_3(r)]=_0(_0({},s[_3(r)]),_8(e||i))}}for(let[e,t]of Object.entries(s))0===Object.keys(t).length&&delete s[e];return Object.keys(s).length>0?s:void 0})(c,o,l)}catch(e){console.warn("Failed to extract capabilities from session",e)}if(a)return a;let p=await this.client.request(e);try{let t,r,i,n;await this.client.session.update(e.topic,{sessionProperties:(i=Ew({},c.sessionProperties||{}),n={capabilities:(t=Ew({},d||{}),r={[u]:p},Eh(t,Ep(r)))},Eh(i,Ep(n)))})}catch(e){console.warn("Failed to update session with capabilities",e)}return p}async getCallStatus(e){var t,r,i;let n=this.client.session.get(e.topic),s=null==(t=n.sessionProperties)?void 0:t.bundler_name;if(s){let t=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn("Failed to fetch call status from bundler",e,t)}}let a=null==(r=n.sessionProperties)?void 0:r.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(e){console.warn("Failed to fetch call status from custom bundler",e,a)}let o=await Ed({resultId:null==(i=e.request.params)?void 0:i[0],storage:this.storage});if(o)try{return await Ea(o,this.getHttpProvider.bind(this))}catch(e){console.warn("Failed to fetch call status from stored send calls",e,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;let i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,m3.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(r=t.request.params)?void 0:r[0]]))});if(!n.ok)throw Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${_k}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,r,i;let n=await this.client.request(e),s=null==(t=e.request.params)?void 0:t[0],a=n?.id,o=n?.capabilities||{},l=null==(r=o?.caip345)?void 0:r.caip2,c=null==(i=o?.caip345)?void 0:i.transactionHashes;return a&&l&&null!=c&&c.length&&await El({sendCalls:{request:s,result:n},storage:this.storage}),n}}var E_=Object.defineProperty,EE=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?E_(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class EI{constructor(e){EE(this,"name",_S),EE(this,"client"),EE(this,"httpProviders"),EE(this,"events"),EE(this,"namespace"),EE(this,"chainId"),this.namespace=e.namespace,this.events=_V("events"),this.client=_V("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t);let r=this.chainId;this.chainId=e,this.events.emit(_C,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return hb(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;let r={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{var t,i;let n=hb(e),s=null==(i=null==(t=this.namespace)?void 0:t.rpcMap)?void 0:i[`${n.namespace}:${n.reference}`];r[n.reference]=this.createHttpProvider(e,s)}),r}getHttpProvider(e){let t=hb(e).reference,r=this.httpProviders[t];if(typeof r>"u")throw Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||_j(e,this.namespace,this.client.core.projectId);return new m5.JsonRpcProvider(new _a.default(r,_V("disableProviderPing")))}}var EA=Object.defineProperty,ES=Object.defineProperties,Ek=Object.getOwnPropertyDescriptors,ET=Object.getOwnPropertySymbols,EC=Object.prototype.hasOwnProperty,Ex=Object.prototype.propertyIsEnumerable,EP=(e,t,r)=>t in e?EA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,EO=(e,t)=>{for(var r in t||(t={}))EC.call(t,r)&&EP(e,r,t[r]);if(ET)for(var r of ET(t))Ex.call(t,r)&&EP(e,r,t[r]);return e},ER=(e,t,r)=>EP(e,"symbol"!=typeof t?t+"":t,r);class EN{constructor(e){var t,r;ER(this,"client"),ER(this,"namespaces"),ER(this,"optionalNamespaces"),ER(this,"sessionProperties"),ER(this,"scopedProperties"),ER(this,"events",new dS.default),ER(this,"rpcProviders",{}),ER(this,"session"),ER(this,"providerOpts"),ER(this,"logger"),ER(this,"uri"),ER(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=mU({logger:null!=(t=e.logger)?t:__,name:null!=(r=this.providerOpts.name)?r:_E}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let t=new EN(e);return await t.initialize(),t}async request(e,t,r){let[i,n]=this.validateChain(t);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(i).request({request:EO({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,i){let n=new Date().getTime();this.request(e,r,i).then(e=>t(null,(0,m3.formatJsonRpcResult)(n,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:my("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));let n=await i();if(this.session=n.session,this.session){let e=_z(this.session.namespaces);this.namespaces=_F(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let i=await r();this.session=i;let n=_z(i.namespaces);return this.namespaces=_F(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[r,i]=this.validateChain(e);this.getProvider(r).setDefaultChain(i,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(!mg(t))return;for(let r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(e){this.logger.warn(e,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await _s.init({core:this.providerOpts.core,logger:this.providerOpts.logger||__,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{let e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(e=>mc(e)))];_J("client",this.client),_J("events",this.events),_J("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=function(e,t){let r=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!r.length)return[];let i=[];return r.forEach(e=>{let r=t.namespaces[e].accounts;i.push(...r)}),i}(e,this.session);if(t?.length===0)return;let r=_W(t),i=ES(EO({},_F(this.namespaces,this.optionalNamespaces)[e]),Ek({accounts:t,chains:r}));"eip155"===e?this.rpcProviders[e]=new Eb({namespace:i}):this.rpcProviders[e]=new EI({namespace:i})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:r}=e;r===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:r,topic:i}=e;if(i!==(null==(t=this.session)?void 0:t.topic))return;let{event:n}=r;if("accountsChanged"===n.name){let e=n.data;e&&mg(e)&&this.events.emit("accountsChanged",e.map(_H))}else if("chainChanged"===n.name){let e=r.chainId,t=r.event.data,i=mc(e),n=_$(e)!==_$(t)?`${i}:${_$(t)}`:e;this.onChainChanged({currentCaipChainId:n})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,i;if(e!==(null==(r=this.session)?void 0:r.topic))return;let{namespaces:n}=t,s=null==(i=this.client)?void 0:i.session.get(e);this.session=ES(EO({},s),Ek({namespaces:n})),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",ES(EO({},my("USER_DISCONNECTED")),Ek({data:e.topic}))))}),this.on(_C,e=>{this.onChainChanged(ES(EO({},e),Ek({internal:!0})))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[_S]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:n}=e;this.optionalNamespaces=_F(t,r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){let[t,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(e=>mc(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];let i=mc(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:t,internal:r=!1}){if(!this.namespaces)return;let[i,n]=this.validateChain(e);n&&(this.updateNamespaceChain(i,n),r?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:t})):this.getProvider(i).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:t,previousCaipChainId:r}){var i,n;try{if(r===t)return;let s=null==(n=null==(i=this.session)?void 0:i.namespaces[e])?void 0:n.accounts;if(!s)return;let a=s.filter(e=>e.includes(`${t}:`)).map(_H);if(!mg(a))return;this.events.emit("accountsChanged",a)}catch(e){this.logger.warn(e,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,t){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${t}`;this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]={chains:[],methods:[],events:[],defaultChain:t}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;let i=(null==(r=this.session)?void 0:r.topic)||"";await this.client.core.storage.setItem(`${_I}/${e}${i}`,t)}async getFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${_I}/${e}${r}`)}async deleteFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${_I}/${e}${r}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;for(let e of(await this.client.core.storage.getKeys()))e.startsWith(_I)&&await this.client.core.storage.removeItem(e)}catch(e){this.logger.warn(e,"Failed to cleanup storage")}}}let EM=["eth_sendTransaction","personal_sign"],EU=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],ED=["chainChanged","accountsChanged"],EL=["chainChanged","accountsChanged","message","disconnect","connect"],Ej=async()=>{let{createAppKit:t}=await e.A(648256);return t};var EW=Object.defineProperty,EB=Object.defineProperties,EF=Object.getOwnPropertyDescriptors,Eq=Object.getOwnPropertySymbols,EH=Object.prototype.hasOwnProperty,Ez=Object.prototype.propertyIsEnumerable,E$=(e,t,r)=>t in e?EW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,EK=(e,t)=>{for(var r in t||(t={}))EH.call(t,r)&&E$(e,r,t[r]);if(Eq)for(var r of Eq(t))Ez.call(t,r)&&E$(e,r,t[r]);return e},EV=(e,t,r)=>E$(e,"symbol"!=typeof t?t+"":t,r);function EJ(e){return Number(e[0].split(":")[1])}function EG(e){return`0x${e.toString(16)}`}class EZ{constructor(){EV(this,"events",new dS.EventEmitter),EV(this,"namespace","eip155"),EV(this,"accounts",[]),EV(this,"signer"),EV(this,"chainId",1),EV(this,"modal"),EV(this,"rpc"),EV(this,"STORAGE_KEY","wc@2:ethereum_provider:"),EV(this,"on",(e,t)=>(this.events.on(e,t),this)),EV(this,"once",(e,t)=>(this.events.once(e,t),this)),EV(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),EV(this,"off",(e,t)=>(this.events.off(e,t),this)),EV(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){let t=new EZ;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,r){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),r)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);let{required:r,optional:i}=function(e){let{chains:t,optionalChains:r,methods:i,optionalMethods:n,events:s,optionalEvents:a,rpcMap:o}=e;if(!mg(t))throw Error("Invalid chains");let l={chains:t,methods:i||EM,events:s||ED,rpcMap:EK({},t.length?{[EJ(t)]:o[EJ(t)]}:{})},c=s?.filter(e=>!ED.includes(e)),d=i?.filter(e=>!EM.includes(e));if(!r&&!a&&!n&&!(null!=c&&c.length)&&!(null!=d&&d.length))return{required:t.length?l:void 0};let u={chains:[...new Set(c?.length&&d?.length||!r?l.chains.concat(r||[]):r)],methods:[...new Set(l.methods.concat(null!=n&&n.length?n:EU))],events:[...new Set(l.events.concat(null!=a&&a.length?a:EL))],rpcMap:o};return{required:t.length?l:void 0,optional:r.length?u:void 0}}(this.rpc);try{let t=await new Promise(async(t,n)=>{var s,a;let o,l;this.rpc.showQrModal&&(null==(s=this.modal)||s.open(),null==(a=this.modal)||a.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),n(Error("Connection request reset. Please try again.")))}));let c=null!=e&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect((o=EK({namespaces:EK({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),l={pairingTopic:e?.pairingTopic,scopedProperties:c},EB(o,EF(l)))).then(e=>{t(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),n(Error(e.message))})});if(!t)return;let n=h_(t.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:EG(this.chainId)})}catch(e){throw this.signer.logger.error(e),e}finally{null==(t=this.modal)||t.close()}}async authenticate(e,t){var r;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{let r=await new Promise(async(r,i)=>{var n,s;let a,o;this.rpc.showQrModal&&(null==(n=this.modal)||n.open(),null==(s=this.modal)||s.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),i(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate((a=EK({},e),o={chains:this.rpc.chains},EB(a,EF(o))),t).then(e=>{r(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),i(Error(e.message))})}),i=r.session;if(i){let e=h_(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:EG(this.chainId)})}return r}catch(e){throw this.signer.logger.error(e),e}finally{null==(r=this.modal)||r.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{let{params:t}=e,{event:r}=t;"accountsChanged"===r.name?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===r.name?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{let t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",EG(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",EB(EK({},my("USER_DISCONNECTED")),EF({data:e.topic,name:"USER_DISCONNECTED"})))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){let t=e.filter(e=>this.isCompatibleChainId(e)).map(e=>this.parseChainId(e));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",EG(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){let t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){let[t,r,i]=e.split(":");return{chainId:`${t}:${r}`,address:i}}setAccounts(e){this.accounts=e.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;let i=null!=(t=e?.chains)?t:[],n=null!=(r=e?.optionalChains)?r:[],s=i.concat(n);if(!s.length)throw Error("No chains specified in either `chains` or `optionalChains`");let a=i.length?e?.methods||EM:[],o=i.length?e?.events||ED:[],l=e?.optionalMethods||[],c=e?.optionalEvents||[],d=e?.rpcMap||this.buildRpcMap(s,e.projectId),u=e?.qrModalOptions||void 0;return{chains:i?.map(e=>this.formatChainId(e)),optionalChains:n.map(e=>this.formatChainId(e)),methods:a,events:o,optionalMethods:l,optionalEvents:c,rpcMap:d,showQrModal:!!(null!=e&&e.showQrModal),qrModalOptions:u,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){let r={};return e.forEach(e=>{r[e]=this.getRpcUrl(e,t)}),r}async initialize(e){var t;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?EJ(this.rpc.chains):EJ(this.rpc.optionalChains),this.signer=await EN.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{let r,i,n,s,a=await Ej(),{convertWCMToAppKitOptions:o}=await Promise.resolve().then(function(){return E6}),l=o((r=EK({},this.rpc.qrModalOptions),i={chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId},EB(r,EF(i))));if(!l.networks.length)throw Error("No networks found for WalletConnect");e=a((n=EK({},l),s={universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:(null==(t=this.rpc.qrModalOptions)?void 0:t.enableMobileFullScreen)===!0},EB(n,EF(s))))}catch(e){throw console.warn(e),Error("To use QR modal, please install @reown/appkit package")}if(e)try{this.modal=e}catch(e){throw this.signer.logger.error(e),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;let{chains:t,optionalChains:r,rpcMap:i}=e;t&&mg(t)&&(this.rpc.chains=t.map(e=>this.formatChainId(e)),t.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)})),r&&mg(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(e=>this.formatChainId(e)),r.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)}))}getRpcUrl(e,t){var r;return(null==(r=this.rpc.rpcMap)?void 0:r[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(e=>this.parseAccount(e))}}var EY=Object.defineProperty,EQ=Object.defineProperties,EX=Object.getOwnPropertyDescriptors,E0=Object.getOwnPropertySymbols,E1=Object.prototype.hasOwnProperty,E2=Object.prototype.propertyIsEnumerable,E5=(e,t,r)=>t in e?EY(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E3=(e,t)=>{for(var r in t||(t={}))E1.call(t,r)&&E5(e,r,t[r]);if(E0)for(var r of E0(t))E2.call(t,r)&&E5(e,r,t[r]);return e};let E8=e=>{let[t,r]=e.split(":");return E4({id:r,caipNetworkId:e,chainNamespace:t,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function E4(e){return E3({formatters:void 0,fees:void 0,serializers:void 0},e)}var E6=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(e){var t,r,i,n,s,a,o;let l=null==(t=e.chains)?void 0:t.map(E8).filter(Boolean);if(0===l.length)throw Error("At least one chain must be specified");let c=l.find(t=>{var r;return t.id===(null==(r=e.defaultChain)?void 0:r.id)}),d={projectId:e.projectId,networks:l,themeMode:e.themeMode,themeVariables:function(e){if(e)return{"--w3m-font-family":e["--wcm-font-family"],"--w3m-accent":e["--wcm-accent-color"],"--w3m-color-mix":e["--wcm-background-color"],"--w3m-z-index":e["--wcm-z-index"]?Number(e["--wcm-z-index"]):void 0,"--w3m-qr-color":e["--wcm-accent-color"],"--w3m-font-size-master":e["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":e["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}(e.themeVariables),chainImages:e.chainImages,connectorImages:e.walletImages,defaultNetwork:c,metadata:EQ(E3({},e.metadata),EX({name:(null==(r=e.metadata)?void 0:r.name)||"WalletConnect",description:(null==(i=e.metadata)?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:(null==(n=e.metadata)?void 0:n.url)||"https://walletconnect.org",icons:(null==(s=e.metadata)?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]})),showWallets:!0,featuredWalletIds:"NONE"===e.explorerRecommendedWalletIds?[]:Array.isArray(e.explorerRecommendedWalletIds)?e.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===e.explorerExcludedWalletIds?[]:Array.isArray(e.explorerExcludedWalletIds)?e.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(a=e.mobileWallets)&&a.length||null!=(o=e.desktopWallets)&&o.length){let t=[...(e.mobileWallets||[]).map(e=>({id:e.id,name:e.name,links:e.links})),...(e.desktopWallets||[]).map(e=>({id:e.id,name:e.name,links:{native:e.links.native,universal:e.links.universal}}))],r=[...d.featuredWalletIds||[],...d.excludeWalletIds||[]],i=t.filter(e=>!r.includes(e.id));i.length&&(d.customWallets=i)}return d},defineChain:E4}),E9=e.i(807072);e.i(589813);var E7=e.i(866388),Ie=e.i(399678),It=(e.i(556662),e.i(41333));let Ir=Symbol("data-suffix-plugin");var Ii=e.i(899662),In=e.i(757086),Is=Object.defineProperty,Ia=(e,t)=>{for(var r in t)Is(e,r,{get:t[r],enumerable:!0})},Io={84532:{usdcAddress:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",usdcName:"USDC"},8453:{usdcAddress:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",usdcName:"USD Coin"},43113:{usdcAddress:"0x5425890298aed601595a70AB815c96711a31Bc65",usdcName:"USD Coin"},43114:{usdcAddress:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",usdcName:"USD Coin"},4689:{usdcAddress:"0xcdf79194c6c285077a58da47641d4dbe51f63542",usdcName:"Bridged USDC"},103:{usdcAddress:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",usdcName:"USDC"},101:{usdcAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",usdcName:"USDC"},1328:{usdcAddress:"0x4fcf1784b31630811181f670aea7a7bef803eaed",usdcName:"USDC"},1329:{usdcAddress:"0xe15fc38f6d8c56af07bbcbe3baf5708a2bf42392",usdcName:"USDC"},137:{usdcAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",usdcName:"USD Coin"},80002:{usdcAddress:"0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582",usdcName:"USDC"},3338:{usdcAddress:"0xbbA60da06c2c5424f03f7434542280FCAd453d10",usdcName:"USDC"},2741:{usdcAddress:"0x84a71ccd554cc1b02749b35d22f684cc8ec987e1",usdcName:"Bridged USDC"},11124:{usdcAddress:"0xe4C7fBB0a626ed208021ccabA6Be1566905E2dFc",usdcName:"Bridged USDC"},1514:{usdcAddress:"0xF1815bd50389c46847f0Bda824eC8da914045D14",usdcName:"Bridged USDC"},41923:{usdcAddress:"0x12a272A581feE5577A5dFa371afEB4b2F3a8C2F8",usdcName:"Bridged USDC (Stargate)"},0x135a9d92:{usdcAddress:"0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",usdcName:"Bridged USDC (SKALE Bridge)"}},Il=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationUsed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"Blacklisted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newBlacklister",type:"address"}],name:"BlacklisterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"burner",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newMasterMinter",type:"address"}],name:"MasterMinterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!1,internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"MinterConfigured",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"oldMinter",type:"address"}],name:"MinterRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"previousOwner",type:"address"},{indexed:!1,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newAddress",type:"address"}],name:"PauserChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newRescuer",type:"address"}],name:"RescuerChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"UnBlacklisted",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{inputs:[],name:"CANCEL_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"RECEIVE_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"TRANSFER_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"authorizationState",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"blacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"blacklister",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_amount",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"},{internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"configureMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"currency",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"decrement",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"increment",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"tokenName",type:"string"},{internalType:"string",name:"tokenSymbol",type:"string"},{internalType:"string",name:"tokenCurrency",type:"string"},{internalType:"uint8",name:"tokenDecimals",type:"uint8"},{internalType:"address",name:"newMasterMinter",type:"address"},{internalType:"address",name:"newPauser",type:"address"},{internalType:"address",name:"newBlacklister",type:"address"},{internalType:"address",name:"newOwner",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"newName",type:"string"}],name:"initializeV2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"lostAndFound",type:"address"}],name:"initializeV2_1",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"accountsToBlacklist",type:"address[]"},{internalType:"string",name:"newSymbol",type:"string"}],name:"initializeV2_2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"isBlacklisted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"isMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"masterMinter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"}],name:"mint",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"minterAllowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"pauser",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"removeMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IERC20",name:"tokenContract",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"rescueERC20",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"rescuer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"unBlacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newBlacklister",type:"address"}],name:"updateBlacklister",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newMasterMinter",type:"address"}],name:"updateMasterMinter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newPauser",type:"address"}],name:"updatePauser",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newRescuer",type:"address"}],name:"updateRescuer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"}];e.s([],180703),e.i(180703),(Pu=Pk||(Pk={})).assertEqual=e=>{},Pu.assertIs=function(e){},Pu.assertNever=function(e){throw Error()},Pu.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},Pu.getValidEnumValues=e=>{let t=Pu.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return Pu.objectValues(r)},Pu.objectValues=e=>Pu.objectKeys(e).map(function(t){return e[t]}),Pu.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},Pu.find=(e,t)=>{for(let r of e)if(t(r))return r},Pu.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,Pu.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},Pu.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(PT||(PT={})).mergeShapes=(e,t)=>({...e,...t});let Ic=Pk.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Id=e=>{switch(typeof e){case"undefined":return Ic.undefined;case"string":return Ic.string;case"number":return Number.isNaN(e)?Ic.nan:Ic.number;case"boolean":return Ic.boolean;case"function":return Ic.function;case"bigint":return Ic.bigint;case"symbol":return Ic.symbol;case"object":if(Array.isArray(e))return Ic.array;if(null===e)return Ic.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return Ic.promise;if("u">typeof Map&&e instanceof Map)return Ic.map;if("u">typeof Set&&e instanceof Set)return Ic.set;if("u">typeof Date&&e instanceof Date)return Ic.date;return Ic.object;default:return Ic.unknown}};e.s(["ZodParsedType",0,Ic,"getParsedType",0,Id,"objectUtil",()=>PT,"util",()=>Pk],458728);let Iu=Pk.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ih=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class Ip extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(i);else if("invalid_return_type"===n.code)i(n.returnTypeError);else if("invalid_arguments"===n.code)i(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof Ip))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pk.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let i of this.issues)if(i.path.length>0){let r=i.path[0];t[r]=t[r]||[],t[r].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Ip.create=e=>new Ip(e),e.s(["ZodError",()=>Ip,"ZodIssueCode",0,Iu,"quotelessJson",0,Ih],559413);let If=(e,t)=>{let r;switch(e.code){case Iu.invalid_type:r=e.received===Ic.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Iu.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Pk.jsonStringifyReplacer)}`;break;case Iu.unrecognized_keys:r=`Unrecognized key(s) in object: ${Pk.joinValues(e.keys,", ")}`;break;case Iu.invalid_union:r="Invalid input";break;case Iu.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Pk.joinValues(e.options)}`;break;case Iu.invalid_enum_value:r=`Invalid enum value. Expected ${Pk.joinValues(e.options)}, received '${e.received}'`;break;case Iu.invalid_arguments:r="Invalid function arguments";break;case Iu.invalid_return_type:r="Invalid function return type";break;case Iu.invalid_date:r="Invalid date";break;case Iu.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Pk.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Iu.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Iu.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Iu.custom:r="Invalid input";break;case Iu.invalid_intersection_types:r="Intersection results could not be merged";break;case Iu.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Iu.not_finite:r="Number must be finite";break;default:r=t.defaultError,Pk.assertNever(e)}return{message:r}},Iy=If;function Ig(e){Iy=e}function Im(){return Iy}e.s(["getErrorMap",()=>Im,"setErrorMap",()=>Ig],725827),e.i(725827),e.s(["defaultErrorMap",0,If,"getErrorMap",()=>Im,"setErrorMap",()=>Ig],279407),e.i(279407);let Iw=e=>{let{data:t,path:r,errorMaps:i,issueData:n}=e,s=[...r,...n.path||[]],a={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(a,{data:t,defaultError:o}).message;return{...n,path:s,message:o}},Iv=[];function Ib(e,t){let r=Iy,i=Iw({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===If?void 0:If].filter(e=>!!e)});e.common.issues.push(i)}class I_{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if("aborted"===i.status)return IE;"dirty"===i.status&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return I_.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:t,value:n}=i;if("aborted"===t.status||"aborted"===n.status)return IE;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||i.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let IE=Object.freeze({status:"aborted"}),II=e=>({status:"dirty",value:e}),IA=e=>({status:"valid",value:e}),IS=e=>"aborted"===e.status,Ik=e=>"dirty"===e.status,IT=e=>"valid"===e.status,IC=e=>"u">typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,II,"EMPTY_PATH",0,Iv,"INVALID",0,IE,"OK",0,IA,"ParseStatus",()=>I_,"addIssueToContext",()=>Ib,"isAborted",0,IS,"isAsync",0,IC,"isDirty",0,Ik,"isValid",0,IT,"makeIssue",0,Iw],696555),e.i(696555),e.s([],924326),e.i(924326),e.i(458728),(Ph=PC||(PC={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},Ph.toString=e=>"string"==typeof e?e:e?.message;class Ix{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let IP=(e,t)=>{if(IT(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ip(e.common.issues);return this._error=t,this._error}}};function IO(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:n}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??i??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class IR{get description(){return this._def.description}_getType(e){return Id(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Id(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new I_,ctx:{common:e.parent.common,data:e.data,parsedType:Id(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(IC(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Id(e)},i=this._parseSync({data:e,path:r.path,parent:r});return IP(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Id(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return IT(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>IT(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Id(e)},i=this._parse({data:e,path:r.path,parent:r});return IP(r,await (IC(i)?i:Promise.resolve(i)))}refine(e,t){return this._refinement((r,i)=>{let n=e(r),s=()=>i.addIssue({code:Iu.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"u">typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new Ag({schema:this,typeName:Px.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Am.create(this,this._def)}nullable(){return Aw.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return I7.create(this)}promise(){return Ay.create(this,this._def)}or(e){return At.create([this,e],this._def)}and(e){return An.create(this,e,this._def)}transform(e){return new Ag({...IO(this._def),schema:this,typeName:Px.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new Av({...IO(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:Px.ZodDefault})}brand(){return new AI({typeName:Px.ZodBranded,type:this,...IO(this._def)})}catch(e){return new Ab({...IO(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:Px.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return AA.create(this,e)}readonly(){return AS.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let IN=/^c[^\s-]{8,}$/i,IM=/^[0-9a-z]+$/,IU=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ID=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,IL=/^[a-z0-9_-]{21}$/i,Ij=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,IW=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,IB=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,IF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Iq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,IH=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Iz=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,I$=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,IK=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,IV="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IJ=RegExp(`^${IV}$`);function IG(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function IZ(e){let t=`${IV}T${IG(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class IY extends IR{_parse(e){var t,r,n,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ic.string){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.string,received:t.parsedType}),IE}let o=new I_;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(a=this._getOrReturnCtx(e,a),t?Ib(a,{code:Iu.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&Ib(a,{code:Iu.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)IB.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"email",code:Iu.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)i||(i=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),i.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:Iu.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)ID.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:Iu.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)IL.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:Iu.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)IN.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:Iu.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)IM.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:Iu.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)IU.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:Iu.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{Ib(a=this._getOrReturnCtx(e,a),{validation:"url",code:Iu.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"regex",code:Iu.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?IZ(l).test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?IJ.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${IG(l)}$`).test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{code:Iu.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?IW.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"duration",code:Iu.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(r=l.version)||!r)&&IF.test(t)||("v6"===r||!r)&&IH.test(t))&&1&&(Ib(a=this._getOrReturnCtx(e,a),{validation:"ip",code:Iu.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!Ij.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(i));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(Ib(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:Iu.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,!(("v4"===(s=l.version)||!s)&&Iq.test(n)||("v6"===s||!s)&&Iz.test(n))&&1&&(Ib(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:Iu.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?I$.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"base64",code:Iu.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?IK.test(e.data)||(Ib(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:Iu.invalid_string,message:l.message}),o.dirty()):Pk.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:Iu.invalid_string,...PC.errToObj(r)})}_addCheck(e){return new IY({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...PC.errToObj(e)})}url(e){return this._addCheck({kind:"url",...PC.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...PC.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...PC.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...PC.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...PC.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...PC.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...PC.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...PC.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...PC.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...PC.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...PC.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...PC.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...PC.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...PC.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...PC.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...PC.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...PC.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...PC.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...PC.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...PC.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...PC.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...PC.errToObj(t)})}nonempty(e){return this.min(1,PC.errToObj(e))}trim(){return new IY({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new IY({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new IY({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}IY.create=e=>new IY({checks:[],typeName:Px.ZodString,coerce:e?.coerce??!1,...IO(e)});class IQ extends IR{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ic.number){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.number,received:t.parsedType}),IE}let r=new I_;for(let i of this._def.checks)"int"===i.kind?Pk.isInteger(e.data)||(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,i.value)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.not_finite,message:i.message}),r.dirty()):Pk.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,PC.toString(t))}gt(e,t){return this.setLimit("min",e,!1,PC.toString(t))}lte(e,t){return this.setLimit("max",e,!0,PC.toString(t))}lt(e,t){return this.setLimit("max",e,!1,PC.toString(t))}setLimit(e,t,r,i){return new IQ({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:PC.toString(i)}]})}_addCheck(e){return new IQ({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:PC.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:PC.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:PC.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:PC.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:PC.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:PC.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:PC.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:PC.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:PC.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&Pk.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}IQ.create=e=>new IQ({checks:[],typeName:Px.ZodNumber,coerce:e?.coerce||!1,...IO(e)});class IX extends IR{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Ic.bigint)return this._getInvalidInput(e);let r=new I_;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):Pk.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.bigint,received:t.parsedType}),IE}gte(e,t){return this.setLimit("min",e,!0,PC.toString(t))}gt(e,t){return this.setLimit("min",e,!1,PC.toString(t))}lte(e,t){return this.setLimit("max",e,!0,PC.toString(t))}lt(e,t){return this.setLimit("max",e,!1,PC.toString(t))}setLimit(e,t,r,i){return new IX({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:PC.toString(i)}]})}_addCheck(e){return new IX({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:PC.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:PC.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:PC.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:PC.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:PC.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}IX.create=e=>new IX({checks:[],typeName:Px.ZodBigInt,coerce:e?.coerce??!1,...IO(e)});class I0 extends IR{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Ic.boolean){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.boolean,received:t.parsedType}),IE}return IA(e.data)}}I0.create=e=>new I0({typeName:Px.ZodBoolean,coerce:e?.coerce||!1,...IO(e)});class I1 extends IR{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ic.date){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.date,received:t.parsedType}),IE}if(Number.isNaN(e.data.getTime()))return Ib(this._getOrReturnCtx(e),{code:Iu.invalid_date}),IE;let r=new I_;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(Ib(t=this._getOrReturnCtx(e,t),{code:Iu.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Pk.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new I1({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:PC.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:PC.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}I1.create=e=>new I1({checks:[],coerce:e?.coerce||!1,typeName:Px.ZodDate,...IO(e)});class I2 extends IR{_parse(e){if(this._getType(e)!==Ic.symbol){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.symbol,received:t.parsedType}),IE}return IA(e.data)}}I2.create=e=>new I2({typeName:Px.ZodSymbol,...IO(e)});class I5 extends IR{_parse(e){if(this._getType(e)!==Ic.undefined){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.undefined,received:t.parsedType}),IE}return IA(e.data)}}I5.create=e=>new I5({typeName:Px.ZodUndefined,...IO(e)});class I3 extends IR{_parse(e){if(this._getType(e)!==Ic.null){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.null,received:t.parsedType}),IE}return IA(e.data)}}I3.create=e=>new I3({typeName:Px.ZodNull,...IO(e)});class I8 extends IR{constructor(){super(...arguments),this._any=!0}_parse(e){return IA(e.data)}}I8.create=e=>new I8({typeName:Px.ZodAny,...IO(e)});class I4 extends IR{constructor(){super(...arguments),this._unknown=!0}_parse(e){return IA(e.data)}}I4.create=e=>new I4({typeName:Px.ZodUnknown,...IO(e)});class I6 extends IR{_parse(e){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.never,received:t.parsedType}),IE}}I6.create=e=>new I6({typeName:Px.ZodNever,...IO(e)});class I9 extends IR{_parse(e){if(this._getType(e)!==Ic.undefined){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.void,received:t.parsedType}),IE}return IA(e.data)}}I9.create=e=>new I9({typeName:Px.ZodVoid,...IO(e)});class I7 extends IR{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==Ic.array)return Ib(t,{code:Iu.invalid_type,expected:Ic.array,received:t.parsedType}),IE;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,n=t.data.length<i.exactLength.value;(e||n)&&(Ib(t,{code:e?Iu.too_big:Iu.too_small,minimum:n?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(Ib(t,{code:Iu.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(Ib(t,{code:Iu.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new Ix(t,e,t.path,r)))).then(e=>I_.mergeArray(r,e));let n=[...t.data].map((e,r)=>i.type._parseSync(new Ix(t,e,t.path,r)));return I_.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new I7({...this._def,minLength:{value:e,message:PC.toString(t)}})}max(e,t){return new I7({...this._def,maxLength:{value:e,message:PC.toString(t)}})}length(e,t){return new I7({...this._def,exactLength:{value:e,message:PC.toString(t)}})}nonempty(e){return this.min(1,e)}}I7.create=(e,t)=>new I7({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Px.ZodArray,...IO(t)});class Ae extends IR{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=Pk.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Ic.object){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.object,received:t.parsedType}),IE}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof I6&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let a=[];for(let e of n){let t=i[e],n=r.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new Ix(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof I6){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(Ib(r,{code:Iu.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let i=r.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new Ix(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of a){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>I_.mergeObjectSync(t,e)):I_.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return PC.errToObj,new Ae({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let i=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:PC.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Ae({...this._def,unknownKeys:"strip"})}passthrough(){return new Ae({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ae({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ae({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Px.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ae({...this._def,catchall:e})}pick(e){let t={};for(let r of Pk.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new Ae({...this._def,shape:()=>t})}omit(e){let t={};for(let r of Pk.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new Ae({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof Ae){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=Am.create(e(n))}return new Ae({...t._def,shape:()=>r})}if(t instanceof I7)return new I7({...t._def,type:e(t.element)});if(t instanceof Am)return Am.create(e(t.unwrap()));if(t instanceof Aw)return Aw.create(e(t.unwrap()));if(t instanceof As)return As.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of Pk.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new Ae({...this._def,shape:()=>t})}required(e){let t={};for(let r of Pk.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Am;)e=e._def.innerType;t[r]=e}return new Ae({...this._def,shape:()=>t})}keyof(){return Ah(Pk.objectKeys(this.shape))}}Ae.create=(e,t)=>new Ae({shape:()=>e,unknownKeys:"strip",catchall:I6.create(),typeName:Px.ZodObject,...IO(t)}),Ae.strictCreate=(e,t)=>new Ae({shape:()=>e,unknownKeys:"strict",catchall:I6.create(),typeName:Px.ZodObject,...IO(t)}),Ae.lazycreate=(e,t)=>new Ae({shape:e,unknownKeys:"strip",catchall:I6.create(),typeName:Px.ZodObject,...IO(t)});class At extends IR{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new Ip(e.ctx.common.issues));return Ib(t,{code:Iu.invalid_union,unionErrors:r}),IE});{let e,i=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=i.map(e=>new Ip(e));return Ib(t,{code:Iu.invalid_union,unionErrors:n}),IE}}get options(){return this._def.options}}At.create=(e,t)=>new At({options:e,typeName:Px.ZodUnion,...IO(t)});let Ar=e=>{if(e instanceof Ad)return Ar(e.schema);if(e instanceof Ag)return Ar(e.innerType());if(e instanceof Au)return[e.value];if(e instanceof Ap)return e.options;if(e instanceof Af)return Pk.objectValues(e.enum);else if(e instanceof Av)return Ar(e._def.innerType);else if(e instanceof I5)return[void 0];else if(e instanceof I3)return[null];else if(e instanceof Am)return[void 0,...Ar(e.unwrap())];else if(e instanceof Aw)return[null,...Ar(e.unwrap())];else if(e instanceof AI)return Ar(e.unwrap());else if(e instanceof AS)return Ar(e.unwrap());else if(e instanceof Ab)return Ar(e._def.innerType);else return[]};class Ai extends IR{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ic.object)return Ib(t,{code:Iu.invalid_type,expected:Ic.object,received:t.parsedType}),IE;let r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(Ib(t,{code:Iu.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),IE)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=Ar(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(i.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);i.set(n,r)}}return new Ai({typeName:Px.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...IO(r)})}}class An extends IR{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if(IS(e)||IS(i))return IE;let n=function e(t,r){let i=Id(t),n=Id(r);if(t===r)return{valid:!0,data:t};if(i===Ic.object&&n===Ic.object){let i=Pk.objectKeys(r),n=Pk.objectKeys(t).filter(e=>-1!==i.indexOf(e)),s={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};s[i]=n.data}return{valid:!0,data:s}}if(i===Ic.array&&n===Ic.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};i.push(s.data)}return{valid:!0,data:i}}if(i===Ic.date&&n===Ic.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,i.value);return n.valid?((Ik(e)||Ik(i))&&t.dirty(),{status:t.value,value:n.data}):(Ib(r,{code:Iu.invalid_intersection_types}),IE)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}An.create=(e,t,r)=>new An({left:e,right:t,typeName:Px.ZodIntersection,...IO(r)});class As extends IR{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ic.array)return Ib(r,{code:Iu.invalid_type,expected:Ic.array,received:r.parsedType}),IE;if(r.data.length<this._def.items.length)return Ib(r,{code:Iu.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),IE;!this._def.rest&&r.data.length>this._def.items.length&&(Ib(r,{code:Iu.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new Ix(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>I_.mergeArray(t,e)):I_.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new As({...this._def,rest:e})}}As.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new As({items:e,typeName:Px.ZodTuple,rest:null,...IO(t)})};class Aa extends IR{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ic.object)return Ib(r,{code:Iu.invalid_type,expected:Ic.object,received:r.parsedType}),IE;let i=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)i.push({key:n._parse(new Ix(r,e,r.path,e)),value:s._parse(new Ix(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?I_.mergeObjectAsync(t,i):I_.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new Aa(t instanceof IR?{keyType:e,valueType:t,typeName:Px.ZodRecord,...IO(r)}:{keyType:IY.create(),valueType:e,typeName:Px.ZodRecord,...IO(t)})}}class Ao extends IR{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ic.map)return Ib(r,{code:Iu.invalid_type,expected:Ic.map,received:r.parsedType}),IE;let i=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:i._parse(new Ix(r,e,r.path,[s,"key"])),value:n._parse(new Ix(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let i=await r.key,n=await r.value;if("aborted"===i.status||"aborted"===n.status)return IE;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let i=r.key,n=r.value;if("aborted"===i.status||"aborted"===n.status)return IE;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}}}}Ao.create=(e,t,r)=>new Ao({valueType:t,keyType:e,typeName:Px.ZodMap,...IO(r)});class Al extends IR{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ic.set)return Ib(r,{code:Iu.invalid_type,expected:Ic.set,received:r.parsedType}),IE;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&(Ib(r,{code:Iu.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&(Ib(r,{code:Iu.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let i of e){if("aborted"===i.status)return IE;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let a=[...r.data.values()].map((e,t)=>n._parse(new Ix(r,e,r.path,t)));return r.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new Al({...this._def,minSize:{value:e,message:PC.toString(t)}})}max(e,t){return new Al({...this._def,maxSize:{value:e,message:PC.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Al.create=(e,t)=>new Al({valueType:e,minSize:null,maxSize:null,typeName:Px.ZodSet,...IO(t)});class Ac extends IR{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ic.function)return Ib(t,{code:Iu.invalid_type,expected:Ic.function,received:t.parsedType}),IE;function r(e,r){return Iw({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Iy,If].filter(e=>!!e),issueData:{code:Iu.invalid_arguments,argumentsError:r}})}function i(e,r){return Iw({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Iy,If].filter(e=>!!e),issueData:{code:Iu.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Ay){let e=this;return IA(async function(...t){let a=new Ip([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw a.addIssue(r(t,e)),a}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw a.addIssue(i(l,e)),a})})}{let e=this;return IA(function(...t){let a=e._def.args.safeParse(t,n);if(!a.success)throw new Ip([r(t,a.error)]);let o=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new Ip([i(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ac({...this._def,args:As.create(e).rest(I4.create())})}returns(e){return new Ac({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Ac({args:e||As.create([]).rest(I4.create()),returns:t||I4.create(),typeName:Px.ZodFunction,...IO(r)})}}class Ad extends IR{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ad.create=(e,t)=>new Ad({getter:e,typeName:Px.ZodLazy,...IO(t)});class Au extends IR{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return Ib(t,{received:t.data,code:Iu.invalid_literal,expected:this._def.value}),IE}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Ah(e,t){return new Ap({values:e,typeName:Px.ZodEnum,...IO(t)})}Au.create=(e,t)=>new Au({value:e,typeName:Px.ZodLiteral,...IO(t)});class Ap extends IR{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return Ib(t,{expected:Pk.joinValues(r),received:t.parsedType,code:Iu.invalid_type}),IE}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return Ib(t,{received:t.data,code:Iu.invalid_enum_value,options:r}),IE}return IA(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ap.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ap.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Ap.create=Ah;class Af extends IR{_parse(e){let t=Pk.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Ic.string&&r.parsedType!==Ic.number){let e=Pk.objectValues(t);return Ib(r,{expected:Pk.joinValues(e),received:r.parsedType,code:Iu.invalid_type}),IE}if(this._cache||(this._cache=new Set(Pk.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=Pk.objectValues(t);return Ib(r,{received:r.data,code:Iu.invalid_enum_value,options:e}),IE}return IA(e.data)}get enum(){return this._def.values}}Af.create=(e,t)=>new Af({values:e,typeName:Px.ZodNativeEnum,...IO(t)});class Ay extends IR{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==Ic.promise&&!1===t.common.async?(Ib(t,{code:Iu.invalid_type,expected:Ic.promise,received:t.parsedType}),IE):IA((t.parsedType===Ic.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ay.create=(e,t)=>new Ay({type:e,typeName:Px.ZodPromise,...IO(t)});class Ag extends IR{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Px.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:e=>{Ib(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===i.type){let e=i.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return IE;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?IE:"dirty"===i.status||"dirty"===t.value?II(i.value):i});{if("aborted"===t.value)return IE;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?IE:"dirty"===i.status||"dirty"===t.value?II(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?IE:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?IE:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>IT(e)?Promise.resolve(i.transform(e.value,n)).then(e=>({status:t.value,value:e})):IE);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!IT(e))return IE;let s=i.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}Pk.assertNever(i)}}Ag.create=(e,t,r)=>new Ag({schema:e,typeName:Px.ZodEffects,effect:t,...IO(r)}),Ag.createWithPreprocess=(e,t,r)=>new Ag({schema:t,effect:{type:"preprocess",transform:e},typeName:Px.ZodEffects,...IO(r)});class Am extends IR{_parse(e){return this._getType(e)===Ic.undefined?IA(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Am.create=(e,t)=>new Am({innerType:e,typeName:Px.ZodOptional,...IO(t)});class Aw extends IR{_parse(e){return this._getType(e)===Ic.null?IA(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Aw.create=(e,t)=>new Aw({innerType:e,typeName:Px.ZodNullable,...IO(t)});class Av extends IR{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===Ic.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Av.create=(e,t)=>new Av({innerType:e,typeName:Px.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...IO(t)});class Ab extends IR{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return IC(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Ip(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new Ip(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ab.create=(e,t)=>new Ab({innerType:e,typeName:Px.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...IO(t)});class A_ extends IR{_parse(e){if(this._getType(e)!==Ic.nan){let t=this._getOrReturnCtx(e);return Ib(t,{code:Iu.invalid_type,expected:Ic.nan,received:t.parsedType}),IE}return{status:"valid",value:e.data}}}A_.create=e=>new A_({typeName:Px.ZodNaN,...IO(e)});let AE=Symbol("zod_brand");class AI extends IR{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class AA extends IR{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?IE:"dirty"===e.status?(t.dirty(),II(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?IE:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new AA({in:e,out:t,typeName:Px.ZodPipeline})}}class AS extends IR{_parse(e){let t=this._def.innerType._parse(e),r=e=>(IT(e)&&(e.value=Object.freeze(e.value)),e);return IC(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function Ak(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function AT(e,t={},r){return e?I8.create().superRefine((i,n)=>{let s=e(i);if(s instanceof Promise)return s.then(e=>{if(!e){let e=Ak(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=Ak(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):I8.create()}AS.create=(e,t)=>new AS({innerType:e,typeName:Px.ZodReadonly,...IO(t)});let AC={object:Ae.lazycreate};(Pp=Px||(Px={})).ZodString="ZodString",Pp.ZodNumber="ZodNumber",Pp.ZodNaN="ZodNaN",Pp.ZodBigInt="ZodBigInt",Pp.ZodBoolean="ZodBoolean",Pp.ZodDate="ZodDate",Pp.ZodSymbol="ZodSymbol",Pp.ZodUndefined="ZodUndefined",Pp.ZodNull="ZodNull",Pp.ZodAny="ZodAny",Pp.ZodUnknown="ZodUnknown",Pp.ZodNever="ZodNever",Pp.ZodVoid="ZodVoid",Pp.ZodArray="ZodArray",Pp.ZodObject="ZodObject",Pp.ZodUnion="ZodUnion",Pp.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Pp.ZodIntersection="ZodIntersection",Pp.ZodTuple="ZodTuple",Pp.ZodRecord="ZodRecord",Pp.ZodMap="ZodMap",Pp.ZodSet="ZodSet",Pp.ZodFunction="ZodFunction",Pp.ZodLazy="ZodLazy",Pp.ZodLiteral="ZodLiteral",Pp.ZodEnum="ZodEnum",Pp.ZodEffects="ZodEffects",Pp.ZodNativeEnum="ZodNativeEnum",Pp.ZodOptional="ZodOptional",Pp.ZodNullable="ZodNullable",Pp.ZodDefault="ZodDefault",Pp.ZodCatch="ZodCatch",Pp.ZodPromise="ZodPromise",Pp.ZodBranded="ZodBranded",Pp.ZodPipeline="ZodPipeline",Pp.ZodReadonly="ZodReadonly";let Ax=(e,t={message:`Input not instance of ${e.name}`})=>AT(t=>t instanceof e,t),AP=IY.create,AO=IQ.create,AR=A_.create,AN=IX.create,AM=I0.create,AU=I1.create,AD=I2.create,AL=I5.create,Aj=I3.create,AW=I8.create,AB=I4.create,AF=I6.create,Aq=I9.create,AH=I7.create,Az=Ae.create,A$=Ae.strictCreate,AK=At.create,AV=Ai.create,AJ=An.create,AG=As.create,AZ=Aa.create,AY=Ao.create,AQ=Al.create,AX=Ac.create,A0=Ad.create,A1=Au.create,A2=Ap.create,A5=Af.create,A3=Ay.create,A8=Ag.create,A4=Am.create,A6=Aw.create,A9=Ag.createWithPreprocess,A7=AA.create,Se=()=>AP().optional(),St=()=>AO().optional(),Sr=()=>AM().optional(),Si={string:e=>IY.create({...e,coerce:!0}),number:e=>IQ.create({...e,coerce:!0}),boolean:e=>I0.create({...e,coerce:!0}),bigint:e=>IX.create({...e,coerce:!0}),date:e=>I1.create({...e,coerce:!0})};e.s(["BRAND",0,AE,"NEVER",0,IE,"Schema",()=>IR,"ZodAny",()=>I8,"ZodArray",()=>I7,"ZodBigInt",()=>IX,"ZodBoolean",()=>I0,"ZodBranded",()=>AI,"ZodCatch",()=>Ab,"ZodDate",()=>I1,"ZodDefault",()=>Av,"ZodDiscriminatedUnion",()=>Ai,"ZodEffects",()=>Ag,"ZodEnum",()=>Ap,"ZodFirstPartyTypeKind",()=>Px,"ZodFunction",()=>Ac,"ZodIntersection",()=>An,"ZodLazy",()=>Ad,"ZodLiteral",()=>Au,"ZodMap",()=>Ao,"ZodNaN",()=>A_,"ZodNativeEnum",()=>Af,"ZodNever",()=>I6,"ZodNull",()=>I3,"ZodNullable",()=>Aw,"ZodNumber",()=>IQ,"ZodObject",()=>Ae,"ZodOptional",()=>Am,"ZodPipeline",()=>AA,"ZodPromise",()=>Ay,"ZodReadonly",()=>AS,"ZodRecord",()=>Aa,"ZodSchema",()=>IR,"ZodSet",()=>Al,"ZodString",()=>IY,"ZodSymbol",()=>I2,"ZodTransformer",()=>Ag,"ZodTuple",()=>As,"ZodType",()=>IR,"ZodUndefined",()=>I5,"ZodUnion",()=>At,"ZodUnknown",()=>I4,"ZodVoid",()=>I9,"any",()=>AW,"array",()=>AH,"bigint",()=>AN,"boolean",()=>AM,"coerce",0,Si,"custom",()=>AT,"date",()=>AU,"datetimeRegex",()=>IZ,"discriminatedUnion",()=>AV,"effect",()=>A8,"enum",()=>A2,"function",()=>AX,"instanceof",()=>Ax,"intersection",()=>AJ,"late",0,AC,"lazy",()=>A0,"literal",()=>A1,"map",()=>AY,"nan",()=>AR,"nativeEnum",()=>A5,"never",()=>AF,"null",()=>Aj,"nullable",()=>A6,"number",()=>AO,"object",()=>Az,"oboolean",()=>Sr,"onumber",()=>St,"optional",()=>A4,"ostring",()=>Se,"pipeline",()=>A7,"preprocess",()=>A9,"promise",()=>A3,"record",()=>AZ,"set",()=>AQ,"strictObject",()=>A$,"string",()=>AP,"symbol",()=>AD,"transformer",()=>A8,"tuple",()=>AG,"undefined",()=>AL,"union",()=>AK,"unknown",()=>AB,"void",()=>Aq],480),e.i(480),e.i(559413),e.s(["BRAND",0,AE,"DIRTY",0,II,"EMPTY_PATH",0,Iv,"INVALID",0,IE,"NEVER",0,IE,"OK",0,IA,"ParseStatus",()=>I_,"Schema",()=>IR,"ZodAny",()=>I8,"ZodArray",()=>I7,"ZodBigInt",()=>IX,"ZodBoolean",()=>I0,"ZodBranded",()=>AI,"ZodCatch",()=>Ab,"ZodDate",()=>I1,"ZodDefault",()=>Av,"ZodDiscriminatedUnion",()=>Ai,"ZodEffects",()=>Ag,"ZodEnum",()=>Ap,"ZodError",()=>Ip,"ZodFirstPartyTypeKind",()=>Px,"ZodFunction",()=>Ac,"ZodIntersection",()=>An,"ZodIssueCode",0,Iu,"ZodLazy",()=>Ad,"ZodLiteral",()=>Au,"ZodMap",()=>Ao,"ZodNaN",()=>A_,"ZodNativeEnum",()=>Af,"ZodNever",()=>I6,"ZodNull",()=>I3,"ZodNullable",()=>Aw,"ZodNumber",()=>IQ,"ZodObject",()=>Ae,"ZodOptional",()=>Am,"ZodParsedType",0,Ic,"ZodPipeline",()=>AA,"ZodPromise",()=>Ay,"ZodReadonly",()=>AS,"ZodRecord",()=>Aa,"ZodSchema",()=>IR,"ZodSet",()=>Al,"ZodString",()=>IY,"ZodSymbol",()=>I2,"ZodTransformer",()=>Ag,"ZodTuple",()=>As,"ZodType",()=>IR,"ZodUndefined",()=>I5,"ZodUnion",()=>At,"ZodUnknown",()=>I4,"ZodVoid",()=>I9,"addIssueToContext",()=>Ib,"any",()=>AW,"array",()=>AH,"bigint",()=>AN,"boolean",()=>AM,"coerce",0,Si,"custom",()=>AT,"date",()=>AU,"datetimeRegex",()=>IZ,"defaultErrorMap",0,If,"discriminatedUnion",()=>AV,"effect",()=>A8,"enum",()=>A2,"function",()=>AX,"getErrorMap",()=>Im,"getParsedType",0,Id,"instanceof",()=>Ax,"intersection",()=>AJ,"isAborted",0,IS,"isAsync",0,IC,"isDirty",0,Ik,"isValid",0,IT,"late",0,AC,"lazy",()=>A0,"literal",()=>A1,"makeIssue",0,Iw,"map",()=>AY,"nan",()=>AR,"nativeEnum",()=>A5,"never",()=>AF,"null",()=>Aj,"nullable",()=>A6,"number",()=>AO,"object",()=>Az,"objectUtil",()=>PT,"oboolean",()=>Sr,"onumber",()=>St,"optional",()=>A4,"ostring",()=>Se,"pipeline",()=>A7,"preprocess",()=>A9,"promise",()=>A3,"quotelessJson",0,Ih,"record",()=>AZ,"set",()=>AQ,"setErrorMap",()=>Ig,"strictObject",()=>A$,"string",()=>AP,"symbol",()=>AD,"transformer",()=>A8,"tuple",()=>AG,"undefined",()=>AL,"union",()=>AK,"unknown",()=>AB,"util",()=>Pk,"void",()=>Aq],966951);var Sn=e.i(966951),Sn=Sn,Ss=e.i(522081),Sa=e.i(164981),So=e.i(238284),Sl=e.i(904397),Sc=e.i(234627),Sd=e.i(989382);let Su={block:(0,Sl.defineBlock)({format:e=>({transactions:e.transactions?.map(e=>{if("string"==typeof e)return e;let t=(0,Sc.formatTransaction)(e);return"0x7e"===t.typeHex&&(t.isSystemTx=e.isSystemTx,t.mint=e.mint?(0,So.hexToBigInt)(e.mint):void 0,t.sourceHash=e.sourceHash,t.type="deposit"),t}),stateRoot:e.stateRoot})}),transaction:(0,Sc.defineTransaction)({format(e){let t={};return"0x7e"===e.type&&(t.isSystemTx=e.isSystemTx,t.mint=e.mint?(0,So.hexToBigInt)(e.mint):void 0,t.sourceHash=e.sourceHash,t.type="deposit"),t}}),transactionReceipt:(0,Sd.defineTransactionReceipt)({format:e=>({l1GasPrice:e.l1GasPrice?(0,So.hexToBigInt)(e.l1GasPrice):null,l1GasUsed:e.l1GasUsed?(0,So.hexToBigInt)(e.l1GasUsed):null,l1Fee:e.l1Fee?(0,So.hexToBigInt)(e.l1Fee):null,l1FeeScalar:e.l1FeeScalar?Number(e.l1FeeScalar):null})})};var Sh=e.i(917976),Sp=e.i(513880),Sf=e.i(373457),Sy=e.i(374251),Sg=e.i(6197);let Sm={blockTime:2e3,contracts:{gasPriceOracle:{address:"0x420000000000000000000000000000000000000F"},l1Block:{address:"0x4200000000000000000000000000000000000015"},l2CrossDomainMessenger:{address:"0x4200000000000000000000000000000000000007"},l2Erc721Bridge:{address:"0x4200000000000000000000000000000000000014"},l2StandardBridge:{address:"0x4200000000000000000000000000000000000010"},l2ToL1MessagePasser:{address:"0x4200000000000000000000000000000000000016"}},formatters:Su,serializers:{transaction:function(e,t){var r;return"deposit"===(r=e).type||void 0!==r.sourceHash?function(e){!function(e){let{from:t,to:r}=e;if(t&&!(0,Sp.isAddress)(t))throw new Sh.InvalidAddressError({address:t});if(r&&!(0,Sp.isAddress)(r))throw new Sh.InvalidAddressError({address:r})}(e);let{sourceHash:t,data:r,from:i,gas:n,isSystemTx:s,mint:a,to:o,value:l}=e,c=[t,i,o??"0x",a?(0,en.toHex)(a):"0x",l?(0,en.toHex)(l):"0x",n?(0,en.toHex)(n):"0x",s?"0x1":"0x",r??"0x"];return(0,Sf.concatHex)(["0x7e",(0,Sy.toRlp)(c)])}(e):(0,Sg.serializeTransaction)(e,t)}}};var Sw=e.i(261393);let Sv=(0,Sw.defineChain)({...Sm,id:84532,network:"base-sepolia",name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://sepolia.basescan.org",apiUrl:"https://api-sepolia.basescan.org/api"}},contracts:{...Sm.contracts,disputeGameFactory:{0xaa36a7:{address:"0xd6E6dBf4F7EA0ac412fD8b65ED297e64BB7a06E1"}},l2OutputOracle:{0xaa36a7:{address:"0x84457ca9D0163FbC4bbfe4Dfbb20ba46e48DF254"}},portal:{0xaa36a7:{address:"0x49f53e41452c74589e85ca1677426ba426459e85",blockCreated:4446677}},l1StandardBridge:{0xaa36a7:{address:"0xfd0Bf71F60660E2f608ed56e1659C450eB113120",blockCreated:4446677}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:1059647}},testnet:!0,sourceId:0xaa36a7});({...Sv,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://sepolia-preconf.base.org"]}}});let Sb=(0,Sw.defineChain)({id:43113,name:"Avalanche Fuji",nativeCurrency:{decimals:18,name:"Avalanche Fuji",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax-test.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://testnet.snowtrace.io",apiUrl:"https://api-testnet.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7096959}},testnet:!0}),S_=(0,Sw.defineChain)({...Sm,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{...Sm.contracts,disputeGameFactory:{1:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{1:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{1:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:0x10ac19f}},l1StandardBridge:{1:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:0x10ac19f}}},sourceId:1});({...S_,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://mainnet-preconf.base.org"]}}});let SE=(0,Sw.defineChain)({id:1329,name:"Sei Network",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc.sei-apis.com/"],webSocket:["wss://evm-ws.sei-apis.com/"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com",apiUrl:"https://seitrace.com/pacific-1/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11"}}}),SI=(0,Sw.defineChain)({id:1328,name:"Sei Testnet",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc-testnet.sei-apis.com"],webSocket:["wss://evm-ws-testnet.sei-apis.com"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x5e201b3}},testnet:!0}),SA=(0,Sw.defineChain)({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0x18938b0}}}),SS=(0,Sw.defineChain)({id:80002,name:"Polygon Amoy",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://rpc-amoy.polygon.technology"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://amoy.polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3127388}},testnet:!0}),Sk=(0,Sw.defineChain)({id:3338,name:"Peaq",nativeCurrency:{decimals:18,name:"peaq",symbol:"PEAQ"},rpcUrls:{default:{http:["https://quicknode1.peaq.xyz","https://quicknode2.peaq.xyz","https://quicknode3.peaq.xyz"],webSocket:["wss://quicknode1.peaq.xyz","wss://quicknode2.peaq.xyz","wss://quicknode3.peaq.xyz"]}},blockExplorers:{default:{name:"Subscan",url:"https://peaq.subscan.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3566354}}}),ST=(0,Sw.defineChain)({id:43114,name:"Avalanche",blockTime:1700,nativeCurrency:{decimals:18,name:"Avalanche",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://snowtrace.io",apiUrl:"https://api.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0xb5b35e}}}),SC=(0,Sw.defineChain)({id:4690,name:"IoTeX Testnet",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.testnet.iotex.io"],webSocket:["wss://babel-api.testnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://testnet.iotexscan.io"}},contracts:{multicall3:{address:"0xb5cecD6894c6f473Ec726A176f1512399A2e355d",blockCreated:0x17383c8}},testnet:!0}),Sx=(0,Sw.defineChain)({id:4689,name:"IoTeX",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.mainnet.iotex.io"],webSocket:["wss://babel-api.mainnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://iotexscan.io"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x15230d6}}});var SP=e.i(68082),SO=e.i(456471),SR=e.i(58919);let SN=32n*e.i(533484).maxUint16,SM={block:(0,Sl.defineBlock)({format(e){let t=e.transactions?.map(e=>{if("string"==typeof e)return e;let t=SM.transaction?.format(e);return"0x71"===t.typeHex?t.type="eip712":"0xff"===t.typeHex&&(t.type="priority"),t});return{l1BatchNumber:e.l1BatchNumber?(0,So.hexToBigInt)(e.l1BatchNumber):null,l1BatchTimestamp:e.l1BatchTimestamp?(0,So.hexToBigInt)(e.l1BatchTimestamp):null,transactions:t}}}),transaction:(0,Sc.defineTransaction)({format(e){let t={};return"0x71"===e.type?t.type="eip712":"0xff"===e.type&&(t.type="priority"),{...t,l1BatchNumber:e.l1BatchNumber?(0,So.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,So.hexToBigInt)(e.l1BatchTxIndex):null}}}),transactionReceipt:(0,Sd.defineTransactionReceipt)({format:e=>({l1BatchNumber:e.l1BatchNumber?(0,So.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,So.hexToBigInt)(e.l1BatchTxIndex):null,logs:e.logs.map(e=>({...(0,SO.formatLog)(e),l1BatchNumber:e.l1BatchNumber?(0,So.hexToBigInt)(e.l1BatchNumber):null,transactionLogIndex:(0,So.hexToNumber)(e.transactionLogIndex),logType:e.logType})),l2ToL1Logs:e.l2ToL1Logs.map(e=>({blockNumber:(0,So.hexToBigInt)(e.blockHash),blockHash:e.blockHash,l1BatchNumber:e.l1BatchNumber?(0,So.hexToBigInt)(e.l1BatchNumber):null,transactionIndex:(0,So.hexToBigInt)(e.transactionIndex),shardId:(0,So.hexToBigInt)(e.shardId),isService:e.isService,sender:e.sender,key:e.key,value:e.value,transactionHash:e.transactionHash,logIndex:(0,So.hexToBigInt)(e.logIndex)}))})}),transactionRequest:(0,SR.defineTransactionRequest)({exclude:["customSignature","factoryDeps","gasPerPubdata","paymaster","paymasterInput"],format:e=>e.gasPerPubdata||e.paymaster&&e.paymasterInput||e.factoryDeps||e.customSignature?{eip712Meta:{...e.gasPerPubdata?{gasPerPubdata:(0,en.toHex)(e.gasPerPubdata)}:{gasPerPubdata:(0,en.toHex)(50000n)},...e.paymaster&&e.paymasterInput?{paymasterParams:{paymaster:e.paymaster,paymasterInput:Array.from((0,SP.hexToBytes)(e.paymasterInput))}}:{},...e.factoryDeps?{factoryDeps:e.factoryDeps.map(e=>Array.from((0,SP.hexToBytes)(e)))}:{},...e.customSignature?{customSignature:Array.from((0,SP.hexToBytes)(e.customSignature))}:{}},type:"0x71"}:{}})};var SU=e.i(382947),SD=e.i(293309),SL=SU;class Sj extends SL.BaseError{constructor(){super('Transaction is not an EIP712 transaction.\n\nTransaction must:\n  - include `type: "eip712"`\n  - include one of the following: `customSignature`, `paymaster`, `paymasterInput`, `gasPerPubdata`, `factoryDeps`',{name:"InvalidEip712TransactionError"})}}function SW(e){return"eip712"===e.type||"customSignature"in e&&!!e.customSignature||"paymaster"in e&&!!e.paymaster||"paymasterInput"in e&&!!e.paymasterInput||"gasPerPubdata"in e&&"bigint"==typeof e.gasPerPubdata||"factoryDeps"in e&&!!e.factoryDeps||!1}function SB(e){let{chainId:t,to:r,from:i,paymaster:n,paymasterInput:s}=e;if(!SW(e))throw new Sj;if(!t||t<=0)throw new SD.InvalidChainIdError({chainId:t});if(r&&!(0,Sp.isAddress)(r))throw new Sh.InvalidAddressError({address:r});if(i&&!(0,Sp.isAddress)(i))throw new Sh.InvalidAddressError({address:i});if(n&&!(0,Sp.isAddress)(n))throw new Sh.InvalidAddressError({address:n});if(n&&!s)throw new SU.BaseError("`paymasterInput` must be provided when `paymaster` is defined");if(!n&&s)throw new SU.BaseError("`paymaster` must be provided when `paymasterInput` is defined")}var SF=e.i(349218),Sq=e.i(382578),SH=SU;class Sz extends SH.BaseError{constructor({givenLength:e,maxBytecodeSize:t}){super(`Bytecode cannot be longer than ${t} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class S$ extends SH.BaseError{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class SK extends SH.BaseError{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function SV(e){let t=(0,SP.toBytes)(e);if(t.length%32!=0)throw new SK({givenLength:t.length});if(t.length>SN)throw new Sz({givenLength:t.length,maxBytecodeSize:SN});let r=(0,Sq.sha256)(t),i=(0,SP.toBytes)(r),n=t.length/32;if(n%2==0)throw new S$({givenLengthInWords:n});let s=(0,SP.toBytes)(n),a=(0,SF.pad)(s,{size:2}),o=new Uint8Array([1,0]);return i.set(o,0),i.set(a,2),i}let SJ={blockTime:1e3,formatters:SM,serializers:{transaction:function(e,t){return SW(e)?function(e){let{chainId:t,gas:r,nonce:i,to:n,from:s,value:a,maxFeePerGas:o,maxPriorityFeePerGas:l,customSignature:c,factoryDeps:d,paymaster:u,paymasterInput:h,gasPerPubdata:p,data:f}=e;SB(e);let y=[i?(0,en.toHex)(i):"0x",l?(0,en.toHex)(l):"0x",o?(0,en.toHex)(o):"0x",r?(0,en.toHex)(r):"0x",n??"0x",a?(0,en.toHex)(a):"0x",f??"0x",(0,en.toHex)(t),(0,en.toHex)(""),(0,en.toHex)(""),(0,en.toHex)(t),s??"0x",p?(0,en.toHex)(p):(0,en.toHex)(50000n),d??[],c??"0x",u&&h?[u,h]:[]];return(0,Sf.concatHex)(["0x71",(0,Sy.toRlp)(y)])}(e):(0,Sg.serializeTransaction)(e,t)}},custom:{getEip712Domain:e=>{SB(e);let t=function(e){let{gas:t,nonce:r,to:i,from:n,value:s,maxFeePerGas:a,maxPriorityFeePerGas:o,factoryDeps:l,paymaster:c,paymasterInput:d,gasPerPubdata:u,data:h}=e;return{txType:113n,from:BigInt(n),to:i?BigInt(i):0n,gasLimit:t??0n,gasPerPubdataByteLimit:u??50000n,maxFeePerGas:a??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:r?BigInt(r):0n,value:s??0n,data:h??"0x",factoryDeps:l?.map(e=>(0,en.toHex)(SV(e)))??[],paymasterInput:d||"0x"}}(e);return{domain:{name:"zkSync",version:"2",chainId:e.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:t}}}},SG=(0,Sw.defineChain)({...SJ,blockTime:200,id:2741,name:"Abstract",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.mainnet.abs.xyz"],webSocket:["wss://api.mainnet.abs.xyz/ws"]}},blockExplorers:{default:{name:"Etherscan",url:"https://abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.mainnet.abs.xyz"}},contracts:{multicall3:{address:"0xAa4De41dba0Ca5dCBb288b7cC6b708F3aaC759E7",blockCreated:5288},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:5263}}}),SZ=(0,Sw.defineChain)({...SJ,blockTime:200,id:11124,name:"Abstract Testnet",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.testnet.abs.xyz"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.testnet.abs.xyz"}},testnet:!0,contracts:{multicall3:{address:"0xF9cda624FBC7e059355ce98a31693d299FACd963",blockCreated:358349},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:431682}}}),SY=(0,Sw.defineChain)({id:1514,name:"Story",nativeCurrency:{decimals:18,name:"IP Token",symbol:"IP"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:340998},ensRegistry:{address:"0x5dc881dda4e4a8d312be3544ad13118d1a04cb17",blockCreated:648924},ensUniversalResolver:{address:"0xddfb18888a9466688235887dec2a10c4f5effee9",blockCreated:649114}},rpcUrls:{default:{http:["https://mainnet.storyrpc.io"]}},blockExplorers:{default:{name:"Story explorer",url:"https://storyscan.io",apiUrl:"https://storyscan.io/api/v2"}},ensTlds:[".ip"],testnet:!1}),SQ=(0,Sw.defineChain)({id:41923,name:"EDU Chain",nativeCurrency:{decimals:18,name:"EDU",symbol:"EDU"},rpcUrls:{default:{http:["https://rpc.edu-chain.raas.gelato.cloud"]}},blockExplorers:{default:{name:"EDU Chain Explorer",url:"https://educhain.blockscout.com/"}},testnet:!1});var SX=e.i(793115),S0=e.i(65937);async function S1({hash:e,privateKey:t,to:r="object"}){let{r:i,s:n,recovery:s}=dP.secp256k1.sign(e.slice(2),t.slice(2),{lowS:!0,extraEntropy:!!(0,es.isHex)(!1,{strict:!1})&&(0,SP.hexToBytes)(!1)}),a={r:(0,en.numberToHex)(i,{size:32}),s:(0,en.numberToHex)(n,{size:32}),v:s?28n:27n,yParity:s};return"bytes"===r||"hex"===r?(0,S0.serializeSignature)({...a,to:r}):a}async function S2(e){let{chainId:t,nonce:r,privateKey:i,to:n="object"}=e,s=e.contractAddress??e.address,a=await S1({hash:(0,a0.hashAuthorization)({address:s,chainId:t,nonce:r}),privateKey:i,to:n});return"object"===n?{address:s,chainId:t,nonce:r,...a}:a}var S5=e.i(367472);async function S3({message:e,privateKey:t}){return await S1({hash:(0,S5.hashMessage)(e),privateKey:t,to:"hex"})}var S8=e.i(323355);async function S4(e){let{privateKey:t,transaction:r,serializer:i=Sg.serializeTransaction}=e,n="eip4844"===r.type?{...r,sidecars:!1}:r,s=await S1({hash:(0,S8.keccak256)(await i(n)),privateKey:t});return await i(r,s)}var S6=e.i(888427);async function S9(e){let{privateKey:t,...r}=e;return await S1({hash:(0,S6.hashTypedData)(r),privateKey:t,to:"hex"})}var S7=e.i(923167),ke=e.i(297813),kt=e.i(53171),kr=e.i(11123),ki=e.i(602878);let kn=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],name:"AccountNonceOrderingUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"aaVersion",type:"uint8"}],name:"AccountVersionUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"deployerAddress",type:"address"},{indexed:!0,internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"contractAddress",type:"address"}],name:"ContractDeployed",type:"event"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"create2Account",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"createAccount",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"extendedAccountVersion",outputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_keccak256BytecodeHash",type:"bytes32"}],name:"forceDeployKeccak256",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment",name:"_deployment",type:"tuple"},{internalType:"address",name:"_sender",type:"address"}],name:"forceDeployOnAddress",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment[]",name:"_deployments",type:"tuple[]"}],name:"forceDeployOnAddresses",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"getAccountInfo",outputs:[{components:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"supportedAAVersion",type:"uint8"},{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],internalType:"struct IContractDeployer.AccountInfo",name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"uint256",name:"_senderNonce",type:"uint256"}],name:"getNewAddressCreate",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"getNewAddressCreate2",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_version",type:"uint8"}],name:"updateAccountVersion",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"_nonceOrdering",type:"uint8"}],name:"updateNonceOrdering",outputs:[],stateMutability:"nonpayable",type:"function"}],ks="/docs/contract/encodeDeployData";function ka(e,t,r,i){let n=[t,r,i];return({create:{functionName:"create",argsContractDeployer:n},create2:{functionName:"create2",argsContractDeployer:n},createAccount:{functionName:"createAccount",argsContractDeployer:[...n,1]},create2Account:{functionName:"create2Account",argsContractDeployer:[...n,1]}})[e||"create"]}var ko=e.i(672091),kl=e.i(855721),kc=e.i(864673),kd=e.i(905576),ku=e.i(529664),kh=e.i(950714),kp=e.i(522665),kf=e.i(164502),ky=e.i(647432);function kg(e){if(!SW(e))throw new Sj;(0,ky.assertRequest)(e)}var km=e.i(914893),kw=e.i(425409);async function kv(e,t){let{account:r=e.account,chain:i=e.chain,...n}=t,s=r?(0,ko.parseAccount)(r):e.account;if(!s)throw new ku.AccountNotFoundError({docsPath:"/docs/actions/wallet/signTransaction"});if(kg({account:s,chain:i,...t}),!i?.custom?.getEip712Domain)throw new SU.BaseError("`getEip712Domain` not found on chain.");if(!i?.serializers?.transaction)throw new SU.BaseError("transaction serializer not found on chain.");let a=await (0,kf.getAction)(e,kl.getChainId,"getChainId")({});null!==i&&(0,kh.assertCurrentChain)({currentChainId:a,chain:i});let o=i?.custom.getEip712Domain({...n,chainId:a,from:s.address,type:"eip712"}),l=await (0,kw.signTypedData)(e,{...o,account:s});return i?.serializers?.transaction({chainId:a,...n,customSignature:l,type:"eip712"},{r:"0x0",s:"0x0",v:0n})}async function kb(e,t){return SW(t)?kv(e,t):await (0,km.signTransaction)(e,t)}async function k_(e,t){let{account:r=e.account,chain:i=e.chain}=t,n=r?(0,ko.parseAccount)(r):e.account;if(!n)throw new ku.AccountNotFoundError({docsPath:"/docs/actions/wallet/sendTransaction"});try{let r;kg(t);let s=await (0,kc.prepareTransactionRequest)(e,{...t,nonceManager:n.nonceManager,parameters:["gas","nonce","fees"]});null!==i&&(r=await (0,kf.getAction)(e,kl.getChainId,"getChainId")({}),(0,kh.assertCurrentChain)({currentChainId:r,chain:i}));let a=await kb(e,{...s,chainId:r});return await (0,kf.getAction)(e,kd.sendRawTransaction,"sendRawTransaction")({serializedTransaction:a})}catch(e){throw(0,kp.getTransactionError)(e,{...t,account:n,chain:i})}}var kE=e.i(347568);async function kI(e,t){return SW(t)?k_(e,t):(0,kE.sendTransaction)(e,t)}var kA=e.i(699344),kS=e.i(4706);function kk(e){return JSON.parse(function(e){let t=[],r=!1;for(let n=0;n<e.length;n++){let s=!1;if("\\"===e[n]&&(t.push(e[n++]),s=!s),'"'===e[n]){t.push(e[n]),s||(r=!r);continue}if(!r){let r=function(e,t){if(!e[t]?.match(/[-\d]/))return null;let r=e.slice(t).match(/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/);return r?r[0]:null}(e,n);if(r?.length){var i;n+=r.length-1,r.match(/\.|[eE]-/)?t.push(r):t.push((i=r,`{"$n":"${i}"}`));continue}}t.push(e[n])}return t.join("")}(e),(e,t)=>{var r;return(r=t)&&"object"==typeof r&&"$n"in r&&"string"==typeof r.$n?function({$n:e}){if(e.match(/[eE]/)){let[t,r]=e.split(/[eE]/);return BigInt(t)*BigInt(10)**BigInt(r)}return BigInt(e)}(t):t})}var kT=0n;function kC(e){let t;return{id:(t=kT,kT++,t.toString()),jsonrpc:"2.0",method:e.methodName,params:e.params}}function kx(e,t){return JSON.stringify(e,(e,t)=>{var r;return"bigint"==typeof t?(r=t,{$n:`${r}`}):t},t).replace(/\{\s*"\$n"\s*:\s*"(-?\d+)"\s*\}/g,"$1")}function kP(e){return!(null==e||"object"!=typeof e||Array.isArray(e))&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"method"in e&&"string"==typeof e.method&&"params"in e}var kO=e.i(184883);function kR(e){return"bigint"==typeof e?Number(e):e}var kN={};function kM(e){return function t(r,i){if(Array.isArray(r))return r.map((e,r)=>t(e,{...i,keyPath:[...i.keyPath,r]}));if("object"!=typeof r||null===r)return e.reduce((e,t)=>t(e,i),r);{let e={};for(let n in r){if(!Object.prototype.hasOwnProperty.call(r,n))continue;let s={...i,keyPath:[...i.keyPath,n]};e[n]=t(r[n],s)}return e}}}function kU(e,t){return r=>{let i=kM(e);return Object.freeze({...r,params:i(r.params,t)})}}var kD={accountNotifications:1,blockNotifications:1,getAccountInfo:1,getBalance:1,getBlock:1,getBlockHeight:0,getBlockProduction:0,getBlocks:2,getBlocksWithLimit:2,getEpochInfo:0,getFeeForMessage:1,getInflationGovernor:0,getInflationReward:1,getLargestAccounts:0,getLatestBlockhash:0,getLeaderSchedule:1,getMinimumBalanceForRentExemption:1,getMultipleAccounts:1,getProgramAccounts:1,getSignaturesForAddress:1,getSlot:0,getSlotLeader:0,getStakeMinimumDelegation:0,getSupply:0,getTokenAccountBalance:1,getTokenAccountsByDelegate:2,getTokenAccountsByOwner:2,getTokenLargestAccounts:1,getTokenSupply:1,getTransaction:1,getTransactionCount:0,getVoteAccounts:0,isBlockhashValid:1,logsNotifications:1,programNotifications:1,requestAirdrop:2,sendTransaction:1,signatureNotifications:1,simulateTransaction:1};function kL(e){let t=e?.onIntegerOverflow;return r=>(0,kO.pipe)(r,t?e=>{var r;return kU([(r=(...r)=>t(e,...r),(e,{keyPath:t})=>("bigint"==typeof e&&r&&(e>Number.MAX_SAFE_INTEGER||e<-Number.MAX_SAFE_INTEGER)&&r(t,e),e))],{keyPath:[]})(e)}:e=>e,kU([kR],{keyPath:[]}),function({defaultCommitment:e,optionsObjectPositionByMethod:t}){return r=>{let{params:i,methodName:n}=r;if(!Array.isArray(i))return r;let s=t[n];return null==s?r:Object.freeze({methodName:n,params:function({commitmentPropertyName:e,params:t,optionsObjectPositionInParams:r,overrideCommitment:i}){let n=t[r];if(void 0===n||n&&"object"==typeof n&&!Array.isArray(n)){if(n&&e in n){if(!n[e]||"finalized"===n[e]){let i=[...t],{[e]:s,...a}=n;return Object.keys(a).length>0?i[r]=a:r===i.length-1?i.length--:i[r]=void 0,i}}else if("finalized"!==i){let s=[...t];return s[r]={...n,[e]:i},s}}return t}({commitmentPropertyName:"sendTransaction"===n?"preflightCommitment":"commitment",optionsObjectPositionInParams:s,overrideCommitment:e,params:i})})}}({defaultCommitment:e?.defaultCommitment,optionsObjectPositionByMethod:kD}))}function kj(e){return function(t,{keyPath:r}){var i;return"number"==typeof t&&Number.isInteger(t)||"bigint"==typeof t?(i=r,e.some(e=>{if(e.length!==i.length)return!1;for(let t=i.length-1;t>=0;t--){let r=i[t],n=e[t];if(n!==r&&(n!==kN||"number"!=typeof r))return!1}return!0}))?Number(t):BigInt(t):t}}function kW(e){var t,r;return t=[kj(e)],r={keyPath:[]},e=>kM(t)(e,r)}var kB=[["data","parsed","info","tokenAmount","decimals"],["data","parsed","info","tokenAmount","uiAmount"],["data","parsed","info","rentExemptReserve","decimals"],["data","parsed","info","rentExemptReserve","uiAmount"],["data","parsed","info","delegatedAmount","decimals"],["data","parsed","info","delegatedAmount","uiAmount"],["data","parsed","info","extensions",kN,"state","olderTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",kN,"state","newerTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",kN,"state","preUpdateAverageRate"],["data","parsed","info","extensions",kN,"state","currentRate"]],kF=[...kB,["data","parsed","info","lastExtendedSlotStartIndex"],["data","parsed","info","slashPenalty"],["data","parsed","info","warmupCooldownRate"],["data","parsed","info","decimals"],["data","parsed","info","numRequiredSigners"],["data","parsed","info","numValidSigners"],["data","parsed","info","stake","delegation","warmupCooldownRate"],["data","parsed","info","exemptionThreshold"],["data","parsed","info","burnPercent"],["data","parsed","info","commission"],["data","parsed","info","votes",kN,"confirmationCount"]],kq=[["index"],["instructions",kN,"accounts",kN],["instructions",kN,"programIdIndex"],["instructions",kN,"stackHeight"]],kH=[["addressTableLookups",kN,"writableIndexes",kN],["addressTableLookups",kN,"readonlyIndexes",kN],["header","numReadonlySignedAccounts"],["header","numReadonlyUnsignedAccounts"],["header","numRequiredSignatures"],["instructions",kN,"accounts",kN],["instructions",kN,"programIdIndex"],["instructions",kN,"stackHeight"]],kz=["getAccountInfo","getBalance","getBlock","getBlockCommitment","getBlockHeight","getBlockProduction","getBlocks","getBlocksWithLimit","getBlockTime","getClusterNodes","getEpochInfo","getEpochSchedule","getFeeForMessage","getFirstAvailableBlock","getGenesisHash","getHealth","getHighestSnapshotSlot","getIdentity","getInflationGovernor","getInflationRate","getInflationReward","getLargestAccounts","getLatestBlockhash","getLeaderSchedule","getMaxRetransmitSlot","getMaxShredInsertSlot","getMinimumBalanceForRentExemption","getMultipleAccounts","getProgramAccounts","getRecentPerformanceSamples","getRecentPrioritizationFees","getSignaturesForAddress","getSignatureStatuses","getSlot","getSlotLeader","getSlotLeaders","getStakeMinimumDelegation","getSupply","getTokenAccountBalance","getTokenAccountsByDelegate","getTokenAccountsByOwner","getTokenLargestAccounts","getTokenSupply","getTransaction","getTransactionCount","getVersion","getVoteAccounts","index","isBlockhashValid","minimumLedgerSlot","requestAirdrop","sendTransaction","simulateTransaction"];function k$(e){return kP(e)&&kz.includes(e.method)}var kK=Object.prototype.toString,kV=Object.keys||function(e){let t=[];for(let r in e)t.push(r);return t};function kJ(e){let t=function e(t,r){let i,n,s,a,o,l,c;if(!0===t)return"true";if(!1===t)return"false";switch(typeof t){case"object":if(null===t)return null;if("toJSON"in t&&"function"==typeof t.toJSON)return e(t.toJSON(),r);if("[object Array]"===(c=kK.call(t))){for(i=0,s="[",n=t.length-1;i<n;i++)s+=e(t[i],!0)+",";return n>-1&&(s+=e(t[i],!0)),s+"]"}if("[object Object]"!==c)return JSON.stringify(t);for(n=(a=kV(t).sort()).length,s="",i=0;i<n;)void 0!==(l=e(t[o=a[i]],!1))&&(s&&(s+=","),s+=JSON.stringify(o)+":"+l),i++;return"{"+s+"}";case"function":case"undefined":return r?null:void 0;case"bigint":return`${t.toString()}n`;case"string":return JSON.stringify(t);default:return isFinite(t)?t:null}}(e,!1);if(void 0!==t)return""+t}var kG={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new kS.SolanaError(kS.SOLANA_ERROR__RPC__INTEGER_OVERFLOW,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return(0,kS.safeCaptureStackTrace)(a,e),a}(e.methodName,t,r)}},kZ=globalThis.AbortController;function kY(e){return kP(e)?kJ([e.method,e.params]):void 0}function kQ(e,t){var r,i,n,s,a;return i=(r={url:e,...t},(0,kO.pipe)(function(e){let t,{fromJson:r,headers:i,toJson:n,url:s}=e,a=i&&function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(i);return async function({payload:e,signal:i}){let o=n?n(e):JSON.stringify(e),l={...t,body:o,headers:{...a,accept:"application/json","content-length":o.length.toString(),"content-type":"application/json; charset=utf-8"},method:"POST",signal:i},c=await fetch(s,l);if(!c.ok)throw new kS.SolanaError(kS.SOLANA_ERROR__RPC__TRANSPORT_HTTP_ERROR,{headers:c.headers,message:c.statusText,statusCode:c.status});return r?r(await c.text(),e):await c.json()}}({...{...r,headers:{...!1,...r.headers?function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(r.headers):void 0,"solana-client":"js/5.5.1"}},fromJson:(e,t)=>k$(t)?kk(e):JSON.parse(e),toJson:e=>k$(e)?kx(e):JSON.stringify(e)}),e=>{let t;return async function(r){let{payload:i,signal:n}=r,s=kY(i);if(void 0===s)return await e(r);if(t||(queueMicrotask(()=>{t=void 0}),t={}),null==t[s]){let i=new kZ,n=(async()=>{try{return await e({...r,signal:i.signal})}catch(e){if(e===(PO||={}))return;throw e}})();t[s]={abortController:i,numConsumers:0,responsePromise:n}}let a=t[s];if(a.numConsumers++,!n)return await a.responsePromise;{let e=a.responsePromise;return await new Promise((t,r)=>{let i=e=>{n.removeEventListener("abort",i),a.numConsumers-=1,queueMicrotask(()=>{0===a.numConsumers&&a.abortController.abort(PO||={})}),r(e.target.reason)};n.addEventListener("abort",i),e.then(t).catch(r).finally(()=>{n.removeEventListener("abort",i)})})}}})),a={api:(s={requestTransformer:kL(kG),responseTransformer:(n={allowedNumericKeyPaths:(PP||(PP={getAccountInfo:kF.map(e=>["value",...e]),getBlock:[["transactions",kN,"meta","preTokenBalances",kN,"accountIndex"],["transactions",kN,"meta","preTokenBalances",kN,"uiTokenAmount","decimals"],["transactions",kN,"meta","postTokenBalances",kN,"accountIndex"],["transactions",kN,"meta","postTokenBalances",kN,"uiTokenAmount","decimals"],["transactions",kN,"meta","rewards",kN,"commission"],...kq.map(e=>["transactions",kN,"meta","innerInstructions",kN,...e]),...kH.map(e=>["transactions",kN,"transaction","message",...e]),["rewards",kN,"commission"]],getClusterNodes:[[kN,"featureSet"],[kN,"shredVersion"]],getInflationGovernor:[["initial"],["foundation"],["foundationTerm"],["taper"],["terminal"]],getInflationRate:[["foundation"],["total"],["validator"]],getInflationReward:[[kN,"commission"]],getMultipleAccounts:kF.map(e=>["value",kN,...e]),getProgramAccounts:kF.flatMap(e=>[["value",kN,"account",...e],[kN,"account",...e]]),getRecentPerformanceSamples:[[kN,"samplePeriodSecs"]],getTokenAccountBalance:[["value","decimals"],["value","uiAmount"]],getTokenAccountsByDelegate:kB.map(e=>["value",kN,"account",...e]),getTokenAccountsByOwner:kB.map(e=>["value",kN,"account",...e]),getTokenLargestAccounts:[["value",kN,"decimals"],["value",kN,"uiAmount"]],getTokenSupply:[["value","decimals"],["value","uiAmount"]],getTransaction:[["meta","preTokenBalances",kN,"accountIndex"],["meta","preTokenBalances",kN,"uiTokenAmount","decimals"],["meta","postTokenBalances",kN,"accountIndex"],["meta","postTokenBalances",kN,"uiTokenAmount","decimals"],["meta","rewards",kN,"commission"],...kq.map(e=>["meta","innerInstructions",kN,...e]),...kH.map(e=>["transaction","message",...e])],getVersion:[["feature-set"]],getVoteAccounts:[["current",kN,"commission"],["delinquent",kN,"commission"]],simulateTransaction:[["value","loadedAccountsDataSize"],...kF.map(e=>["value","accounts",kN,...e]),...kq.map(e=>["value","innerInstructions",kN,...e])]}),PP)},(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return(0,kO.pipe)(e,e=>((e,t)=>{if("error"in e){let{error:n}=e;if(n&&"object"==typeof n&&"code"in n&&(-32002===n.code||n.code===-32002n)&&"data"in n&&n.data){var r,i;let e=(r=[kj([["loadedAccountsDataSize"],...kF.map(e=>["accounts",kN,...e]),...kq.map(e=>["innerInstructions",kN,...e])])],i={keyPath:[]},e=>kM(r)(e,i))(n.data,t),s={...n,data:e};throw(0,kS.getSolanaErrorFromJsonRpcError)(s)}throw(0,kS.getSolanaErrorFromJsonRpcError)(e.error)}return e})(e,t),e=>e.result,e=>kW(i??[])(e,t))})},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t=Object.freeze({methodName:i,params:e}),r=s?.requestTransformer?s?.requestTransformer(t):t;return Object.freeze({execute:async({signal:e,transport:t})=>{let i=kC(r),n=await t({payload:i,signal:e});return s?.responseTransformer?s.responseTransformer(n,r):n}})}}})),transport:i},new Proxy(a.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...i){let n=t.toString(),s=Reflect.get(e,n,r);if(!s)throw new kS.SolanaError(kS.SOLANA_ERROR__RPC__API_PLAN_MISSING_FOR_RPC_METHOD,{method:n,params:i});return function({transport:e},t){return{send:async r=>await t.execute({signal:r?.abortSignal,transport:e})}}(a,s(...i))}}})}var kX=e.i(977886),k0=globalThis.AbortController,k1=globalThis.EventTarget;function k2(){return Symbol(void 0)}var k5=Symbol();function k3(e){return{on(t,r,i){function n(e){e instanceof CustomEvent?r(e.detail):r()}return e.addEventListener(t,n,i),()=>{e.removeEventListener(t,n)}}}}var k8=e.i(667643),k4=globalThis.AbortController,k6=new WeakMap;function k9(e,t,r){let i;if(void 0===r)return;let n=((i=k6.get(t))||k6.set(t,i={}),i);!n[r]&&e>0&&(n[r]=0);let s=e+n[r];return s<=0?delete n[r]:n[r]=s,s}var k7=new WeakMap;async function Te({channel:e,responseTransformer:t,signal:r,subscribeRequest:i,unsubscribeMethodName:n}){var s;let a,o,l,c,d,u,h;e.on("error",()=>{a=void 0,k6.delete(e)},{signal:r});let p=new Promise((t,i)=>{function s(){if(0===k9(-1,e,a)){let t=kC({methodName:n,params:[a]});a=void 0,e.send(t).catch(()=>{})}i(this.reason)}r.aborted?s.call(r):r.addEventListener("abort",s)}),f=kC(i);await e.send(f);let y=new Promise((t,i)=>{let n=new k4;r.addEventListener("abort",n.abort.bind(n));let s={signal:n.signal};e.on("error",e=>{n.abort(),i(e)},s),e.on("message",e=>{e&&"object"==typeof e&&"id"in e&&e.id===f.id&&(n.abort(),"error"in e?i((0,kS.getSolanaErrorFromJsonRpcError)(e.error)):t(e.result))},s)});if(null==(a=await (0,k8.safeRace)([p,y])))throw new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__EXPECTED_SERVER_SUBSCRIPTION_ID);k9(1,e,a);let g=((o=k7.get(e))||k7.set(e,o=new WeakMap),l=t??e,(c=o.get(l))||o.set(l,(s=e=>{if(!("method"in e))return;let r=t?t(e.params.result,i):e.params.result;return[`notification:${e.params.subscription}`,r]},c={...h=k3(u=new k1),on(t,r,i){d||(d={dispose:e.on("message",e=>{let t=s(e);if(!t)return;let[r,i]=t;u.dispatchEvent(new CustomEvent(r,{detail:i}))}),numSubscribers:0}),d.numSubscribers++;let n=h.on(t,r,i),a=!0;function o(){a&&(a=!1,i?.signal.removeEventListener("abort",o),d.numSubscribers--,0===d.numSubscribers&&(d.dispose(),d=void 0),n())}return i?.signal.addEventListener("abort",o),o}})),c),m=`notification:${a}`;return{on(t,r,i){switch(t){case"notification":return g.on(m,r,i);case"error":return e.on("error",r,i);default:throw new kS.SolanaError(kS.SOLANA_ERROR__INVARIANT_VIOLATION__DATA_PUBLISHER_CHANNEL_UNIMPLEMENTED,{channelName:t,supportedChannelNames:["notification","error"]})}}}}var Tt=globalThis.EventTarget,Tr=globalThis.WebSocket,Ti={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new kS.SolanaError(kS.SOLANA_ERROR__RPC__INTEGER_OVERFLOW,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return(0,kS.safeCaptureStackTrace)(a,e),a}(e.methodName,t,r)}},Tn=globalThis.AbortController,Ts={jsonrpc:"2.0",method:"ping"};function Ta(e){return(0,kO.pipe)(e,e=>Object.freeze({...e,on:(t,r,i)=>"message"!==t?e.on(t,r,i):e.on("message",e=>r(kk(e)),i)}),e=>Object.freeze({...e,send:t=>e.send(kx(t))}))}function To(e,t){var r,i,n,s;let a,o;return r=function({createChannel:e}){var t;return(0,kO.pipe)((t=e,async({execute:e,signal:r})=>{let i=await t({abortSignal:r});return await e({channel:i,signal:r})}),e=>{let t;return t=new Map,function(r){let{request:i,signal:n}=r,s=kJ([i.methodName,i.params]),a=t.get(s);if(!a){let i=new Tn,n=e({...r,signal:i.signal});n.then(e=>{e.on("error",()=>{t.delete(s),i.abort()},{signal:i.signal})}).catch(()=>{}),t.set(s,a={abortController:i,dataPublisherPromise:n,numSubscribers:0})}return a.numSubscribers++,n.addEventListener("abort",()=>{a.numSubscribers--,0===a.numSubscribers&&queueMicrotask(()=>{0===a.numSubscribers&&(t.delete(s),a.abortController.abort())})},{signal:a.abortController.signal}),a.dataPublisherPromise}})}({createChannel:function(e){if(!1===/^wss?:/i.test(e.url)){let t=e.url.match(/^([^:]+):/);throw new DOMException(t?`Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${t[1]}:' is not allowed.`:`Failed to construct 'WebSocket': The URL '${e.url}' is invalid.`)}let{intervalMs:t,...r}=e;return function(e,{maxSubscriptionsPerChannel:t,minChannels:r}){let i={entries:[],freeChannelIndex:-1};function n(){let e;if(i.entries.length<r){i.freeChannelIndex=-1;return}for(let r=0;r<i.entries.length;r++){let n=(i.freeChannelIndex+r+2)%i.entries.length,s=i.entries[n];s.subscriptionCount<t&&(!e||e.subscriptionCount>=s.subscriptionCount)&&(e={poolIndex:n,subscriptionCount:s.subscriptionCount})}i.freeChannelIndex=e?.poolIndex??-1}return function({abortSignal:t}){let r;function s(){let e=i.entries.findIndex(e=>e===r);i.entries.splice(e,1),r.dispose(),n()}if(-1===i.freeChannelIndex){let t=new Tn,n=e({abortSignal:t.signal});n.then(e=>{e.on("error",s,{signal:t.signal})}).catch(s),r={channel:n,dispose(){t.abort()},subscriptionCount:0},i.entries.push(r)}else r=i.entries[i.freeChannelIndex];return r.subscriptionCount++,t.addEventListener("abort",function(){r.subscriptionCount--,0===r.subscriptionCount?s():-1!==i.freeChannelIndex&&(i.freeChannelIndex--,n())}),n(),r.channel}}(({abortSignal:i})=>(function({sendBufferHighWatermark:e,signal:t,url:r}){let i,n,s;if(t.aborted)return Promise.reject(t.reason);let a=!1,o=new Set;function l(){o.forEach(e=>{e()}),o.clear()}function c(){l(),a||n(t.reason),y.readyState!==Tr.CLOSED&&y.readyState!==Tr.CLOSING&&y.close(1e3)}function d(e){if(!t.aborted&&!a){let t=new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_FAILED_TO_CONNECT,{errorEvent:e});n(t),h.dispatchEvent(new CustomEvent("error",{detail:t}))}}function u(e){t.aborted||h.dispatchEvent(new CustomEvent("message",{detail:e.data}))}let h=new Tt,p=k3(h);function f(){a=!0,s({...p,async send(t){if(y.readyState!==Tr.OPEN)throw new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED);if(!i&&y.bufferedAmount>e){let t,r=new Promise((r,n)=>{let s=setInterval(()=>{y.readyState===Tr.OPEN&&y.bufferedAmount>e||(clearInterval(s),i=void 0,r())},16);t=()=>{i=void 0,clearInterval(s),n(new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CLOSED_BEFORE_MESSAGE_BUFFERED))}});i={onCancel:t,promise:r}}i&&(!ArrayBuffer.isView(t)||t instanceof DataView||(t=new t.constructor(t)),await i.promise),y.send(t)}})}let y=new Tr(r);return t.addEventListener("abort",c),y.addEventListener("close",function e(r){l(),i?.onCancel(),t.removeEventListener("abort",c),y.removeEventListener("close",e),y.removeEventListener("error",d),y.removeEventListener("message",u),y.removeEventListener("open",f),t.aborted||r.wasClean&&1e3===r.code||h.dispatchEvent(new CustomEvent("error",{detail:new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED,{cause:r})}))}),y.addEventListener("error",d),y.addEventListener("message",u),y.addEventListener("open",f),new Promise((e,t)=>{n=t,s=e})})({...r,sendBufferHighWatermark:e.sendBufferHighWatermark??131072,signal:i}).then(e.jsonSerializer).then(e=>(function({abortSignal:e,channel:t,intervalMs:r}){let i;function n(){t.send(Ts).catch(e=>{(0,kS.isSolanaError)(e,kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED)&&a.abort()})}function s(){clearInterval(i),i=setInterval(n,r)}let a=new Tn;return a.signal.addEventListener("abort",()=>{clearInterval(i)}),e.addEventListener("abort",()=>{a.abort()}),t.on("error",()=>{a.abort()},{signal:a.signal}),t.on("message",s,{signal:a.signal}),globalThis.navigator.onLine&&s(),globalThis.addEventListener("offline",function(){clearInterval(i)},{signal:a.signal}),globalThis.addEventListener("online",function(){n(),s()},{signal:a.signal}),{...t,send:(...e)=>(a.signal.aborted||s(),t.send(...e))}})({abortSignal:i,channel:e,intervalMs:t??5e3})),{maxSubscriptionsPerChannel:e.maxSubscriptionsPerChannel??100,minChannels:e.minChannels??1})}({...t,url:e,jsonSerializer:Ta})}),i={api:(a=kL(Ti),n={allowedNumericKeyPaths:(PN||(PN={accountNotifications:kF.map(e=>["value",...e]),blockNotifications:[["value","block","transactions",kN,"meta","preTokenBalances",kN,"accountIndex"],["value","block","transactions",kN,"meta","preTokenBalances",kN,"uiTokenAmount","decimals"],["value","block","transactions",kN,"meta","postTokenBalances",kN,"accountIndex"],["value","block","transactions",kN,"meta","postTokenBalances",kN,"uiTokenAmount","decimals"],["value","block","transactions",kN,"meta","rewards",kN,"commission"],["value","block","transactions",kN,"meta","innerInstructions",kN,"index"],["value","block","transactions",kN,"meta","innerInstructions",kN,"instructions",kN,"programIdIndex"],["value","block","transactions",kN,"meta","innerInstructions",kN,"instructions",kN,"accounts",kN],["value","block","transactions",kN,"transaction","message","addressTableLookups",kN,"writableIndexes",kN],["value","block","transactions",kN,"transaction","message","addressTableLookups",kN,"readonlyIndexes",kN],["value","block","transactions",kN,"transaction","message","instructions",kN,"programIdIndex"],["value","block","transactions",kN,"transaction","message","instructions",kN,"accounts",kN],["value","block","transactions",kN,"transaction","message","header","numReadonlySignedAccounts"],["value","block","transactions",kN,"transaction","message","header","numReadonlyUnsignedAccounts"],["value","block","transactions",kN,"transaction","message","header","numRequiredSignatures"],["value","block","rewards",kN,"commission"]],programNotifications:kF.flatMap(e=>[["value",kN,"account",...e],[kN,"account",...e]])}),PN)},o=(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return(0,kO.pipe)(e,e=>kW(i??[])(e,t))},s={planExecutor:({request:e,...t})=>Te({...t,responseTransformer:o,subscribeRequest:{...e,methodName:e.methodName.replace(/Notifications$/,"Subscribe")},unsubscribeMethodName:e.methodName.replace(/Notifications$/,"Unsubscribe")}),requestTransformer:a},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t={methodName:i,params:e},r=s.requestTransformer?s.requestTransformer(t):t;return{execute:e=>s.planExecutor({...e,request:r}),request:r}}}})),transport:r},new Proxy(i.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...n){var s,a;let o=t.toString(),l=Reflect.get(e,o,r);if(!l)throw new kS.SolanaError(kS.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CANNOT_CREATE_SUBSCRIPTION_PLAN,{notificationName:o});let c=l(...n);return s=i.transport,a=c,{async subscribe({abortSignal:e}){let t=await s({signal:e,...a});return function({abortSignal:e,dataChannelName:t,dataPublisher:r,errorChannelName:i}){let n=new Map;function s(e){for(let[t,r]of n.entries())r.__hasPolled?(n.delete(t),r.onError(e)):r.publishQueue.push({__type:1,err:e})}let a=new k0;e.addEventListener("abort",()=>{a.abort(),s(PR||=k2())});let o={signal:a.signal},l=k5;return r.on(i,e=>{l===k5&&(l=e,a.abort(),s(e))},o),r.on(t,e=>{n.forEach((t,r)=>{if(t.__hasPolled){let{onData:i}=t;n.set(r,{__hasPolled:!1,publishQueue:[]}),i(e)}else t.publishQueue.push({__type:0,data:e})})},o),{async *[Symbol.asyncIterator](){if(e.aborted)return;if(l!==k5)throw l;let t=Symbol();n.set(t,{__hasPolled:!1,publishQueue:[]});try{for(;;){let e=n.get(t);if(!e)throw new kS.SolanaError(kS.SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_STATE_MISSING);if(e.__hasPolled)throw new kS.SolanaError(kS.SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_MUST_NOT_POLL_BEFORE_RESOLVING_EXISTING_MESSAGE_PROMISE);let r=e.publishQueue;try{if(r.length)for(let t of(e.publishQueue=[],r))if(0===t.__type)yield t.data;else throw t.err;else yield await new Promise((e,r)=>{n.set(t,{__hasPolled:!0,onData:e,onError:r})})}catch(e){if(e===(PR||=k2()))return;throw e}}}finally{n.delete(t)}}}}({abortSignal:e,dataChannelName:"notification",dataPublisher:t,errorChannelName:"error"})}}}}})}var Tl=e.i(931763),Tc=e.i(701983),Td=e.i(958680),Tu=e.i(816775);e.i(475321),e.i(884555),e.i(655686),e.i(754332),e.i(383759),e.i(236710),e.i(334353),e.i(40239);var Th=((Pf=Th||{})[Pf.Uninitialized=0]="Uninitialized",Pf[Pf.Initialized=1]="Initialized",Pf[Pf.Frozen=2]="Frozen",Pf),Tp=((Py=Tp||{})[Py.MintTokens=0]="MintTokens",Py[Py.FreezeAccount=1]="FreezeAccount",Py[Py.AccountOwner=2]="AccountOwner",Py[Py.CloseAccount=3]="CloseAccount",Py[Py.TransferFeeConfig=4]="TransferFeeConfig",Py[Py.WithheldWithdraw=5]="WithheldWithdraw",Py[Py.CloseMint=6]="CloseMint",Py[Py.InterestRate=7]="InterestRate",Py[Py.PermanentDelegate=8]="PermanentDelegate",Py[Py.ConfidentialTransferMint=9]="ConfidentialTransferMint",Py[Py.TransferHookProgramId=10]="TransferHookProgramId",Py[Py.ConfidentialTransferFeeConfig=11]="ConfidentialTransferFeeConfig",Py[Py.MetadataPointer=12]="MetadataPointer",Py[Py.GroupPointer=13]="GroupPointer",Py[Py.GroupMemberPointer=14]="GroupMemberPointer",Py[Py.ScaledUiAmount=15]="ScaledUiAmount",Py[Py.Pause=16]="Pause",Py),Tf=((Pg=Tf||{})[Pg.Uninitialized=0]="Uninitialized",Pg[Pg.TransferFeeConfig=1]="TransferFeeConfig",Pg[Pg.TransferFeeAmount=2]="TransferFeeAmount",Pg[Pg.MintCloseAuthority=3]="MintCloseAuthority",Pg[Pg.ConfidentialTransferMint=4]="ConfidentialTransferMint",Pg[Pg.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",Pg[Pg.DefaultAccountState=6]="DefaultAccountState",Pg[Pg.ImmutableOwner=7]="ImmutableOwner",Pg[Pg.MemoTransfer=8]="MemoTransfer",Pg[Pg.NonTransferable=9]="NonTransferable",Pg[Pg.InterestBearingConfig=10]="InterestBearingConfig",Pg[Pg.CpiGuard=11]="CpiGuard",Pg[Pg.PermanentDelegate=12]="PermanentDelegate",Pg[Pg.NonTransferableAccount=13]="NonTransferableAccount",Pg[Pg.TransferHook=14]="TransferHook",Pg[Pg.TransferHookAccount=15]="TransferHookAccount",Pg[Pg.ConfidentialTransferFee=16]="ConfidentialTransferFee",Pg[Pg.ConfidentialTransferFeeAmount=17]="ConfidentialTransferFeeAmount",Pg[Pg.ScaledUiAmountConfig=18]="ScaledUiAmountConfig",Pg[Pg.PausableConfig=19]="PausableConfig",Pg[Pg.PausableAccount=20]="PausableAccount",Pg[Pg.MetadataPointer=21]="MetadataPointer",Pg[Pg.TokenMetadata=22]="TokenMetadata",Pg[Pg.GroupPointer=23]="GroupPointer",Pg[Pg.TokenGroup=24]="TokenGroup",Pg[Pg.GroupMemberPointer=25]="GroupMemberPointer",Pg[Pg.TokenGroupMember=26]="TokenGroupMember",Pg),Ty=((Pm=Ty||{})[Pm.CreateAssociatedToken=0]="CreateAssociatedToken",Pm[Pm.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",Pm[Pm.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",Pm),Tg=((Pw=Tg||{})[Pw.Mint=0]="Mint",Pw[Pw.Token=1]="Token",Pw[Pw.Multisig=2]="Multisig",Pw),Tm=((Pv=Tm||{})[Pv.InitializeMint=0]="InitializeMint",Pv[Pv.InitializeAccount=1]="InitializeAccount",Pv[Pv.InitializeMultisig=2]="InitializeMultisig",Pv[Pv.Transfer=3]="Transfer",Pv[Pv.Approve=4]="Approve",Pv[Pv.Revoke=5]="Revoke",Pv[Pv.SetAuthority=6]="SetAuthority",Pv[Pv.MintTo=7]="MintTo",Pv[Pv.Burn=8]="Burn",Pv[Pv.CloseAccount=9]="CloseAccount",Pv[Pv.FreezeAccount=10]="FreezeAccount",Pv[Pv.ThawAccount=11]="ThawAccount",Pv[Pv.TransferChecked=12]="TransferChecked",Pv[Pv.ApproveChecked=13]="ApproveChecked",Pv[Pv.MintToChecked=14]="MintToChecked",Pv[Pv.BurnChecked=15]="BurnChecked",Pv[Pv.InitializeAccount2=16]="InitializeAccount2",Pv[Pv.SyncNative=17]="SyncNative",Pv[Pv.InitializeAccount3=18]="InitializeAccount3",Pv[Pv.InitializeMultisig2=19]="InitializeMultisig2",Pv[Pv.InitializeMint2=20]="InitializeMint2",Pv[Pv.GetAccountDataSize=21]="GetAccountDataSize",Pv[Pv.InitializeImmutableOwner=22]="InitializeImmutableOwner",Pv[Pv.AmountToUiAmount=23]="AmountToUiAmount",Pv[Pv.UiAmountToAmount=24]="UiAmountToAmount",Pv[Pv.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",Pv[Pv.InitializeTransferFeeConfig=26]="InitializeTransferFeeConfig",Pv[Pv.TransferCheckedWithFee=27]="TransferCheckedWithFee",Pv[Pv.WithdrawWithheldTokensFromMint=28]="WithdrawWithheldTokensFromMint",Pv[Pv.WithdrawWithheldTokensFromAccounts=29]="WithdrawWithheldTokensFromAccounts",Pv[Pv.HarvestWithheldTokensToMint=30]="HarvestWithheldTokensToMint",Pv[Pv.SetTransferFee=31]="SetTransferFee",Pv[Pv.InitializeConfidentialTransferMint=32]="InitializeConfidentialTransferMint",Pv[Pv.UpdateConfidentialTransferMint=33]="UpdateConfidentialTransferMint",Pv[Pv.ConfigureConfidentialTransferAccount=34]="ConfigureConfidentialTransferAccount",Pv[Pv.ApproveConfidentialTransferAccount=35]="ApproveConfidentialTransferAccount",Pv[Pv.EmptyConfidentialTransferAccount=36]="EmptyConfidentialTransferAccount",Pv[Pv.ConfidentialDeposit=37]="ConfidentialDeposit",Pv[Pv.ConfidentialWithdraw=38]="ConfidentialWithdraw",Pv[Pv.ConfidentialTransfer=39]="ConfidentialTransfer",Pv[Pv.ApplyConfidentialPendingBalance=40]="ApplyConfidentialPendingBalance",Pv[Pv.EnableConfidentialCredits=41]="EnableConfidentialCredits",Pv[Pv.DisableConfidentialCredits=42]="DisableConfidentialCredits",Pv[Pv.EnableNonConfidentialCredits=43]="EnableNonConfidentialCredits",Pv[Pv.DisableNonConfidentialCredits=44]="DisableNonConfidentialCredits",Pv[Pv.ConfidentialTransferWithFee=45]="ConfidentialTransferWithFee",Pv[Pv.InitializeDefaultAccountState=46]="InitializeDefaultAccountState",Pv[Pv.UpdateDefaultAccountState=47]="UpdateDefaultAccountState",Pv[Pv.Reallocate=48]="Reallocate",Pv[Pv.EnableMemoTransfers=49]="EnableMemoTransfers",Pv[Pv.DisableMemoTransfers=50]="DisableMemoTransfers",Pv[Pv.CreateNativeMint=51]="CreateNativeMint",Pv[Pv.InitializeNonTransferableMint=52]="InitializeNonTransferableMint",Pv[Pv.InitializeInterestBearingMint=53]="InitializeInterestBearingMint",Pv[Pv.UpdateRateInterestBearingMint=54]="UpdateRateInterestBearingMint",Pv[Pv.EnableCpiGuard=55]="EnableCpiGuard",Pv[Pv.DisableCpiGuard=56]="DisableCpiGuard",Pv[Pv.InitializePermanentDelegate=57]="InitializePermanentDelegate",Pv[Pv.InitializeTransferHook=58]="InitializeTransferHook",Pv[Pv.UpdateTransferHook=59]="UpdateTransferHook",Pv[Pv.InitializeConfidentialTransferFee=60]="InitializeConfidentialTransferFee",Pv[Pv.WithdrawWithheldTokensFromMintForConfidentialTransferFee=61]="WithdrawWithheldTokensFromMintForConfidentialTransferFee",Pv[Pv.WithdrawWithheldTokensFromAccountsForConfidentialTransferFee=62]="WithdrawWithheldTokensFromAccountsForConfidentialTransferFee",Pv[Pv.HarvestWithheldTokensToMintForConfidentialTransferFee=63]="HarvestWithheldTokensToMintForConfidentialTransferFee",Pv[Pv.EnableHarvestToMint=64]="EnableHarvestToMint",Pv[Pv.DisableHarvestToMint=65]="DisableHarvestToMint",Pv[Pv.WithdrawExcessLamports=66]="WithdrawExcessLamports",Pv[Pv.InitializeMetadataPointer=67]="InitializeMetadataPointer",Pv[Pv.UpdateMetadataPointer=68]="UpdateMetadataPointer",Pv[Pv.InitializeGroupPointer=69]="InitializeGroupPointer",Pv[Pv.UpdateGroupPointer=70]="UpdateGroupPointer",Pv[Pv.InitializeGroupMemberPointer=71]="InitializeGroupMemberPointer",Pv[Pv.UpdateGroupMemberPointer=72]="UpdateGroupMemberPointer",Pv[Pv.InitializeScaledUiAmountMint=73]="InitializeScaledUiAmountMint",Pv[Pv.UpdateMultiplierScaledUiMint=74]="UpdateMultiplierScaledUiMint",Pv[Pv.InitializePausableConfig=75]="InitializePausableConfig",Pv[Pv.Pause=76]="Pause",Pv[Pv.Resume=77]="Resume",Pv[Pv.InitializeTokenMetadata=78]="InitializeTokenMetadata",Pv[Pv.UpdateTokenMetadataField=79]="UpdateTokenMetadataField",Pv[Pv.RemoveTokenMetadataKey=80]="RemoveTokenMetadataKey",Pv[Pv.UpdateTokenMetadataUpdateAuthority=81]="UpdateTokenMetadataUpdateAuthority",Pv[Pv.EmitTokenMetadata=82]="EmitTokenMetadata",Pv[Pv.InitializeTokenGroup=83]="InitializeTokenGroup",Pv[Pv.UpdateTokenGroupMaxSize=84]="UpdateTokenGroupMaxSize",Pv[Pv.UpdateTokenGroupUpdateAuthority=85]="UpdateTokenGroupUpdateAuthority",Pv[Pv.InitializeTokenGroupMember=86]="InitializeTokenGroupMember",Pv);new Uint8Array([250,166,180,250,13,12,184,70]),new Uint8Array([121,113,108,39,54,51,0,4]),new Uint8Array([152,32,222,176,223,237,116,134]),new Uint8Array([210,225,30,162,88,184,77,141]),new Uint8Array([234,18,32,56,89,141,37,181]),new Uint8Array([108,37,171,143,248,30,18,110]),new Uint8Array([161,105,88,1,237,221,216,203]),new Uint8Array([221,233,49,45,181,202,220,200]),new Uint8Array([215,228,166,228,84,100,86,123]),Sn.union([Sn.string().transform(e=>e.replace(/[^0-9.-]+/g,"")),Sn.number()]).pipe(Sn.coerce.number().min(1e-4).max(0x3b9ac9ff));var Tw=Sn.enum(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","solana-devnet","solana","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia"]),Tv=new Map([["abstract",2741],["abstract-testnet",11124],["base-sepolia",84532],["base",8453],["avalanche-fuji",43113],["avalanche",43114],["iotex",4689],["sei",1329],["sei-testnet",1328],["polygon",137],["polygon-amoy",80002],["peaq",3338],["story",1514],["educhain",41923],["skale-base-sepolia",0x135a9d92]]),Tb=["solana-devnet","solana"];Object.fromEntries(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia",...Tb].map(e=>[Tv.get(e),e]));var T_={id:0x135a9d92,name:"SKALE Base Sepolia",nativeCurrency:{name:"Credits",symbol:"CREDITS",decimals:18},rpcUrls:{default:{http:["https://base-sepolia-testnet.skalenodes.com/v1/jubilant-horrible-ancha"]}},blockExplorers:{default:{name:"Blockscout",url:"https://base-sepolia-testnet-explorer.skalenodes.com",apiUrl:"https://base-sepolia-testnet-explorer.skalenodes.com/api"}}};function TE(e){let t=TP(e);return(0,Ss.createPublicClient)({chain:t,transport:(0,Ie.http)()}).extend(Sa.publicActions)}function TI(){return TE("base-sepolia")}function TA(){return TE("avalanche-fuji")}function TS(e,t){let r=TP(e),i=(0,E7.createWalletClient)({chain:r,transport:(0,Ie.http)(),account:function(e,t={}){let{nonceManager:r}=t,i=(0,en.toHex)(dP.secp256k1.getPublicKey(e.slice(2),!1));return{...function(e){if("string"==typeof e){if(!(0,Sp.isAddress)(e,{strict:!1}))throw new Sh.InvalidAddressError({address:e});return{address:e,type:"json-rpc"}}if(!(0,Sp.isAddress)(e.address,{strict:!1}))throw new Sh.InvalidAddressError({address:e.address});return{address:e.address,nonceManager:e.nonceManager,sign:e.sign,signAuthorization:e.signAuthorization,signMessage:e.signMessage,signTransaction:e.signTransaction,signTypedData:e.signTypedData,source:"custom",type:"local"}}({address:(0,SX.publicKeyToAddress)(i),nonceManager:r,sign:async({hash:t})=>S1({hash:t,privateKey:e,to:"hex"}),signAuthorization:async t=>S2({...t,privateKey:e}),signMessage:async({message:t})=>S3({message:t,privateKey:e}),signTransaction:async(t,{serializer:r}={})=>S4({privateKey:e,transaction:t,serializer:r}),signTypedData:async t=>S9({...t,privateKey:e})}),publicKey:i,source:"privateKey"}}(t)});return TR(r)?i.extend(Sa.publicActions).extend(e=>({sendTransaction:t=>kI(e,t),signTransaction:t=>kb(e,t),deployContract:t=>(function(e,t){let{abi:r,args:i,bytecode:n,deploymentType:s,salt:a,...o}=t,l=function(e){let{abi:t,args:r,bytecode:i,deploymentType:n,salt:s}=e;if(!r||0===r.length){let{functionName:e,argsContractDeployer:t}=ka(n,s??ke.zeroHash,(0,en.toHex)(SV(i)),"0x");return(0,ki.encodeFunctionData)({abi:kn,functionName:e,args:t})}let a=t.find(e=>"type"in e&&"constructor"===e.type);if(!a)throw new kt.AbiConstructorNotFoundError({docsPath:ks});if(!("inputs"in a)||!a.inputs||0===a.inputs.length)throw new kt.AbiConstructorParamsNotFoundError({docsPath:ks});let o=(0,kr.encodeAbiParameters)(a.inputs,r),{functionName:l,argsContractDeployer:c}=ka(n,s??ke.zeroHash,(0,en.toHex)(SV(i)),o);return(0,ki.encodeFunctionData)({abi:kn,functionName:l,args:c})}({abi:r,args:i,bytecode:n,deploymentType:s,salt:a});return o.factoryDeps=o.factoryDeps||[],o.factoryDeps.includes(n)||o.factoryDeps.push(n),k_(e,{...o,data:l,to:"create2"===s||"create2Account"===s?"0x0000000000000000000000000000000000010000":"0x0000000000000000000000000000000000008006"})})(e,t),writeContract:t=>(0,S7.writeContract)(Object.assign(e,{sendTransaction:t=>kI(e,t)}),t)})):i.extend(Sa.publicActions)}function Tk(e){return TS("base-sepolia",e)}function TT(e){return TS("avalanche-fuji",e)}function TC(e){return"object"==typeof e&&null!==e&&"chain"in e&&"transport"in e}function Tx(e){return"object"==typeof e&&null!==e&&"string"==typeof e.address&&"string"==typeof e.type&&"function"==typeof e.sign&&"function"==typeof e.signMessage&&"function"==typeof e.signTypedData&&"function"==typeof e.signTransaction}function TP(e){if(!e)throw Error("NETWORK environment variable is not set");switch(e){case"abstract":return SG;case"abstract-testnet":return SZ;case"base":return S_;case"base-sepolia":return Sv;case"avalanche":return ST;case"avalanche-fuji":return Sb;case"sei":return SE;case"sei-testnet":return SI;case"polygon":return SA;case"polygon-amoy":return SS;case"peaq":return Sk;case"story":return SY;case"educhain":return SQ;case"iotex":return Sx;case"iotex-testnet":return SC;case"skale-base-sepolia":return T_;default:throw Error(`Unsupported network: ${e}`)}}var TO=new Set([2741,11124]);function TR(e){return TO.has(e.id)}function TN(e){return kQ(e?(0,kX.devnet)(e):(0,kX.devnet)("https://api.devnet.solana.com"))}function TM(e){return kQ(e?(0,kX.mainnet)(e):(0,kX.mainnet)("https://api.mainnet-beta.solana.com"))}function TU(e,t){if("solana-devnet"===e)return TN(t);if("solana"===e)return TM(t);throw Error("Invalid network")}function TD(e,t){if("solana-devnet"===e)return To((0,kX.devnet)(t?TL(t):"wss://api.devnet.solana.com"));if("solana"===e)return To((0,kX.mainnet)(t?TL(t):"wss://api.mainnet-beta.solana.com"));throw Error("Invalid network")}function TL(e){return e.startsWith("http")?e.replace("http","ws"):e}function Tj(e){if(!Tb.find(t=>t===e))throw Error(`Unsupported SVM network: ${e}`);return TU(e)}async function TW(e){let t=oQ.base58.decode(e);if(64===t.length)return await (0,kA.createKeyPairSignerFromBytes)(t);if(32===t.length)return await (0,kA.createKeyPairSignerFromPrivateKeyBytes)(t);throw Error(`Unexpected key length: ${t.length}. Expected 32 or 64 bytes.`)}function TB(e){return"object"==typeof e&&null!==e&&(0,kA.isTransactionSigner)(e)}Ia({},{authorizationPrimaryType:()=>Tq,authorizationTypes:()=>TF,config:()=>Io,createClientAvalancheFuji:()=>TA,createClientSepolia:()=>TI,createConnectedClient:()=>TE,createSigner:()=>TS,createSignerAvalancheFuji:()=>TT,createSignerSepolia:()=>Tk,getChainFromNetwork:()=>TP,isAccount:()=>Tx,isSignerWallet:()=>TC,isZkStackChain:()=>TR,usdcABI:()=>Il});var TF={TransferWithAuthorization:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"validAfter",type:"uint256"},{name:"validBefore",type:"uint256"},{name:"nonce",type:"bytes32"}]},Tq="TransferWithAuthorization";Ia({},{SvmAddressRegex:()=>TH});var TH=/^[1-9A-HJ-NP-Za-km-z]{32,44}$/,Tz=/^0x[0-9a-fA-F]{40}$/,T$=/^0x[a-fA-F0-9]{40}|[A-Za-z0-9][A-Za-z0-9-]{0,34}[A-Za-z0-9]$/,TK=["exact"],TV=[1],TJ=["insufficient_funds","invalid_exact_evm_payload_authorization_valid_after","invalid_exact_evm_payload_authorization_valid_before","invalid_exact_evm_payload_authorization_value","invalid_exact_evm_payload_signature","invalid_exact_evm_payload_undeployed_smart_wallet","invalid_exact_evm_payload_recipient_mismatch","invalid_exact_svm_payload_transaction","invalid_exact_svm_payload_transaction_amount_mismatch","invalid_exact_svm_payload_transaction_create_ata_instruction","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_payee","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_asset","invalid_exact_svm_payload_transaction_instructions","invalid_exact_svm_payload_transaction_instructions_length","invalid_exact_svm_payload_transaction_instructions_compute_limit_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction_too_high","invalid_exact_svm_payload_transaction_instruction_not_spl_token_transfer_checked","invalid_exact_svm_payload_transaction_instruction_not_token_2022_transfer_checked","invalid_exact_svm_payload_transaction_fee_payer_included_in_instruction_accounts","invalid_exact_svm_payload_transaction_fee_payer_transferring_funds","invalid_exact_svm_payload_transaction_not_a_transfer_instruction","invalid_exact_svm_payload_transaction_receiver_ata_not_found","invalid_exact_svm_payload_transaction_sender_ata_not_found","invalid_exact_svm_payload_transaction_simulation_failed","invalid_exact_svm_payload_transaction_transfer_to_incorrect_ata","invalid_network","invalid_payload","invalid_payment_requirements","invalid_scheme","invalid_payment","payment_expired","unsupported_scheme","invalid_x402_version","invalid_transaction_state","invalid_x402_version","settle_exact_svm_block_height_exceeded","settle_exact_svm_transaction_confirmation_timed_out","unsupported_scheme","unexpected_settle_error","unexpected_verify_error"],TG=e=>Number.isInteger(Number(e))&&Number(e)>=0,TZ=Sn.string().regex(Tz).or(Sn.string().regex(TH)),TY=Sn.string().regex(T$).or(Sn.string().regex(TH)),TQ=Sn.object({scheme:Sn.enum(TK),network:Tw,maxAmountRequired:Sn.string().refine(TG),resource:Sn.string().url(),description:Sn.string(),mimeType:Sn.string(),outputSchema:Sn.record(Sn.any()).optional(),payTo:TZ,maxTimeoutSeconds:Sn.number().int(),asset:TY,extra:Sn.record(Sn.any()).optional()}),TX=Sn.object({from:Sn.string().regex(Tz),to:Sn.string().regex(Tz),value:Sn.string().refine(TG).refine(e=>e.length<=18),validAfter:Sn.string().refine(TG),validBefore:Sn.string().refine(TG),nonce:Sn.string().regex(/^0x[0-9a-fA-F]{64}$/)}),T0=Sn.object({signature:Sn.string().regex(/^0x[0-9a-fA-F]+$/),authorization:TX}),T1=Sn.object({transaction:Sn.string().regex(/^[A-Za-z0-9+/]*={0,2}$/)}),T2=Sn.object({x402Version:Sn.number().refine(e=>TV.includes(e)),scheme:Sn.enum(TK),network:Tw,payload:Sn.union([T0,T1])});Sn.object({x402Version:Sn.number().refine(e=>TV.includes(e)),error:Sn.enum(TJ).optional(),accepts:Sn.array(TQ).optional(),payer:Sn.string().regex(T$).optional()});var T5=Sn.enum(["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"]),T3=Sn.object({type:Sn.literal("http"),method:T5,queryParams:Sn.record(Sn.string(),Sn.string()).optional(),bodyType:Sn.enum(["json","form-data","multipart-form-data","text","binary"]).optional(),bodyFields:Sn.record(Sn.string(),Sn.any()).optional(),headerFields:Sn.record(Sn.string(),Sn.any()).optional()});Sn.discriminatedUnion("type",[T3]);var T8=Sn.object({resource:Sn.string(),type:Sn.enum(["http"]),x402Version:Sn.number().refine(e=>TV.includes(e)),accepts:Sn.array(TQ),lastUpdated:Sn.date(),metadata:Sn.record(Sn.any()).optional()});Sn.object({paymentPayload:T2,paymentRequirements:TQ}),Sn.object({paymentPayload:T2,paymentRequirements:TQ}),Sn.object({isValid:Sn.boolean(),invalidReason:Sn.enum(TJ).optional(),payer:TZ.optional()}),Sn.object({success:Sn.boolean(),errorReason:Sn.enum(TJ).optional(),payer:TZ.optional(),transaction:Sn.string().regex(T$),network:Tw}),Sn.object({type:Sn.string().optional(),limit:Sn.number().optional(),offset:Sn.number().optional()}),Sn.object({x402Version:Sn.number().refine(e=>TV.includes(e)),items:Sn.array(T8),pagination:Sn.object({limit:Sn.number(),offset:Sn.number(),total:Sn.number()})});var T4=Sn.object({x402Version:Sn.number().refine(e=>TV.includes(e)),scheme:Sn.enum(TK),network:Tw,extra:Sn.record(Sn.any()).optional()});function T6(e){try{let t=(0,Tc.getBase64Encoder)().encode(e.transaction);return(0,Tl.getTransactionDecoder)().decode(t)}catch(e){throw console.error("error",e),Error("invalid_exact_svm_payload_transaction")}}function T9(e){let t=(0,Td.getCompiledTransactionMessageDecoder)().decode(e.messageBytes),r=t.staticAccounts??[];for(let e of t.instructions??[]){let t=r[e.programAddressIndex].toString();if(t===Tu.TOKEN_PROGRAM_ADDRESS.toString()||t==="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb".toString()){let t=e.accountIndices??[];if(t.length>=4){let e=r[t[3]].toString();if(e)return e}}}return""}async function T7(e,t,r){let i=await Ce(e,t),n=(0,Tl.getBase64EncodedWireTransaction)(i);return await r.simulateTransaction(n,{sigVerify:!0,replaceRecentBlockhash:!1,commitment:"confirmed",encoding:"base64",accounts:void 0,innerInstructions:void 0,minContextSlot:void 0}).send()}async function Ce(e,t){if((0,kA.isTransactionModifyingSigner)(e)){let[r]=await e.modifyAndSignTransactions([t]);if(!r)throw Error("transaction_signer_failed_to_return_transaction");return r}if((0,kA.isTransactionPartialSigner)(e)){var r,i;let[n]=await e.signTransactions([t]);if(!n)throw Error("transaction_signer_failed_to_return_signatures");return r=t,i=n,Object.freeze({...r,signatures:Object.freeze({...r.signatures,...i})})}throw Error("transaction_signer_must_support_offline_signing")}Sn.object({kinds:Sn.array(T4)}),Ia({},{createDevnetRpcClient:()=>TN,createMainnetRpcClient:()=>TM,createSignerFromBase58:()=>TW,createSvmConnectedClient:()=>Tj,decodeTransactionFromPayload:()=>T6,getRpcClient:()=>TU,getRpcSubscriptions:()=>TD,getTokenPayerFromTransaction:()=>T9,isSignerWallet:()=>TB,signAndSimulateTransaction:()=>T7,signTransactionWithSigner:()=>Ce}),Sn.object({paymentHeader:Sn.string(),paymentRequirements:TQ});var Ct=((Pb=Ct||{})[Pb.RequestUnits=0]="RequestUnits",Pb[Pb.RequestHeapFrame=1]="RequestHeapFrame",Pb[Pb.SetComputeUnitLimit=2]="SetComputeUnitLimit",Pb[Pb.SetComputeUnitPrice=3]="SetComputeUnitPrice",Pb[Pb.SetLoadedAccountsDataSizeLimit=4]="SetLoadedAccountsDataSizeLimit",Pb);e.s([],559889),e.i(388477),e.i(331502);class Cr{static parse(e){try{return new Cr(e)}catch(e){return null}}static throwIfNotWellFormedJwt(e){return i7.decodeJwt(e),e}get subject(){return this._decoded.sub}get expiration(){return this._decoded.exp}get issuer(){return this._decoded.iss}get audience(){return this._decoded.aud}isExpired(e=0){return Date.now()>=1e3*(this.expiration-e)}constructor(e){this.value=e,this._decoded=i7.decodeJwt(e)}}class Ci extends Cr{static parse(e){try{return new Ci(e)}catch(e){return null}}get appId(){return this._decoded.aid?this._decoded.aid:this.audience}}let Cn=({style:e,...t})=>(0,j.jsxs)("svg",{viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{height:"28px",width:"28px",...e},...t,children:[(0,j.jsx)("rect",{width:"1024",height:"1024",fill:"#0052FF",rx:100,ry:100}),(0,j.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 512C152 710.823 313.177 872 512 872C710.823 872 872 710.823 872 512C872 313.177 710.823 152 512 152C313.177 152 152 313.177 152 512ZM420 396C406.745 396 396 406.745 396 420V604C396 617.255 406.745 628 420 628H604C617.255 628 628 617.255 628 604V420C628 406.745 617.255 396 604 396H420Z",fill:"white"})]}),Cs="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PScwIDAgMTAyNCAxMDI0JyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHN0eWxlPSdoZWlnaHQ6MjhweDt3aWR0aDoyOHB4Jz48cmVjdCB3aWR0aD0nMTAyNCcgaGVpZ2h0PScxMDI0JyBmaWxsPScjMDA1MkZGJyByeD0nMTAwJyByeT0nMTAwJz48L3JlY3Q+PHBhdGggZmlsbC1ydWxlPSdldmVub2RkJyBjbGlwLXJ1bGU9J2V2ZW5vZGQnIGQ9J00xNTIgNTEyQzE1MiA3MTAuODIzIDMxMy4xNzcgODcyIDUxMiA4NzJDNzEwLjgyMyA4NzIgODcyIDcxMC44MjMgODcyIDUxMkM4NzIgMzEzLjE3NyA3MTAuODIzIDE1MiA1MTIgMTUyQzMxMy4xNzcgMTUyIDE1MiAzMTMuMTc3IDE1MiA1MTJaTTQyMCAzOTZDNDA2Ljc0NSAzOTYgMzk2IDQwNi43NDUgMzk2IDQyMFY2MDRDMzk2IDYxNy4yNTUgNDA2Ljc0NSA2MjggNDIwIDYyOEg2MDRDNjE3LjI1NSA2MjggNjI4IDYxNy4yNTUgNjI4IDYwNFY0MjBDNjI4IDQwNi43NDUgNjE3LjI1NSAzOTYgNjA0IDM5Nkg0MjBaJyBmaWxsPSd3aGl0ZSc+PC9wYXRoPjwvc3ZnPg==",Ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAALZJREFUaEPtmjEOhDAMBNc/O14GvOzys3CAKK6eAlmaVGl2Zc+kTOU685vkc9/bnD2prZK5/TZY24z9P+g4F5hNh7/GdoG37WlAA5CATwgCxHENYISwQAMQII5rACOEBRqAAHFcAxghLNAABIjjGsAIYYEGIEAc1wBGCAs0AAHiuAYwQligAQgQxzWAEcICDUCAOK4BjBAWaAACxHENYISwQAMQII6fBjr+VHkW3+u+tfyxMpJaDgYzYxb/ALZVAAAAAElFTkSuQmCC";class Co extends nl.E{async initialize(){await this.importPromise,await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:Ca,id:"com.coinbase.wallet"}}async promptConnection(){try{await this.importPromise;let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new nd.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,nu.f)(e)}}constructor(t,r,i,s,a){super("base_account",t,r,i),this.connectorType="base_account",this.walletClientType="base_account",this.displayName="Base",this.setBaseAccountSdk=a,this.proxyProvider=new nl.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.baseAccountConfig={...s,appChainIds:[r.id].concat(t.map(e=>e.id))},n?(this.proxyProvider.setWalletProvider(n.getProvider()),this.setBaseAccountSdk(n)):this.importPromise=e.A(111070).then(({createBaseAccountSDK:e})=>{n=e(this.baseAccountConfig),this.proxyProvider.setWalletProvider(n.getProvider()),this.setBaseAccountSdk(n)}).catch(console.error)}}let Cl=[1,0xaa36a7,137,10,8453,84532,42161,7777777,43114,56];class Cc extends nl.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:Cs,id:"com.coinbase.wallet"}}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new nd.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,nu.f)(e)}}updateConnectionPreference(e){this.coinbaseWalletConfig={...this.coinbaseWalletConfig,preference:{...this.coinbaseWalletConfig.preference,options:e}},this.walletClientType="smartWalletOnly"===e?"coinbase_smart_wallet":"coinbase_wallet",s=aZ({...this.coinbaseWalletConfig}),this.proxyProvider.setWalletProvider(s.getProvider())}constructor(e,t,r,i){if(super("coinbase_wallet",e,t,r),this.connectorType="coinbase_wallet",this.displayName="Coinbase Wallet",this.proxyProvider=new nl.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.coinbaseWalletConfig={...i,appChainIds:[t.id].concat(e.map(e=>e.id))},this.walletClientType="smartWalletOnly"===this.coinbaseWalletConfig.preference?.options?"coinbase_smart_wallet":"coinbase_wallet","coinbase_smart_wallet"===this.walletClientType&&(this.displayName="Coinbase Smart Wallet"),!s){let e="eoaOnly"!==this.coinbaseWalletConfig.preference?.options?(this.coinbaseWalletConfig.appChainIds??[]).filter(e=>!Cl.includes(e)):[];e.length>0&&!e.every(e=>H.DEFAULT_SUPPORTED_CHAIN_IDS.has(e))&&console.info(`The configured chains are not supported by Coinbase Smart Wallet: ${e.join(", ")}`),s=aZ(this.coinbaseWalletConfig)}this.proxyProvider.setWalletProvider(s.getProvider())}}let Cd=({...e})=>(0,j.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,j.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.37126 11.0323C2.37126 12.696 3.90598 13.4421 5.40654 13.4468C8.91753 13.4468 12.8021 11.2897 12.7819 7.67984C12.7673 5.07728 10.3748 2.86167 7.54357 2.88296C4.8495 2.88296 2.21821 4.6411 2.21803 7.03628C2.21803 7.67951 2.58722 8.30178 3.55231 8.37184C2.74763 9.16826 2.37126 10.1225 2.37126 11.0323ZM7.55283 8.68012C8.11562 8.68012 8.57186 8.13217 8.57186 7.45624C8.57186 6.78032 8.11562 6.23237 7.55283 6.23237C6.99003 6.23237 6.53379 6.78032 6.53379 7.45624C6.53379 8.13217 6.99003 8.68012 7.55283 8.68012ZM10.4747 8.68012C11.0375 8.68012 11.4937 8.13217 11.4937 7.45625C11.4937 6.78032 11.0375 6.23237 10.4747 6.23237C9.91186 6.23237 9.45562 6.78032 9.45562 7.45625C9.45562 8.13217 9.91186 8.68012 10.4747 8.68012Z",fill:e.color||"var(--privy-color-foreground-3)"})});class Cu extends nl.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return await this.isConnected()?(await this.proxyProvider.request({method:"wallet_switchEthereumChain",params:[(0,nl.t)(e?.chainId||"0x1")]}),this.getConnectedWallet()):null}get walletBranding(){return{name:"Privy Wallet",icon:Cd,id:"io.privy.wallet"}}disconnect(){this.connected=!1}async promptConnection(){}constructor({provider:e,chains:t,defaultChain:r,rpcConfig:i,imported:n,walletIndex:s}){super("privy",t,r,i),this.connectorType="embedded",this.proxyProvider=e,this.walletIndex=s,n&&(this.connectorType="embedded_imported"),this.subscribeListeners()}}async function Ch(){let e=Pq();return e?e.getAccessToken():Promise.resolve(nu.s.get(aY.P)||nu.s.get(aY.C)||null)}let Cp=["eth_sign","eth_populateTransactionRequest","eth_signTransaction","personal_sign","eth_signTypedData_v4","csw_signUserOperation","secp256k1_sign"];function Cf(e){return e?{"privy-ui":"t"}:void 0}class Cy{async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new nd.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(oh,{email:this.meta.email,code:this.meta.emailCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new nd.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(op,{email:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,nd.f)(e)}}async sendCodeEmail({email:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new nd.a("Auth flow has no API instance");if(e&&(this.meta.email=e),t&&(this.meta.captchaToken=t),!this.meta.email)throw new nd.a("Email must be set when initialzing authentication.");let i=Cf(r);try{return await this.api.post(ou,{email:this.meta.email,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,nd.f)(e)}}constructor({email:e,captchaToken:t,disableSignup:r}){this.meta={email:e,captchaToken:t,disableSignup:r??!1}}}class Cg extends Cy{async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode||!this.meta.oldAddress)throw new nd.a("Email, email code, and an old email address must be set prior to calling update.");try{return await this.api.post(oy,{oldAddress:this.meta.oldAddress,newAddress:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,nd.f)(e)}}constructor(e,t,r){super({email:t,captchaToken:r}),this.meta={email:t,captchaToken:r,oldAddress:e,disableSignup:!1}}}class Cm{execute(e){return null===this.promise&&(this.promise=(async()=>{try{return await this.fn(e)}finally{this.promise=null}})()),this.promise}constructor(e){this.promise=null,this.fn=e}}class Cw{get meta(){return this._meta}async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new nd.a("Auth flow must be initialized first");try{let e=await this.api.post(oa,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});if(!e)throw new nd.a("No response from authentication");return e}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oo,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid})}catch(e){throw(0,nd.f)(e)}}async _startChannelOnce(){if(!this.api)throw new nd.a("Auth flow has no API instance");let e=await this.api.post(os,{token:this.captchaToken});aQ.isMobile&&!aQ.isIOS&&e.connect_uri&&(0,oY.o)(e.connect_uri,"_blank"),this._meta={...this._meta,connectUri:e.connect_uri,channelToken:e.channel_token}}async initializeFarcasterConnect(){if(!this.api)throw new nd.a("Auth flow has no API instance");await this.startChannelOnce.execute()}async _pollForReady(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new nd.a("Auth flow must be initialized first");let e=await this.api.get(ol,{headers:{"farcaster-channel-token":this.meta.channelToken}});return"completed"===e.state&&(this.message=e.message,this.signature=e.signature,this.fid=e.fid,!0)}constructor(e,t=!1){this._meta={disableSignup:!1},this.captchaToken=e,this.startChannelOnce=new Cm(this._startChannelOnce.bind(this)),this.pollForReady=new Cm(this._pollForReady.bind(this)),this._meta.disableSignup=t}}function Cv(){return"u">typeof window&&"chrome-extension:"===window.location.protocol&&"chrome"in window}function Cb(){if(!Cv())return;let e=window.chrome;return e?.runtime?.id}function C_(){if(!Cv())return!1;let e=window.chrome;return"function"==typeof e?.identity?.launchWebAuthFlow}async function CE(e){return new Promise((t,r)=>{C_()?window.chrome.identity.launchWebAuthFlow({url:e,interactive:!0},async e=>{try{let r=function(){if(!Cv())return;let e=window.chrome;return e?.runtime?.lastError?.message}();if(r||!e){let e=`WebAuthFlow failed: ${r||"Response URI missing"}`;throw Error(e)}let i=new URL(e),n=Cb();if(!n)throw Error("Invalid extension context");if("chrome-extension:"===i.protocol){if(i.hostname!==n)throw Error("Invalid responseUri origin")}else{if("https:"!==i.protocol)throw Error("Invalid responseUri protocol");{let e=i.hostname.split(".");if(3!==e.length||"chromiumapp"!==e[1]||"org"!==e[2]||e[0]!==n)throw Error("Invalid responseUri origin")}}let s=i.searchParams.get("privy_oauth_state"),a=i.searchParams.get("privy_oauth_code");if(!s||!a)throw Error("Invalid responseUri - missing required parameters");t({privyOAuthState:s,privyOAuthCode:a})}catch(e){r(e)}}):r(Error("Chrome identity API not available"))})}function CI(e){return crypto.getRandomValues(new Uint8Array(e))}function CA(){return eL.encode(CI(36))}function CS(){return CA()}async function Ck(e,t="S256"){if("S256"!=t)return e;{let t=await async function(e){let t=(new TextEncoder).encode(e);return new Uint8Array(await crypto.subtle.digest("SHA-256",t))}(e);return eL.encode(t)}}class CT{addCaptchaToken(e){this.meta.captchaToken=e}isActive(){return!!(this.meta.authorizationCode&&this.meta.stateCode&&this.meta.provider)}async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new nd.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling authenticate.");if("undefined"===this.meta.authorizationCode)throw new nd.a("User denied confirmation during OAuth flow");let e=function(){let e=nu.s.get(aY.a);if(!e)throw new nd.a("Authentication error.");return e}();try{let t=await this.api.post(oA,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});return nu.s.del(aY.a),nu.s.del(aY.H),nu.s.del(aY.O),t}catch(t){let e=(0,nd.f)(t);if(e.privyErrorCode)throw new nd.a(e.message||"Invalid code during OAuth flow.",void 0,e.privyErrorCode);if("User denied confirmation during OAuth flow"===e.message)throw new nd.a("Invalid code during oauth flow.",void 0,nd.b.OAUTH_USER_DENIED);throw new nd.a("Invalid code during OAuth flow.",void 0,nd.b.UNKNOWN_AUTH_ERROR)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new nd.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling link.");if("undefined"===this.meta.authorizationCode)throw new nd.a("User denied confirmation during OAuth flow");let e=nu.s.get(aY.a);if(!e)throw new nd.a("Authentication error.");try{let t=await this.api.post(oS,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e});return nu.s.del(aY.a),t}catch(e){throw(0,nd.f)(e)}}async getAuthorizationUrl(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.provider)throw new nd.a("Provider must be set when initializing OAuth authentication.");let e=CA();nu.s.put(aY.a,e);let t=CS();nu.s.put(aY.S,t);let r=await Ck(e);this.meta.withPrivyUi||nu.s.put(aY.H,!0),this.meta.disableSignup?nu.s.put(aY.O,!0):nu.s.del(aY.O);let i=Cf(this.meta.withPrivyUi),n=window.location.href,s=function(){let e=Cb();if(e)return`https://${e}.chromiumapp.org`}();s&&(n=s);try{return await this.api.post(oI,{provider:this.meta.provider,redirect_to:this.meta.customOAuthRedirectUrl||n,token:this.meta.captchaToken,code_challenge:r,state_code:t},{headers:{...i}})}catch(e){throw(0,nd.f)(e)}}constructor(e){this.meta=e}}function CC(){let e=new URL(window.location.href);e.searchParams.delete("privy_oauth_code"),e.searchParams.delete("privy_oauth_provider"),e.searchParams.delete("privy_oauth_state"),nu.s.del(aY.S),window.history.replaceState({},"",e)}class Cx{async initRegisterFlow(e){if(!this.api)throw new nd.a("Auth flow has no API instance");this.authenticateForRegistration=!0,this.meta.initRegisterResponse=await this.initRegisterOnce.execute(e)}async initAuthenticationFlow(e){if(!this.api)throw new nd.a("Auth flow has no API instance");this.authenticateForRegistration=!1,this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute(e)}async initLinkFlow(){if(!this.api)throw new nd.a("Auth flow has no API instance");this.meta.initLinkResponse=await this.initLinkOnce.execute()}async register(){let t=await e.A(629997);if(!this.api)throw new nd.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new nd.a("WebAuthn is not supported in this browser");this.meta.initRegisterResponse||(this.meta.initRegisterResponse=await this.initRegisterOnce.execute());try{let e=this.meta.initRegisterResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(oN,{relying_party:this.meta.initRegisterResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new nd.a("Passkey request timed out or rejected by user.",void 0,nd.b.PASSKEY_NOT_ALLOWED);throw(0,nd.f)(e)}}async authenticate(){if(this.authenticateForRegistration)return this.register();let t=await e.A(629997);if(!this.api)throw new nd.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new nd.a("WebAuthn is not supported in this browser");this.meta.initAuthenticateResponse||(this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute());let r=this.meta.allowedCredentialsIds?.map(e=>({type:"public-key",id:e}))??this.meta.initAuthenticateResponse.options.allow_credentials;try{let e=await t.startAuthentication({optionsJSON:this._transformInitAuthenticateOptionsToCamelCase({...this.meta.initAuthenticateResponse.options,allow_credentials:r})});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(oR,{relying_party:this.meta.initAuthenticateResponse.relying_party,challenge:this.meta.initAuthenticateResponse.options.challenge,authenticator_response:this._transformAuthenticationResponseToSnakeCase(e)})}catch(e){if("NotAllowedError"===e.name)throw new nd.a("Passkey request timed out or rejected by user.",void 0,nd.b.PASSKEY_NOT_ALLOWED);throw(0,nd.f)(e)}}async link(){let t=await e.A(629997);if(!this.api)throw new nd.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new nd.a("WebAuthn is not supported in this browser");this.meta.initLinkResponse||(this.meta.initLinkResponse=await this.initLinkOnce.execute());try{let e=this.meta.initLinkResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(oO,{relying_party:this.meta.initLinkResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new nd.a("Passkey request timed out or rejected by user.",void 0,nd.b.PASSKEY_NOT_ALLOWED);throw(0,nd.f)(e)}}async _initRegisterOnce(e){if(!this.api)throw new nd.a("Auth flow has no API instance");let t=Cf(e);return await this.api.post(oP,{token:this.meta.captchaToken},{headers:{...t}})}async _initAuthenticateOnce(e){if(!this.api)throw new nd.a("Auth flow has no API instance");let t=Cf(e);return await this.api.post(ox,{token:this.meta.captchaToken},{headers:{...t}})}async _initLinkOnce(){if(!this.api)throw new nd.a("Auth flow has no API instance");return await this.api.post(oC,{})}_transformInitLinkOptionsToCamelCase(e){return{rp:e.rp,user:{id:e.user.id,name:e.user.name,displayName:e.user.display_name},challenge:e.challenge,pubKeyCredParams:e.pub_key_cred_params.map(e=>({type:e.type,alg:e.alg})),timeout:e.timeout,excludeCredentials:e.exclude_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports})),authenticatorSelection:{authenticatorAttachment:e.authenticator_selection?.authenticator_attachment,requireResidentKey:e.authenticator_selection?.require_resident_key,residentKey:e.authenticator_selection?.resident_key,userVerification:e.authenticator_selection?.user_verification},attestation:e.attestation,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props?.rk,hmacCreateSecret:e.extensions?.hmac_create_secret},hints:this.meta.hints}}_transformRegistrationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,attestation_object:e.response.attestationObject,authenticator_data:e.response.authenticatorData},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}_transformInitAuthenticateOptionsToCamelCase(e){return{rpId:e.rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}_transformAuthenticationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,authenticator_data:e.response.authenticatorData,signature:e.response.signature,user_handle:e.response.userHandle},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}constructor({captchaToken:e,setPasskeyAuthState:t,hints:r}){this.authenticateForRegistration=!1,this.initRegisterOnce=new Cm(this._initRegisterOnce.bind(this)),this.initAuthenticateOnce=new Cm(this._initAuthenticateOnce.bind(this)),this.initLinkOnce=new Cm(this._initLinkOnce.bind(this)),this.meta={captchaToken:e,setPasskeyAuthState:t,hints:r}}}let CP=({address:e,chainId:t,nonce:r})=>`${window.location.host} wants you to sign in with your Ethereum account:
${e}

By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.

URI: ${window.location.origin}
Version: 1
Chain ID: ${t}
Nonce: ${r}
Issued At: ${(new Date).toISOString()}
Resources:
- https://privy.io`;class CO{get meta(){return{connectorType:this.wallet?.connectorType,walletClientType:this.wallet?.walletClientType,chainId:this.wallet?.chainId,address:this.wallet?.address,disableSignup:this._meta.disableSignup}}async authenticate(){if(!this.client)throw new nd.a("SiweFlow has no client instance");try{if(this.preparedMessage&&this.signature)return await this.client.authenticateWithSiweInternal({message:this.preparedMessage,signature:this.signature,chainId:this.wallet?.chainId,walletClientType:this.walletClientType??this.wallet?.walletClientType,connectorType:this.connectorType??this.wallet?.connectorType,mode:this._meta.disableSignup?"no-signup":"login-or-sign-up"});if(!this.wallet)throw new nd.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.client)throw new nd.a("SiweFlow has no client instance");try{if(!this.wallet)throw new nd.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType})}catch(e){throw(0,nd.f)(e)}}async sign(){if(!this.client)throw new nd.a("SiweFlow has no client instance");if(await this.buildMessage(),!this.preparedMessage)throw new nd.a("Could not prepare SIWE message");if(!this.wallet)throw new nd.a("SiweFlow has no wallet instance");let e=await this.wallet.sign(this.preparedMessage);return{message:this.preparedMessage,signature:e}}async _getNonceOnce(){if(!this.client)throw new nd.a("SiweFlow has no client instance");if(!this.wallet)throw new nd.a("UI SiweFlow has no wallet instance");return await this.client.generateSiweNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new nd.a("SiweFlow has no client instance");if(!this.wallet)throw new nd.a("SiweFlow has no wallet instance");let e=this.wallet.address,t=this.wallet.chainId.replace("eip155:","");return this.nonce||(this.nonce=await this.getNonceOnce.execute()),this.preparedMessage=CP({address:e,chainId:t,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n){this._meta={disableSignup:!1},this.getNonceOnce=new Cm(this._getNonceOnce.bind(this)),this.wallet=t,this.captchaToken=r,this.client=e,this._meta.disableSignup=i,this.preparedMessage=n?.message,this.signature=n?.signature,this.walletClientType=n?.walletClientType,this.connectorType=n?.connectorType}}class CR{get meta(){return{connectorType:this.wallet.connectorType,walletClientType:this.wallet.walletClientType,disableSignup:this._meta.disableSignup,messageType:this._meta.messageType,address:this.wallet?.address}}set messageType(e){this._meta.messageType=e}async authenticate(){if(!this.client)throw new nd.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up",messageType:this.meta.messageType})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.client)throw new nd.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,messageType:this.meta.messageType})}catch(e){throw(0,nd.f)(e)}}async sign(){let e,t;if(!this.client)throw new nd.a("SiwsFlow has no client instance");await this.buildMessage();let r="transaction"===this.meta.messageType;if(!this.preparedMessage)throw new nd.a("Could not prepare SIWS message");if(!r&&!this.wallet.provider.signMessage||r&&!this.wallet.provider.signTransaction)throw new nd.a("Wallet does not support the necessary signing methods");if(r&&this._plugin){let r=await this.wallet.provider.signTransaction({transaction:oQ.base64.decode(this.preparedMessage)});e=oQ.base64.encode(r.signedTransaction),t=this._plugin.getSignatureFromTransaction(r.signedTransaction,this.wallet.address)}else{e=this.preparedMessage;let r=await this.wallet.provider.signMessage({message:(new TextEncoder).encode(this.preparedMessage)});t=oQ.base64.encode(r.signature)}return{message:e,signature:t}}async _getNonceOnce(){if(!this.client)throw new nd.a("SiwsFlow has no client instance");return await this.client.generateSiwsNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new nd.a("SiwsFlow has no client instance");let e=this.wallet.address;return this.nonce||(this.nonce=await this.getNonceOnce.execute()),"transaction"===this.meta.messageType&&this._plugin?this.preparedMessage=this._plugin.createSiwsMemoTransaction({address:e,nonce:this.nonce}):this.preparedMessage=(0,oY.p)({address:e,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n="plain",s){this._meta={disableSignup:!1,messageType:"plain"},this.getNonceOnce=new Cm(this._getNonceOnce.bind(this)),this.wallet=e,this.captchaToken=r,this.client=t,this._meta.disableSignup=i,this._meta.messageType=n,this._plugin=s}}class CN{async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new nd.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(ob,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new nd.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(ow,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,nd.f)(e)}}async sendSmsCode({phoneNumber:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new nd.a("Auth flow has no API instance");if(e&&(this.meta.phoneNumber=e),t&&(this.meta.captchaToken=t),!this.meta.phoneNumber)throw new nd.a("phone nNumber must be set when initialzing authentication.");let i=Cf(r);try{return await this.api.post(om,{phoneNumber:this.meta.phoneNumber,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,nd.f)(e)}}constructor({phoneNumber:e,captchaToken:t,disableSignup:r}){this.meta={phoneNumber:e,captchaToken:t,disableSignup:r??!1}}}class CM extends CN{async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode||!this.meta.oldPhoneNumber)throw new nd.a("Phone number, sms code, and an old phone number must be set prior to calling update.");try{return await this.api.post(o_,{old_phone_number:this.meta.oldPhoneNumber,new_phone_number:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,nd.f)(e)}}constructor(e,t,r){super({phoneNumber:t,captchaToken:r}),this.meta={phoneNumber:t,captchaToken:r,oldPhoneNumber:e,disableSignup:!1}}}let CU=(0,W.createContext)({enabled:!1,siteKey:"",provider:void 0,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:nd.n,setError:nd.n,setExecuting:nd.n,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:nd.d,reset:nd.n,execute:nd.n});class CD extends nd.c{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}let CL=({children:e,appId:t,captchaSiteKey:r,enabledCaptchaProvider:i})=>{let n=(0,W.useRef)(null),s=(0,W.useRef)(null),[a,o]=(0,W.useState)(),[l,c]=(0,W.useState)(),[d,u]=(0,W.useState)(!1),h=(0,W.useMemo)(()=>i?d||a||l?!d||a||l?a&&!l?{status:"success",token:a}:l?{status:"error",error:l}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"},[i,a,l,d]),p=(0,W.useMemo)(()=>i?"turnstile"===i?{remove:()=>{n.current?.remove(),u(!1),c(void 0),o(void 0)},reset:()=>{n.current?.reset(),u(!1),c(void 0),o(void 0)},execute:()=>{u(!0),n.current?.execute()},waitForResult:async()=>{try{return await (0,nl.p)(()=>n.current?.getResponse(),{interval:200,timeout:2e4})}catch(e){throw new CD("Captcha failed",null,nd.b.CAPTCHA_TIMEOUT)}}}:{remove:()=>{s.current?.removeCaptcha(),u(!1),c(void 0),o(void 0)},reset:()=>{s.current?.resetCaptcha(),u(!1),c(void 0),o(void 0)},execute:()=>{u(!0),s.current?.execute()},waitForResult:async()=>{try{return await (0,nl.p)(()=>{let e=s.current?.getResponse();if(e)return e},{interval:200,timeout:2e4})}catch(e){throw new CD("Captcha failed",null,nd.b.CAPTCHA_TIMEOUT)}}}:null,[i]),f=(0,W.useMemo)(()=>{if(!i||!p)return{...h,enabled:!1,siteKey:"",appId:t,setToken:nd.n,setError:nd.n,setExecuting:nd.n,waitForResult:()=>Promise.resolve(void 0),remove:nd.d,reset:nd.n,execute:nd.n,provider:void 0,ref:{current:null}};let e={...h,enabled:!0,appId:t,setToken:o,setError:c,setExecuting:u};return"turnstile"===i?{...e,provider:"turnstile",ref:n,siteKey:r.split("t:")[1]??"",...p}:{...e,provider:"hcaptcha",ref:s,siteKey:r.split("h:")[1]??"",...p}},[h,i,p,t,r]);return(0,j.jsx)(CU.Provider,{value:f,children:e})},Cj=()=>(0,W.useContext)(CU);class CW{async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oM,{captcha_token:this.meta.captchaToken,telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oU,{telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData})}catch(e){throw(0,nd.f)(e)}}constructor(e,t=!1){this.meta={disableSignup:!1},this.meta={captchaToken:e,disableSignup:!1},this.meta.disableSignup=t}}function CB(e){let t={detail:"",retryable:!1};return e?.privyErrorCode===nd.b.LINKED_TO_ANOTHER_USER&&(t.detail="This account has already been linked to another user."),e?.privyErrorCode===nd.b.DISALLOWED_LOGIN_METHOD&&(t.detail="Login with Telegram not allowed."),e?.privyErrorCode===nd.b.INVALID_DATA&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===nd.b.CANNOT_LINK_MORE_OF_TYPE&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===nd.b.INVALID_CREDENTIALS&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===nd.b.TOO_MANY_REQUESTS&&(t.detail="Too many requests. Please wait before trying again."),e?.privyErrorCode===nd.b.TOO_MANY_REQUESTS&&e.message.includes("rate limit")&&(t.detail="Request limit reached for Telegram. Please wait a moment and try again."),e instanceof CD&&(t.retryable=!0,t.detail="Something went wrong. Try again."),t}function CF(e){return Object.fromEntries(decodeURIComponent(e).split("&").map(e=>e.split("=").map(decodeURIComponent)))}function Cq(){let e=new URL(window.location.href);e.searchParams.delete("id"),e.searchParams.delete("hash"),e.searchParams.delete("auth_date"),e.searchParams.delete("first_name"),e.searchParams.delete("last_name"),e.searchParams.delete("username"),e.searchParams.delete("photo_url"),e.hash="",window.history.replaceState({},"",e)}let CH=(0,W.lazy)(()=>e.A(534631)),Cz=(0,W.lazy)(()=>e.A(214564)),C$=e=>{let t=Cj();return(0,W.useEffect)(()=>t.remove,[t.remove]),t.enabled&&t.provider?(0,j.jsx)(W.Suspense,{fallback:null,children:(0,j.jsxs)("div",{className:"hidden h-0 w-0",children:["turnstile"===t.provider&&(0,j.jsx)(CH,{...e,captchaContext:t}),"hcaptcha"===t.provider&&(0,j.jsx)(Cz,{...e,captchaContext:t})]})}):null};var CK=Object.freeze({__proto__:null,AccountNotFoundScreen:()=>e.A(144943),AffirmativeConsentScreen:()=>e.A(331219),AllowlistRejectionScreen:()=>e.A(227555),AuthenticateWithWalletScreen:()=>e.A(895094),AwaitingEvmToSolBridgingScreen:()=>e.A(290098),AwaitingExternalEthereumTransferScreen:()=>e.A(966286),AwaitingPasswordlessCodeScreen:()=>e.A(993937),AwaitingSolToEvmBridgingScreen:()=>e.A(623860),CaptchaScreen:()=>e.A(555325),CoinbaseOnrampStatusScreen:()=>e.A(570238),ConnectLedgerScreen:()=>e.A(531859),ConnectOnlyLandingScreen:()=>e.A(779157),ConnectOnlyStatusScreen:()=>e.A(849953),ConnectOrCreateScreen:()=>e.A(499645),ConnectionStatusScreen:()=>e.A(120244),CrossAppAuthScreen:()=>e.A(552353),DelegatedActionsConsentScreen:()=>e.A(607196),DelegatedActionsRevokeScreen:()=>e.A(583838),EmbeddedWalletConnectingScreen:()=>e.A(290228),EmbeddedWalletCreatedScreen:()=>e.A(611127),EmbeddedWalletKeyExportScreen:()=>e.A(170674),EmbeddedWalletOnAccountCreateScreen:()=>e.A(110658),EmbeddedWalletPasswordCreateScreen:()=>e.A(462688),EmbeddedWalletPasswordUpdateScreen:()=>e.A(608202),EmbeddedWalletPasswordUpdateSplashScreen:()=>e.A(708660),ErrorScreen:()=>e.A(731726),FarcasterConnectStatusScreen:()=>e.A(200538),FarcasterSignerStatusScreen:()=>e.A(923150),FundSolWalletWithExternalSolanaWallet:()=>e.A(47291),FundWithBankDepositScreen:()=>e.A(876123),FundingAmountEditScreen:()=>e.A(498236),FundingMethodSelectionScreen:()=>e.A(852835),InAppBrowserLoginNotPossible:()=>e.A(59324),InstallWalletScreen:()=>e.A(149085),LandingScreen:()=>e.A(398249),LinkConflictScreen:()=>e.A(903916),LinkEmailScreen:()=>e.A(340092),LinkPasskeyScreen:()=>e.A(51722),LinkPhoneScreen:()=>e.A(308114),LoginFailedScreen:()=>e.A(322764),ManualTransferScreen:()=>e.A(147341),MfaAuthEnrollmentFlowScreen:()=>e.A(983585),MfaAuthVerifyFlowScreen:()=>e.A(929532),MfaEnrollmentFlowScreen:()=>e.A(629303),MoonpayStatusScreen:()=>e.A(292274),OAuthStatusScreen:()=>e.A(490928),PasskeySelectSignupOrLogin:()=>e.A(214162),PasskeyStatusScreen:()=>e.A(684892),PasswordRecoveryScreen:()=>e.A(848958),RecoveryOAuthScreen:()=>e.A(482717),RecoverySelectionScreen:()=>e.A(532241),SendTransactionScreen:()=>e.A(471295),SetAutomaticRecoveryScreen:()=>e.A(975770),SignRequestScreen:()=>e.A(927294),StandardSignAndSendTransactionScreen:()=>e.A(971601),TelegramAuthScreen:()=>e.A(996033),TransferFromWalletScreen:()=>e.A(301325),UpdateEmailScreen:()=>e.A(490230),UpdatePhoneScreen:()=>e.A(90372),UserLimitReachedScreen:()=>e.A(766249),WalletInterstitialScreen:()=>e.A(350211)});let CV=(0,o1.create)(()=>({inProgressMfaFlow:void 0})),CJ=oX.createGlobalStyle`
  :root {
     ${e=>CG(e.palette)}
  };
`,CG=e=>{let t={"--privy-color-background":e.background,"--privy-color-background-2":e.background2,"--privy-color-background-3":e.background3,"--privy-color-foreground":e.foreground,"--privy-color-foreground-2":e.foreground2,"--privy-color-foreground-3":e.foreground3,"--privy-color-foreground-4":e.foreground4,"--privy-color-foreground-accent":e.foregroundAccent,"--privy-color-accent":e.accent,"--privy-color-accent-light":e.accentLight,"--privy-color-accent-hover":e.accentHover,"--privy-color-accent-dark":e.accentDark,"--privy-color-accent-darkest":e.accentDarkest,"--privy-color-success":e.success,"--privy-color-success-dark":e.successDark,"--privy-color-success-light":e.successLight,"--privy-color-success-bg":e.successBg,"--privy-color-error":e.error,"--privy-color-error-light":e.errorLight,"--privy-color-error-bg":e.errorBg,"--privy-color-error-bg-hover":e.errorBgHover,"--privy-color-warn":e.warn,"--privy-color-warn-light":e.warnLight,"--privy-color-warn-bg":e.warnBg,"--privy-color-warning-dark":e.warningDark,"--privy-color-error-dark":e.errorDark,"--privy-color-info-bg":e.infoBg,"--privy-color-info-bg-hover":e.infoBgHover,"--privy-color-border-default":e.borderDefault,"--privy-color-border-hover":e.borderHover,"--privy-color-border-focus":e.borderFocus,"--privy-color-border-error":e.borderError,"--privy-color-border-success":e.borderSuccess,"--privy-color-border-warning":e.borderWarning,"--privy-color-border-info":e.borderInfo,"--privy-color-border-interactive":e.borderInteractive,"--privy-color-border-interactive-hover":e.borderInteractiveHover,"--privy-color-background-hover":e.backgroundHover,"--privy-color-background-clicked":e.backgroundClicked,"--privy-color-background-disabled":e.backgroundDisabled,"--privy-color-background-interactive":e.backgroundInteractive,"--privy-color-background-interactive-hover":e.backgroundInteractiveHover,"--privy-color-background-interactive-clicked":e.backgroundInteractiveClicked,"--privy-color-background-interactive-disabled":e.backgroundInteractiveDisabled,"--privy-color-foreground-hover":e.foregroundHover,"--privy-color-foreground-clicked":e.foregroundClicked,"--privy-color-foreground-disabled":e.foregroundDisabled,"--privy-color-foreground-interactive":e.foregroundInteractive,"--privy-color-foreground-interactive-hover":e.foregroundInteractiveHover,"--privy-link-navigation-color":e.linkNavigationColor,"--privy-link-navigation-decoration":e.linkNavigationDecoration,"--privy-accent-has-good-contrast":e.accentHasGoodContrast,"--privy-color-icon-default":e.iconDefault,"--privy-color-icon-muted":e.iconMuted,"--privy-color-icon-subtle":e.iconSubtle,"--privy-color-icon-inverse":e.iconInverse,"--privy-color-icon-success":e.iconSuccess,"--privy-color-icon-warning":e.iconWarning,"--privy-color-icon-error":e.iconError,"--privy-color-icon-interactive":e.iconInteractive,"--privy-color-icon-default-hover":e.iconDefaultHover,"--privy-color-icon-muted-hover":e.iconMutedHover,"--privy-color-icon-subtle-hover":e.iconSubtleHover,"--privy-color-icon-default-clicked":e.iconDefaultClicked,"--privy-color-icon-muted-clicked":e.iconMutedClicked,"--privy-color-icon-subtle-clicked":e.iconSubtleClicked,"--privy-color-icon-default-disabled":e.iconDefaultDisabled,"--privy-color-icon-muted-disabled":e.iconMutedDisabled,"--privy-color-icon-subtle-disabled":e.iconSubtleDisabled,"--privy-color-icon-error-hover":e.iconErrorHover,"--privy-color-icon-interactive-hover":e.iconInteractiveHover,"--privy-color-icon-error-clicked":e.iconErrorClicked,"--privy-color-icon-interactive-clicked":e.iconInteractiveClicked,"--privy-color-icon-muted-disabled-alt":e.iconMutedDisabledAlt,"--privy-color-icon-subtle-disabled-alt":e.iconSubtleDisabledAlt,"--privy-border-radius-xs":"6px","--privy-border-radius-sm":"8px","--privy-border-radius-md":"12px","--privy-border-radius-mdlg":"16px","--privy-border-radius-lg":"24px","--privy-border-radius-full":"9999px","--privy-height-modal-full":"620px","--privy-height-modal-compact":"480px"};return oX.css`
    ${Object.entries(t).map(([e,t])=>`${e}: ${t};`).join("\n")}
  `},CZ=oX.styled.div`
  // css normalize only the privy application to avoid conflicts
  // with consuming application
  ${"\n  *,\n  ::before,\n  ::after {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n  }\n\n  line-height: 1.15;\n  -webkit-text-size-adjust: 100%;\n  -moz-tab-size: 4;\n  tab-size: 4;\n  font-feature-settings: normal;\n\n  margin: 0;\n  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n\n  hr {\n    height: 0;\n    color: inherit;\n    border-top-width: 1px;\n  }\n\n  abbr:where([title]) {\n    text-decoration: underline dotted;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: inherit;\n    font-weight: inherit;\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n    display: inline;\n  }\n\n  a {\n    color: inherit;\n    text-decoration: inherit;\n  }\n\n  b,\n  strong {\n    font-weight: bolder;\n  }\n\n  code,\n  kbd,\n  samp,\n  pre {\n    font-family: ui-monospace, SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;\n    font-size: 1em;\n  }\n\n  small {\n    font-size: 80%;\n  }\n\n  sub,\n  sup {\n    font-size: 75%;\n    line-height: 0;\n    position: relative;\n    vertical-align: baseline;\n  }\n\n  sub {\n    bottom: -0.25em;\n  }\n\n  sup {\n    top: -0.5em;\n  }\n\n  table {\n    text-indent: 0;\n    border-color: inherit;\n    border-collapse: collapse;\n  }\n\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n  }\n\n  button,\n  select {\n    text-transform: none;\n  }\n\n  button,\n  [type='button'],\n  [type='reset'],\n  [type='submit'] {\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n  }\n\n  ::-moz-focus-inner {\n    border-style: none;\n    padding: 0;\n  }\n\n  :-moz-focusring {\n    outline: 1px dotted ButtonText;\n  }\n\n  :-moz-ui-invalid {\n    box-shadow: none;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  progress {\n    vertical-align: baseline;\n  }\n\n  ::-webkit-inner-spin-button,\n  ::-webkit-outer-spin-button {\n    height: auto;\n  }\n\n  [type='search'] {\n    -webkit-appearance: textfield;\n    outline-offset: -2px;\n  }\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  ::-webkit-file-upload-button {\n    -webkit-appearance: button;\n    font: inherit;\n  }\n\n  summary {\n    display: list-item;\n  }\n\n  blockquote,\n  dl,\n  dd,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6,\n  hr,\n  figure,\n  p,\n  pre {\n    margin: 0;\n  }\n\n  fieldset {\n    margin: 0;\n    padding: 0;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  ol,\n  ul,\n  menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  textarea {\n    resize: vertical;\n  }\n\n  input::placeholder,\n  textarea::placeholder {\n    opacity: 1;\n    color: #9ca3af;\n  }\n\n  button,\n  [role='button'] {\n    cursor: pointer;\n  }\n\n  :disabled {\n    cursor: default;\n  }\n\n  img,\n  svg,\n  video,\n  canvas,\n  audio,\n  iframe,\n  embed,\n  object {\n    display: block;\n  }\n\n  img,\n  video {\n    max-width: 100%;\n    height: auto;\n  }\n\n  [hidden] {\n    display: none;\n  }\n"}

  // Privy styles
  color: var(--privy-color-foreground-2);

  h3 {
    font-size: 16px;
    line-height: 24px;
    font-weight: 500;
    color: var(--privy-color-foreground-2);
  }

  h4 {
    font-size: 14px;
    line-height: 20px;
    font-weight: 500;
    color: var(--privy-color-foreground);
  }

  p {
    font-size: 13px;
    line-height: 20px;
    color: var(--privy-color-foreground-2);
  }

  button:focus,
  input:focus,
  optgroup:focus,
  select:focus,
  textarea:focus {
    outline: none;
    border-color: var(--privy-color-accent-light);
    box-shadow: 0 0 0 3px var(--privy-color-border-focus);
  }

  .mobile-only {
    @media (min-width: 441px) {
      display: none;
    }
  }

  /* Animations */

  @keyframes fadein {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
`,CY=({children:e,open:t,onClick:r,...i})=>(0,j.jsx)(lW,{show:t,as:W.default.Fragment,children:(0,j.jsxs)(dA,{onClose:r,...i,as:CX,children:[(0,j.jsx)(lj,{as:W.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,j.jsx)(CQ,{id:"privy-dialog-backdrop","aria-hidden":"true"})}),(0,j.jsx)(C0,{children:(0,j.jsx)(lj,{as:W.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,j.jsx)(dI,{as:C1,children:e})})})]})}),CQ=oX.styled.div`
  position: fixed;
  inset: 0;

  transition: backdrop-filter 100ms ease;
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px);

  &.entering,
  &.leaving {
    backdrop-filter: unset;
    -webkit-backdrop-filter: unset;
  }
`,CX=oX.styled.div`
  position: relative;
  z-index: 999999;
`,C0=oX.styled.div`
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100vw;
  min-height: 100vh;
`,C1=oX.styled.div`
  // reset some default dialog styles
  padding: 0;
  background: transparent;
  border: none;
  width: 100%;
  pointer-events: auto;

  outline: none;
  display: block;

  /*
   * Normally it is bad to mix media queries like this We are doing
   * this here specifically for animations to avoid weird jank.
   */
  /* Mobile animation is a bottom drawer */
  @media (max-width: 440px) {
    opacity: 1;
    transform: translate3d(0, 0, 0);
    transition: transform 200ms ease-in;
    position: fixed;
    bottom: 0;

    &.entering,
    &.leaving {
      opacity: 0;
      transform: translate3d(0, 100%, 0);
      transition:
        transform 150ms ease-in 0ms,
        opacity 0ms ease 150ms;
    }
  }

  /* Tablet/Desktop animation is a fade in */
  @media (min-width: 441px) {
    opacity: 1;
    transition: opacity 100ms ease-in;

    &.entering,
    &.leaving {
      opacity: 0;
      transition-delay: 5ms;
    }

    margin: auto;
    width: 360px;
    box-shadow: 0px 8px 36px rgba(55, 65, 81, 0.15);
    border-radius: var(--privy-border-radius-lg);
  }
`;oX.styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
`;let C2=(0,W.lazy)(()=>e.A(668098)),C5=(0,W.lazy)(()=>CK.MfaAuthVerifyFlowScreen().then(e=>({default:e.default.component}))),C3=()=>(0,j.jsx)(xe,{children:(0,j.jsx)(nl.L,{})}),C8=()=>{let{currentScreen:e}=(0,na.a)(),t=CV(e=>e.inProgressMfaFlow),r=()=>CV.setState({inProgressMfaFlow:void 0}),{component:i,isLoading:n}=(()=>{let{ready:e}=(0,na.u)(),{currentScreen:t}=(0,na.a)(),[r,i]=(0,W.useState)(null),[n,s]=(0,W.useState)(!1),a=function(e){let[t,r]=(0,W.useState)(!1),i=(0,W.useRef)(null),n=(0,W.useRef)(null),s=(0,W.useRef)(null);return(0,W.useEffect)(()=>{if(i.current&&(clearTimeout(i.current),i.current=null),n.current&&(clearTimeout(n.current),n.current=null),e)s.current=Date.now(),i.current=setTimeout(()=>{r(!0)},150);else if(null!==s.current){let e=Date.now()-s.current;e>=150?n.current=setTimeout(()=>{r(!1),s.current=null},Math.max(0,400-(e-150))):(i.current&&(clearTimeout(i.current),i.current=null),r(!1),s.current=null)}return()=>{i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current)}},[e]),t}(n);return(0,W.useEffect)(()=>{t?(s(!0),CK[t]().then(r=>{(!t||e||r.default.isShownBeforeReady)&&(i(()=>r.default.component),s(!1))}).catch(()=>{i(null),s(!1)})):(i(null),s(!1))},[t,e]),{component:r,isLoading:a}})();return function(){let{isModalOpen:e}=(0,na.u)(),{headless:t}=(0,aY.u)(),{currentScreen:r}=(0,na.a)(),{status:i,execute:n,reset:s,enabled:a}=Cj(),[o,l]=(0,W.useState)(!1);(0,W.useEffect)(()=>{!e&&a&&s()},[e,a,s]),(0,W.useEffect)(()=>{r?CK[r]().then(e=>{l(!!e.default.isCaptchaRequired)}).catch(()=>{l(!1)}):l(!1)},[r]),(0,W.useEffect)(()=>{e&&o&&!t&&"ready"===i&&a&&n()},[e,o,t,i,a,n])}(),e||"txn"!==t?n?(0,j.jsx)(C3,{}):i?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(nl.H,{$if:!!t,children:(0,j.jsx)(W.Suspense,{children:(0,j.jsx)(i,{})})}),(0,j.jsxs)(W.Suspense,{children:["txn"===t&&(0,j.jsx)(C2,{onClose:r}),"auth"===t&&(0,j.jsx)(C5,{})]})]}):null:(0,j.jsx)(W.Suspense,{children:(0,j.jsx)(C2,{onClose:r})})},C4=()=>{let e=(0,W.useRef)(null);return(0,j.jsx)(C7,{style:{height:(0,nl.u)(e)},id:"privy-modal-content",children:(0,j.jsx)("div",{ref:e,children:(0,j.jsx)(C8,{})})})},C6=({open:e})=>{var t;let r=(0,aY.u)(),{gracefulClosePrivyModal:i}=(()=>{let{closePrivyModal:e}=(0,nd.u)(),{onUserCloseViaDialogOrKeybindRef:t}=(0,na.a)();return{gracefulClosePrivyModal:(0,W.useCallback)(()=>{if(!t?.current)return e({shouldCallAuthOnSuccess:!1});t.current()},[e])}})(),n=CV(e=>e.inProgressMfaFlow);return t={onMfaRequired:()=>{r.mfa.noPromptOnMfaRequired||CV.setState({inProgressMfaFlow:"txn"})}},(0,o0.u)("configureMfa",t),r.render.standalone?(0,j.jsx)(CZ,{children:(0,j.jsx)(C9,{id:"privy-modal-content",children:(0,j.jsx)(C8,{})})}):(0,j.jsx)(CY,{open:!(!e&&!n),id:"privy-dialog","aria-label":"log in or sign up","aria-labelledby":"privy-dialog-title",onClick:()=>i(),children:(0,j.jsx)(CZ,{children:(0,j.jsx)(C4,{})})})},C9=oX.styled.div`
  display: flex;
  flex-direction: column;
  text-align: center;
  font-size: 14px;
  line-height: 20px;
  width: 100%;
  background: var(--privy-color-background);
  padding: 0 16px;
`,C7=(0,oX.styled)(C9)`
  transition: height 150ms ease-out;
  overflow-x: hidden;
  overflow-y: auto;
  scrollbar-width: none;

  // Ensure the modal gets pinned to the top if it ever gets too tall
  max-height: calc(100svh - 32px);

  border-radius: var(--privy-border-radius-lg) var(--privy-border-radius-lg) 0 0;
  box-shadow: 0px 0px 36px rgba(55, 65, 81, 0.15);

  @media (min-width: 441px) {
    box-shadow: 0px 8px 36px rgba(55, 65, 81, 0.15);
    border-radius: var(--privy-border-radius-lg);
  }
`,xe=oX.styled.div`
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  padding: 2rem;
`;function xt(e){let t=(0,W.useRef)(null),r=(0,W.useRef)();return(0,W.useEffect)(()=>{r.current?.remove(),r.current=function({botUsername:e,scriptHost:t}){let r=document.createElement("script"),{origin:i}=new URL(t);return r.async=!0,r.src=`${i}/js/telegram-login.js`,r.setAttribute("data-telegram-login",e),r.setAttribute("data-request-access","write"),r.setAttribute("data-lang","en"),r}(e),t.current?.after(r.current)},[e]),(0,j.jsx)("div",{ref:t,hidden:!0})}let xr=()=>{let{ready:e}=(0,nc.u)(),{client:t}=(0,nd.u)();return(0,W.useEffect)(()=>{let r=()=>{if(!t.connectors||!e)return;let r=t.connectors.wallets.map(e=>({address:e.address,connectorType:e.connectorType,walletClientType:e.walletClientType,connectedAt:e.connectedAt,id:e.meta.id}));nu.s.put(aY.b,r)};return t.connectors?.on("walletsUpdated",r),()=>{t.connectors?.off("walletsUpdated",r)}},[e,t.connectors]),null};class xi extends nl.E{async initialize(){let e=await this.createProvider();this.provider=e,this.proxyProvider.setWalletProvider(e),this.subscribeListeners(),e.session&&(this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,nl.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown"),this.connected=!0,await this.syncAccounts()),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),this.getConnectedWallet()}async isConnected(){return!!this.walletProvider?.connected}get walletBranding(){let e=this.walletProvider?.session?.peer.metadata.icons?.[0];return{name:(0,nl.s)(this.walletProvider?.session?.peer.metadata.name||"")||"WalletConnect",icon:"string"==typeof e?e:nu.W,id:this.walletProvider?.session?.peer.metadata.name.toLowerCase()||"wallet_connect_v2"}}async resetConnection(e){this.walletProvider&&this.walletProvider.connected&&(await this.walletProvider.disconnect(),this.walletProvider.signer.session=void 0,this.walletClientType=e,this.redirectUri=void 0,this.fallbackUniversalRedirectUri=void 0,(0,oY.d)(),this.onDisconnect())}async promptConnection(){if(this.provider)return new Promise((e,t)=>{(async()=>{let t="",r=await Promise.race([this.walletProvider?.enable(),this.proxyProvider.walletTimeout()]);if(r?.length&&(t=r[0]),!t||""===t)throw new nd.P("Unable to retrieve address");this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,nl.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown",this.proxyProvider.rpcTimeoutDuration=(0,nl.c)(this.rpcConfig,this.walletClientType)),this.connected=!0,await this.syncAccounts(r),e()})().catch(e=>{t(e?(0,nu.f)(e):new nd.P("Unknown error during connection"))})})}disconnect(){this.walletProvider?.disconnect().then(()=>this.onDisconnect()).catch(()=>console.warn("Unable to disconnect WalletConnect provider"))}get walletProvider(){return this.proxyProvider.walletProvider}setWalletProvider(e){this.proxyProvider.setWalletProvider(e)}async createProvider(){let e={};for(let t of this.chains){let r=(0,nl.a)(t.id,this.chains,this.rpcConfig,this.privyAppId);r&&(e[t.id]=r)}let t=this.shouldEnforceDefaultChainOnConnect?[this.defaultChain.id]:[],r=this.chains.map(e=>e.id),i=await EZ.init({projectId:this.walletConnectCloudProjectId,chains:t,optionalChains:r,optionalEvents:EL,optionalMethods:EU,rpcMap:e,showQrModal:!1,metadata:{description:this.privyAppName,name:this.privyAppName,url:window.location.origin,icons:[]}});return i.on("display_uri",e=>{if(i.signer.abortPairingAttempt(),(0,oY.r)(),!this.showPrivyQrModal)throw new nd.P("WalletConnect modal not available - Privy handles wallet connections through its own UI");if(aQ.isMobile&&this.walletEntry){let{redirect:t,href:r}=(0,oY.b)(e,this.walletEntry);(0,oY.o)(t,"_self"),(0,oY.s)({href:r,name:this.walletEntry.metadata?.shortName||this.walletEntry.name});let i=(0,oY.a)(e,this.walletEntry);return this.redirectUri=t,this.fallbackUniversalRedirectUri=i?.redirect,this.showPrivyQrModal({native:t,universal:t})}if(this.redirectUri=void 0,this.walletEntry){let t=(0,oY.a)(e,this.walletEntry);this.fallbackUniversalRedirectUri=t?.redirect}this.showPrivyQrModal({native:e,universal:void 0})}),i.on("connect",()=>{i.session?.peer.metadata.url&&(this.walletEntry=(0,nl.g)(i.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown")}),i}async enableProvider(){return this.walletProvider?.connected?Promise.resolve(this.walletProvider.accounts):await this.walletProvider?.enable()}setWalletEntry(e,t){this.walletEntry=e,this.showPrivyQrModal=t}constructor({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,shouldEnforceDefaultChainOnConnect:n,privyAppId:s,privyAppName:a,walletClientType:o}){super(o||"unknown",r,i,t),this.connectorType="wallet_connect_v2",this.privyAppId=s,this.privyAppName=a,this.walletConnectCloudProjectId=e,this.rpcConfig=t,this.shouldEnforceDefaultChainOnConnect=n,this.proxyProvider=new nl.P(void 0,this.rpcTimeoutDuration),o&&(this.walletEntry=(0,nl.b)(o),this.walletClientType=o)}}let xn=["error","invalid_request_arguments","wallet_not_on_device","invalid_recovery_pin","insufficient_funds","missing_or_invalid_mfa","mfa_verification_max_attempts_reached","mfa_timeout","twilio_verification_failed"];class xs extends Error{constructor(e,t){super(t),this.type=e}}function xa(e){let t=e.type;return"string"==typeof t&&xn.includes(t)}function xo(e){return xa(e)&&"wallet_not_on_device"===e.type}function xl(e){return xa(e)&&("invalid_recovery_pin"===e.type||"invalid_request_arguments"===e.type)}function xc(e){return!!xa(e)&&"mfa_timeout"===e.type}function xd(e){return!!xa(e)&&"missing_or_invalid_mfa"===e.type}function xu(e){return!!xa(e)&&"mfa_verification_max_attempts_reached"===e.type}function xh(e){return!(!xa(e)||!e.message.includes("code 429"))}function xp(e){let t;return"string"==typeof(t=e.type)&&"client_error"===t&&"MFA canceled"===e.message}async function xf(e,t,r,i,n,s=!1){let a=s,o=async o=>{if(a&&t&&t.length>0){o===+!s?n("configureMfa","onMfaRequired",{mfaMethods:t}):i.current?.reject(new xs("missing_or_invalid_mfa","MFA verification failed, retry."));let a=await new Promise((e,t)=>{r.current={resolve:e,reject:t},setTimeout(()=>{let e=new xs("mfa_timeout","Timed out waiting for MFA code");i.current?.reject(e),t(e)},3e5)});return await e(a)}return await e()},l=null;for(let e=0;e<4;e++)try{l=await o(e),i.current?.resolve(void 0);break}catch(e){if("missing_or_invalid_mfa"!==e.type)throw i.current?.resolve(void 0),e;a=!0}if(null===l){let e=new xs("mfa_verification_max_attempts_reached","Max MFA verification attempts reached");throw i.current?.reject(e),e}return l}let xy=(PM=0,()=>"id-"+PM++);function xg(e){return void 0!==e.error}let xm=new class{enqueue(e,t){this.callbacks[e]=t}dequeue(e,t){let r=this.callbacks[t];if(!r)throw Error(`cannot dequeue ${e} event: no event found for id ${t}`);switch(delete this.callbacks[t],e){case"privy:iframe:ready":case"privy:user-signer:sign":case"privy:wallets:add":case"privy:wallets:import":case"privy:wallets:set-recovery":case"privy:wallets:connect":case"privy:wallets:recover":case"privy:wallets:rpc":case"privy:wallet:create":case"privy:mfa:verify":case"privy:mfa:init-enrollment":case"privy:mfa:submit-enrollment":case"privy:mfa:unenroll":case"privy:mfa:clear":case"privy:auth:unlink-passkey":case"privy:farcaster:init-signer":case"privy:farcaster:sign":case"privy:solana-wallet:create":case"privy:delegated-actions:consent":return r;default:throw Error(`invalid wallet event type ${e}`)}}constructor(){this.callbacks={}}},xw=new Map,xv=(e,t)=>"bigint"==typeof t?t.toString():t;function xb(e,t,r,i){let n=r.contentWindow;if(!n)throw Error("iframe not initialized");let s=`${e}${JSON.stringify(t,xv)}`;if("privy:wallet:create"===e||"privy:wallets:add"===e||"privy:solana-wallet:create"===e){let e=xw.get(s);if(e)return e}let a=new Promise((r,s)=>{let a=xy();xm.enqueue(a,{resolve:r,reject:s}),n.postMessage({id:a,event:e,data:t},i)}).finally(()=>{xw.delete(s)});return xw.set(s,a),a}function x_(e){let t=(0,aY.c)(),r=(0,W.useRef)(null),i=(0,W.useRef)(e.mfaMethods),n=(0,o0.a)(),[s,a]=(0,W.useState)(!1);return(0,W.useEffect)(()=>{i.current=e.mfaMethods},[e.mfaMethods]),(0,W.useEffect)(()=>{if(!s)return;let t=r.current;if(!t)return;function a(t){var r;t&&t.origin===e.origin&&"string"==typeof(r=t.data).event&&/^privy:.+/.test(r.event)&&function(e){switch(e.event){case"privy:iframe:ready":let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data);case"privy:user-signer:sign":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:add":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:set-recovery":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:connect":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:recover":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:rpc":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallet:create":let r=xm.dequeue(e.event,e.id);return xg(e)?r.reject(new xs(e.error.type,e.error.message)):r.resolve(e.data);case"privy:wallets:import":let i=xm.dequeue(e.event,e.id);return xg(e)?i.reject(new xs(e.error.type,e.error.message)):i.resolve(e.data);case"privy:mfa:verify":let n=xm.dequeue(e.event,e.id);return xg(e)?n.reject(new xs(e.error.type,e.error.message)):n.resolve(e.data);case"privy:mfa:init-enrollment":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:submit-enrollment":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:unenroll":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:clear":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:auth:unlink-passkey":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:solana-wallet:create":let s=xm.dequeue(e.event,e.id);return xg(e)?s.reject(new xs(e.error.type,e.error.message)):s.resolve(e.data);case"privy:farcaster:init-signer":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:farcaster:sign":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:delegated-actions:consent":{let t=xm.dequeue(e.event,e.id);return xg(e)?t.reject(new xs(e.error.type,e.error.message)):t.resolve(e.data)}default:console.warn("Unsupported wallet proxy method:",e)}}(t.data)}let o={signWithUserSigner:r=>xf(i=>xb("privy:user-signer:sign",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),addWallet:r=>xf(i=>xb("privy:wallets:add",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),setRecovery:r=>xf(i=>xb("privy:wallets:set-recovery",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),connect:r=>xf(i=>xb("privy:wallets:connect",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),recover:r=>xf(i=>xb("privy:wallets:recover",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!r.recoveryAccessToken&&!r.recoveryPassword&&!r.recoverySecretOverride),rpc:r=>xf(i=>xb("privy:wallets:rpc",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),create:r=>xb("privy:wallet:create",r,t,e.origin),importWallet:r=>xb("privy:wallets:import",r,t,e.origin),createSolana:r=>xf(i=>xb("privy:solana-wallet:create",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),createDelegatedAction:r=>xb("privy:delegated-actions:consent",r,t,e.origin),verifyMfa:r=>xf(i=>xb("privy:mfa:verify",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!0),initEnrollMfa:r=>xf(i=>xb("privy:mfa:init-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),submitEnrollMfa:r=>xf(i=>xb("privy:mfa:submit-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),unenrollMfa:r=>xf(i=>xb("privy:mfa:unenroll",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),clearMfa:r=>xb("privy:mfa:clear",r,t,e.origin),unlinkPasskeyAccount:r=>xf(i=>xb("privy:auth:unlink-passkey",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),initFarcasterSigner:r=>xb("privy:farcaster:init-signer",r,t,e.origin),signFarcasterMessage:r=>xb("privy:farcaster:sign",r,t,e.origin)};window.addEventListener("message",a);let l=new AbortController;return(0,nl.i)(()=>xb("privy:iframe:ready",{},t,e.origin),{abortSignal:l.signal}).then(()=>e.onLoad(o),(...t)=>{console.warn("Privy iframe failed to load: ",...t),e.onLoadFailed()}),()=>{window.removeEventListener("message",a),l.abort()}},[s]),t?(0,j.jsx)("iframe",{ref:r,width:"0",height:"0",style:{display:"none",height:"0px",width:"0px"},onLoad:()=>a(!0),src:(0,E9.constructURL)({origin:e.origin,path:`/apps/${e.appId}/embedded-wallets`,query:{caid:e.clientAnalyticsId,client_id:e.appClientId}})}):null}let xE=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&e.delegated),xI="popup-privy-oauth",xA="PRIVY_OAUTH_USE_BROADCAST_CHANNEL";class xS{async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oA,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oS,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(e){throw(0,nd.f)(e)}}constructor(e){this.meta=e}}async function xk({api:e,requesterAppId:t,providerAppId:r}){let i=(await e.get(`/api/v1/apps/${t}/cross-app/connections`)).connections.find(e=>e.provider_app_id===r);if(!i)throw new nd.a("Invalid connected app");return{name:i.provider_app_name,logoUrl:i.provider_app_icon_url||void 0,apiUrl:i.provider_app_custom_api_url,readOnly:i.read_only,customAuthAuthorizeUrl:i.provider_app_custom_auth_authorize_url,customAuthTransactUrl:i.provider_app_custom_auth_transact_url}}let xT=async({user:e,address:t,client:r,request:i,requesterAppId:n,reconnect:s})=>{r.createAnalyticsEvent({eventName:"cross_app_request_started",payload:{address:t,method:i.method}});let a=e?.linkedAccounts.find(e=>"cross_app"===e.type&&(e.embeddedWallets.some(e=>e.address===t)||e.smartWallets.some(e=>e.address===t)));if(!e||!a)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Cannot request a signature with this wallet address",address:t}}),new nd.a("Cannot request a signature with this wallet address");let o=r.getProviderAccessToken(a.providerApp.id),l=await xk({api:r.api,requesterAppId:n,providerAppId:a.providerApp.id});if(!o){if(l.readOnly)throw console.error("cannot transact against a read-only provider app"),new nd.a("Cannot transact against a read-only provider app");await s({appId:a.providerApp.id,action:"link"})&&(o=r.getProviderAccessToken(a.providerApp.id))}if(!o)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Transactions require a valid token",address:t}}),new nd.a("Transactions require a valid token");let c=new URL(l.customAuthTransactUrl||`${l.apiUrl}/oauth/transact`);c.searchParams.set("token",o||""),c.searchParams.set("request",xC(i));let d=(0,a1.trigger)({location:c.href});if(!d)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Missing token",address:t}}),new nd.a("Failed to initialize signature request");return new Promise((e,n)=>{let s=setTimeout(()=>{c(),n(new nd.a("Request timeout")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Request timeout",address:t}})},12e4),o=setInterval(()=>{d.closed&&(c(),n(new nd.a("User rejected request")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"User rejected request",address:t}}))},300),l=s=>{s.data&&("set"===s.data.token?.action&&void 0!==s.data.token?.value?r.storeProviderAccessToken(a.providerApp.id,s.data.token.value):"clear"===s.data.token?.action&&r.storeProviderAccessToken(a.providerApp.id,null),"PRIVY_CROSS_APP_ACTION_RESPONSE"===s.data.type&&s.data.result&&(c(),e(s.data.result),r.createAnalyticsEvent({eventName:"cross_app_request_success",payload:{address:t,method:i.method}})),"PRIVY_CROSS_APP_ACTION_ERROR"===s.data.type&&s.data.error&&(c(),n(s.data.error),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:s.data.error,address:t}})))};window.addEventListener("message",l);let c=()=>{d.close(),clearInterval(o),clearTimeout(s),window.removeEventListener("message",l)}})},xC=e=>JSON.stringify({content:{request:{request:xx(e,en.toHex)}},timestamp:Date.now(),callbackUrl:window.origin}),xx=(e,t)=>"bigint"==typeof e?t(e):Array.isArray(e)?e.map(e=>xx(e,t)):e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,r])=>[e,xx(r,t)])):e;function xP({isCreatingWallet:e,skipSplashScreen:t}){return e?"EmbeddedWalletPasswordCreateScreen":t?"EmbeddedWalletPasswordUpdateScreen":"EmbeddedWalletPasswordUpdateSplashScreen"}function xO({walletAction:e,availableRecoveryMethods:t,legacySetWalletPasswordFlow:r,isResettingPassword:i,showAutomaticRecovery:n}){return n?"SetAutomaticRecoveryScreen":r||1===t.length?xP({isCreatingWallet:"create"===e,skipSplashScreen:i}):"RecoverySelectionScreen"}function xR(e){switch(e){case"user-passcode":return"PasswordRecoveryScreen";case"google-drive":case"icloud":return"RecoveryOAuthScreen";default:throw Error("Recovery method not supported")}}function xN(e,t){if(e.onComplete)switch(t){case"external":e.fundingResult?e.onComplete({...e.fundingResult,fundingMethod:t}):e.onComplete({status:"cancelled",address:e.address,fundingMethod:t,amount:e.amount});break;case null:e.onComplete({status:"cancelled",address:e.address,fundingMethod:void 0,amount:e.amount});break;default:e.onComplete({status:"completed",address:e.address,fundingMethod:t,amount:e.amount})}}function xM(e,t,r,i,n,s,a){return{...e,funding:e?.funding?{...e.funding,fundingResult:{status:t,address:e.funding.address,fundingMethod:void 0,transactionHash:r,amount:e.funding.amount,assetType:n?s?.symbol||"ETH":a.nativeCurrency.symbol||"ETH",metadata:{walletClientType:i}}}:void 0,solanaFundingData:e?.solanaFundingData,sendTransaction:e?.sendTransaction}}let xU=new Map([["FundingMethodSelectionScreen",null],["TransferFromWalletScreen","external"],["FundingAmountEditScreen","external"],["ConnectOnlyLandingScreen","external"],["ConnectOnlyStatusScreen","external"],["AwaitingExternalEthereumTransferScreen","external"],["AwaitingEvmToSolBridgingScreen","external"],["AwaitingSolToEvmBridgingScreen","external"],["ManualTransferScreen","manual"],["MoonpayStatusScreen","moonpay"]]);function xD(e){let t=e.toLowerCase();return!!window?.webkit?.messageHandlers?.ReactNativeWebView||!!window?.ReactNativeWebView||["fbav","fban","instagram","snapchat","linkedinapp"].some(e=>t.includes(e))}async function xL({rpc:e,address:t}){return(await e.getBalance(t,{commitment:"confirmed"}).send()).value??0n}let xj={apple_oauth:"apple",custom_auth:"custom",discord_oauth:"discord",email:"email",farcaster:"farcaster",github_oauth:"github",google_oauth:"google",instagram_oauth:"instagram",linkedin_oauth:"linkedin",passkey:"passkey",phone:"sms",spotify_oauth:"spotify",telegram:"telegram",tiktok_oauth:"tiktok",line_oauth:"line",twitch_oauth:"twitch",twitter_oauth:"twitter",wallet:"siwe",smart_wallet:"siwe",cross_app:"privy:"},xW=e=>{if((0,na.i)(e))return{displayName:e.replace("custom:",""),loginMethod:"custom"};let t=xj[e];return"wallet"===e||"phone"===e?{displayName:e,loginMethod:t}:{displayName:t,loginMethod:t}};async function xB(e,t,r,i){let n=ec(e),{chain:s,...a}=await (async()=>i?await i():await t.prepareTransactionRequest({...n,account:{address:r,type:"json-rpc"}}))();return{...a,type:eo[a.type]}}let xF=({disabled:e})=>{let{migrate:t}=(()=>{let e=(0,aY.u)(),{user:t}=(0,na.u)(),{client:r,refreshSessionAndUser:i,walletProxy:n}=(0,nd.u)();return{migrate:(0,W.useCallback)(async()=>{if("legacy-embedded-wallets-only"===e.embeddedWallets.mode)return{success:!0,migrated:!1};if(!t)throw new nd.a("User must be authenticated before migrating wallets",nd.b.MUST_BE_AUTHENTICATED);if(!n)throw new nd.a("Cannot connect to wallet proxy");let s=await r.getAccessToken();if(!s)throw new nd.a("User must be authenticated before migrating wallets",nd.b.MUST_BE_AUTHENTICATED);let a=t.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&(0,nu.i)(e)&&!(0,na.b)(e));if(0===a.length)return{success:!0,migrated:!1};let o=a.filter(e=>e.imported),l=a.filter(e=>!e.imported);if(l.length>0){let e=l.find(e=>"ethereum"===e.chainType&&0===e.walletIndex)??l.find(e=>"solana"===e.chainType&&0===e.walletIndex)??null;if(!e)throw new nd.a("Primary wallet not found");let{entropyId:t,entropyIdVerifier:r}=(0,nc.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!xo(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!1},delegatedWallets:l.map(e=>({address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}))})}for(let e of o){let{entropyId:t,entropyIdVerifier:r}=(0,nc.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!xo(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!0},delegatedWallets:[{address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}]})}return await i(),{success:!0,migrated:!0}},[e.embeddedWallets.mode,t,n,r,i])}})(),{user:r}=(0,na.u)(),{walletProxy:i}=(0,nd.u)(),n=(0,W.useRef)(!1),s=(0,W.useRef)(0);return(0,W.useEffect)(()=>{e||s.current>2||n.current||!r||!i||(n.current=!0,s.current++,t().catch(e=>{console.debug("Unable to migrate wallets: ",e)}).finally(()=>{n.current=!1}))},[r,i,e,t]),null},xq=(0,o1.create)(()=>({ethereum:[]})),xH=(0,o1.create)(()=>({user:null,authenticated:!1})),xz=e=>xH.setState({user:e});class x${async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oq,{token:this.meta.token})}catch(e){throw(0,nd.f)(e)}}async link(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oH,{token:this.meta.token})}catch(e){throw(0,nd.f)(e)}}constructor(e){this.meta={token:e}}}let xK=(e,t)=>!(0,na.c)(e)&&("all-users"===t||"users-without-wallets"===t&&!xV(e).length),xV=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"ethereum"===e.chainType),xJ=(e,t)=>!(0,na.d)(e)&&("all-users"===t||"users-without-wallets"===t&&!xG(e).length),xG=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"solana"===e.chainType),xZ=()=>{let{walletProxy:e,recoverEmbeddedWallet:t,setUser:r,refreshSessionAndUser:i,privy:n,client:s}=(0,nd.u)(),a=(0,aY.u)();return{create:async({walletIndex:o,chainType:l,latestUser:c,recoveryMethod:d,recoveryPassword:u,recoveryAccessToken:h,idempotencyKey:p})=>{let f=c;f||(f=await i());let y=await s.getAccessToken();if(!f||!y||!e)throw Error("User must be authenticated before creating a Privy wallet");return await (0,oY.c)({appConfig:a,user:f,refreshSessionAndUser:i,privy:n,accessToken:y,proxy:e,recoverEmbeddedWallet:t,setUser:r,walletIndex:o,chainType:l,recoveryMethod:d,recoveryPassword:u,recoveryAccessToken:h,idempotencyKey:p})}}},xY=(0,o1.create)(()=>({jwtAuthFlowState:{status:"not-enabled"}}));function xQ({customAuth:e}){let{jwtAuthFlowState:t}=function({customAuth:e}){let t=(0,o0.a)(),r=(0,W.useRef)(),i=(0,W.useCallback)(e=>(r.current=e,()=>{r.current=void 0}),[]),n=e?.getCustomAccessToken??(()=>Promise.resolve(void 0)),{state:s}=function({subscribe:e,getExternalJwt:t,enabled:r=!0,onAuthenticated:i,onUnauthenticated:n,onError:s}){let{client:a,setAuthenticated:o,setUser:l,setIsNewUser:c}=(0,nd.u)(),{logout:d,authenticated:u,ready:h}=(0,oY.u)(),{create:p}=xZ(),f=(0,aY.u)();if(!a)throw new nd.a("`useSyncJwtBasedAuthState` must be used within a `PrivyProvider`");let[y,g]=(0,W.useState)({status:"initial"}),m=(0,W.useRef)(),w=(0,W.useRef)(!1),v=(0,W.useRef)(t);(0,W.useEffect)(()=>{v.current=t},[t]);let b=(0,W.useRef)(i);(0,W.useEffect)(()=>{b.current=i},[i]);let _=(0,W.useRef)(n);(0,W.useEffect)(()=>{_.current=n},[n]);let E=(0,W.useRef)(s);(0,W.useEffect)(()=>{E.current=s},[s]);let I=(0,W.useRef)(p);(0,W.useEffect)(()=>{I.current=p},[p]);let A=(0,W.useRef)(f.embeddedWallets.ethereum.createOnLogin);(0,W.useEffect)(()=>{A.current=f.embeddedWallets.ethereum.createOnLogin},[f.embeddedWallets.ethereum.createOnLogin]);let S=(0,W.useRef)(f.embeddedWallets.solana.createOnLogin);(0,W.useEffect)(()=>{S.current=f.embeddedWallets.solana.createOnLogin},[f.embeddedWallets.solana.createOnLogin]);let k=(0,W.useRef)(l);(0,W.useEffect)(()=>{k.current=l},[l]);let T=(0,W.useRef)(c);(0,W.useEffect)(()=>{T.current=c},[c]);let C=(0,W.useRef)(o);return(0,W.useEffect)(()=>{C.current=o},[o]),(0,W.useEffect)(()=>{if(!r||!h)return;let t=async()=>{if(!w.current){w.current=!0;try{g({status:"loading"});let e=await v.current();if(void 0!==m.current&&m.current===e)return void g({status:"done"});if(!e)return u&&(await d(),_.current?.()),m.current=e,void g({status:"done"});a.startAuthFlow(new x$(e));let{user:t,isNewUser:r=!1}=await a.authenticate();if(!t)throw new nd.a("Failed to sync with custom auth provider");b.current?.({user:t,isNewUser:r}),k.current(t),T.current(r),C.current(!0);let i=xK(t,A.current),n=xJ(t,S.current);if(i&&n){let e=await I.current({chainType:"ethereum",walletIndex:0,latestUser:t});await I.current({chainType:"solana",walletIndex:0,latestUser:e.user})}else n?await I.current({chainType:"solana",walletIndex:0,latestUser:t}):i&&await I.current({chainType:"ethereum",walletIndex:0,latestUser:t});m.current=e,g({status:"done"})}catch(e){if(console.warn(e),await d().catch(()=>{}),_.current?.(),e instanceof nd.e&&e.privyErrorCode===nd.b.LINKED_TO_ANOTHER_USER)return g({status:"initial"}),void setTimeout(()=>{t()},0);E.current?.(e),g({status:"error",error:e})}finally{w.current=!1}}};return t(),e(t)},[e,a,u,d,r,h]),r?{state:y}:{state:{status:"not-enabled"}}}({enabled:!0===e?.enabled,subscribe:i,getExternalJwt:n,onAuthenticated:({user:e,isNewUser:r})=>{t("login","onComplete",{user:e,isNewUser:r,wasAlreadyAuthenticated:!1,loginMethod:"custom",loginAccount:null}),t("customAuth","onAuthenticated",{user:e})},onUnauthenticated:()=>{t("customAuth","onUnauthenticated")},onError:e=>{t("login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR)}});return(0,W.useEffect)(()=>{(async()=>{e&&!e.isLoading&&r.current?.()})()},[e?.enabled,e?.getCustomAccessToken,e?.isLoading]),{jwtAuthFlowState:s}}({customAuth:e});return(0,W.useEffect)(()=>{xY.setState({jwtAuthFlowState:t})},[t]),null}let xX=(0,W.createContext)(!1),x0=t=>{let r=t.client,i=t.privy,n=(0,It.u)(),s=(0,aY.u)();(0,nl.d)((0,nl.e)(s?.appearance.walletList??[]));let[u,h]=(0,W.useState)(!1),p=CV(e=>e.inProgressMfaFlow),[f,y]=(0,W.useState)(!1),g=xH(e=>e.user),m=xq(e=>e.ethereum),[w,v]=(0,W.useState)(void 0),[b,_]=(0,W.useState)(!1),[E,I]=(0,W.useState)(null),[A,S]=(0,W.useState)(!1),[k,T]=(0,W.useState)({status:"disconnected",connectedWallet:null,connectError:null,connector:null,connectRetry:nd.n}),[C,x]=(0,W.useState)({status:"initial"}),[P,O]=(0,W.useState)({status:"initial"}),[R,N]=(0,W.useState)({status:"initial"}),[M,U]=(0,W.useState)({status:"initial"}),[D,L]=(0,W.useState)({status:"initial"}),[B,F]=(0,W.useState)({status:"initial"}),[q,H]=(0,W.useState)(null),z=(0,aY.c)(),[$,K]=(0,W.useState)({}),[V,J]=(0,W.useState)(null),G=(0,W.useRef)(null),[Z,Y]=(0,W.useState)(!1),Q=(0,W.useRef)(null),X=(0,W.useRef)(null),ee=(0,W.useRef)(o0.p),[et,er]=(0,W.useState)(!1),ei=xH(e=>e.authenticated),ea=(0,W.useCallback)(e=>{xH.setState({authenticated:e}),!e&&E&&CK[E]().then(e=>{e.default.isUnauthenticatedScreem&&I(null)})},[E]);r.onStoreCustomerAccessToken=e=>{e&&(0,o0.e)(ee,"accessToken","onAccessTokenGranted",{accessToken:e})},r.onDeleteCustomerAccessToken=()=>{xz(null),ea(!1),(0,o0.e)(ee,"accessToken","onAccessTokenRemoved")};let eo=(0,W.useRef)(null),el=(0,W.useRef)(null),ec=(0,W.useRef)(!1),ed=({showWalletUIs:e})=>ec.current?ec.current:void 0!==e?!e:!s.embeddedWallets.showWalletUIs,eu=e=>{I(e),setTimeout(()=>{h(!0)},15)};(0,W.useEffect)(()=>{if(!g)return void r.connectors?.removeEmbeddedWalletConnectors();let e=(0,na.c)(g),n=(0,na.e)(g),a=(0,na.f)(g);e&&n.length||r.connectors?.removeEmbeddedWalletConnectors(),a.length||r.connectors?.removeImportedWalletConnectors(),r.connectors?q?(e&&r.connectors.addEmbeddedWalletConnectors({walletProxy:q,user:g,embeddedWallets:n,defaultChain:s.defaultChain,appId:t.appId,privyClient:i}),a.forEach(e=>r.connectors?.addImportedWalletConnector(q,e.address,s.defaultChain,t.appId))):console.debug("Failed to add embedded wallet connector: Wallet proxy not initialized"):console.debug("Failed to add embedded wallet connector: Client connectors not initialized")},[q,g]),(0,W.useEffect)(()=>{q&&G.current?.(q)},[q]),(0,W.useEffect)(()=>{if(s.externalWallets.solana.connectors)return s.externalWallets.solana.connectors.onMount(),()=>s.externalWallets.solana.connectors?.onUnmount()},[s.externalWallets.solana.connectors]),(0,W.useEffect)(()=>{!f&&z&&async function(){let e,t,i,n,a,o=eh(),l=ef(),c=(e=new Set,t=[],n=(i=()=>(function(e){if("u"<typeof window)return;let t=t=>e(t.detail);return window.addEventListener("eip6963:announceProvider",t),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",t)})(r=>{t.some(({info:e})=>e.uuid===r.info.uuid)||(t=[...t,r],e.forEach(e=>e(t,{added:[r]})))}))(),{_listeners:()=>e,clear(){e.forEach(e=>e([],{removed:[...t]})),t=[]},destroy(){this.clear(),e.clear(),n?.()},findProvider:({rdns:e})=>t.find(t=>t.info.rdns===e),getProviders:()=>t,reset(){this.clear(),n?.(),n=i()},subscribe:(r,{emitImmediately:i}={})=>(e.add(r),i&&r(t,{added:t}),()=>e.delete(r))});r.initializeConnectorManager({walletConnectCloudProjectId:s.walletConnectCloudProjectId,rpcConfig:s.rpcConfig,chains:s.chains,defaultChain:s.defaultChain,store:c,walletList:s.appearance.walletList,shouldEnforceDefaultChainOnConnect:s.shouldEnforceDefaultChainOnConnect,externalWalletConfig:s.externalWallets,appName:s.name??"Privy",walletChainType:s.appearance.walletChainType,setBaseAccountSdk:v}),r.connectors?.on("connectorInitialized",()=>{a&&clearTimeout(a);let e=r.connectors.walletConnectors.length,t=r.connectors.walletConnectors.reduce((e,t)=>e+ +!!t.initialized,0);t===e?er(!0):a=setTimeout(()=>{console.debug({message:"Unable to initialize all expected connectors before timeout",initialized:t,expected:e}),er(!0)},1500)}),r.connectors?.initialize().then(()=>{ev()});let d=await r.getAuthenticatedUser(),u=!!d;s.legal.requireUsersAcceptTerms&&d&&!d.hasAcceptedTerms?(await r.logout(),eP.setReadyToTrue(!0),(0,o0.e)(ee,"logout","onSuccess")):(s.customAuth?.enabled||(ea(!!d),d&&(0,o0.e)(ee,"login","onComplete",{user:d,isNewUser:!1,wasAlreadyAuthenticated:!0,loginMethod:null,loginAccount:null}),xz(d)),o?el.current=u?"link":"login":l&&!u?(el.current="login",K({telegramAuthModalData:{seamlessAuth:!0}}),eu("TelegramAuthScreen")):eP.setReadyToTrue(!!d))}()},[r,V,f,z]),(0,W.useEffect)(()=>{if(f){if(!g||!g.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType))return void Y(!!q);if([...m].some(e=>"privy"===e.walletClientType))return void Y(!0);Y(!!q)}},[f,g,m,q]),(0,W.useEffect)(()=>{r.connectors?.setWalletList(s.appearance.walletList)},[s.appearance.walletList.join()]);let eh=()=>{let e=function(){let e=new URLSearchParams(window.location.search),t=e.get("privy_oauth_code"),r=e.get("privy_oauth_state"),i=e.get("privy_oauth_provider");if(!t||!r||!i)return{inProgress:!1};let n=!1;try{n=!!window.opener.location.origin}catch{}return{inProgress:!0,authorizationCode:t,stateCode:r,provider:i,withPrivyUi:!nu.s.get(aY.H),popupFlow:null!==window.opener&&n,disableSignup:!!nu.s.get(aY.O)}}();return e.inProgress&&e.popupFlow?window.opener.location.origin!==window.location.origin?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Origins between parent and child windows do not match."}):"error"===e.authorizationCode?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Something went wrong. Try again."}):void window.opener.postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}):(e.inProgress&&e.provider.startsWith("privy:")&&!e.popupFlow&&(new BroadcastChannel(xI).postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}),window.close()),!!e.inProgress&&!!e.withPrivyUi&&(r.startAuthFlow(new CT({...e,customOAuthRedirectUrl:s.customOAuthRedirectUrl})),eu("OAuthStatusScreen"),!0))},ef=()=>{let e,t=(e=function(){let e=new URLSearchParams(window.location.search),t=Number(e.get("id")||""),r=e.get("hash"),i=Number(e.get("auth_date")||""),n=e.get("first_name");if(t&&n&&i&&r)return Object.fromEntries(e.entries())}())?(Cq(),{flowType:"login-url",authData:e}):(e=function(){let e=window.location.hash;if(!e||!e.startsWith("#tgWebAppData"))return;let t=CF(e.replace("#tgWebAppData=","")),{user:r,auth_date:i,hash:n}=t;return r&&i&&n?t:void 0}())?(Cq(),{flowType:"web-app",authData:e}):void 0;if(!t||!s.loginMethods.telegram||!s.loginConfig.telegramAuthConfiguration?.seamlessAuthEnabled)return;let i=new CW;return r.startAuthFlow(i),"login-url"===t.flowType&&(i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=t.authData),"web-app"===t.flowType&&(i.meta.telegramAuthResult=void 0,i.meta.telegramWebAppData=t.authData),!0},ey=async(e,t,i,n)=>{if("solana_adapter"!==e)eg(await r.connectors?.createEthereumWalletConnector({connectorType:e,walletClientType:t})||null,t,i,n);else{let e=r.connectors?.findSolanaWalletConnector(t);if(!e)return;eg(e,t,i,n)}};async function eg(e,t,r,i){if(!e)return T({status:"disconnected",connectedWallet:null,connectError:new nd.P("Unable to connect to wallet."),connector:null,connectRetry:nd.n}),i?.(null,r);T({status:"disconnected",connectedWallet:null,connectError:null,connector:e,connectRetry:nd.n}),e instanceof xi&&t&&await e.resetConnection(t),T({connector:e,status:"connecting",connectedWallet:null,connectError:null,connectRetry:()=>eg(e,t,r,i)});try{let t=await e.connect({showPrompt:!0});if((!t||(0,nl.f)(t))&&s.shouldEnforceDefaultChainOnConnect&&!s.chains.find(e=>e.id===Number(t?.chainId.replace("eip155:","")))&&("wallet_connect_v2"!==t?.connectorType||"metamask"!==t?.walletClientType)){T(t=>({...t,connector:e,status:"switching_to_supported_chain",connectedWallet:null,connectError:null,connectRetry:nd.n}));try{await t?.switchChain(s.defaultChain.id),t&&(t.chainId=(0,nl.l)((0,en.toHex)(s.defaultChain.id)))}catch{console.warn(`Unable to switch to default chain: ${s.defaultChain.id}`)}}return T(e=>({...e,status:"connected",connectedWallet:t,connectError:null,connectRetry:nd.n})),t&&(0,o0.e)(ee,"connectWallet","onSuccess",{wallet:t}),i?.(t,r)}catch(e){return e instanceof nd.c?(console.warn(e.cause?e.cause:e.message),(0,o0.e)(ee,"connectWallet","onError",e.privyErrorCode||nd.b.GENERIC_CONNECT_WALLET_ERROR)):(console.warn(e),(0,o0.e)(ee,"connectWallet","onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR)),T(t=>({...t,status:"disconnected",connectedWallet:null,connectError:e})),i?.(null,r)}}let em=async(e,t,i)=>{if(null===e||!(0,nl.f)(e))return;let n=new CO(r,e,t,i);r.startAuthFlow(n)},ew=async(e,t,i,s="plain")=>{let a=n(oY.e);if("transaction"===s&&!a)throw new nd.a("useSolanaLedger plugin hook must be mounted");if(null===e||!(0,nl.n)(e))return;let o=new CR(e,r,t,i,s,a);r.startAuthFlow(o)},ev=async()=>{let e=new URLSearchParams(window.location.search),t=e.get("privy_connector"),i=e.get("privy_wallet_client"),n="true"===e.get("privy_connect_only");if(!t||!i)return;let s=(0,nl.m)({connectorType:t,walletClientType:i});if(!s||!s.isInstalled)return eu("LoginFailedScreen");if(!r.connectors)throw new nd.a("Connector not initialized");await eu(n?"ConnectOnlyStatusScreen":"ConnectionStatusScreen");let a=new URL(window.location.href);a.searchParams.delete("privy_connector"),a.searchParams.delete("privy_wallet_client"),a.searchParams.delete("privy_connect_only"),window.history.pushState({},"",a),ey(t,i,void 0,n?void 0:"solana_adapter"===t?ew:em)};(0,W.useEffect)(()=>{f&&ei&&null===g&&r.getAuthenticatedUser().then(xz)},[f,ei,g,r]);let eb=e=>{if(!ei)throw(0,o0.e)(ee,"linkAccount","onError",nd.b.MUST_BE_AUTHENTICATED,{linkMethod:e}),new nd.a("User must be authenticated before linking an account.")},e_=()=>{xq.setState(e=>{let t=r.connectors?.wallets.filter(nl.f).map(e=>({...e,linked:(e=>{if(!ei||!g)return!1;if("privy"===e.walletClientType)return!0;for(let t of g.linkedAccounts)if("wallet"===t.type&&t.address===e.address&&"privy"!==t.walletClientType)return!0;return!1})(e),loginOrLink:async()=>{if(!await e.isConnected())throw new nd.a("Wallet is not connected");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new nd.a("Cannot link or login with embedded wallet");(async e=>{let t;if(!r.connectors)throw new nd.a("Connector not initialized");t="ethereum"===e.type?r.connectors.findWalletConnector(e.connectorType,e.walletClientType)||null:r.connectors.findSolanaWalletConnector(e.walletClientType)||null,T(r=>({...r,connector:t,status:"connected",connectedWallet:e,connectError:null,connectRetry:nd.n})),s.captcha.enabledProvider&&!ei?(K({captchaModalData:{callback:t=>(0,nl.f)(e)?em(e,t):ew(e,t),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),await eu("CaptchaScreen")):((0,nl.f)(e)?await em(e):await ew(e),await eu("ConnectionStatusScreen"))})(e)},fund:async t=>{await eP.fundWallet(e.address,t)},unlink:async()=>{if(!ei)throw new nd.a("User is not authenticated.");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new nd.a("Cannot unlink an embedded wallet");xz(await r.unlinkEthereumWallet(e.address))}}))||[];return(0,nl.h)(e.ethereum,t)?{}:{ethereum:t}})};(0,W.useEffect)(()=>{e_()},[g?.linkedAccounts,ei,f]),(0,W.useEffect)(()=>{if(f){if(!r.connectors)throw new nd.a("Connector not initialized");e_(),r.connectors.on("walletsUpdated",e_)}},[f]),(0,W.useEffect)(()=>{[...s.loginMethodsAndOrder?.primary??[],...s.loginMethodsAndOrder?.overflow??[]].filter(e=>e.startsWith("privy:")).forEach(e=>r.getCrossAppProviderDetails(e.replace("privy:","")))},[!!r]);let eE=({transaction:e,sponsor:a,uiOptions:o,fundWalletConfig:l,address:c,signOnly:d})=>new Promise(async(u,h)=>{let{requesterAppId:p}=o||{},f=d?"signTransaction":"sendTransaction",y=c?(0,na.h)(g,c):(0,na.c)(g);if(!y&&c){let t=(0,na.j)(xq.getState().ethereum,c);if(t){if(a)throw new nd.a("Cannot sponsor transactions for externally connected wallet.");try{let r=await t.getEthereumProvider(),i=e.data,s=n(Ir);s&&(i=s.appendDataSuffix({data:i}));let a={...e,from:c,chainId:e.chainId||Number(t.chainId.replace("eip155:","")),value:void 0!==e.value?(0,en.toHex)(e.value):void 0,data:i},o=await r.request({method:"sendTransaction"===f?"eth_sendTransaction":"eth_signTransaction",params:[a]});return(0,o0.e)(ee,f,"onSuccess",{hash:o}),void u({hash:o})}catch(e){return(0,o0.e)(ee,f,"onError",nd.b.TRANSACTION_FAILURE),void h(e??new nu.P("Unable to "+f+e))}}}if(!y)return(0,o0.e)(ee,f,"onError",nd.b.EMBEDDED_WALLET_NOT_FOUND),void h(new nd.a("No embedded or connected wallet found for address."));if(!ei||!g)return(0,o0.e)(ee,f,"onError",nd.b.MUST_BE_AUTHENTICATED),void h(Error("User must be authenticated before signing with a Privy wallet"));let m=y.address,w=y.walletIndex??0,{entropyId:v,entropyIdVerifier:b}=(0,nc.g)(g,y),_=eO.wallets.find(e=>"privy"===e.walletClientType&&(0,aX.getAddress)(e.address)===(0,aX.getAddress)(m));if(!_)return(0,o0.e)(ee,f,"onError",nd.b.EMBEDDED_WALLET_NOT_FOUND),void h(Error("Must have a Privy wallet before signing"));let E=await _.getEthereumProvider(),I=await E.request({method:"eth_chainId"}),A=e.chainId?Number(e.chainId):(0,nu.e)(I);if(!s.chains.map(e=>e.id).includes(A))throw new nd.P(`Chain ID ${A} is not supported. It must be added to the config.supportedChains property of the PrivyProvider.`,nd.b.UNSUPPORTED_CHAIN_ID);let S=e.data,k=n(Ir);k&&(S=k.appendDataSuffix({data:S}));let T={...e,from:e.from??m,chainId:A,data:S},C=await Ch();if(!C||!q)return(0,o0.e)(ee,f,"onError",nd.b.EMBEDDED_WALLET_NOT_FOUND),void h(Error("Must have valid access token and Privy wallet to send transaction"));let x=(0,Ii.g)(T.chainId,s.chains,s.rpcConfig,{appId:t.appId}),P=(0,na.b)(y),O=async({transactionRequest:e})=>{try{let t;if(!await eP.recoverEmbeddedWallet({address:m}))throw(0,o0.e)(ee,f,"onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR),h(Error("Unable to connect to wallet")),Error("Unable to connect to wallet");if(a){let t=await (async({transactionRequest:e})=>{if(!P)throw new nd.a("Sponsoring is only supported for wallets on the TEE stack");if(d)throw new nd.a("Cannot sponsor a sign transaction request");let t=e=>null==e?void 0:(0,en.toHex)(e),r=await (0,ep.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:C,requesterAppId:p,message:e}),{chain_type:"ethereum",method:"eth_sendTransaction",caip2:(0,nl.l)((0,en.toHex)(e.chainId)),sponsor:!0,params:{transaction:{from:e.from,to:e.to,chain_id:t(e.chainId),data:(0,es.isHex)(e.data)?e.data?e.data:(0,en.toHex)(Uint8Array.from(e.data)):void 0,value:t(e.value)}},wallet_id:y.id});if(r.data&&"hash"in r.data)return r.data.hash;throw new nu.P("Unable to sign transaction")})({transactionRequest:e});return(0,o0.e)(ee,"sendTransaction","onSuccess",{hash:t}),t}if(P){let r=e=>null==e?void 0:(0,en.toHex)(e),n=await (0,ep.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:C,requesterAppId:p,message:e}),{chain_type:"ethereum",method:"eth_signTransaction",params:{transaction:{from:e.from,to:e.to,nonce:r(e.nonce),chain_id:r(e.chainId),data:(0,es.isHex)(e.data)?e.data?e.data:(0,en.toHex)(Uint8Array.from(e.data)):void 0,value:r(e.value),type:e.type,gas_limit:r(e.gasLimit??e.gas),gas_price:r(e.gasPrice??e.gas),max_fee_per_gas:r(e.maxFeePerGas),max_priority_fee_per_gas:r(e.maxPriorityFeePerGas)}},wallet_id:y.id});if(!n.data||!("signed_transaction"in n.data))throw new nu.P("Unable to sign transaction");t=n.data.signed_transaction}else t=await async function({accessToken:e,entropyId:t,entropyIdVerifier:r,transactingWalletIndex:i,walletProxy:n,transactionRequest:s,requesterAppId:a}){return(await n.rpc({entropyId:t,entropyIdVerifier:r,hdWalletIndex:i??0,chainType:"ethereum",accessToken:e,requesterAppId:a,request:{method:"eth_signTransaction",params:[s]}})).response.data}({accessToken:C,entropyId:v,entropyIdVerifier:b,transactingWalletIndex:w,walletProxy:q,transactionRequest:e,requesterAppId:p});if(d)return(0,o0.e)(ee,"signTransaction","onSuccess",{signature:t}),t;{let e=await x.sendRawTransaction({serializedTransaction:t});return(0,o0.e)(ee,"sendTransaction","onSuccess",{hash:e}),e}}catch(e){throw(0,o0.e)(ee,f,"onError",nd.b.TRANSACTION_FAILURE),e}};if(ed({showWalletUIs:o?.showWalletUIs})){let e=d||a?T:await xB(T,x,T.from);try{let t=await O({transactionRequest:e});d?(0,o0.e)(ee,"signTransaction","onSuccess",{signature:t}):(0,o0.e)(ee,"sendTransaction","onSuccess",{hash:t}),u({hash:t})}catch(e){(0,o0.e)(ee,f,"onError",nd.b.TRANSACTION_FAILURE),h(e)}}else{let e={connectingWalletAddress:m,recoveryMethod:y.recoveryMethod,entropyId:v,entropyIdVerifier:b,onCompleteNavigateTo:"SendTransactionScreen",isUnifiedWallet:P,onFailure:e=>{(0,o0.e)(ee,f,"onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR),h(e)}},t=s.fundingConfig&&(0,nu.a)(s.fundingConfig.options).length>=1?(0,nu.p)({address:m,appConfig:s,fundWalletConfig:l,methodScreen:"FundingMethodSelectionScreen",chainIdOverride:T.chainId,comingFromSendTransactionScreen:!0}):void 0;K({connectWallet:e,sendTransaction:{transactionRequest:T,transactingWalletIndex:w,transactingWalletAddress:m,entropyId:v,entropyIdVerifier:b,signOnly:d,scanTransaction:async()=>{let e=await xB(T,x,T.from);return await r.scanTransaction({metadata:{domain:s.embeddedWallets.transactionScanning.domain},chain_id:e.chainId.toString(),request:{method:"eth_sendTransaction",params:[{from:e.from,to:e.to,value:e.value?.toString(),gas:e.gas?.toString(),gasPrice:e.gasPrice?.toString(),nonce:e.nonce?.toString(),data:e.data}]}})},getIsSponsored:async()=>!!a,onConfirm:({transactionRequest:e})=>O({transactionRequest:e}),onSuccess:e=>{d?(0,o0.e)(ee,"signTransaction","onSuccess",{signature:e.hash}):(0,o0.e)(ee,"sendTransaction","onSuccess",{hash:e.hash}),u(e)},onFailure:e=>{(0,o0.e)(ee,f,"onError",nd.b.TRANSACTION_FAILURE),h(e)},uiOptions:o||{},fundWalletConfig:l,requesterAppId:p},funding:t}),eu("EmbeddedWalletConnectingScreen")}});function eI(){return new Promise(async(e,t)=>{let r=await Ch();if(!r||!q)throw Error("Must have valid access token to enroll in MFA");try{await q.verifyMfa({accessToken:r}),e()}catch(e){t(e)}})}let eA=e=>e?.linkedAccounts.filter(e=>null!==e.latestVerifiedAt&&("wallet"!==e.type||"privy"!==e.walletClientType)).sort((e,t)=>t.latestVerifiedAt.getTime()-e.latestVerifiedAt.getTime())[0],eS=e=>{let t=g?.linkedAccounts.filter(t=>t.type===e).length??0,{displayName:r,loginMethod:i}=xW(e);if("passkey"===e&&t>=5||"passkey"!==e&&t>=1)throw(0,o0.e)(ee,"linkAccount","onError",nd.b.CANNOT_LINK_MORE_OF_TYPE,{linkMethod:i}),new nd.a(`User already has an account of type ${r} linked.`)};async function ek({showAutomaticRecovery:e=!1,legacySetWalletPasswordFlow:t=!1}){I(null);let r=t?"setWalletPassword":"setWalletRecovery";if(!ei||!g)throw(0,o0.e)(ee,r,"onError",nd.b.MUST_BE_AUTHENTICATED),Error("User must be authenticated before adding recovery method to Privy wallet");let i=(0,na.g)(g);if(!i||!q)throw(0,o0.e)(ee,r,"onError",nd.b.EMBEDDED_WALLET_NOT_FOUND),Error("Must have a Privy wallet to add a recovery method");let n=(0,na.b)(i);if(n)throw(0,o0.e)(ee,r,"onError",nd.b.UNSUPPORTED_WALLET_TYPE),new nd.a("User owned wallet recovery is only supported for on-device execution and this app uses TEE execution. Learn more https://docs.privy.io/recipes/tee-wallet-migration-guide");try{await eI()}catch(e){throw(0,o0.e)(ee,r,"onError",nd.b.MISSING_MFA_CREDENTIALS),e}return new Promise((a,o)=>{let l="user-passcode"===i.recoveryMethod,c=xO({walletAction:"update",availableRecoveryMethods:s.embeddedWallets.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:t,isResettingPassword:l,showAutomaticRecovery:e}),{entropyId:d,entropyIdVerifier:u}=(0,nc.g)(g),h={recoveryMethod:i.recoveryMethod,connectingWalletAddress:i.address,onCompleteNavigateTo:c,shouldForceMFA:!1,entropyId:d,isUnifiedWallet:n,entropyIdVerifier:u,onFailure:e=>{(0,o0.e)(ee,r,"onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR),o(e)}};K({setWalletPassword:{onSuccess:e=>{(0,o0.e)(ee,r,"onSuccess",{method:"user-passcode",wallet:e}),a(e)},onFailure:e=>{(0,o0.e)(ee,r,"onError",nd.b.USER_EXITED_SET_PASSWORD_FLOW),o(e)},callAuthOnSuccessOnClose:!1},recoverWallet:{entropyId:d,entropyIdVerifier:u,onFailure:o},connectWallet:h,recoverySelection:{isInAccountCreateFlow:!1,isResettingPassword:l,shouldCreateEth:!1,shouldCreateSol:!1}}),eu("EmbeddedWalletConnectingScreen")})}async function eT({appId:e,action:t,disableSignup:i}){let n=await Ch();if("link"===t&&!n)throw(0,o0.e)(ee,"linkAccount","onError",nd.b.MUST_BE_AUTHENTICATED,{linkMethod:`privy:${e}`}),new nd.a("User must be authenticated before linking an account.");if("login"===t&&n)throw(0,o0.e)(ee,"login","onError",nd.b.UNKNOWN_AUTH_ERROR),new nd.a("Attempted to log in, but user is already logged in. Use a `link` helper instead.");eo.current=`privy:${e}`,el.current=t;let a=(0,a1.trigger)();return r.createAnalyticsEvent({eventName:"cross_app_auth_started",payload:{providerAppId:e}}),new Promise(async(n,o)=>{let{name:l,logoUrl:c}=await xk({api:r.api,providerAppId:e,requesterAppId:s.id});K({crossAppAuth:{appId:e,name:l,logoUrl:c,action:t,popup:a,disableSignup:i,onSuccess:n,onError:o}}),eu("CrossAppAuthScreen")})}let eC={ready:f,authenticated:ei,user:g,walletConnectors:r.connectors||null,connectWallet:e=>{e&&"target"in e&&e&&(e=void 0),K({externalConnectWallet:{walletList:e?.walletList&&e?.walletList.length>0?e.walletList:void 0,walletChainType:e?.walletChainType,description:e?.description,hideHeader:e?.hideHeader}}),eu("ConnectOnlyLandingScreen")},linkWallet:e=>(e&&"target"in e&&e&&(e=void 0),eb("siwe"),eo.current="siwe",el.current="link",K({...$,externalConnectWallet:{...$.externalConnectWallet,walletList:e?.walletList,walletChainType:e?.walletChainType,description:e?.description||`Link a wallet to your ${s?.name} account`}}),eu("AuthenticateWithWalletScreen")),startCrossAppAuthFlow:eT,linkEmail:()=>{eb("email"),eS("email"),eo.current="email",el.current="link",eu("LinkEmailScreen")},linkPhone:()=>{eb("sms"),eS("phone"),eo.current="sms",el.current="link",eu("LinkPhoneScreen")},linkGoogle:async()=>{eb("google"),eS("google_oauth"),el.current="link",await eP.initLoginWithOAuth("google")},linkTwitter:async()=>{eb("twitter"),eS("twitter_oauth"),el.current="link",await eP.initLoginWithOAuth("twitter")},linkTwitch:async()=>{eb("twitch"),eS("twitch_oauth"),el.current="link",await eP.initLoginWithOAuth("twitch")},linkDiscord:async()=>{eb("discord"),eS("discord_oauth"),el.current="link",await eP.initLoginWithOAuth("discord")},linkGithub:async()=>{eb("github"),eS("github_oauth"),el.current="link",await eP.initLoginWithOAuth("github")},linkSpotify:async()=>{eb("spotify"),eS("spotify_oauth"),el.current="link",await eP.initLoginWithOAuth("spotify")},linkInstagram:async()=>{eb("instagram"),eS("instagram_oauth"),el.current="link",await eP.initLoginWithOAuth("instagram")},linkTiktok:async()=>{eb("tiktok"),eS("tiktok_oauth"),el.current="link",await eP.initLoginWithOAuth("tiktok")},linkLine:async()=>{eb("line"),eS("line_oauth"),el.current="link",await eP.initLoginWithOAuth("line")},linkLinkedIn:async()=>{eb("linkedin"),eS("linkedin_oauth"),el.current="link",await eP.initLoginWithOAuth("linkedin")},linkApple:async()=>{eb("apple"),eS("apple_oauth"),el.current="link",await eP.initLoginWithOAuth("apple")},linkPasskey:async()=>{eb("passkey"),eS("passkey"),await eP.initLinkWithPasskey(),eu("LinkPasskeyScreen")},linkTelegram:async e=>{if(eb("telegram"),eS("telegram"),el.current="link",eo.current="telegram",e?.launchParams)if(e.launchParams.initDataRaw){let t=new CW;r.startAuthFlow(t),t.meta.telegramAuthResult=void 0,t.meta.telegramWebAppData=CF(e.launchParams.initDataRaw),K({telegramAuthModalData:{seamlessAuth:!0}}),eu("TelegramAuthScreen")}else(0,o0.e)(ee,"linkAccount","onError",nd.b.INVALID_DATA,{linkMethod:"telegram"});else await eP.initLoginWithTelegram();eu("TelegramAuthScreen")},linkFarcaster:async()=>{eb("farcaster"),eS("farcaster"),await eP.initLoginWithFarcaster(),el.current="link",eo.current="farcaster",eu("FarcasterConnectStatusScreen")},updateEmail:()=>{if(eb("email"),!g?.email)throw new nd.a("User does not have an email linked to their account.");el.current="update",eo.current="email",eu("UpdateEmailScreen")},updatePhone:()=>{if(eb("sms"),!g?.phone)throw new nd.a("User does not have a phone number linked to their account.");el.current="update",eo.current="sms",eu("UpdatePhoneScreen")},login:async e=>{e&&"target"in e&&e&&(e=void 0);let t="Attempted to log in, but user is already logged in. Use a `link` helper instead.";if(!f){let e=await new Promise(e=>{J(t=>e.bind(t))});if(J(null),e)return void console.warn(t)}!g||g.isGuest?(el.current="login",K({login:e}),eu("LandingScreen")):console.warn(t)},connectOrCreateWallet:async()=>{f||(await new Promise(e=>{J(()=>e)}),J(null)),ei?console.warn("User must be unauthenticated to `connectOrCreateWallet`"):(el.current="connect-or-create",eu("ConnectOrCreateScreen"))},logout:async()=>{if(el.current=null,eo.current=null,g&&r.clearProviderAcccessTokens(g),I(null),await r.logout(),g&&q)try{await q.clearMfa({userId:g.id})}catch(e){}xz(null),ea(!1),O({status:"initial"}),N({status:"initial"}),x({status:"initial"}),U({status:"initial"}),L({status:"initial"}),F({status:"initial"}),(0,o0.e)(ee,"logout","onSuccess"),h(!1),nu.s.del(aY.d),nu.s.del((0,aY.g)(s.id))},getAccessToken:(0,W.useCallback)(async()=>{let e=await r.getCustomerAccessToken();return e&&!ei&&ea(!0),e},[r,ei]),unlinkWallet:async e=>{let t;return xz(t=e.startsWith("0x")?await r.unlinkEthereumWallet(e):await r.unlinkSolanaWallet(e)),t},unlinkEmail:async e=>{let t=await r.unlinkEmail(e);return xz(t),t},unlinkPhone:async e=>{let t=await r.unlinkPhone(e);return xz(t),t},unlinkGoogle:async e=>{let t=await r.unlinkOAuth("google",e);return xz(t),t},unlinkTwitter:async e=>{let t=await r.unlinkOAuth("twitter",e);return xz(t),t},unlinkTwitch:async e=>{let t=await r.unlinkOAuth("twitch",e);return xz(t),t},unlinkDiscord:async e=>{let t=await r.unlinkOAuth("discord",e);return xz(t),t},unlinkGithub:async e=>{let t=await r.unlinkOAuth("github",e);return xz(t),t},unlinkSpotify:async e=>{let t=await r.unlinkOAuth("spotify",e);return xz(t),t},unlinkInstagram:async e=>{let t=await r.unlinkOAuth("instagram",e);return xz(t),t},unlinkTiktok:async e=>{let t=await r.unlinkOAuth("tiktok",e);return xz(t),t},unlinkLine:async e=>{let t=await r.unlinkOAuth("line",e);return xz(t),t},unlinkLinkedIn:async e=>{let t=await r.unlinkOAuth("linkedin",e);return xz(t),t},unlinkApple:async e=>{let t=await r.unlinkOAuth("apple",e);return xz(t),t},unlinkFarcaster:async e=>{let t=await r.unlinkFarcaster(e);return xz(t),t},unlinkTelegram:async e=>{let t=await r.unlinkTelegram(e);return xz(t),t},unlinkPasskey:async e=>{let t=await Ch();if(!t)throw Error("Must have valid access token to enroll in MFA");if(!q)throw Error("Wallet proxy not initialized.");let i=s.passkeys.shouldUnenrollMfaOnUnlink;await q.unlinkPasskeyAccount({credentialId:e,accessToken:t,removeAsMfa:i});let n=await r.getAuthenticatedUser();return xz(n),n},unlinkCrossAppAccount:async({subject:e})=>{let t=g?.linkedAccounts.find(t=>"cross_app"===t.type&&t.subject===e)?.providerApp;if(!t)throw new nd.a("Invalid subject");r.storeProviderAccessToken(t.id,null);let i=await r.unlinkOAuth(`privy:${t.id}`,e);return xz(i),i},setWalletRecovery:async e=>ek({legacySetWalletPasswordFlow:!1,showAutomaticRecovery:e?.showAutomaticRecovery??!1}),setWalletPassword:async()=>ek({legacySetWalletPasswordFlow:!0,showAutomaticRecovery:!1}),signMessage:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=e.message,l=t?.address?(0,na.h)(g,t.address):(0,na.c)(g);if(!l&&void 0!==t?.address){let e=(0,na.j)(xq.getState().ethereum,t.address);if(e)try{let t=await e.getEthereumProvider(),r=await t.request({method:"personal_sign",params:[o,e.address]});return(0,o0.e)(ee,"signMessage","onSuccess",{signature:r}),void n({signature:r})}catch(e){return(0,o0.e)(ee,"signMessage","onError",nd.b.UNABLE_TO_SIGN),void s(e??new nu.P("Unable to sign message"))}}if(!l)throw new nd.a("No embedded or connected wallet found for address.");if(!ei||!g)return(0,o0.e)(ee,"signMessage","onError",nd.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let c=l.address,d=l.walletIndex??0,{entropyId:u,entropyIdVerifier:h}=(0,nc.g)(g,l),p=(0,na.b)(l);if("string"!=typeof o||o.length<1)return(0,o0.e)(ee,"signMessage","onError",nd.b.INVALID_MESSAGE),void s(Error("Message must be a non-empty string"));let f=async()=>{let t;if(!ei)throw Error("User must be authenticated before signing with a Privy wallet");let n=await Ch();if(!q||!n||!await eP.recoverEmbeddedWallet({address:c}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_started",payload:{walletAddress:c,requesterAppId:a}}),p){let r=(0,es.isHex)(e.message,{strict:!0}),s=await (0,ep.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:n,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"personal_sign",params:r?{message:o.slice(2),encoding:"hex"}:{message:o,encoding:"utf-8"},wallet_id:l.id});if(!s.data||!("signature"in s.data))throw new nu.P("Unable to sign message");t=s.data.signature}else{let{response:e}=await q.rpc({accessToken:n,entropyId:u,entropyIdVerifier:h,chainType:"ethereum",hdWalletIndex:d,requesterAppId:a,request:{method:"personal_sign",params:[o,c]}});t=e.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_completed",payload:{walletAddress:c,requesterAppId:a}}),t};if(ed({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,o0.e)(ee,"signMessage","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,o0.e)(ee,"signMessage","onError",nd.b.UNABLE_TO_SIGN),s(e??new nu.P("Unable to sign message"))}else K({signMessage:{method:"personal_sign",data:o,confirmAndSign:f,onSuccess:e=>{(0,o0.e)(ee,"signMessage","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,o0.e)(ee,"signMessage","onError",nd.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:l.recoveryMethod,connectingWalletAddress:c,entropyId:u,entropyIdVerifier:h,onCompleteNavigateTo:"SignRequestScreen",isUnifiedWallet:p,onFailure:e=>{(0,o0.e)(ee,"signMessage","onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),eu("EmbeddedWalletConnectingScreen")}),signTypedData:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=t?.address?(0,na.h)(g,t.address):(0,na.c)(g);if(!o&&t?.address){let r=(0,na.j)(xq.getState().ethereum,t.address);if(r)try{let t=await r.getEthereumProvider(),i=(0,nl.j)(e),s=await t.request({method:"eth_signTypedData_v4",params:[r.address,i]});return(0,o0.e)(ee,"signTypedData","onSuccess",{signature:s}),void n({signature:s})}catch(e){return(0,o0.e)(ee,"signTypedData","onError",nd.b.UNABLE_TO_SIGN),void s(e??new nu.P("Unable to sign typed data "+e))}}if(!o)throw new nd.a("No embedded or connected wallet found for address.");if(!ei||!g)return(0,o0.e)(ee,"signTypedData","onError",nd.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let l=o.address,c=o.walletIndex??0,{entropyId:d,entropyIdVerifier:u}=(0,nc.g)(g,o),h=(0,na.b)(o),p=(0,nl.j)(e),f=async()=>{let e;if(!ei)throw Error("User must be authenticated before signing with a Privy wallet");let t=await Ch();if(!q||!t||!await eP.recoverEmbeddedWallet({address:l}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_started",payload:{walletAddress:l,requesterAppId:a}}),h){let{domain:r,types:n,primaryType:s,message:l}=p,c=await (0,ep.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:t,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"eth_signTypedData_v4",params:{typed_data:{domain:r,types:n,primary_type:s,message:l}},wallet_id:o.id});if(!c.data||!("signature"in c.data))throw new nu.P("Unable to sign message");e=c.data.signature}else{let{response:r}=await q.rpc({accessToken:t,entropyId:d,entropyIdVerifier:u,chainType:"ethereum",hdWalletIndex:c,requesterAppId:a,request:{method:"eth_signTypedData_v4",params:[l,p]}});e=r.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_completed",payload:{walletAddress:l,requesterAppId:a}}),e};if(ed({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,o0.e)(ee,"signTypedData","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,o0.e)(ee,"signTypedData","onError",nd.b.UNABLE_TO_SIGN),s(e??new nu.P("Unable to sign message"))}else K({signMessage:{method:"eth_signTypedData_v4",data:p,confirmAndSign:f,onSuccess:e=>{(0,o0.e)(ee,"signTypedData","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,o0.e)(ee,"signTypedData","onError",nd.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:o.recoveryMethod,connectingWalletAddress:o.address,entropyId:d,isUnifiedWallet:h,entropyIdVerifier:u,onCompleteNavigateTo:"SignRequestScreen",onFailure:e=>{(0,o0.e)(ee,"signMessage","onError",nd.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),eu("EmbeddedWalletConnectingScreen")}),sendTransaction:async(e,t)=>await eE({transaction:e,sponsor:t?.sponsor,uiOptions:t?.uiOptions,fundWalletConfig:t?.fundWalletConfig,address:t?.address,signOnly:!1}),signTransaction:async(e,t)=>({signature:(await eE({transaction:e,uiOptions:t?.uiOptions,address:t?.address,signOnly:!0})).hash}),promptMfa:eI,async init(e){switch(e){case"sms":return void await r.initMfaSmsVerification();case"passkey":return await r.initMfaPasskeyVerification();case"totp":return;default:throw Error(`Unsupported MFA method: ${e}`)}},async submit(t,r){switch(t){case"totp":case"sms":if("string"!=typeof r)throw new nd.a("Invalid MFA code");Q.current?.resolve({mfaMethod:t,mfaCode:r,relyingParty:window.origin}),await new Promise((e,t)=>{X.current={resolve:e,reject:t}});break;case"passkey":let i;if("string"==typeof r)throw new nd.a("Invalid authenticator response");let n=await e.A(629997),s={id:(i=await n.startAuthentication({optionsJSON:r})).id,raw_id:i.rawId,response:{client_data_json:i.response.clientDataJSON,authenticator_data:i.response.authenticatorData,signature:i.response.signature,user_handle:i.response.userHandle},authenticator_attachment:i.authenticatorAttachment,client_extension_results:{app_id:i.clientExtensionResults.appid,cred_props:i.clientExtensionResults.credProps,hmac_create_secret:i.clientExtensionResults.hmacCreateSecret},type:i.type};Q.current?.resolve({mfaMethod:t,mfaCode:s,relyingParty:window.origin}),await new Promise((e,t)=>{X.current={resolve:e,reject:t}});break;default:throw Q.current?.reject(new nd.a("Unsupported MFA method")),new nd.a(`Unsupported MFA method: ${t}`)}},cancel(){Q.current?.reject(new nd.a("MFA canceled"))},async initEnrollmentWithSms(e){let t=await Ch();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.initEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber})},enrollInMfa:e=>new Promise((t,r)=>{e?(s.mfa.noPromptOnMfaRequired&&console.warn("[Privy Warning] Triggering the 'showMfaEnrollmentModal' function when 'noPromptOnMfaRequired' is set to true is unexpected. If this is intentional, ensure that you are building custom UIs for MFA verification."),K({mfaEnrollmentFlow:{mfaMethods:s.mfa.methods,shouldUnlinkOnUnenrollMfa:s.passkeys.shouldUnlinkOnUnenrollMfa,onSuccess:t,onFailure:r}}),eu("MfaEnrollmentFlowScreen")):(eP.closePrivyModal(),t())}),async initEnrollmentWithTotp(){let e=await Ch();if(!e||!q)throw Error("Must have valid access token to enroll in MFA");let t=await q.initEnrollMfa({method:"totp",accessToken:e});return{secret:t.secret,authUrl:t.authUrl}},async submitEnrollmentWithSms(e){let t=await Ch();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber,code:e.mfaCode}),xz(await r.getAuthenticatedUser())},async submitEnrollmentWithTotp(e){let t=await Ch();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"totp",accessToken:t,code:e.mfaCode}),xz(await r.getAuthenticatedUser())},async initEnrollmentWithPasskey(){},async submitEnrollmentWithPasskey({credentialIds:e},t={}){let i=await Ch();if(!i||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:e,removeForLogin:t.removeForLogin}),xz(await r.getAuthenticatedUser())},async unenroll(e,t={}){let i=await Ch();if(!i||!q)throw Error("Must have valid access token to remove MFA");"passkey"===e?await q.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:[],removeForLogin:t.removeForLogin}):await q.unenrollMfa({method:e,accessToken:i}),xz(await r.getAuthenticatedUser())},requestFarcasterSignerFromWarpcast:async()=>{let e=await Ch(),t=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!e)throw Error("Must have valid access token to connect with Farcaster");if(!q||!t)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,na.b)(t))throw new nd.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eP.recoverEmbeddedWallet({address:t.address}))throw Error("Unable to connect to wallet");let i=await q.initFarcasterSigner({address:t.address,hdWalletIndex:null,accessToken:e,mfaCode:null,mfaMethod:null,relyingParty:window.origin});"approved"===i.status&&xz(await r.getAuthenticatedUser()||g||null),K({farcasterSigner:i}),eu("FarcasterSignerStatusScreen")},getFarcasterSignerPublicKey:async()=>{let e,t=await Ch(),r=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!q||!r)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,na.b)(r))throw new nd.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eP.recoverEmbeddedWallet({address:r.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");return e=g.farcaster.signerPublicKey.slice(2),Uint8Array.from(e.match(/.{1,2}/g).map(e=>parseInt(e,16)))},signFarcasterMessage:async t=>{let r=await Ch(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!r)throw Error("Must have valid access token to connect with Farcaster");if(!q||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,na.b)(i))throw new nd.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eP.recoverEmbeddedWallet({address:i.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");let n=await e.A(629997),s=await q.signFarcasterMessage({address:i.address,hdWalletIndex:null,accessToken:r,mfaCode:null,mfaMethod:null,payload:{hash:n.bufferToBase64URLString(t)},fid:BigInt(g.farcaster.fid),relyingParty:window.origin});return new Uint8Array(n.base64URLStringToBuffer(s.signature))},signMessageWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return xT({user:g,client:r,address:t,requesterAppId:s.id,request:{method:n?"privy_signSmartWalletMessage":"personal_sign",params:[e,t],chainId:i},reconnect:eT})},signTypedDataWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t)),a=(0,nl.j)(e);return xT({user:g,client:r,address:t,requesterAppId:s.id,request:{method:n?"privy_signSmartWalletTypedData":"eth_signTypedData_v4",params:[t,a],chainId:i},reconnect:eT})},sendTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return xT({user:g,client:r,address:t,requesterAppId:s.id,request:{method:i?"privy_sendSmartWalletTx":"eth_sendTransaction",params:[e],chainId:e.chainId},reconnect:eT})},signTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return xT({user:g,client:r,address:t,requesterAppId:s.id,request:{method:i?"privy_signSmartWalletTx":"eth_signTransaction",params:[e],chainId:e.chainId},reconnect:eT})},isModalOpen:u||!!p,mfaMethods:s.mfa.methods};a=eC.signMessage,o=eC.signTypedData,c=async(e,t)=>await eE({transaction:e,...t,signOnly:!1}),l=async(e,t)=>({signature:(await eE({transaction:e,...t,signOnly:!0})).hash});let ex=async e=>{let t,i,n;S(!0),L({status:"loading"}),r.startAuthFlow(new CT({...e,customOAuthRedirectUrl:s.customOAuthRedirectUrl}));let a=nu.s.get(aY.S),o=e.stateCode;if(a!==o)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e.provider,storedStateCode:a??"",returnedStateCode:o??""}}),S(!1),new nd.a("Unexpected auth flow. This may be a phishing attempt.",void 0,nd.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{({user:t,oAuthTokens:n}=await r.link()),eo.current=e.provider;let i=eA(t);t&&i&&(0,o0.e)(ee,"linkAccount","onSuccess",{user:t,linkMethod:eo.current,linkedAccount:i})}catch(t){throw S(!1),(0,o0.e)(ee,"linkAccount","onError",t.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e.provider}),t}else try{({user:t,isNewUser:i,oAuthTokens:n}=await r.authenticate()),eo.current=e.provider;let s=eA(t);t&&s&&void 0!==i&&(0,o0.e)(ee,"login","onComplete",{user:t,isNewUser:i,wasAlreadyAuthenticated:!1,loginMethod:eo.current,loginAccount:s})}catch(e){throw S(!1),L({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}return xz(t),_(i||!1),ea(!0),S(!1),L({status:"done"}),n&&t&&(0,o0.e)(ee,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),t??void 0},eP={privy:i,setAuthenticated:ea,setUser:xz,setIsNewUser:_,isNewUserThisSession:b,pendingTransaction:null,walletConnectionStatus:k,setWalletConnectionStatus:T,connectors:r.connectors?.walletConnectors??[],rpcConfig:s.rpcConfig,chains:s.chains,appId:t.appId,showFiatPrices:"native-token"!==s.embeddedWallets.priceDisplay.primary,clientAnalyticsId:r.clientAnalyticsId,hideWalletUIs:ec,isHeadlessSigning:(0,W.useCallback)(ed,[s.embeddedWallets.showWalletUIs]),emailOtpState:P,setEmailOtpState:O,smsOtpState:R,setSmsOtpState:N,oAuthState:D,setOAuthState:L,telegramAuthState:B,setTelegramAuthState:F,siweState:M,setSiweState:U,isHeadlessOAuthLoading:A,baseAccountSdk:w,setBaseAccountSdk:v,nativeTokenSymbolForChainId:e=>s.chains.find(t=>t.id===Number(e))?.nativeCurrency.symbol,initializeWalletProxy:async e=>{if(q)return q;let t=new Promise(e=>{G.current=e}),r=new Promise(t=>setTimeout(()=>t(null),e)),i=await Promise.race([t,r]);return G.current=null,i},getAuthFlow:()=>r.authFlow,getAuthMeta:()=>r.authFlow?.meta,client:r,closePrivyModal:async(e={shouldCallAuthOnSuccess:!0,isSuccess:!1})=>{let i,a=f&&ei&&g;if(a&&eo.current&&(i=eA(g)),"login"===el.current)e.shouldCallAuthOnSuccess&&a&&eo.current?(0,o0.e)(ee,"login","onComplete",{user:g,isNewUser:b,wasAlreadyAuthenticated:!1,loginMethod:eo.current,loginAccount:i??null}):(0,o0.e)(ee,"login","onError",nd.b.USER_EXITED_AUTH_FLOW);else if("link"===el.current&&i)e.isSuccess&&a&&eo.current?(0,o0.e)(ee,"linkAccount","onSuccess",{user:g,linkMethod:eo.current,linkedAccount:i}):eo.current&&(0,o0.e)(ee,"linkAccount","onError",nd.b.USER_EXITED_LINK_FLOW,{linkMethod:eo.current});else if("update"===el.current&&i)e.isSuccess&&a&&eo.current?(0,o0.e)(ee,"update","onSuccess",{user:g,updateMethod:eo.current,updatedAccount:i}):eo.current&&(0,o0.e)(ee,"update","onError",nd.b.USER_EXITED_UPDATE_FLOW,{linkMethod:eo.current});else if("connect-or-create"===el.current){let e=xq.getState().ethereum;e[0]?(0,o0.e)(ee,"connectOrCreateWallet","onSuccess",{wallet:e[0]}):(0,o0.e)(ee,"connectOrCreateWallet","onError",nd.b.USER_EXITED_AUTH_FLOW)}let o=E&&xU.has(E),l="ErrorScreen"===E&&$.errorModalData&&xU.has($.errorModalData.previousScreen);if((o||l)&&$.funding){let e,r=xU.get(E)??null;if(l&&$.funding?.onError){let e=$.errorModalData?.error,t=e?.privyErrorCode||nd.b.UNKNOWN_FUNDING_ERROR,r=new nd.a(e?.message||"Funding failed",e,t);$.funding?.onError?.(r)}if("solana"===$.funding.chainType){let t=s.solanaRpcs[$.funding.chain];if(!t)return console.warn("Unable to load solana rpc, skipping balance"),(0,o0.e)(ee,"fundSolanaWallet","onUserExited",{address:$.funding.address,fundingMethod:r,chain:$.funding.chain,balance:e}),h(!1),void xN($.funding,r);if(n(oY.S))try{e=await xL({rpc:t.rpc,address:$.funding.address})}catch{console.error("Unable to pull wallet balance")}else console.warn("Unable to load solana plugin, skipping balance");(0,o0.e)(ee,"fundSolanaWallet","onUserExited",{address:$.funding.address,fundingMethod:r,chain:$.funding.chain,balance:e})}else{let i=(0,Ii.g)($.funding.chain.id,s.chains,s.rpcConfig,{appId:t.appId});try{e=await i.getBalance({address:$.funding.address})}catch{console.error("Unable to pull wallet balance")}(0,o0.e)(ee,"fundWallet","onUserExited",{address:$.funding.address,chain:$.funding.chain,fundingMethod:r,balance:e}),xN($.funding,r)}}K(e=>({...e,externalConnectWallet:{}})),el.current=null,eo.current=null,_(!1),h(!1),T({status:"disconnected",connectedWallet:null,connector:null,connectError:null,connectRetry:()=>{}}),setTimeout(()=>{r.authFlow=void 0},200)},openPrivyModal:eu,connectWallet:eg,initLoginWithWallet:async(e,t,r,i)=>{(0,nl.f)(e)?(eo.current="siwe",em(e,t,r)):(eo.current="siws",ew(e,t,r,i))},loginWithWallet:async()=>{let e,t,i;if(!f)throw new nd.g;if(r.authFlow instanceof CO?e="siwe":r.authFlow instanceof CR&&(e="siws"),!e)throw new nd.a("Must initialize SIWE/SIWS flow first.");if(null!==await r.getAccessToken())try{({user:t}=await r.link()),eo.current=e}catch(t){throw(0,o0.e)(ee,"linkAccount","onError",t.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{({user:t,isNewUser:i}=await r.authenticate()),eo.current=e}catch(e){throw(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.GENERIC_CONNECT_WALLET_ERROR),e}xz(t||g||null),_(i||!1),ea(!0)},delegateWallet:async({address:e,chainType:t,showDelegationUIs:r})=>new Promise(async(i,n)=>{let s=await Ch();if(!ei||!g||!s)throw new nd.a("User must be authenticated and have an embedded wallet to delegate actions.");if("solana"!==t&&"ethereum"!==t)throw new nd.a("Only Solana and Ethereum embedded wallets are supported for delegation and revocation.");let a=eP.walletProxy??await eP.initializeWalletProxy(15e3);if(!a)throw new nd.a("Wallet proxy not initialized.");if((({address:e,user:t})=>!!xE(t).find(t=>t.address===e))({address:e,user:g}))return i();let o=(0,na.h)(g,e);if(!o)throw new nd.a("Address to delegate is not associated with current user.");if((0,na.b)(o))throw new nd.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let l=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new nd.a("Address to delegate is not associated with current user.");if(!(0,nu.i)(r))throw new nd.a(`useDelegatedActions is not supported for ${r.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:r.address,chainType:r.chainType,walletIndex:r.walletIndex??0}})({address:e,user:g}),c=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new nd.a("Address to delegate is not associated with current user.");let i=r.imported?r:(0,na.g)(t);if(!i)throw new nd.a("Unable to determine root address for delegated address.");if(!(0,nu.i)(i))throw new nd.a(`useDelegatedActions is not supported for ${i.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:i.address,chainType:i.chainType,imported:i.imported}})({address:e,user:g}),d=async()=>{await a.createDelegatedAction({accessToken:s,rootWallet:c,delegatedWallets:[l]}),await eP.refreshSessionAndUser()};if(await eP.recoverEmbeddedWallet({address:e}),r)K({delegatedActions:{consent:{address:e,onDelegate:d,onSuccess:async()=>{i()},onError:async e=>{n(e)}}}}),eu("DelegatedActionsConsentScreen");else try{await d(),i()}catch(e){n(e)}}),revokeDelegatedWallets:async({showDelegationUIs:e})=>new Promise(async(t,i)=>{if(!ei||!g)throw new nd.a("User must be authenticated and have an embedded wallet to revoke a delegated wallet.");let n=xE(g);if(0===n.length)throw new nd.a("User has no delegated wallets to revoke.");if(n.some(na.b))throw new nd.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let s=async()=>{await r.revokeDelegatedWallet(),await eP.refreshSessionAndUser()};if(e)K({delegatedActions:{revoke:{onRevoke:s,onSuccess:async()=>{t()},onError:async e=>{i(e)}}}}),eu("DelegatedActionsRevokeScreen");else try{await s(),t()}catch(e){i(e)}}),initLoginWithFarcaster:async(e,t)=>{let i=new Cw(e,t);r.startAuthFlow(i);try{eo.current="farcaster",await i.initializeFarcasterConnect()}catch(e){throw"login"===el.current?(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR):"link"===el.current&&(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR,{linkMethod:"farcaster"}),e}},loginWithFarcaster:async()=>{let e,t;if(!f)throw new nd.g;if(!(r.authFlow instanceof Cw))throw new nd.a("Must initialize Farcaster flow first.");if(null!==await r.getAccessToken())try{({user:e}=await r.link()),eo.current="farcaster"}catch(e){throw(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"farcaster"}),e}else try{({user:e,isNewUser:t}=await r.authenticate()),eo.current="farcaster"}catch(e){throw(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}xz(e||null),_(t||!1),ea(!0)},async crossAppAuthFlow({appId:e,popup:t,action:i,disableSignup:n}){let s=`privy:${e}`;eo.current=s;let{url:a,stateCode:o,codeVerifier:l}=await async function({api:e,appId:t}){let r=CA(),i=CS(),n=await Ck(r);try{let{url:s}=await e.post(oI,{provider:`privy:${t}`,redirect_to:window.location.href,code_challenge:n,state_code:i});return{url:s,stateCode:i,codeVerifier:r}}catch(e){throw(0,nd.f)(e)}}({api:r.api,appId:e});if(!a)throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:"Unable to open cross-app auth popup",appId:e}}),new nd.a("No authorization URL returned for cross-app auth.");try{let c=await async function({url:e,popup:t}){return t.location=e,new Promise((e,r)=>{let i,n=setTimeout(()=>{r(new nd.a("Authorization request timed out after 2 minutes.")),s()},12e4);function s(){t?.close(),window.removeEventListener("message",o)}let a=setInterval(()=>{t?.closed&&!i&&(s(),clearInterval(a),clearTimeout(n),r(new nd.a("User rejected request")))},300);function o(t){t.data&&("PRIVY_OAUTH_RESPONSE"===t.data.type&&t.data.stateCode&&t.data.authorizationCode&&(clearTimeout(n),e(t.data),s()),"PRIVY_OAUTH_ERROR"===t.data.type&&(clearTimeout(n),r(new nd.a(t.data.error)),s()),t.data.type===xA&&((i=new BroadcastChannel(xI)).onmessage=o))}window.addEventListener("message",o)})}({url:a,popup:t,provider:s}),d=c.stateCode,u=c.authorizationCode;if(d!==o)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:s,storedStateCode:o??"",returnedStateCode:d??""}}),new nd.a("Unexpected auth flow. This may be a phishing attempt.",void 0,nd.b.OAUTH_UNEXPECTED);let h=await async function({appId:e,stateCode:t,codeVerifier:r,authorizationCode:i,action:n,client:s,disableSignup:a}){if(!i||!t)throw new nd.a("[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===i)throw new nd.a("User denied confirmation during cross-app auth flow");try{let o=new xS({authorizationCode:i,stateCode:t,codeVerifier:r,provider:`privy:${e}`,disableSignup:!!a});s.startAuthFlow(o);let l="link"===n?await s.link():await s.authenticate(),c=l.oAuthTokens?.accessToken;return console.debug(),c}catch(t){let e=(0,nd.f)(t);if(e.privyErrorCode===nd.b.ACCOUNT_TRANSFER_REQUIRED)throw e;if(e.privyErrorCode)throw new nd.a(e.message||"Invalid code during cross-app auth flow.",void 0,e.privyErrorCode);if("User denied confirmation during cross-app auth flow"===e.message)throw new nd.a("Invalid code during cross-app auth flow.",void 0,nd.b.OAUTH_USER_DENIED);throw new nd.a("Invalid code during cross-app auth flow.",void 0,nd.b.UNKNOWN_AUTH_ERROR)}}({appId:e,codeVerifier:l,stateCode:d,authorizationCode:u,action:i,client:r,disableSignup:n});h&&r.storeProviderAccessToken(e,h);let p=await eP.refreshSessionAndUser();if(!p)throw new nd.a("Unable to update user");return r.createAnalyticsEvent({eventName:"cross_app_auth_completed",payload:{providerAppId:e}}),p}catch(e){throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:e.toString(),provider:s}}),e}},async initLoginWithOAuth(e,t,i){if(eo.current=e,!(0,nu.b)()||"google"===e&&!s.allowOAuthInEmbeddedBrowsers&&xD(window.navigator.userAgent))return void eu("InAppBrowserLoginNotPossible");"twitter"===e&&window.opener&&window.opener.postMessage({type:xA},"*"),nu.s.del(aY.H),nu.s.del(aY.O);let n=new CT({provider:e,disableSignup:!!i,withPrivyUi:!0,customOAuthRedirectUrl:s.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),r.startAuthFlow(n);let a=await r.authFlow.getAuthorizationUrl();if(a&&a.url)if("twitter"===e&&aQ.isAndroid&&(a.url=a.url.replace("x.com","twitter.com")),"chrome-extension:"===window.location.protocol&&C_())try{let{privyOAuthCode:e,privyOAuthState:t}=await CE(a.url);eu("OAuthStatusScreen"),n.meta.stateCode=t,n.meta.authorizationCode=e}catch(e){throw console.error("OAuth in chrome extension flow failed:",e),e}else window.location.assign(a.url)},async initLoginWithTelegram(e,t){if(!f)throw new nd.g;eo.current="telegram";let i=new CW(e,t);r.startAuthFlow(i),F({status:"loading"}),i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=await new Promise((e,t)=>s.loginConfig.telegramAuthConfiguration?window.Telegram?void window.Telegram.Login.auth({bot_id:s.loginConfig.telegramAuthConfiguration.botId,request_access:!0},r=>r?e(r):("link"===el.current?(0,o0.e)(ee,"linkAccount","onError",nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}):"login"===el.current?(0,o0.e)(ee,"login","onError",nd.b.INVALID_CREDENTIALS):"update"===el.current&&(0,o0.e)(ee,"login","onError",nd.b.FAILED_TO_UPDATE_ACCOUNT),t(new nd.a("Telegram auth failed or was canceled by the client")))):t(new nd.a("Telegram was not initialized")):t(new nd.a("Telegram Auth configuration is not loaded")))},async loginWithTelegram(e){let t,i;if(!(r.authFlow instanceof CW))throw new nd.a("Must initialize Telegram flow before calling loginWithTelegram");r.authFlow.meta.captchaToken||=e?.captchaToken;let n=await Ch(),s=e?.intent||el.current;if("login"===s)try{let e=await r.authenticate();t=e.user,i=e.isNewUser,eo.current="telegram"}catch(e){throw(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}else{if("link"!==s)throw new nd.a("Unknown auth intent");try{t=(await r.link()).user,eo.current="telegram"}catch(e){throw(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}),e}}xz(t),_(i||!1),ea(!0),F({status:"done"});let a=t?.linkedAccounts.find(({type:e})=>"telegram"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:a}},async loginWithOAuth(e){let t,i,n;if(!(r.authFlow instanceof CT))throw new nd.a("Must initialize OAuth flow before calling loginWithOAuth");let s=nu.s.get(aY.S),a=r.authFlow.meta.stateCode;if(s!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e,storedStateCode:s??"",returnedStateCode:a??""}}),new nd.a("Unexpected auth flow. This may be a phishing attempt.",void 0,nd.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{let i=await r.link();t=i.user,n=i.oAuthTokens,eo.current=e}catch(t){throw(0,o0.e)(ee,"linkAccount","onError",t.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{let s=await r.authenticate();t=s.user,i=s.isNewUser,n=s.oAuthTokens,eo.current=e}catch(t){throw"login"===el.current?(0,o0.e)(ee,"login","onError",t.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR):"link"===el.current&&(0,o0.e)(ee,"linkAccount","onError",t.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}return xz(t),_(i||!1),ea(!0),n&&t&&(0,o0.e)(ee,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),n},passkeyAuthState:C,setPasskeyAuthState:x,async initSignupWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new Cx({captchaToken:e,setPasskeyAuthState:x,hints:s.passkeys.registration?.hints});r.startAuthFlow(i),el.current="login";try{eo.current="passkey",x({status:"generating-challenge"}),await i.initRegisterFlow(t),x({status:"awaiting-passkey"})}catch(e){throw x({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}},async signupWithPasskey(){let e,t;if(!f)throw new nd.g;if(!(r.authFlow instanceof Cx))throw new nd.a("Must initialize Passkey flow first.");if("passkey"!==eo.current){let e=new nd.a("Must init login with Passkey flow first.");throw x({status:"error",error:e}),e}let i=await Ch();try{eo.current="passkey",x({status:"awaiting-passkey"}),{user:e,isNewUser:t}=await r.authenticate()}catch(e){throw x({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}xz(e),_(t||!1),ea(!0),x({status:"done"});let n=e?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:e,isNewUser:t||!1,wasAlreadyAuthenticated:!!i,loginAccount:n}},async initLoginWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new Cx({captchaToken:e,setPasskeyAuthState:x,hints:void 0});r.startAuthFlow(i),el.current="login";try{eo.current="passkey",x({status:"generating-challenge"}),await i.initAuthenticationFlow(t),x({status:"awaiting-passkey"})}catch(e){throw x({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}},async loginWithPasskey(e){let t,i;if(!f)throw new nd.g;if(!(r.authFlow instanceof Cx))throw new nd.a("Must initialize Passkey flow first.");if(e?.credentialIds&&(r.authFlow.meta.allowedCredentialsIds=e.credentialIds),"passkey"!==eo.current){let e=new nd.a("Must init login with Passkey flow first.");throw x({status:"error",error:e}),e}let n=await Ch();try{eo.current="passkey",x({status:"awaiting-passkey"}),{user:t,isNewUser:i}=await r.authenticate()}catch(e){throw x({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}xz(t),_(i||!1),ea(!0),x({status:"done"});let s=t?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:s}},async initLinkWithPasskey(e){let t=new Cx({captchaToken:e,hints:s.passkeys.registration?.hints});r.startAuthFlow(t),el.current="link",eo.current="passkey",x({status:"generating-challenge"});try{await t.initLinkFlow(),x({status:"awaiting-passkey"})}catch(e){throw(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR,{linkMethod:"passkey"}),x({status:"error",error:e}),e}},async linkWithPasskey(){let e;if(!f)throw new nd.g;if(!(r.authFlow instanceof Cx))throw new nd.a("Must initialize Passkey flow first.");if("passkey"!==eo.current)throw new nd.a("Must init login with Passkey flow first.");try{eo.current="passkey",{user:e}=await r.link()}catch(e){throw(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"passkey"}),e}return xz(e||g||null),x({status:"done"}),e},async initLoginWithHeadlessOAuth(e,t,i){if(!(0,nu.b)()||"google"===e&&!s.allowOAuthInEmbeddedBrowsers&&xD(window.navigator.userAgent))throw Error("It looks like you're using an in-app browser.  To log in, please try again using an external browser.");let n=new CT({provider:e,withPrivyUi:!1,disableSignup:i??!1,customOAuthRedirectUrl:s.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),L({status:"loading"});let a=await r.startAuthFlow(n).getAuthorizationUrl();if(a?.url)if("chrome-extension:"===window.location.protocol&&C_())try{let{privyOAuthCode:e,privyOAuthState:t}=await CE(a.url);n.meta.stateCode=t,n.meta.authorizationCode=e,await ex(n.meta)}catch(e){throw L({status:"error",error:e}),e}else window.location.assign(a.url)},loginWithHeadlessOAuth:ex,initLoginWithEmail:async({email:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{let s=new Cy({email:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{eo.current="email",O({status:"sending-code"});let e=await s.sendCodeEmail({withPrivyUi:n});if(e?.ssoRedirectUrl)return window.location.href=e.ssoRedirectUrl,void await (0,nl.k)(1e4);O({status:"awaiting-code-input"})}catch(e){throw O({status:"error",error:e}),"login"===el.current?(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR):"link"===el.current&&(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"email"}),e}},initUpdateEmail:async({oldAddress:e,newAddress:t,captchaToken:i})=>{let n=new Cg(e,t,i);r.startAuthFlow(n);try{await n.sendCodeEmail({withPrivyUi:!0})}catch(e){throw(0,o0.e)(ee,"update","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR,{linkMethod:eo.current}),e}},initUpdatePhone:async(e,t,i)=>{let n=new CM(e,t,i);r.startAuthFlow(n);try{await n.sendSmsCode({withPrivyUi:!0})}catch(e){(0,o0.e)(ee,"update","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR,{linkMethod:eo.current})}},initLoginWithSms:async({phoneNumber:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{N({status:"sending-code"});let s=new CN({phoneNumber:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{eo.current="sms",await s.sendSmsCode({withPrivyUi:n}),N({status:"awaiting-code-input"})}catch(e){throw N({status:"error",error:e}),"login"===el.current?(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR):"link"===el.current&&(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"sms"}),e}},resendEmailCode:async()=>{await r.authFlow?.sendCodeEmail({withPrivyUi:!0})},resendSmsCode:async()=>{await r.authFlow?.sendSmsCode({withPrivyUi:!0})},loginWithCode:async e=>{let t,i;function n(e){r.authFlow instanceof Cy?O(e):r.authFlow instanceof CN&&N(e)}if(n({status:"submitting-code"}),!f){let e=new nd.g;throw n({status:"error",error:e}),e}if(r.authFlow instanceof Cy)r.authFlow.meta.emailCode=e.trim();else{if(!(r.authFlow instanceof CN)){let e=new nd.a("Must initialize a passwordless code flow first");throw n({status:"error",error:e}),e}r.authFlow.meta.smsCode=e.trim()}let s=await Ch();if("link"===el.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:eo.current}),e}else if("update"===el.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,o0.e)(ee,"update","onError",e.privyErrorCode||nd.b.FAILED_TO_UPDATE_ACCOUNT,{linkMethod:eo.current}),e}else try{({user:t,isNewUser:i}=await r.authenticate())}catch(e){throw n({status:"error",error:e}),(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),e}let a=t||g;xz(a||null),_(i||!1),ea(!0),n({status:"done"});let o=null;return r.authFlow instanceof Cy?o=a?.linkedAccounts.find(({type:e})=>"email"===e)||null:r.authFlow instanceof CN&&(o=a?.linkedAccounts.find(({type:e})=>"phone"===e)||null),{user:a,isNewUser:i||!1,wasAlreadyAuthenticated:!!s,linkedAccount:o}},generateSiweMessage:async({address:e,chainId:t,captchaToken:i})=>{el.current=ei?"link":"login",eo.current="siwe",U({status:"generating-message"});let n=await r.generateSiweNonce({address:e,captchaToken:i});return U({status:"awaiting-signature"}),CP({address:e,chainId:t.replace("eip155:",""),nonce:n})},generateSiweMessageForSmartWallet:async({address:e,chainId:t})=>{let i=await r.generateSiweNonce({address:e});return CP({address:e,chainId:t.replace("eip155:",""),nonce:i})},linkSmartWallet:async({message:e,signature:t,smartWalletType:i,smartWalletVersion:n})=>{let s;s=await r.linkSmartWallet({message:e,signature:t,smartWalletType:i,smartWalletVersion:n}),xz((s=await eP.refreshSessionAndUser()??s)||g||null)},loginWithSiwe:async({message:e,signature:t,captchaToken:i,disableSignup:n,walletClientType:s,connectorType:a})=>{let o,l=null;try{if(g)throw Error("User already authenticated");let c=new CO(r,void 0,i,n,{message:e,signature:t,walletClientType:s,connectorType:a});r.startAuthFlow(c),eo.current="siwe",el.current="login",U({status:"submitting-signature"});let d=await r.authenticate();if({user:l,isNewUser:o}=d,!l)throw Error("Authentication failed - no user returned")}catch(e){throw(0,o0.e)(ee,"login","onError",e.privyErrorCode||nd.b.UNKNOWN_AUTH_ERROR),U({status:"error",error:e}),e}return xz(l),_(o||!1),ea(!0),U({status:"done"}),el.current=null,eo.current=null,{user:l,isNewUser:o||!1}},linkWithSiwe:async({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s})=>{let a;eb("siwe");let o=null;try{U({status:"submitting-signature"}),a=await r.linkWithSiwe({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s}),a=await eP.refreshSessionAndUser()??a,U({status:"done"}),(o=eA(a)||null)&&(0,o0.e)(ee,"linkAccount","onSuccess",{user:a,linkMethod:"siwe",linkedAccount:o})}catch(e){throw(0,o0.e)(ee,"linkAccount","onError",e.privyErrorCode||nd.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"siwe"}),el.current=null,eo.current=null,U({status:"error",error:e}),e}let l=a||g;return xz(l||null),el.current=null,eo.current=null,{user:l,linkedAccount:o}},refreshSessionAndUser:async()=>{let e=await r.getAuthenticatedUser();return ea(!!e),xz(e),e},walletProxy:q,createAnalyticsEvent:({eventName:e,payload:t,timestamp:i})=>r.createAnalyticsEvent({eventName:e,payload:t,timestamp:i}),acceptTerms:async()=>{let e=await r.acceptTerms();return xz(e),e},getUsdTokenPrice:e=>r.getUsdTokenPrice(e),getUsdPriceForSol:()=>r.getUsdPriceForSol(),getSplTokenMetadata:e=>r.getSplTokenMetadata(e),recoverEmbeddedWallet:async e=>new Promise(async(t,i)=>{if(!g)return void t(!0);let n=e?.address?(0,na.h)(g,e.address):(0,na.g)(g)||(0,na.f)(g).at(0)||(0,na.k)(g).at(0);if(!n||(0,na.b)(n))return void t(!0);let s=await Ch();if(!s||!q||!n)return void i(Error("Must have valid access token and Privy wallet to recover wallet"));let{entropyId:a,entropyIdVerifier:o}=(0,nc.g)(g,n);try{await q.connect({accessToken:s,entropyId:a,entropyIdVerifier:o}),t(!0)}catch(e){if(xo(e)&&"privy"===n.recoveryMethod){let e;r.createAnalyticsEvent({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:n.address}});try{e=await q.recover({entropyId:a,entropyIdVerifier:o,accessToken:s})}catch(e){return void i(e)}e.entropyId||i(Error("Unable to recover wallet")),r.createAnalyticsEvent({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:n.address}}),t(!0)}else xo(e)&&"privy"!==n.recoveryMethod&&"privy-v2"!==n.recoveryMethod?(K(e=>({...e,recoverWallet:{entropyId:a,entropyIdVerifier:o,onFailure:i,onSuccess:()=>{t(!0)},onCompleteNavigateTo:e.createWallet?"EmbeddedWalletOnAccountCreateScreen":void 0},recoveryOAuthStatus:{provider:n.recoveryMethod,action:"recover",shouldCreateEth:!1,shouldCreateSol:!1,isInAccountCreateFlow:!!e.createWallet}})),eu(xR(n.recoveryMethod))):i(e)}}),setReadyToTrue:e=>{y(!0),V?.(e)},updateWallets:()=>e_(),fundWallet:async(e,t)=>{let r="FundingMethodSelectionScreen";return new Promise((i,n)=>{K({funding:{...(0,nu.p)({address:e,appConfig:s,fundWalletConfig:t,methodScreen:r,onComplete:i,onError:n})}}),eu(r)})},openModal:eu,requestFarcasterSignerStatus:async e=>{let t=await Ch(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!q||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");let n=await r.requestFarcasterSignerStatus(e);return"approved"===n.status&&xz(await r.getAuthenticatedUser()||g||null),n},connectCoinbaseSmartWallet:async()=>{s.externalWallets.coinbaseWallet.config.preference={...s.externalWallets.coinbaseWallet.config.preference,options:"smartWalletOnly"};let e=r.connectors?.findWalletConnector("coinbase_wallet","coinbase_smart_wallet")||r.connectors?.findWalletConnector("coinbase_wallet","coinbase_wallet");if(e)return e.updateConnectionPreference("smartWalletOnly"),eg(e);await ey("coinbase_wallet","coinbase_smart_wallet")},connectBaseAccount:async()=>{let e=r.connectors?.findWalletConnector("base_account","base_account");if(e)return eg(e);await ey("base_account","base_account")},initiateAccountTransfer:async({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l})=>{let c=await r.sendAccountTransferRequest({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l});return xz(c),c},inProgressAuthFlowRef:el,inProgressLoginOrLinkMethodRef:eo};d=eP.recoverEmbeddedWallet,eP.recoverEmbeddedWallet;let eO=(0,W.useMemo)(()=>({wallets:m,ready:Z&&et}),[m,Z,et]),eR=r.authFlow instanceof CW,{siteKey:eN,enabledProvider:eM}=s.captcha,eU=!s.headless&&eM&&!ei&&(f||eR);return(0,j.jsx)(xX.Provider,{value:!0,children:(0,j.jsx)(na.P.Provider,{value:eC,children:(0,j.jsx)(o0.P.Provider,{value:ee,children:(0,j.jsx)(nc.U.Provider,{value:eO,children:(0,j.jsx)(CL,{appId:s.id,captchaSiteKey:eN,enabledCaptchaProvider:eM,children:(0,j.jsxs)(nd.I.Provider,{value:eP,children:[(0,j.jsx)(nl.R,{children:(0,j.jsxs)(na.M,{data:$,setModalData:K,setInitialScreen:I,initialScreen:E,authenticated:ei,open:u,children:[t.children,(0,j.jsx)(xQ,{customAuth:s.customAuth}),eU&&(0,j.jsx)(C$,{delayedExecution:!1}),(0,j.jsx)(xr,{}),(0,j.jsx)(xF,{disabled:s.embeddedWallets.disableAutomaticMigration}),(0,j.jsx)(CJ,{palette:s.appearance.palette||{}}),!s.render.standalone&&(0,j.jsx)(C6,{open:u})]})}),(0,j.jsx)(x_,{appId:t.appId,appClientId:t.clientId,clientAnalyticsId:r.clientAnalyticsId,origin:r.apiUrl,mfaMethods:g?.mfaMethods,mfaPromise:Q,mfaSubmitPromise:X,onLoad:H,onLoadFailed:()=>null}),s.loginConfig.telegramAuthConfiguration&&(0,j.jsx)(nl.H,{$if:!0,children:(0,j.jsx)(xt,{scriptHost:t.apiUrl||aY.D,botUsername:s.loginConfig.telegramAuthConfiguration.botName})})]})})})})})})};class x1 extends Error{constructor(e,t,r){super(e),this.code=t,this.data=r}}class x2 extends no.default{async handleSendTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new x1(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await Ch()||!this.address)throw new x1("Disconnected",4900);let{hash:i}=await (t={address:this.address},c(r,t));return i}async handleSignTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new x1(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await Ch()||!this.address)throw new x1("Disconnected",4900);let{signature:i}=await (t={address:this.address},l(r,t));return i}handleSwitchEthereumChain(e){let t;if(!e.params||!Array.isArray(e.params))throw new x1(`Invalid params for ${e.method}`,4200);if("string"==typeof e.params[0])t=e.params[0];else{if(!("chainId"in e.params[0])||"string"!=typeof e.params[0].chainId)throw new x1(`Invalid params for ${e.method}`,4200);t=e.params[0].chainId}this.chainId=Number(t),this.publicClient=(0,Ii.g)(this.chainId,this.chains,this.rpcConfig,{appId:this.appId}),this.emit("chainChanged",t)}async handlePersonalSign(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for personal_sign");let t=e.params[0],r=e.params[1],{signature:i}=await a({message:t},{address:r});return i}async handleSignedTypedData(e){let t;if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_signTypedData_v4");let r=e.params[0],i="string"==typeof e.params[1]?JSON.parse(e.params[1]):e.params[1],{signature:n}=await (t=(0,nl.j)(i),o(t,{address:r}));return n}async handleEstimateGas(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_estimateGas");delete e.params[0].gasPrice,delete e.params[0].maxFeePerGas,delete e.params[0].maxPriorityFeePerGas;let t={...e.params[0],chainId:(0,nl.t)(this.chainId)};return await this.publicClient.estimateGas({account:t.from??this.address,...ec(t)})}async request(e){let t;switch(console.debug("Embedded1193Provider.request() called with args",e),e.method){case"eth_accounts":case"eth_requestAccounts":return this.address?[this.address]:[];case"eth_chainId":return(0,nl.t)(this.chainId);case"eth_estimateGas":return this.handleEstimateGas(e);case"eth_sendTransaction":return this.handleSendTransaction(e);case"eth_signTransaction":return this.handleSignTransaction(e);case"wallet_switchEthereumChain":return this.handleSwitchEthereumChain(e);case"personal_sign":return this.handlePersonalSign(e);case"eth_signTypedData_v4":return this.handleSignedTypedData(e)}if(t=e.method,!Cp.includes(t))return this.publicClient.request({method:e.method,params:e.params});{let t,r=await Ch();if(await (t={address:this.address},d(t)),!r||!this.address)throw new x1("Disconnected",4900);try{let t={method:e.method,params:e.params},i=this.walletAccount;return i&&(0,na.b)(i)?this.handleWalletApiRequest(t,i,r):(await this.walletProxy.rpc({accessToken:r,entropyId:this.entropyId,entropyIdVerifier:this.entropyIdVerifier,chainType:"ethereum",hdWalletIndex:this.walletIndex,request:t})).response.data}catch(e){throw console.error(e),new x1("Disconnected",4900)}}}async handleWalletApiRequest(e,t,r){let i=this.privyClient;if(!i)throw new x1("Disconnected",4900);if("secp256k1_sign"===e.method){let n=await (0,ep.rpc)(i,async({message:e})=>this.walletProxy.signWithUserSigner({accessToken:r,message:e}),{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:t.id,params:{hash:e.params[0]}});if("secp256k1_sign"!==n.method)throw new x1(`Invalid params for ${e.method}`,4200);return n.data.signature}throw new x1(`Method not supported: ${e.method}`,4200)}constructor({walletProxy:e,address:t,entropyId:r,entropyIdVerifier:i,rpcConfig:n,chains:s,appId:a,chainId:o=1,walletIndex:l,privyClient:c,walletAccount:d}){super(),this.walletProxy=e,this.address=t,this.entropyId=r,this.entropyIdVerifier=i,this.chainId=o,this.rpcConfig=n,this.chains=s,this.publicClient=(0,Ii.g)(o,this.chains,n,{appId:a}),this.rpcTimeoutDuration=(0,nl.c)(n,"privy"),this.appId=a,this.walletIndex=l,this.privyClient=c,this.walletAccount=d}}let x5=({style:e,...t})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",style:{...e},...t,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"})}),x3=({style:e,...t})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"108",height:"108",viewBox:"0 0 108 108",fill:"none",style:{height:"28px",width:"28px",...e},...t,children:[(0,j.jsx)("rect",{width:"108",height:"108",rx:"23",fill:"#AB9FF2"}),(0,j.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46.5267 69.9229C42.0054 76.8509 34.4292 85.6182 24.348 85.6182C19.5824 85.6182 15 83.6563 15 75.1342C15 53.4305 44.6326 19.8327 72.1268 19.8327C87.768 19.8327 94 30.6846 94 43.0079C94 58.8258 83.7355 76.9122 73.5321 76.9122C70.2939 76.9122 68.7053 75.1342 68.7053 72.314C68.7053 71.5783 68.8275 70.7812 69.0719 69.9229C65.5893 75.8699 58.8685 81.3878 52.5754 81.3878C47.993 81.3878 45.6713 78.5063 45.6713 74.4598C45.6713 72.9884 45.9768 71.4556 46.5267 69.9229ZM83.6761 42.5794C83.6761 46.1704 81.5575 47.9658 79.1875 47.9658C76.7816 47.9658 74.6989 46.1704 74.6989 42.5794C74.6989 38.9885 76.7816 37.1931 79.1875 37.1931C81.5575 37.1931 83.6761 38.9885 83.6761 42.5794ZM70.2103 42.5795C70.2103 46.1704 68.0916 47.9658 65.7216 47.9658C63.3157 47.9658 61.233 46.1704 61.233 42.5795C61.233 38.9885 63.3157 37.1931 65.7216 37.1931C68.0916 37.1931 70.2103 38.9885 70.2103 42.5795Z",fill:"#FFFDF8"})]});function x8(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var x4=0;class x6 extends nl.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return{name:this.providerDetail.info.name,icon:this.providerDetail.info.icon,id:this.providerDetail.info.rdns}}disconnect(){console.warn(`Programmatic disconnect with ${this.providerDetail.info.name} is not yet supported.`)}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new nd.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,nu.f)(e)}}constructor(e,t,r,i,n){super(n||"unknown",e,t,r),this.connectorType="injected",this.proxyProvider=new nl.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.providerDetail=i;let s=i.provider;this.proxyProvider.setWalletProvider(s)}}var x9="__private_"+x4+++"__walletBranding";class x7 extends nl.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return x8(this,x9)[x9]??{name:"Browser Extension",icon:x5,id:"extension"}}disconnect(){console.warn("Programmatic disconnect with browser wallets is not yet supported.")}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new nd.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,nu.f)(e)}}constructor(e,t,r,i,n){super(n??"unknown",e,t,r),Object.defineProperty(this,x9,{writable:!0,value:void 0}),this.connectorType="injected",this.proxyProvider=new nl.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.proxyProvider.setWalletProvider(i),"metamask"===n?x8(this,x9)[x9]={name:"MetaMask",icon:nl.M,id:"io.metamask"}:"phantom"===n&&(x8(this,x9)[x9]={name:"Phantom",icon:x3,id:"phantom"})}}class Pe extends x6{disconnect(){console.warn("MetaMask does not support programmatic disconnect.")}async promptConnection(){try{aQ.isMobile||await this.proxyProvider.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new nd.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,nu.f)(e)}}}class Pt extends no.default{get wallets(){let e=new Set;return this.walletConnectors.flatMap(e=>e.wallets).sort((e,t)=>e.connectedAt&&t.connectedAt?t.connectedAt-e.connectedAt:0).filter(t=>{let r=`${t.address}${t.walletClientType}${t.connectorType}${t.meta.id}`;return!e.has(r)&&(e.add(r),!0)})}async initialize(e){if(this.initialized&&!e||(e&&this.removeAllConnectors(),this.externalWalletConfig.disableAllExternalWallets))return;let t=(0,nl.o)({store:this.store,walletList:this.walletList,externalWalletConfig:this.externalWalletConfig,walletChainType:this.walletChainType}).then(e=>{e.forEach(({type:e,eip6963InjectedProvider:t,legacyInjectedProvider:r})=>{this.createEthereumWalletConnector({connectorType:"injected",walletClientType:e,providers:{eip6963InjectedProvider:t,legacyInjectedProvider:r}})})});for(let e of(this.walletList.includes("coinbase_wallet")&&this.createEthereumWalletConnector({connectorType:"coinbase_wallet",walletClientType:"coinbase_wallet"}),this.walletList.includes("base_account")&&this.createEthereumWalletConnector({connectorType:"base_account",walletClientType:"base_account"}),Object.values(nl.q)))!e.isInstalled&&this.walletList.includes(e.client)&&(["ethereum-only","ethereum-and-solana"].includes(this.walletChainType)&&e.chainTypes.includes("ethereum")&&this.createEthereumWalletConnector({connectorType:"null",walletClientType:e.client,walletConfig:e}),["ethereum-and-solana","solana-only"].includes(this.walletChainType)&&e.chainTypes.includes("solana")&&this.addSolanaWalletConnector(new nl.S({id:e.client,name:e.name})));this.externalWalletConfig.walletConnect.enabled&&(this.walletList.includes("wallet_connect_qr")||(0,nl.e)(this.walletList))&&"solana-only"!==this.walletChainType&&this.createEthereumWalletConnector({connectorType:"wallet_connect_v2",walletClientType:"unknown"});let r=this.walletList.includes("wallet_connect_qr_solana")||(0,nl.e)(this.walletList)&&"ethereum-only"!==this.walletChainType,i=this.externalWalletConfig.solana.connectors?.get()||[],n=async e=>{if(!r)return;let t=e.find(e=>"walletconnect_solana"===e.walletBranding?.id);t&&t.wallet&&await t.wallet.initialize({walletConnectCloudProjectId:this.walletConnectCloudProjectId,privyAppName:this.privyAppName})};n(i),i.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector),this.externalWalletConfig.solana.connectors?._setOnConnectorsUpdated?.(e=>{n(e),e?.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector)}),await t,this.initialized=!0}findWalletConnector(e,t,r){return"wallet_connect_v2"===e?this.walletConnectors.filter(nl.r).find(t=>t.connectorType===e&&(!r||t.wallets.some(e=>e.address===r)))??null:this.walletConnectors.filter(nl.r).find(i=>i.connectorType===e&&i.walletClientType===t&&(!r||i.wallets.some(e=>e.address===r)))??null}findSolanaWalletConnector(e){return this.walletConnectors.filter(nl.v).find(t=>"unknown"===t.walletClientType?t.walletBranding.id===e:t.walletClientType===e)??null}findEmbeddedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded"===e.connectorType)}findImportedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded_imported"===e.connectorType)}onInitialized(e){e.wallets.forEach(e=>{let t=this.storedConnections.find(t=>t.address===e.address&&t.connectorType===e.connectorType&&("solana"===e.type&&"unknown"===t.walletClientType&&"unknown"===e.walletClientType?e.meta.id===t.id:t.walletClientType===e.walletClientType));t&&(e.connectedAt=t.connectedAt)}),this.emit("walletsUpdated"),this.emit("connectorInitialized")}onWalletsUpdated(e){e.initialized&&this.emit("walletsUpdated")}addEmbeddedWalletConnectors({walletProxy:e,user:t,embeddedWallets:r,defaultChain:i,appId:n,privyClient:s}){let{entropyId:a,entropyIdVerifier:o}=(0,nc.g)(t);for(let t of r){let r=this.findEmbeddedWalletConnectors().find(e=>e.walletIndex===t.walletIndex);if(r&&(0,nl.r)(r))r.proxyProvider.walletProxy=e;else{let r=new Cu({provider:new x2({walletProxy:e,address:t.address,entropyId:a,entropyIdVerifier:o,rpcConfig:this.rpcConfig,chains:this.chains,appId:n,chainId:i.id,walletIndex:t.walletIndex,privyClient:s,walletAccount:t}),chains:this.chains,defaultChain:i,rpcConfig:this.rpcConfig,imported:!1,walletIndex:t.walletIndex});this.addWalletConnector(r)}}}addImportedWalletConnector(e,t,r,i){let n=this.findWalletConnector("embedded_imported","privy",t);if(n&&(0,nl.r)(n))n.proxyProvider.walletProxy=e;else{let n=new Cu({provider:new x2({walletProxy:e,address:t,entropyId:t,entropyIdVerifier:"ethereum-address-verifier",walletIndex:0,rpcConfig:this.rpcConfig,chains:this.chains,appId:i,chainId:r.id}),chains:this.chains,walletIndex:0,defaultChain:r,rpcConfig:this.rpcConfig,imported:!0});this.addWalletConnector(n)}}removeEmbeddedWalletConnectors(){this.walletConnectors=this.walletConnectors.filter(e=>"embedded"!==e.connectorType),this.storedConnections=(0,nu.l)(),this.emit("walletsUpdated")}removeImportedWalletConnectors(){let e=this.findImportedWalletConnectors();e.length&&(e.forEach(e=>{let t=this.walletConnectors.indexOf(e);this.walletConnectors.splice(t,1)}),this.storedConnections=(0,nu.l)(),this.emit("walletsUpdated"))}async createEthereumWalletConnector({connectorType:e,walletClientType:t,providers:r,walletConfig:i}){let n=this.findWalletConnector(e,t);if(n&&(0,nl.r)(n))return n instanceof xi&&n.resetConnection(t),n;let s="injected"!==e?"coinbase_wallet"===e?new Cc(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.coinbaseWallet.config):"base_account"===e?new Co(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.baseAccount.config,this.setBaseAccountSdk):"null"!==e?new xi({walletConnectCloudProjectId:this.walletConnectCloudProjectId,rpcConfig:this.rpcConfig,chains:this.chains,defaultChain:this.defaultChain,shouldEnforceDefaultChainOnConnect:this.shouldEnforceDefaultChainOnConnect,privyAppId:this.privyAppId,privyAppName:this.privyAppName,walletClientType:t}):i?new nl.w({id:i.client,name:i.name,defaultChain:this.defaultChain,walletClientType:i.client}):null:"metamask"===t&&r?.eip6963InjectedProvider?new Pe(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,"metamask"):"metamask"===t&&r?.legacyInjectedProvider?new x7(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"metamask"):"phantom"===t&&r?.legacyInjectedProvider?new x7(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"phantom"):r?.legacyInjectedProvider&&"unknown_browser_extension"===t?new x7(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider):r?.eip6963InjectedProvider?new x6(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,t):void 0;return s&&this.addWalletConnector(s),s||null}addWalletConnector(e){this.walletConnectors.push(e),e.on("initialized",()=>this.onInitialized(e)),e.on("walletsUpdated",()=>this.onWalletsUpdated(e)),e.initialize().catch(e=>{console.debug("Failed to initialize connector",e)})}setWalletList(e){this.walletList=e,this.initialized&&this.initialize(!0).catch(console.error)}removeAllConnectors(){for(let e of this.walletConnectors)e.removeAllListeners();this.walletConnectors=[]}constructor(e,t,r,i,n,s,a,o,l,c,d,u){super(),this.addSolanaWalletConnector=async e=>{let t=this.findSolanaWalletConnector(e.walletClientType);if(!t||"null"===t.connectorType){if("null"===t?.connectorType){let e=this.walletConnectors.indexOf(t);this.walletConnectors.splice(e,1)}this.addWalletConnector(e)}},this.privyAppId=e,this.walletConnectCloudProjectId=t,this.rpcConfig=r,this.chains=i,this.defaultChain=n,this.walletConnectors=[],this.initialized=!1,this.store=s,this.walletList=a,this.shouldEnforceDefaultChainOnConnect=o,this.externalWalletConfig=l,this.privyAppName=c,this.walletChainType=u||"ethereum-only",this.setBaseAccountSdk=d,this.storedConnections=(0,nu.l)()}}let Pr=(0,o1.create)(()=>({identityToken:null})),Pi=[a2,a5,oF];class Pn{async get(e,t){try{return await this.baseFetch(e,t)}catch(e){throw(0,nd.f)(e)}}async post(e,t,r){try{return await this.baseFetch(e,{method:"POST",...t?{body:t}:{},...r})}catch(e){throw(0,nd.f)(e)}}async delete(e,t){try{return await this.baseFetch(e,{method:"DELETE",...t})}catch(e){throw(0,nd.f)(e)}}constructor({appId:e,appClientId:t,client:r,defaults:i}){this.appId=e,this.appClientId=t,this.clientAnalyticsId=r.clientAnalyticsId,this.sdkVersion=aY.V,this.client=r,this.defaults=i,this.fallbackApiUrl=r.fallbackApiUrl,this.baseFetch=In.ofetch.create({baseURL:this.defaults.baseURL,timeout:this.defaults.timeout,retry:3,retryDelay:500,retryStatusCodes:[408,409,425,500,502,503,504],credentials:"include",onRequest:async({request:e,options:t})=>{let r=new Headers(t.headers);r.set("privy-app-id",this.appId),this.appClientId&&r.set("privy-client-id",this.appClientId),r.set("privy-ca-id",this.clientAnalyticsId||""),r.set("privy-client",`react-auth:${this.sdkVersion}`);let i=Pi.includes(e.toString());if(!r.has("authorization")){let e=await this.client.getAccessToken({disableAutoRefresh:i});null!==e&&r.set("authorization",`Bearer ${e}`)}t.headers=r,t.retryDelay&&"number"==typeof t.retryDelay&&(t.retryDelay=3*t.retryDelay)},onRequestError:({error:e})=>{if(e instanceof DOMException&&"AbortError"===e.name)throw new nd.h}})}}class Ps{getOrCreateGuestCredential(e){let t=(0,aY.g)(e);if((0,nu.b)()){if(nu.s.get(t))return nu.s.get(t);{let e=eL.encode(CI(32));return nu.s.put(t,e),e}}return eL.encode(CI(32))}async authenticate(){if(!this.api)throw new nd.a("Auth flow has no API instance");try{return await this.api.post(oz,{guest_credential:this.meta.guestCredential})}catch(e){throw(0,nd.f)(e)}}async link(){throw Error("Linking is not supported for the guest flow")}constructor(e){this.meta={guestCredential:this.getOrCreateGuestCredential(e)}}}function Pa(){return!(aQ.isSafari&&window.location.origin.startsWith("http://localhost"))}var Po,Pl,Pc,Pd,Pu,Ph,Pp,Pf,Py,Pg,Pm,Pw,Pv,Pb,P_,PE,PI,PA,PS,Pk,PT,PC,Px,PP,PO,PR,PN,PM,PU,PD=((PU={}).PRIVY="privy_access_token",PU.CUSTOMER="customer_access_token",PU);class PL{get token(){return this.privyAccessToken||this.customerAccessToken}getToken(e){return"privy_access_token"===e?this.privyAccessToken:this.customerAccessToken}get customerAccessToken(){return this._getToken(aY.C)}get privyAccessToken(){return this._getToken(aY.P)}_getToken(e){try{let t=nu.s.get(e);return"string"==typeof t?Cr.throwIfNotWellFormedJwt(t):null}catch(e){return console.error(e),this.destroyLocalState(),null}}get refreshToken(){try{let e=nu.s.get(aY.R);return"string"==typeof e?e:null}catch(e){return console.error(e),this.destroyLocalState(),null}}getProviderAccessToken(e){try{let t=nu.s.get((0,aY.e)(e));if("string"!=typeof t)return null;{let r=new Cr(t);return r.isExpired()?(nu.s.del((0,aY.e)(e)),null):r.value}}catch(e){return console.error(e),null}}get mightHaveServerCookies(){try{let e=eW.get(aY.f);return void 0!==e&&e.length>0}catch(e){console.error(e)}return!1}hasRefreshCredentials(e="privy_access_token"){let t="string"==typeof this.getToken(e),r="string"==typeof this.refreshToken&&this.refreshToken!==aY.h;return this.mightHaveServerCookies||t&&r}hasActiveAccessToken(e){let t=Cr.parse(this.getToken(e));return null!==t&&!t.isExpired(30)}authenticate(e){return this.authenticateOnce.execute(e)}link(e){return this.linkOnce.execute(e)}refresh(){return this.refreshOnce.execute()}destroy(){return this.destroyOnce.execute()}storeProviderAccessToken(e,t){"string"==typeof t?nu.s.put((0,aY.e)(e),t):nu.s.del((0,aY.e)(e))}updateIdentityToken(e){"string"==typeof e?this.storeIdentityToken(e):this.clearIdentityToken()}async _authenticate(e){try{let t=await e.authenticate(),{user:r,is_new_user:i,oauth_tokens:n}=t;this.handleTokenResponse(t);let s=n?{provider:n.provider,accessToken:n.access_token,accessTokenExpiresInSeconds:n.access_token_expires_in_seconds,refreshToken:n.refresh_token,refreshTokenExpiresInSeconds:n.refresh_token_expires_in_seconds,scopes:n.scopes}:void 0;return this._trackAuthenticateEvents(e,i),{user:(0,na.l)(r),isNewUser:i,oAuthTokens:s}}catch(e){throw console.warn("Error authenticating session"),(0,nd.i)(e)}}_trackAuthenticateEvents(e,t){let r=e instanceof Cy?"email":e instanceof CN?"sms":e instanceof CO?"siwe":e instanceof Ps?"guest":e instanceof x$?"custom_auth":e instanceof CT?e.meta.provider:null;r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate",payload:{method:r,isNewUser:t}}),"siwe"===r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate_siwe",payload:{connectorType:e.meta.connectorType,walletClientType:e.meta.walletClientType}})}async _link(e){try{let t=await e.link(),r=t.oauth_tokens,i=r?{provider:r.provider,accessToken:r.access_token,accessTokenExpiresInSeconds:r.access_token_expires_in_seconds,refreshToken:r.refresh_token,refreshTokenExpiresInSeconds:r.refresh_token_expires_in_seconds,scopes:r.scopes}:void 0;return{user:(0,na.l)(t),oAuthTokens:i}}catch(e){throw console.warn("Error linking account"),(0,nd.i)(e)}}async _refresh(){if(!this.api)throw new nd.a("Session has no API instance");if(!this.client)throw new nd.a("Session has no PrivyClient instance");await this.client.getAccessToken({disableAutoRefresh:!0});let e=this.token,t=this.refreshToken;if(this.client.useServerCookies&&!this.mightHaveServerCookies&&this.token&&window.location.origin===this.client.apiUrl)return this.destroyLocalState(),null;try{let r;if(!(e&&t||this.mightHaveServerCookies))return null;{let i={};e&&(i.authorization=`Bearer ${e}`),r=await this.api.post(a2,t?{refresh_token:t}:{},{headers:i})}return this.handleTokenResponse(r),(0,na.l)(r.user)}catch(e){if(e instanceof nd.e&&e.privyErrorCode===nd.b.MISSING_OR_INVALID_TOKEN)return console.warn("Unable to refresh tokens - token is missing or no longer valid"),this.destroyLocalState(),null;throw(0,nd.i)(e)}}handleTokenResponse(e){e.session_update_action&&"set"!==e.session_update_action?"clear"===e.session_update_action?this.destroyLocalState():"ignore"===e.session_update_action&&(e.token&&(this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token)),e.identity_token&&this.storeIdentityToken(e.identity_token)):this._storeAllTokens(e)}_storeAllTokens(e){this.storeRefreshToken(e.refresh_token),this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token),e.identity_token&&this.storeIdentityToken(e.identity_token)}async _destroy(){try{await this.api?.post(a5,{refresh_token:this.refreshToken})}catch(e){console.warn("Error destroying session")}this.destroyLocalState()}destroyLocalState(){this.storeRefreshToken(null),this.storeCustomerAccessToken(null),this.storePrivyAccessToken(null),this.clearIdentityToken()}storeCustomerAccessToken(e){if("string"==typeof e){let t=nu.s.get(aY.C);if(nu.s.put(aY.C,e),!this.client?.useServerCookies){let t=Cr.parse(e)?.expiration;eW.set(aY.i,e,{sameSite:"Strict",secure:Pa(),expires:t?new Date(1e3*t):void 0})}t!==e&&this.client?.onStoreCustomerAccessToken?.(e)}else nu.s.del(aY.C),eW.remove(aY.i),this.client?.onDeleteCustomerAccessToken?.()}storeRefreshToken(e){"string"==typeof e?(nu.s.put(aY.R,e),this.client?.useServerCookies||eW.set(aY.f,"t",{sameSite:"Strict",secure:Pa(),expires:30})):(nu.s.del(aY.R),eW.remove(aY.j),eW.remove(aY.f))}storePrivyAccessToken(e){"string"==typeof e?nu.s.put(aY.P,e):nu.s.del(aY.P)}storeIdentityToken(e){if(Pr.setState({identityToken:e}),this.client?.useServerCookies)return;nu.s.put(aY.I,e);let t=Cr.parse(e)?.expiration;eW.set(aY.k,e,{sameSite:"Strict",secure:Pa(),expires:t?new Date(1e3*t):void 0})}clearIdentityToken(){nu.s.del(aY.I),Pr.setState({identityToken:null}),eW.remove(aY.k)}constructor(){this.authenticateOnce=new Cm(async e=>this._authenticate(e)),this.linkOnce=new Cm(async e=>this._link(e)),this.refreshOnce=new Cm(this._refresh.bind(this)),this.destroyOnce=new Cm(this._destroy.bind(this))}}var Pj=0,PW="__private_"+Pj+++"__getOrGenerateClientAnalyticsId";class PB{getAppId(){return this.appId}initializeConnectorManager({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,store:n,walletList:s,shouldEnforceDefaultChainOnConnect:a,externalWalletConfig:o,appName:l,walletChainType:c,setBaseAccountSdk:d}){this.connectors||(this.connectors=new Pt(this.appId,e,t,r,i,n,s,a,o,l,d,c))}generateApi(){let e=new Pn({appId:this.appId,appClientId:this.appClientId,client:this,defaults:{baseURL:this.apiUrl,timeout:this.timeout}});return this.session.api=e,e}updateApiUrl(e){this.apiUrl=e||this.fallbackApiUrl,this.api=this.generateApi(),e&&(this.useServerCookies=!0)}authenticate(){if(!this.authFlow)throw new nd.a("No auth flow in progress.");return this.session.authenticate(this.authFlow)}async link(){if(!this.authFlow)throw new nd.a("No auth flow in progress.");let{oAuthTokens:e}=await this.session.link(this.authFlow);return{user:await this.getAuthenticatedUser(),oAuthTokens:e}}storeProviderAccessToken(e,t){this.session.storeProviderAccessToken(e,t)}getProviderAccessToken(e){return this.session.getProviderAccessToken(e)}async logout(){await this.session.destroy(),this.authFlow=void 0}clearProviderAcccessTokens(e){e.linkedAccounts.filter(e=>"cross_app"===e.type).forEach(e=>{this.storeProviderAccessToken(e.providerApp.id,null)})}startAuthFlow(e){return e.api=this.api,this.authFlow=e,this.authFlow}async initMfaSmsVerification(){try{await this.api.post(oj,{action:"verify"})}catch(e){throw(0,nd.f)(e)}}async initMfaPasskeyVerification(){try{let e,t=await this.api.post(oW,{});return{rpId:(e=t.options).rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}catch(e){throw(0,nd.f)(e)}}async getCrossAppProviderDetails(e){try{return this._cachedProviderAppDetails[e]||(this._cachedProviderAppDetails[e]=await this.api.get(`/api/v1/apps/${e}/cross-app/details`)),this._cachedProviderAppDetails[e]}catch(e){console.error("Error fetching cross app provider details",e)}}async acceptTerms(){try{let e=await this.api.post(oB,{});return(0,na.l)(e)}catch(e){throw(0,nd.i)(e)}}async unlinkEmail(e){try{let t=await this.api.post(of,{address:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async unlinkPhone(e){try{let t=await this.api.post(ov,{phoneNumber:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async unlinkEthereumWallet(e){try{let t=await this.api.post(a9,{address:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async unlinkSolanaWallet(e){try{let t=await this.api.post(oi,{address:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async unlinkOAuth(e,t){try{let r=await this.api.post(ok,{provider:e,subject:t});return await this.getAuthenticatedUser()??(0,na.l)(r)}catch(e){throw(0,nd.i)(e)}}async unlinkFarcaster(e){try{let t=await this.api.post(oc,{fid:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async unlinkTelegram(e){try{let t=await this.api.post(oD,{telegram_user_id:e});return await this.getAuthenticatedUser()??(0,na.l)(t)}catch(e){throw(0,nd.i)(e)}}async revokeDelegatedWallet(){try{await this.api.post(oJ,{})}catch(e){throw(0,nd.i)(e)}}async createAnalyticsEvent({eventName:e,payload:t,timestamp:r,options:i}){if("u">typeof window)try{this.clientAnalyticsId||console.warn("No client analytics id set, refusing to send analytics event"),await this.api.post(oF,{event_name:e,client_id:this.clientAnalyticsId,payload:{...t||{},clientTimestamp:r?r.toISOString():(new Date).toISOString()}},{retry:-1,keepalive:i?.keepAlive??!1})}catch(e){console.log("Unable to submit event. This is not an issue.")}}async signMoonpayOnRampUrl(e){try{return this.api.post(o$,e)}catch(e){throw(0,nd.i)(e)}}async initCoinbaseOnRamp(e){try{return this.api.post(oK,e)}catch(e){throw(0,nd.i)(e)}}async getCoinbaseOnRampStatus({partnerUserId:e}){try{return this.api.get(`${oV}?partnerUserId=${e}`)}catch(e){throw(0,nd.i)(e)}}async getAuthenticatedUser(){return this.session.hasRefreshCredentials()?this.session.refresh():null}async getAccessToken(e){return await this.getPrivyAccessToken(e)||await this.getCustomerAccessToken(e)}async getCustomerAccessToken(e){return await this._getToken(PD.CUSTOMER,e)}async getPrivyAccessToken(e){return await this._getToken(PD.PRIVY,e)}async _getToken(e,t){return this.session.getToken(e)?this.session.hasActiveAccessToken(e)?this.session.hasRefreshCredentials(e)?Ci.parse(this.session.getToken(e))?.appId!==this.appId?(await this.logout(),null):this.session.getToken(e):(this.session.destroyLocalState(),null):!t?.disableAutoRefresh&&this.session.hasRefreshCredentials(e)?(await this.session.refresh(),this.session.getToken(e)):null:null}async getUsdTokenPrice(e){try{return(await this.api.get(`/api/v1/token_price?chainId=${e.id}&tokenSymbol=${e.nativeCurrency.symbol}`)).usd}catch(t){return void console.error(`Unable to fetch token price for chain with id ${e.id}`)}}async getUsdPriceForSol(){try{return(await this.api.get("/api/v1/token_price?chainId=0&tokenSymbol=SOL")).usd}catch(e){return void console.error("Unable to fetch token price for SOL")}}async getSplTokenMetadata({mintAddress:e,cluster:t}){try{return await this.api.get(`/api/v1/spl_token_info?mint_address=${e}&cluster=${t}`)}catch(r){return void console.error(`Unable to fetch token metadata for ${t}:${e}`)}}async requestFarcasterSignerStatus(e){try{return await this.api.post("/api/v1/farcaster/signer/status",{ed25519_public_key:e})}catch(e){throw console.error("Unable to fetch Farcaster signer status"),e}}async generateSiweNonce({address:e,captchaToken:t}){try{return(await this.api.post(a3,{address:e,token:t})).nonce}catch(e){throw(0,nd.i)(e)}}async authenticateWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s}){return await this.api.post(a8,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s})}async linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){return await this.api.post(a4,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n})}async linkSmartWallet({message:e,signature:t,smartWalletType:r,smartWalletVersion:i}){try{let n=await this.api.post(a6,{message:e,signature:t,smart_wallet_type:r,smart_wallet_version:i});return(0,na.l)(n)}catch(e){throw(0,nd.i)(e)}}async linkWithSiwe({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){try{let s=await this.linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n});return(0,na.l)(s)}catch(e){throw(0,nd.i)(e)}}async generateSiwsNonce({address:e,captchaToken:t}){try{return(await this.api.post(oe,{address:e,token:t})).nonce}catch(e){throw(0,nd.i)(e)}}async authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){return await this.api.post(ot,{message:e,signature:t,walletClientType:r,connectorType:i,mode:n,message_type:s})}async authenticateWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){let a=await this.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s});this.session.handleTokenResponse(a);let o=(0,na.l)(a.user);if(!o)throw Error("Authentication failed - no user returned");return{user:o,isNewUser:a.is_new_user||!1}}async sendAccountTransferRequest({nonce:e,account:t,accountType:r,externalWalletMetadata:i,telegramAuthResult:n,telegramWebAppData:s,farcasterEmbeddedAddress:a,oAuthUserInfo:o}){try{let l,c;switch(r){case"email":l=og,c={nonce:e,email:t};break;case"sms":l=oE,c={nonce:e,phoneNumber:t};break;case"siwe":if(l=a7,!i)throw Error("Wallet parameters must be defined");c={nonce:e,address:t,...i};break;case"farcaster":l=od,c={nonce:e,farcaster_id:t,farcaster_embedded_address:a};break;case"telegram":l=oL,c={nonce:e,telegram_auth_result:n,telegram_web_app_data:s};break;case"siws":l=on,c={nonce:e,address:t,...i};break;case"custom":case"guest":case"passkey":throw Error("Invalid transfer account type");default:l=oT,c={nonce:e,userInfo:o}}let d=await this.api.post(l,c);return await this.getAuthenticatedUser()??(0,na.l)(d)}catch(e){throw(0,nd.i)(e)}}async linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){return await this.api.post(or,{message:e,signature:t,walletClientType:r,connectorType:i,message_type:n})}async linkWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){try{let s=await this.linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n});return(0,na.l)(s)}catch(e){throw(0,nd.i)(e)}}async updateUserAndIdToken(){try{let e=await this.api.get(oG);return this.session.updateIdentityToken(e.identity_token),(0,na.l)(e.user)}catch(e){throw(0,nd.i)(e)}}async scanTransaction(e){try{return await this.api.post(oZ,e)}catch(e){throw(0,nd.i)(e)}}constructor({apiUrl:e=aY.D,appId:t,appClientId:r,timeout:i=aY.l}){Object.defineProperty(this,PW,{value:PF}),this._cachedProviderAppDetails={},this.apiUrl=e,this.fallbackApiUrl=this.apiUrl,this.useServerCookies=e!==aY.D&&e.startsWith("https://privy."),this.timeout=i,this.appId=t,this.appClientId=r,this.clientAnalyticsId=(function(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e})(this,PW)[PW](),u||(u=new PL),this.session=u,this.api=this.generateApi(),this.session.client=this}}function PF(){if("u"<typeof window)return null;try{let e=nu.s.get(aY.d);if("string"==typeof e&&e.length>0)return e}catch(e){}let e=eC();try{return nu.s.put(aY.d,e),e}catch(t){return e}}function Pq(){if(!h)throw new nd.a("No global PrivyClient instance found. Please ensure you have initialized the PrivyProvider.");return h}let PH=({config:e,...t})=>{(()=>{if((0,W.useContext)(xX))throw new nd.a("Multiple PrivyProvider instances found","Found multiple instances of PrivyProvider, ensure there is only one mounted in your application tree.")})(),function(){if("u"<typeof window)return;let e=["localhost","127.0.0.1"].includes(window.location.hostname),t="https:"===window.location.protocol||"chrome-extension:"===window.location.protocol;if(!e&&!t)throw new nd.a("Embedded wallet is only available over HTTPS")}(),function(e){if("string"!=typeof e||25!==e.length)throw new nd.a("Cannot initialize the Privy provider with an invalid Privy app ID")}(t.appId),h||(h=new PB({appId:t.appId,appClientId:t.clientId,apiUrl:t.apiUrl}));let r=(0,W.useMemo)(()=>new rd({appId:t.appId,clientId:t.clientId,storage:nu.s,baseUrl:t.apiUrl,sdkVersion:"react-auth:3.14.1"}),[]),i=Pq(),n=Object.assign({},e);return(0,j.jsx)(aY.m,{client:r,legacyClient:i,appClientId:t.clientId,clientConfig:n,children:(0,j.jsx)(It.P,{configPlugins:e?.plugins,children:(0,j.jsx)(x0,{...t,client:i,privy:r})})})};function Pz(){let{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}=(0,W.useContext)(na.P);return{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}}function P$(){let{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenroll:a,enrollInMfa:o}=(0,W.useContext)(na.P);return{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenrollWithSms:()=>a("sms"),unenrollWithTotp:()=>a("totp"),unenrollWithPasskey:e=>a("passkey",e),showMfaEnrollmentModal:()=>o(!0),closeMfaEnrollmentModal:()=>o(!1)}}Symbol("cross-tab-user-sync-plugin"),e.s(["A",()=>xD,"B",()=>x5,"C",()=>CD,"D",()=>Cs,"E",()=>Ca,"F",()=>xO,"G",()=>x3,"H",()=>Cn,"I",()=>PH,"P",()=>xs,"R",()=>Cm,"S",()=>CR,"W",()=>xi,"a",()=>Cj,"b",()=>CO,"c",()=>xR,"d",()=>P$,"e",()=>xo,"f",()=>xh,"g",()=>xd,"h",()=>xc,"i",()=>xp,"j",()=>xu,"k",()=>xJ,"l",()=>CC,"m",()=>CB,"n",()=>xl,"o",()=>CA,"p",()=>xB,"q",()=>CS,"r",()=>Ck,"s",()=>xK,"t",()=>xW,"u",()=>Pz,"v",()=>xZ,"w",()=>xP,"x",()=>xL,"y",()=>xM,"z",()=>Cd],384249)}]);